% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

Here we go. Office hours begin today.

\subsection{Classification of CM Abelian Varieties}
Here is our definition. The point is that we would like to ``recover'' the complex multiplication of a field of CM type acting on a CM abelian variety.
\begin{definition}[CM type]
	Fix a CM field $E$, and let $(A,i)$ be an abelian variety with complex multiplication by $E$ by $i\colon E\to\op{End}^0(A)$. Then $E$ acts faithfully on $H_1(A(\CC),\QQ)$. Hodge theory tells us that we can decompose
	\[H^1(A(\CC),\CC)=H^{01}\oplus H^{10},\]
	where $H^{10}=\ov{H^{01}}$; here $H^{01}=H^0(A(\CC),\Omega^1)$ is the space of global sections $1$-forms on $A(\CC)$. Dualizing, we see
	\[H_1(A(\CC),\CC)=\op{Lie}A(\CC)\oplus\ov{\op{Lie}A(\CC)},\]
	and in fact $E$ acts on $\op{Lie}A(\CC)$. Decomposing $\op{Lie}A(\CC)$ as an $E$-representation as $\bigoplus_{\varphi\in\Phi}\CC_\varphi$ where $\Phi\subseteq\op{Hom}(E,\CC)$. (This decomposes into $1$-dimensional representations because $E^\times$ is commutative.) Then $\Phi$ is the CM type.
\end{definition}
\begin{remark} \label{rem:get-cm-type}
	The point of using the Hodge decomposition is to note that $\op{Hom}(E,\CC)=\Phi\sqcup\ov\Phi$ by taking the conjugation of the action. Thus, $(E,\Phi)$ is fact a CM type. Namely, we have a faithful action of $E\otimes_\QQ\CC$ on $H_1(A(\CC),\QQ)\otimes_\QQ\CC=H_1(A(\CC),\CC)$, and it decomposes into parts coming from $\op{Lie}A(\CC)$ and parts coming from $\ov{\op{Lie}(A(\CC))}$. Irreducible components in $\op{Lie}A(\CC)$ are $\bigoplus_{\varphi\in\Phi}\CC_\varphi$, and irreducible components in $\ov{\op{Lie}(A(\CC))}$ are then $\bigoplus_{\varphi\in\Phi}\CC_{c\varphi}$, and in total everything must sum up to a faithful module over $E\otimes_\QQ\CC=\bigoplus_{\varphi\in\op{Hom}(E,\CC)}\CC_\varphi$ of rank $1$, so we see $\Phi\sqcup c\Phi=\op{Hom}(E,\CC)$, as needed.
\end{remark}
\begin{example} \label{ex:calculate-cm-type}
	Fix a CM type $(E,\Phi)$, and set $A\coloneqq\CC^\Phi/\OO_E$. Then we claim that the CM type of $A$ can be recovered as $\Phi$. Namely, we certainly have an $\mathcal O_E$-action on $A$ by construction, so we have an embedding $i\colon E\into\op{End}^0(A)$ by $i(\alpha)(v_\varphi)_\varphi\coloneqq(\varphi(\alpha)v_\varphi)_\varphi$. As such, we see that the faithful action of $E$ on the universal cover $\CC^\Phi=H_1(A(\CC),\CC)$ is exactly given by
	\[\CC^\Phi=\bigoplus_{\varphi\in\Phi}\CC_\varphi,\]
	as needed.
\end{example}
We are going to classify isogeny and isomorphism classes of these abelian varieties. The following definition will be useful.
\begin{definition}
	Fix CM types $(E,\Phi)$ and $(E',\Phi')$. An \textit{isomorphism of CM types} is an isomorphism $\alpha\colon E\to E'$ such that
	\[\Phi=\{\varphi'\circ\alpha:\varphi'\in\Phi'\}.\]
\end{definition}
Here is the point of this definition.
\begin{proposition} \label{prop:classify-cm-ab-isog}
	Fix a CM algebra $E$. Then the set of pairs $(A,i)$ of abelian varieties with complex multiplication by $i$ (up to isogeny commuting with $i$) is in bijection with CM types $(E,\Phi)$ up to isomorphism.
\end{proposition}
\begin{proof}
	Here, an isogeny $\varphi\colon(A,i)\to(A',i')$ commuting with the complex multiplication is simply an isogeny $\varphi\colon A\to A'$ together with an automorphism $\alpha\colon E\to E$ such that the diagram
	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJFIl0sWzEsMCwiXFxvcHtFbmR9XjAoQSkiXSxbMSwxLCJcXG9we0VuZH1eMChBJykiXSxbMCwxLCJFIl0sWzEsMiwiXFx2YXJwaGkiXSxbMCwzLCJcXGFscGhhIiwyXSxbMCwxLCJpIl0sWzMsMiwiaSciXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\begin{equation}
		\begin{tikzcd}
			E & {\op{End}^0(A)} \\
			E & {\op{End}^0(A')}
			\arrow["\varphi", from=1-2, to=2-2]
			\arrow["\alpha"', from=1-1, to=2-1]
			\arrow["i", from=1-1, to=1-2]
			\arrow["{i'}", from=2-1, to=2-2]
		\end{tikzcd} \label{eq:cm-av-isog}
	\end{equation}
	commutes.

	We now show that $(A,i)\mapsto(E,\Phi_A)$ (where $\Phi_A$ is the CM type of $A$) and $(E,\Phi)\mapsto\CC^\Phi/\OO_E$ are the needed forward and backward maps for our bijection.
	\begin{itemize}
		\item We claim that the construction of $(E,\Phi)\mapsto\CC^\Phi/\OO_E$ is well-defined. Well, suppose we have an isomorphism of CM types $\alpha\colon(E,\Phi)\to(E,\Phi')$. Then we get a commutative diagram as follows.
		% https://q.uiver.app/#q=WzAsNixbMCwwLCJcXENDXlxcUGhpIl0sWzEsMSwiRSJdLFsyLDEsIkUnIl0sWzMsMSwiXFxPT19FIl0sWzAsMSwiXFxPT19FIl0sWzMsMCwiXFxDQ157XFxQaGknfSJdLFsxLDIsIlxcYWxwaGEiXSxbNCwxXSxbMywyXSxbNCwwLCJcXFBoaSJdLFszLDUsIlxcUGhpJyIsMl0sWzAsNSwiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{\CC^\Phi} &&& {\CC^{\Phi'}} \\
			{\OO_E} & E & {E'} & {\OO_E}
			\arrow["\alpha", from=2-2, to=2-3]
			\arrow[from=2-1, to=2-2]
			\arrow[from=2-4, to=2-3]
			\arrow["\Phi", from=2-1, to=1-1]
			\arrow["{\Phi'}"', from=2-4, to=1-4]
			\arrow[dashed, from=1-1, to=1-4]
		\end{tikzcd}\]
		Note that the bottom row becomes an isomorphism $\OO_E\to\OO_E$ because $\alpha$ and $\alpha^{-1}$ must carry algebraic integers to algebraic integers; this isomorphism on the bottom then extends to an isomorphism on the top because $\OO_E$ is a full-rank lattice of our $\CC$-vector spaces. In total, we produce an isomorphism of vector spaces $\CC^\Phi\to\CC^{\Phi'}$ carrying $\OO_E$ to $\OO_{E}$, which provides an isogeny $\varphi\colon\CC^\Phi/\OO_E\to\CC^{\Phi'}/\OO_E$ by \Cref{rem:iso-to-isog}.

		It remains to show that this isogeny $\varphi$ produces an isogeny preserving the complex multiplication. Well, it is enough to note that the following diagram commutes.
		% https://q.uiver.app/#q=WzAsOCxbMCwwLCJFIl0sWzAsMSwiRSJdLFsxLDAsIlxcb3B7RW5kfV4wXFxiaWcoXFxDQ15cXFBoaS9cXE9PX0VcXGJpZykiXSxbMSwxLCJcXG9we0VuZH1eMFxcYmlnKFxcQ0Nee1xcUGhpJ30vXFxPT19FXFxiaWcpIl0sWzIsMCwieCJdLFszLDAsIlxcYmlnKCh2X1xcdmFycGhpKVxcbWFwc3RvKFxcdmFycGhpKHgpdl9cXHZhcnBoaSlcXGJpZykiXSxbMiwxLCJcXGFscGhhIHgiXSxbMywxLCJcXGJpZygodl9cXHZhcnBoaSlcXG1hcHN0byhcXHZhcnBoaShcXGFscGhhIHgpdl9cXHZhcnBoaSlcXGJpZykiXSxbMCwxLCJcXGFscGhhIiwyXSxbMCwyXSxbMSwzXSxbMiwzLCJcXHZhcnBoaSJdLFs0LDYsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XSxbNiw3LCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtYXBzIHRvIn19fV0sWzUsNywiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibWFwcyB0byJ9fX1dLFs0LDUsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			E & {\op{End}^0\big(\CC^\Phi/\OO_E\big)} & x & {\big((v_\varphi)\mapsto(\varphi(x)v_\varphi)\big)} \\
			E & {\op{End}^0\big(\CC^{\Phi'}/\OO_E\big)} & {\alpha x} & {\big((v_\varphi)\mapsto(\varphi(\alpha x)v_\varphi)\big)}
			\arrow["\alpha"', from=1-1, to=2-1]
			\arrow[from=1-1, to=1-2]
			\arrow[from=2-1, to=2-2]
			\arrow["\varphi", from=1-2, to=2-2]
			\arrow[maps to, from=1-3, to=2-3]
			\arrow[maps to, from=2-3, to=2-4]
			\arrow[maps to, from=1-4, to=2-4]
			\arrow[maps to, from=1-3, to=1-4]
		\end{tikzcd}\]

		\item \Cref{rem:get-cm-type} tells us that each $(A,i)$ at least produces some CM type $(E,\Phi_A)$. We show that this is well-defined: let $\varphi\colon(A,i)\to(A',i')$ be an isogeny (with automorphism $\alpha\colon E\to E$), and we will show that we produce an isomorphism $\alpha\colon(E,\Phi_A)\to(E,\Phi_{A'})$ of CM types.

		Set $V\coloneqq\op{Lie}A(\CC)$ and $V'\coloneqq\op{Lie}A'(\CC)$, and recall that we have canonical isomorphisms $A=V/\Lambda$ and $A'=V'/\Lambda'$. By definition, $\Phi_A$ is the subset of $\op{Hom}(E,\CC)$ so that $V=\bigoplus_{\varphi\in\Phi_A}\CC_\varphi$ under the $E$-action, and $\Phi_{A'}$ is defined similarly. Now, \Cref{prop:map-of-complex-torus} argues that the isogeny $\varphi\colon A\to A'$ lifts to an isomorphism of vector spaces $\widetilde\varphi\colon V\to V'$, and any element of $\op{End}^0(A)$ or $\op{End}^0(A')$ will also lift to an isomorphism of vector spaces. In particular, we produce a commutative diagram as follows.
		% https://q.uiver.app/#q=WzAsNCxbMCwwLCJFIl0sWzEsMCwiXFxvcHtFbmR9X1xcQ0MoVikiXSxbMSwxLCJcXG9we0VuZH1fXFxDQyhWKSJdLFswLDEsIkUiXSxbMCwzLCJcXGFscGhhIiwyXSxbMSwyLCJcXHdpZGV0aWxkZVxcdmFycGhpIl0sWzAsMSwiaSJdLFszLDIsImknIl1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			E & {\op{End}_\CC(V)} \\
			E & {\op{End}_\CC(V')}
			\arrow["\alpha"', from=1-1, to=2-1]
			\arrow["\widetilde\varphi", from=1-2, to=2-2]
			\arrow["i", from=1-1, to=1-2]
			\arrow["{i'}", from=2-1, to=2-2]
		\end{tikzcd}\]
		Thus, $V$ is isomorphic to $V'$ as an $E$-representation, and the decomposition $V\cong\bigoplus_{\varphi\in\Phi}\CC_\varphi$ then forces $V'$ to have a factor of $\CC_{\varphi\circ\alpha^{-1}}$ for each $\varphi\in\Phi$, so we conclude that $\alpha\colon(E,\Phi_A)\to(E,\Phi_{A'})$ is in fact an isomorphism of CM types.

		\item For one inverse check, note that taking $(E,\Phi)$ to $A\coloneqq\CC^\Phi/\OO_E$ has as its CM type just $(E,\Phi)$ back again by \Cref{ex:calculate-cm-type}.

		\item For the other inverse check, we describe all $(A,i)$ with CM type $(E,\Phi)$. In particular, we need to show that $(A,i)$ is isogenous to $\CC^\Phi/\OO_E$. Set $V\coloneqq\op{Lie}(A(\CC))$, and recall that $A=V/\Lambda$ for some lattice $\Lambda\subseteq\op{Lie}A$ of full rank; however, having CM type $\Phi$ implies that we can just view $\op{Lie}A$ as $\CC^\Phi$, so $A=\CC^\Phi/\Lambda$ for a lattice $\Lambda$.

		Now, $E$ must have an action on $\Lambda\otimes_\ZZ\QQ$. Fixing a nonzero vector $v$, we see that its orbit by $E$ will be all of $\Lambda\otimes_\ZZ\QQ$; now, having a lattice $\Lambda\subseteq E$ implies that $\Lambda$ and $\OO_E$ are commensurable, which establishes an isogeny with $\OO_E/\Lambda$, as needed.\todo{}
	\end{itemize}
	We won't bother to check that these functors are inverses of each other.
\end{proof}
\begin{remark}
	We will eventually discuss the moduli space $\mc A_g$ of principally polarized $g$-dimensional abelian varieties. Then one can require that $\op{End}(A)$ contains $\OO_E$ for some CM field $E$ as well as $[E:\QQ]=2\dim A$, and this will make finitely many points. (In fact, we produce a Shimura variety of PEL type by adding in $\Phi$, which corresponds to a signature.) Dropping the condition that $[E:\QQ]=2\dim A$ could still desire a positive-dimensional subset of $\mc A_g$; in particular, we cannot expect that ``just'' (finite) combinatorics will be able to parameterize such abelian varieties.
\end{remark}
\begin{remark} \label{rem:fully-classify-cm-ab}
	We continue with a classification of the $(A,i)$ with CM type $(E,\Phi)$. Letting $\OO\subseteq E$ be the largest subring such that $\OO\cdot\Lambda\subseteq\Lambda$, it turns out that $\op{End}(A)=\OO$ by \Cref{prop:map-of-complex-torus}. Thus, $\Lambda$ is an $\mathcal O$-fractional ideal.
\end{remark}
\begin{corollary}
	Fix a CM algebra $E$ and an order $\OO\subseteq E$. Then the isomorphism classes of CM abelian varieties $(A,i)$ with complex multiplication by $\OO\subseteq E$ (namely, such that $i\colon\OO\to\op{End}(A)$) is in bijection with equivalence classes of triples $(E,\Phi,\mf a)$ where $\Phi$ is a CM type of $E$, and $\mf a\subseteq\OO$ is a fractional ideal. The equivalence class of triples is given by $(E,\Phi,\mf a)\sim(E,\Phi',\mf a)$ if and only if there is an isomorphism $\alpha\colon E\to E$ carrying $\Phi$ to $\Phi'=\Phi\circ\alpha$ and $\alpha(\mf a)=c\mf a'$ for some $c\in E^\times$.
\end{corollary}
\begin{proof}
	Use the functors of \Cref{prop:classify-cm-ab-isog}, but now we use \Cref{rem:fully-classify-cm-ab} at the end of the proof.
\end{proof}
\begin{example}
	With $\OO=\OO_E$, we see that our abelian varieties are now in bijection with $\op{Cl}_E$.
\end{example}
\begin{remark}
	Later in life, we will want to add a polarization to results such as \Cref{prop:classify-cm-ab-isog}. Additionally, we are somehow studying ``geometric points'' in the moduli space; there is a separate question of asking over what fields these points in the moduli space can be found over.
\end{remark}

\subsection{Classifying Simple CM Abelian Varieties}
We would like to upgrade \Cref{prop:classify-cm-ab-isog} to restrict to simple abelian varieties. This requires the notion of a ``primitive'' CM type.
\begin{defihelper}[restriction, extension of CM types] \nirindex{restriction} \nirindex{extension}
	Fix an extension $E_0\subseteq E$ of CM algebras.
	\begin{itemize}
		\item Given a CM type $\Phi_0$ on $E_0$, we define its \textit{extension} to $E$ as
		\[\Phi\coloneqq\{\varphi\in\op{Hom}(E,\CC):\varphi|_{E_0}\in\Phi_0\}.\]
		\item Suppose $(E,\Phi)$ is a CM type which is an extension of a CM type $(E_0,\Phi_0)$. Then we can recover the \textit{restriction} to $E_0$ as
		\[\Phi|_{E_0}\coloneqq\{\varphi|_{E_0}:\varphi\in\Phi\}.\]
	\end{itemize}
\end{defihelper}
\begin{remark}
	In fact, $\Phi|_{E_0}$ will succeed in being a CM type if and only if it is an extension. This explains the hypothesis in the definition.
\end{remark}
\begin{definition}[primitive]
	Fix a CM algebra $E$. A CM type $\Phi$ on $E$ is \textit{primitive} if and only if $\Phi$ is not the extension of any CM type $(E_0,\Phi_0)$ for $E_0\subseteq E$.
\end{definition}
Here is a quick sanity check.
\begin{lemma}
	Fix a CM type $(E,\Phi)$, where $E$ is a field. Then there is a unique primitive CM type $(E_0,\Phi_0)$ extending to $(E,\Phi)$.
\end{lemma}
\begin{proof}
	Omitted. The reference is \cite[Proposition~1.9]{milne-cm}. Basically, one may assume that $E$ is Galois, and then one can restrict downwards via some kind of fixed field.
\end{proof}
And here is our result.
\begin{restatable}{proposition}{simplecmclassification}
	Fix a CM field $E$. Then there is a bijection between simple abelian varieties $A$ with complex multiplication by $E$ (up to isogeny) and primitive CM types $(E,\Phi)$ up to isomorphism.
\end{restatable}
We will prove this next class.

\end{document}