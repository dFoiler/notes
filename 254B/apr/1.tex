% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

We now return to discussing complex multiplication.

\subsection{N\'eron Models}
We will not discuss constructions too much, but we will say something. For today, $R$ is a discrete valuation ring with fraction field $K$ and residue field $\kappa$. Here is our definition.
\begin{defihelper}[N\'eron model]
	Fix a discrete valuation ring $(R,\mf m,\kappa)$ with fraction field $K$. Then a \textit{N\'eron model} of some $K$-scheme $A$ such that $\mc A$ is a smooth separated $R$-scheme of finite type satisfying the following.
	\begin{itemize}
		\item $\mc A_K=A$
		\item N\'eron mapping property: if $\mc X$ is a smooth $R$-scheme with $X\coloneqq\mc X_K$, then any map $u\colon X\to U$ is the base-change of a unique map $\mc X\to\mc A$.
	\end{itemize}
\end{defihelper}
\begin{remark}
	The N\'eron mapping property immediately implies uniqueness up to unique isomorphism.
\end{remark}
\begin{remark}
	Additionally, the universal property implies that formation of N\'eron models commutes with \'etale base-change. Namely, if $\Spec R'\to\Spec R$ is \'etale, then $\mc A_{R'}$ continues to be smooth over $R'$, and drawing out the Cartesian square
\end{remark}
Here is our result.
\begin{proposition}
	Fix a discrete valuation ring $(R,\mf m,\kappa)$ with fraction field $K$. If $\mc A$ is an abelian $R$-scheme, then $\mc A$ is a N\'eron model of $\mc A_K$.\todo{Group structure upgrades?}
\end{proposition}
\begin{proof}
	The point is to use the valuative criterion of properness. Let $\mc X$ be a smooth $R$-scheme, and set $X\coloneqq\mc X_K$. To apply the valuative criterion for properness, we let $\eta$ be the generic point of $\mc X_\kappa$, so $\OO_{\mc X,\eta}$ is a discrete valuation ring. Thus, the map $\op{Frac}\OO_{\mc X,\eta}\to A$ produces a unique lift $\Spec\OO_{\mc X,\eta}to\mc A$. (Note the valuative criterion is legal because everything in sight is finite type.)

	Continuing, by spreading out, we note that we get an $R$-scheme $\mc Y\subseteq\mc X$ such that $\mc Y_K=X$ and $\mc Y_\kappa\subseteq\mc X_\kappa$ is open, and we have our unique map $\mc Y\to\mc A$. However, $\mc X\setminus\mc Y$ can be taken to be codimension at least $2$ (in the spreading out) because we are including the generic point.\todo{Why?} Now, \cite[Theorem~4.4.1]{blr-neron} tells us that the group structure (and smoothness) of $\mc A$ tells us that the rational map $\mc Y\to\mc A$ can be uniquely extended to all $\mc X$. Here is the precise citation.
	\begin{proposition}
		Fix a discrete valuation ring $R$, and let $G$ be a smooth separated group $R$-scheme such that we have some rational map $f\colon Z\to G$ where $Z$ is smooth, and $f$ is defined outside a set of codimension at least $2$. Then $f$ extends uniquely to a map $Z\to G$.
	\end{proposition}
	\begin{proof}
		To use the group structure, we define the rational map $F\colon Z\times_RZ\to G$ given by
		\[F(x,y)\coloneqq f(x)f(y)^{-1}.\]
		Then $f$ being defined at $x$ means that $F$ is defined at the element $(x,x)$; in fact, the converse is also true: $F$ being defined on $(x,x)$ means we can define it an open neighborhood $(x,U)$, and then we can shrink $U$ so that $f$ is also defined on $U$, so one can write $f(x)=F(x,u)f(u)$ for $u\in U$ to promise that $f$ is defined at $x$.
		
		From here, we see that $f$ is defined in codimension $1$, so $F$ is defined codimension $1$, so an argument with algebraic Hartog's lemma tells us that $F$ can just be defined globally, so $f$ can be defined globally. To be more explicit, we note that $F$ is defined at some $(x,x)$ provided that the map $\OO_{G,e}\to K(Z\times Z)$ factors through $\OO_{Z\times Z,(x,x)}$, where the application of algebraic Hartog's is valid because we can now to pass to a sufficiently small open (affine) open neighborhood of $(x,x)$ going to $e\in G$. (Namely, this factoring happens in codimension $1$, so our elements are actually in the ring, so we are okay.)
	\end{proof}
	This completes the proof.
\end{proof}
\begin{corollary}
	Fix abelian schemes $\mc A$ and $\mc B$ over the discrete valuation ring $(R,\mf m,\kappa)$ with fraction field $K$. Then the map
	\[\op{Hom}_R(\mc A,\mc B)\to\op{Hom}_K(\mc A_K,\mc B_K)\]
	is an isomorphism.
\end{corollary}
\begin{proof}
	Examining the squares to be a homomorphism and using the N\'eron model property tells us that the backward map is well-defined both as a morphism and in fact a homomorphism. (Namely, squares commuting can be encoded in uniqueness of our morphisms.)
\end{proof}
We now state our theorem for existence, but we will not prove it.
\begin{theorem}
	Fix a discrete valuation ring $(R,\mf m,\kappa)$ with fraction field $K$. Then any abelian $K$-variety $A$ has a N\'eron model $\mc A$. In fact, $\mc A$ is a smooth group scheme, and there is a finite extension $L$ of $K$ such that $\mc A_L$ has semi-abelian identity component.
\end{theorem}

\subsection{The Shimura--Taniyama Formula}
We now return to prove (a special case of) the Shimura--Taniyama formula.
\begin{theorem}
	Fix a number field $K$, and let $A$ be an abelian $K$-variety with complex multiplication by the CM algebra $(E,\Phi)$. Further, we take the following extra assumptions.
	\begin{itemize}
		\item $K$ contains the Galois closure of $E$.
		\item $A$ has good reduction at some prime $\mf P$ of $K$, meaning that $\mc A$ is an abelian scheme.
		\item $K_\mf P$ is unramified over $\QQ_p$ where $p$. Set $\kappa\coloneqq\OO_K/\mf P$.
		\item $\op{End}(A)\cap E=\OO_E$.
	\end{itemize}
	Then there is $\pi\in\OO_E$ such that the reduction of $\pi$ from $\OO_E\subseteq\op{End}A=\op{End}\mc A$ to $\op{End}\mc A_\kappa$ is $\op{Frob}$.
\end{theorem}
\begin{proof}
	% We omit the check that $\op{End}(A)\cap E=\OO_E$. Do note one inclusion holds because any $\varphi\in\op{End}(A)$ is the root of some monic polynomial by \Cref{thm:tate-mod-faithful} because this is true on the level of the Tate module. For the other inclusion, note that any $\varphi\in\OO_E$ is defined over $K$ by \Cref{prop:endo-over-reflex-field}\todo{}
	Quickly, we note that the reduction map
	\[\op{End}\mc A\to\op{End}\mc A_\kappa\]
	is injective. It will help to have the following lemma.
	\begin{lemma}
		Fix everything as above, and let $m$ be an integer coprime to $p$. Then
		\[A(\ov K)[m]=A(K_\mf P^{\mathrm{unr}})[m]=\mc A_\kappa(\ov\kappa)[m].\]
	\end{lemma}
	\begin{proof}
		This only uses that $A$ has good reduction. The second equality is not so bad because $A(K_\mf P^{\mathrm{unr}})=\mc A(\OO_{K_\mf P^{\mathrm{unr}}})$ by the N\'eron mapping property (even as groups), which then reduces to $\mc A_\kappa(\ov\kappa)$. But we are looking at kernels of $[m]$, which is finite \'etale, so Hensel's lemma applies to provide that reduction is a bijection.
		
		We now address the first equality. The cardinality of $A(K_\mf P^{\mathrm{unr}})[m]$ is the correct number $m^{2\dim A}$, so all torsion from $\ov{K_\mf P}$ is defined over $K_\mf P^{\mathrm{unr}}$. In fact, all this torsion must be defined over the smaller algebraically closed field $\ov K$, so the first equality follows as well.
	\end{proof}
	In particular, we see that making $m$ a prime-power tells us that
	\[T_\ell A=T_\ell\mc A_\kappa,\]
	where we have compatibility with Galois action, where the Galois action by $\op{Gal}(\ov K/K)$ on the right is via the decomposition group. So \Cref{thm:tate-mod-faithful} does the job.

	We will complete the proof next class.
\end{proof}
\begin{remark}
	The bulleted assumptions can essentially be removed, but we will not do so.
\end{remark}
\begin{remark}
	In fact, one can show that there is an explicit formula of $(\pi)\subseteq\OO_E$, which we will show next class.
\end{remark}

\end{document}