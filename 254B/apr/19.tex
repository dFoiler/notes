% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

Today we go back to the main theorem of complex multiplication.

\subsection{A Little Dieudonn\'e Theory}
Recall that the proof of \Cref{thm:div-alg-of-simple-av-fq} avoided the computation in the case where $v\mid p$. Quickly, let's recall our set-up: let $A$ be a simple abelian $k$-variety (where $k$ is perfect), and set $D\coloneqq\op{End}^0(A)$.

We might be interested in the ``$p$-divisible group'' $A\left[p^\infty\right]$, which is the inductive system of groups $A\left[p^n\right]$ equipped with the embeddings $A\left[p^n\right]\subseteq A\left[p^{n+1}\right]$. Here is our precise definition.
\begin{defihelper}[$p$-divisible group] \nirindex{p-divisible group@$p$-divisible group}
	Fix a prime $p$ and an integer $h$. A \textit{$p$-divisible group} is a system of finite group schemes $\{X_n\}_{n\in\NN}$ of order $p^{nh}$ equipped with closed embeddings $\iota_n\colon X_n\into X){n+1}$ such that $[p]\colon X_{n+1}\to X_n$ factors through $[p]$ as $[p]=\pi_n\circ\iota_{n-1}$, and $\pi_n$ is faithfully flat.
\end{defihelper}
Do note that we can forget about being faithfully flat if we work over a field.

We now note that Tate's theorem extends to this setting.
\begin{theorem}
	Fix abelian $\FF_q$-varieties $A$ and $B$. Then the restriction map
	\[\op{Hom}(A,B)\otimes\ZZ_p\to\op{Hom}(A[p^\infty],B[p^\infty])\]
	is an isomorphism.
\end{theorem}
One concern here is that $A\left[p^\infty\right]$ does not immediately look like it has any attached linear algebra. Let's remedy this, which is the point of Dieudonn\'e theory; see \cite[Appendix~A.1]{chai-cm-lifting} for more details.
\begin{theorem}[Dieudonn\'e]
	Fix a perfect field $k$ of characteristic $p>0$, and let $W(k)$ be the Witt ring. Then there is an anti-equivalence of categories sending a $p$-divisible group to Dieudonn\'e modules, which are free $W(k)$-modules of finite rank with specified action by two endomorphisms $F$ and $V$ satisfying some explicit relations. Explicitly, let $\sigma\colon W(k)\to W(k)$ be the lift of the Frobenius map $k\to k$, and then we require $F$ to be $\sigma$-linear, $V$ to be $\sigma^{-1}$-linear, and $FV=VF=p$. We label this functor as taking the $p$-divisible group $G$ to the Dieudonn\'e module $\mathbb D(G)$.
\end{theorem}
Here, $F$ is intended to be a ``Frobenius.''
In our context, we expect $\op{Frob}_A\colon A\to A^{(1)}$, which then will descend to a map on the $p$-divisible group $A\left[p^\infty\right]$. Then we know that $\op{Frob}_A$ factors through $[p]$ via map $V\colon A^{(1)}\to A$ we call the ``Verschiebung.''
\begin{remark}
	If we want to consider isogeny classes, then we end up inverting $p$ in our $\op{Hom}$s, so the conditions $FV=VF=p$ end up fully specifying $V$; for example, this condition implies that $V$ is $\sigma^{-1}$-linear by the linearity of the condition $FV=p$.
\end{remark}
As one might expect, our equivalence of categories sends a $p$-divisible group $\{X_n\}_{n\in\NN}$ basically to its crystalline cohomology, in analogy with the Tate module being \'etale cohomology.

\subsection{Loose End of Honda--Tate Theory}
We now return to the setting of \Cref{thm:div-alg-of-simple-av-fq}. Recall that we have $K\coloneqq\QQ(\pi)$ equal to $Z(D)$, where $D\coloneqq\op{End}^0(A)$. Also, set $W\coloneqq W(\FF_q)$ for brevity. Now, the equivalence of our categories tells us that
\[D\otimes_\QQ\QQ_p=(\op{End}\mathbb D(A[p^\infty]))\opp\otimes W[1/p],\]
so the decomposition $K\otimes_\QQ\QQ_p=\prod_{v\mid p}K_v$ gives rise to a decomposition
\[A[p^\infty]\sim\prod_{v\mid p}G_v\]
in the isogeny category of $p$-divisible groups. As such, we get a decomposition of $\mathbb D(A[p^\infty])$ as
\[\mathbb D(A[p^\infty])\otimes_WW[1/p]=\bigoplus_{v\mid p}\mathbb D(G_v)\otimes_WW[1/p].\]
We now set $D_v\coloneqq D\otimes_KK_v$ to be the $v$-component, which is going to be the endomorphism algebra $(\op{End}\mathbb D(G_v))\opp\otimes_WW[1/p]$. (Here, endomorphism means that we are taking a $W[1/p]$-linear map compatible with the action by Frobenius.)

There is some way to track through the Frobenius action on everything. Approximately speaking, if $g(t)$ is the minimal polynomial for $\pi_A$, then a factorization $g=\prod_{v\mid p}g_v$ in $\QQ_p[T]$ will make $\pi_A$ act on $\mathbb D(A[p^\infty])$ as $F^r$ (with $q=p^r$), and then the polynomials $g_v$ explicate how Frobenius should end up acting on each of the $v$-components. With some effort, one can compute $\op{inv}D_v$ as
\[\frac{W[1/p][F]}{g_v(F^r)},\]
which yields the correct answer.
\begin{remark}
	One can run a similar computation to prove \Cref{thm:st} without all of our extra assumptions.
\end{remark}

\subsection{Reduction Step for the Main Theorem}
We now begin the proof of \Cref{thm:main}. We quickly recall the set-up. Fix our abelian variety $A$ over a number field $K$ with complex multiplication by $(E,\Phi)$, and we will assume that $K$ contains the reflex field $E^*$. For some $\sigma\in\op{Gal}(\ov\QQ/E^*)$, we can reduce this down to the abelianization, so Artin reciprocity grants a unique $s\in\AA^\times_{E,f}/E^{*,\times}$ such that
\[\op{Art}_{E^*}(s)=\sigma|_{E^{*,\mathrm{ab}}}.\]
Further, $\eta(\sigma)$ is some finite id\'ele in $\AA^\times_{E,f}$, and we know $\op N_\Phi(s)\in\AA^\times_{E,f}/E^\times$. We would like to know that these elements agree in the id\'ele class group.

We begin with some notation.
\begin{notation}
	Let $K$ be a number field, and set $T^K\coloneqq\op{Res}_{K/\QQ}\mathbb G_m$ to be an algebraic $\QQ$-group. Now, for our CM field $E$, set $F\coloneqq E^+$. Note that there is a norm map $\op N_{E/F}\colon T_E\to T_F$ for any extension of numbers fields $E/F$, so we go ahead and define
	\[T\coloneqq\mathbb G_m\times_{T^F}T^E,\]
	where the embedding $\mathbb G_m\to T^F$ is given on $\QQ$-points by the inclusion $\QQ^\times\subseteq F^\times$.
\end{notation}
\begin{lemma} \label{lem:get-to-hausdorff-quotient}
	Fix everything as above.
	\begin{listalph}
		\item If $T\subseteq T^E$, then $T(\AA_{f})/T(\QQ)\subseteq T^E(\AA_f)/T^E(\QQ)$ is a topological embedding. 
		\item The space $T(\AA_f)/T(\QQ)$ is Hausdorff.
	\end{listalph}
\end{lemma}
The point for (b) is to show that we will be able to compare two elements via open subsets, which we understand in $\AA_{E,f}^\times$ already. Importantly, $\AA_{E,f}^\times/E^\times$ fails to be Hausdorff because $E^\times$ is dense in $\AA_{E,f}^\times$ (even though the embedding $E^\times\to\AA_{E}^\times$ is discrete and cocompact!).
\begin{proof}
	For (a), the inclusion $T\subseteq T^E$ is defined on the level of algebraic groups, so it is defined using polynomials over $\QQ$. Thus, if $x\in T(\AA_f)$ goes down to $T^E(\QQ)$, then we can actually show that $x\in T(\QQ)$ by some algebra. The rest of the check for (a) is similar.

	For (b), we will actually check that $T(\QQ)\subseteq T(\AA_f)$ is discrete. For this, we need to find an open neighborhood of the identity which intersects $T(\AA_f)$ at only finitely many points. Well, $T(\QQ)\cap\OO_E^\times$ is an open subset of $T(\QQ)$ in the restricted topology. By the Dirichlet unit theorem, we know that $\OO_F^\times$ is a finite-index subgroup of $\OO_E^\times$, so we may pass to $T(\QQ)\cap\OO_F^\times$.

	Now, $a\in T(\QQ)\cap\OO_F^\times$ consists of elements $a\in\OO_F^\times$ such that $\op N_{E/F}a=a^2$, and this value is rational. But then this requires that $a^2=\pm1$, so being totally real requires $a^2=1$, so we see that $T(\QQ)\cap\OO_F^\times$ is a finite set.
\end{proof}

\end{document}