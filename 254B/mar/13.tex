% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

\section{March 13}

Today we continue talking about the dual isogeny.

\subsection{The Theorem of the Square}
We begin with a remark.
\begin{remark}
	Fix an elliptic curve $(E,e)$. Then for closed points $x,y\in E(k)$, the definition of the group law has
	\[(x)-(e)+(y)-(e)\sim(x+y)-(e)\]
	by definition of the addition as coming from $\Pic E$. Thus, $(x)+(y)\sim(x+y)+(e)$ after cancelling out the redundant $(e)$.
\end{remark}
Now, to compute some dual isogenies, we want the following lemma.
\begin{lemma} \label{lem:almost-square}
	Fix an elliptic $k$-curve $(E,e)$ and a reduced $k$-scheme $S$ with projection $\pi_S\colon E_S\to S$. For any line bundle $\mc L$ of degree $0$ on $E_S$. Then for any section $x\colon S\to E_S$ of $\pi_S$, we have
	\[t_x^*\mc L\otimes_{\OO_{E_S}}\pi_S^*x^*\mc L^{-1}\cong\mc L\otimes_{\OO_{E_S}}\pi_S^*e_S^*\mc L\]
	as line bundles on $E_S$.
\end{lemma}
Intuitively, we are saying that degree-$0$ line bundles are translation-invariant.
\begin{proof}
	As perhaps to be expected, we will build up to the result from $S=\Spec k$ and then reduce to there.
	\begin{enumerate}
		\item Suppose $S=\Spec k$ where $k$ is algebraically closed. Now, we can write $\mc L$ as a line bundle, so we can write it as a degree-$0$ divisor, which by \Cref{thm:deg-1-bundle-is-point} we know must look like $(e)-(y)$ for some $y\in E(k)$.

		Now, we calculate $t_{-x}^*(\OO_E((e)-(y)))$ where $x\in E(S)=E(k)$. We may do this computation on the level of divisors, where we see $t_{-x}$ will pull back the divisor $(e)-(y)$ along $t_x$ to the divisor $(x)-(x+y)$; as such, $t_{-x}^*(\OO_E((e)-(y)))=\OO_E((x)-(x+y))$. But then
		\[(x)-(x+y)=(e)-(y)\]
		by definition of the group law, so we conclude that $t_{-x}^*\mc L=\mc L$. This is what we wanted, upon noting the terms $\pi_S^*x^*\mc L^{-1}$ are pullbacks of line bundles on $\Spec k$ and therefore simply one-dimensional vector spaces, so these terms do not matter in the tensor produce.

		\item We now reduce to $S=\Spec k$. The point is that both sides of the desired equality are actually rigidified line bundles. Namely, we compute
		\[e_S^*\left(t_x^*\mc L\otimes\pi_S^*x^*\mc L^{-1}\right)=x^*\mc L\otimes x^*\mc L^{-1}=\OO_S\]
		canonically; in particular, we have noted that $e_S^*t_x^*=(t_x\circ e_S)^*=x^*$. Similar holds for the other side, so we do indeed have rigidified line bundles. The moral of the story is that a rigidified line bundle is equivalent by the Yoneda lemma to providing a morphism of natural transformations from $S$ to the category of its rigidified line bundles, so these two rigidified line bundles provide two scheme morphisms
		\[S\rightrightarrows\Pic^0_E.\]
		Call the two maps $R$ and $L$. However, our two maps agree on fibers by the field case: for any point $s\in S$, we have the pullback square
		% https://q.uiver.app/?q=WzAsNCxbMSwxLCJTIl0sWzEsMCwiRV9TIl0sWzAsMSwiXFxTcGVjIGsocykiXSxbMCwwLCJFX3trKHMpfSJdLFszLDJdLFsyLDBdLFszLDFdLFsxLDBdLFszLDAsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{E_{k(s)}} & {E_S} \\
			{\Spec k(s)} & S
			\arrow[from=1-1, to=2-1]
			\arrow[from=2-1, to=2-2]
			\arrow[from=1-1, to=1-2]
			\arrow[from=1-2, to=2-2]
			\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
		\end{tikzcd}\]
		which by the previous step must have $R=L$ as maps on the left-hand arrow. Thus, $R$ and $L$ agree on all points. We now finish the proof in the usual way, using the hypothesis that $S$ is a $k$-scheme with finite type. Namely, consider the following fiber product.
		% https://q.uiver.app/?q=WzAsNCxbMCwwLCJaIl0sWzEsMCwiXFxQaWNeMF9FIl0sWzEsMSwiXFxQaWNeMF9FXFx0aW1lc1xcUGljXjBfRSJdLFswLDEsIlMiXSxbMywyLCJSIiwwLHsib2Zmc2V0IjotMX1dLFszLDIsIkwiLDIseyJvZmZzZXQiOjF9XSxbMSwyXSxbMCwzXSxbMCwxXSxbMCwyLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			Z & {\Pic^0_E} \\
			S & {\Pic^0_E\times\Pic^0_E}
			\arrow["R", shift left=1, from=2-1, to=2-2]
			\arrow["L"', shift right=1, from=2-1, to=2-2]
			\arrow[from=1-2, to=2-2]
			\arrow[from=1-1, to=2-1]
			\arrow[from=1-1, to=1-2]
			\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
		\end{tikzcd}\]
		Because $R$ and $L$ agree on all points, we see that $Z$ becomes a closed subscheme of $S$ containing all points (it's closed because the right map is the closed embedding $\Delta\colon E\to E\times E$), but then we must have $Z=S$ because this is a closed embedding and $S$ is reduced.
		\qedhere
	\end{enumerate}
\end{proof}
\begin{corollary}[Square] \label{cor:square}
	As schemes on $S\coloneqq E\times E$, we let $p_1,p_2\colon S\to E$ be the projections. Then, where $m$ is the multiplication, we have
	\[m^*\mc L\otimes p_1\mc L^{-1}\otimes p_2\mc L^{-1}\cong\OO_S\]
	for any degree-$0$ line bundle $\mc L$ on $E$.
\end{corollary}
\begin{proof}
	Set $S=E$. Let $p_1,p_2\colon E\times E\to E$ be our projections, and let $p_1\colon E_E\to E$ be the projection of our base-change. The point is that $\Delta\colon E\times E\to E$ provides a section for $p_1$, which gives $t_x\colon E\times E\to E\times E$ can be tracked around to give the closed point $(x,y)\mapsto(x,x+y)$. Now, for any line bundle $\mc M$ of degree $0$ on $E$, we see that
	\[m^*\mc M\otimes p_1^*\mc M^{-1}\cong p_2^*\mc M\]
	by tracking everything around and plugging into the previous theorem.\todo{What?} This is called the theorem of the square.
\end{proof}
\begin{remark}
	Let's describe how to show \Cref{lem:almost-square} without the reduced hypothesis. The point is that \Cref{cor:square} is almost the most general version of having a section $s\colon S\to E_S$. In particular, the map $E\times\Pic^0_E\to\Pic^0_E$ has a canonical section given by $\id_{\Pic^0_E}$ by the Yoneda lemma produces a rigidified line bundle $\mc P$ called the ``Poincar\'e line bundle.'' This provides a ``universal rigidified line bundle.'' We now make two remarks.
	\begin{itemize}
		\item The above proof merely wants to show that $R=L$ for some maps $R,L\colon S\to\Pic^0_E$. But this is a question local on $S$, so we may choose a trivializing open cover to assume that all line bundles are trivial (but rigidified).
		\item Then one can check that $\mc P$ is in fact the universal line bundle, obtaining the result by base-change in the following diagram.
		% https://q.uiver.app/?q=WzAsNSxbMSwwLCJFXFx0aW1lcyBFXFx0aW1lcyBcXFBpY14wX0UiXSxbMSwxLCJFXFx0aW1lc1xcUGljXjBfRSJdLFswLDEsIlMiXSxbMiwxLCJcXG1jIFAiXSxbMiwwLCJwX3syM31eKlxcbWMgUCJdLFsyLDEsIih4LFxcbWMgTCkiXSxbMCwxLCJwX3sxM30iXSxbMyw0LCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtYXBzIHRvIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			& {E\times E\times \Pic^0_E} & {p_{23}^*\mc P} \\
			S & {E\times\Pic^0_E} & {\mc P}
			\arrow["{(x,\mc L)}", from=2-1, to=2-2]
			\arrow["{p_{13}}", from=1-2, to=2-2]
			\arrow[maps to, from=2-3, to=1-3]
		\end{tikzcd}\]
	\end{itemize}
	Chasing our universal line bundle around using \Cref{cor:square} is able to finish.
\end{remark}
\begin{remark}
	Translation-invariance characterizes degree-$0$ line bundles, so \Cref{lem:almost-square} does not hold in higher degrees. For example,
	\[t_{-x}^*\OO_E((e))=\OO_E((x))\ne\OO_E((e)),\]
	so $\OO_E((e))$ is not translation-invariant!
\end{remark}
The point of talking about the theorem of the square is that we get the following result.
\begin{lemma}
	Fix an isogeny of elliptic $k$-curves $f\colon(E,e)\to(E',e')$. Then $f\circ f^t$ and $f^t\circ f$ are both multiplication by $\deg f$.
\end{lemma}
\begin{proof}
	We track through our definitions. Because we are asking for two morphisms on varieties to be equal, it is enough to base-change to the algebraic closure and check that our morphisms agree on closed points. Namely, tracking through the definition of $f^t$, we know it makes the following diagram commute.
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJFJyJdLFsxLDAsIkUiXSxbMCwxLCJcXFBpY14wX3tFJ30iXSxbMSwxLCJcXFBpY14wX0UiXSxbMCwyXSxbMiwzLCJmXioiXSxbMCwxLCJmXnQiXSxbMSwzXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{E'} & E \\
		{\Pic^0_{E'}} & {\Pic^0_E}
		\arrow[from=1-1, to=2-1]
		\arrow["{f^*}", from=2-1, to=2-2]
		\arrow["{f^t}", from=1-1, to=1-2]
		\arrow[from=1-2, to=2-2]
	\end{tikzcd}\]
	Thus, $f^*\OO_E((e)-f^t(x'))=f^*\OO_{E'}((e)-(x'))$ for any $x'\in E'(k)$. Now here are our checks.
	\begin{itemize}
		\item We compute $f^t\circ f$. Set $x'\coloneqq f(x)$ for some $x\in E(k)$. Then
		\[f^*\OO_{E'}((e')-(f(x)))=\OO_{E'}\left((\ker f)-(f^{-1}f(x))\right)\]
		by computing $f^*$ as pre-images on the level of divisors. However, because we are dealing with an abelian group scheme, we see that the pre-image $f^{-1}f(x)=x+\ker f$; here, $x+\ker f$ refers to $\ker f$ base-changed under $t_{-x}$. However, our degree-$0$ line bundles are translation-invariant, so
		\[(\ker f)-(x+\ker f)=\sum_{y\in\ker f}((y)-(x+y))\sim(\deg f)((e)-(x)).\]
		Thus,
		\[\OO_E\left((e)-f^t(f(x))\right)=\OO_E((\deg f)((e)-(x))),\]
		but by the uniqueness of effective divisors representing degree-$1$ line bundles, we conclude that $f^t(f(x))=\deg f$.
		\item Now, to complete the other computation, we set $g\coloneqq f\circ f^t$ and see that $g\circ f=(\deg f)f$ by the previous step. We can now more or less cancel the $f$s to finish.
		\qedhere
	\end{itemize}
\end{proof}

\end{document}