% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

Here we go.

\subsection{The Dual Isogeny}
Let's prove \Cref{thm:dual-map}.
\dualmapthm*
\begin{proof}
	Fix a $k$-scheme $T$. Then $(\ker f^\lor)(T)$ by definition consists of rigidified line bundles $(\mc L,A)\in\Pic_{B/k}^\circ(T)$ such that $f^*(\mc L,\alpha)$ is trivial in $A^\lor$. (It turns out that we can show that asserting we are in $\Pic_{B/k}^\circ$ already: one can try to show $m^*\mc L\cong\op{pr}_1^*\mc L\otimes\op{pr}_2^*\mc L$ directly.) We claim that this set is in bijection with just line bundles $\mc L$ on $B\times T$ such that $f^*\mc L\cong\OO_{A\times T}$. Indeed, for any such line bundle $\mc L$, having $f^*\mc L\cong\OO_{A\times T}$ pins it down in the target, and then this actually fixes the isomorphism $\alpha$.

	To continue, we will use fpqc descent to the map $A\times T\to B\times T$, which is fpqc because $f\colon A\to B$ is an isogeny (flat, for example, by miracle flatness). The point is that \Cref{thm:fpqc-descent} tells us line bundles on $B\times T$ are equivalent to line bundles on $A\times T$ together with descent data. Let's unwind the descent data; set $G\coloneqq\ker f$.
	\begin{itemize}
		\item We take $S_0\coloneqq A\times T$ and $S\coloneqq B\times T$.
		\item Then $S_1\coloneqq S_0\times_SS_0$ is $(A\times T)_{B\times T}(A\times T)$. Pairs in $S_1$ can be written as $(a,a+g)$ for some $g\in\ker f$ (notably, the coordinates must agree down in $B\times T$), so this is just $A\times T\times G$.
		\item Analogously, we see that $S_2=A\times T\times G\times g$.
	\end{itemize}
	Now, the line bundles $\mc L$ of interest need to be $\OO_{A\times T}$ after pulling back by $f$, so $\theta\colon\op{pr}_1^*\OO_{A\times T}\to\op{pr}_2^*\OO_{A\times T}$ can be turned into an invertible global section $\OO_{A\times T\times G}\to\OO_{A\times T\times G}$. Namely, $\theta\in\Gamma(A\times T\times G,\OO_{A\times T\times G}^\times)$. Because $A$ is proper over $k$, this really amounts to having $\theta\in\Gamma(T\times G,\OO_{T\times G}^\times)$. Also note that we are asking to satisfy a cocycle condition
	\[\op{pr}_{13}^*\theta=\op{pr}_2^*\theta\circ\op{pr}_{12}^*\theta.\]
	Let's compare what we have with $G^\lor(T)$, which is supposed to be $f\in\op{Hom}(G_T,\mathbb G_{m,T})$. In other words, $f$ is a global section of $\Gamma(T\times G,\OO_{T\times G}^\times)$ such that $\Delta_T(f)=f\otimes f$ (to be a group homomorphism).

	So it remains to show that the cocycle condition on $\theta$ corresponds to the homomorphism condition on $f$. Well, tracking through all the identifications, we see that we are asking for
	\[\theta(a,g_1+g_2)=\theta(a,g_1)\theta(a+g_1,g_2),\]
	which unwinds to $\Delta_T(\theta)=\theta\otimes\theta$ upon staring out how the Hopf algebra comultiplication behaves.
\end{proof}
\begin{remark}
	Because $\ker f$ is a finite group scheme, we see that $(\ker f)^\lor$ is finite. Because $f$ being an isogeny requires $\dim A=\dim B$, we are able to conclude that $f^\lor$ is also an isogeny. In fact, $\deg f=\deg f^\lor$ by plugging \Cref{thm:dual-map} into
	\[\deg f=\dim_k\Gamma(\ker f,\OO_{\ker f}).\]
\end{remark}
Let's run some other checks on duality.
\begin{proposition} \label{prop:add-duals}
	Given two morphisms $f,g\colon A\to B$ of abelian $k$-varieties, we have $(f+g)^\lor=f^\lor+g^\lor$.
\end{proposition}
\begin{proof}
	It is enough to check this on $B^\lor(\ov k)$. By unwinding the definitions, it is enough to show that
	\[(f+g)^*\mc L\stackrel?\cong f^*\mc L\otimes g^*\mc L.\]
	But in fact $\mc L\in B^\lor(\ov k)$ implies that $m^*\mc L\cong\op{pr}_1^*\mc L\otimes\op{pr}_2^*\mc L$ on $B\times B$, which we can then pull back along $(f,g)\colon A\to B\times B$ to achieve the desired equality.
\end{proof}
\begin{corollary}
	Fix any abelian $k$-variety $A$. Then for any integer $n\in\ZZ$, we have $[n]_{A^\lor}=[n]_A^\lor$.
\end{corollary}
\begin{proof}
	Note ${\id_A^\lor}=\id_{A^\lor}$ by unwinding definitions. Then for $n\ge0$, write $[n]_A=[1]_A+\cdots+[1]_A$ and apply \Cref{prop:add-duals}. For $n\le0$, one notes that $[n]+[-n]=[0]$ to derive this from the positive case.
\end{proof}
\begin{remark}
	For example, we are able to say that $A[n]^\lor$ is $A^\lor[n]$ after identifying duals suitably.
\end{remark}

\subsection{Quotients}
We will want quotients. For the correct references, see SGA 3, expos\'e 6, 3.2.
\begin{theorem}
	Fix a closed normal group $k$-subscheme $A\subseteq B$, where $A$ and $B$ are fppf group $k$-schemes. (Here, fppf means faithfully flat of finite presentation.) Then there is a unique fppf group scheme $C$ such that
	\[1\to A\to B\to C\to1\]
	is exact in the category of fppf sheaves. In fact, $C$ is the fppf sheafification of the fppf presheaf $T\mapsto B(T)/A(T)$.
\end{theorem}
In life, $A$ will typically be affine and in fact finite (such as the kernel of an isogeny). If $B$ is also affine, then one can take the ring of $A$-invariants to do the job. In general, because $A$ is finite, one may work locally on $A$ to complete the argument. Perhaps the gluing wants to glue along the fppf topology, for which one needs to do descent.
\begin{theorem}[{\cite[Theorem~6.1.5]{blr-neron}}]
	Fix a map $f\colon S_0\to S$ which is fpqc. Then the functor from $\mathrm{Sch}_S$ to $S_0$-schemes with descent data is fully faithful. In fact, this upgrades to an equivalence if one works with quasi-affine schemes.
\end{theorem}
This is enough to do our gluing because we only need uniqueness. The point of the above result is to reduce this discussion to sheaves on the fpqc topology.
\begin{remark}
	There is a general theory trying to build a quotient scheme modulo some proper and flat equivalence relation; one essentially uses the Hilbert scheme to encode everything.
\end{remark}
For our purposes, we are only ever going to take quotients by finite group schemes, but understanding quotients in general can be helpful because, for example, this allows us to construction the Picard scheme by taking a quotient of divisors by an equivalence relation to get line bundles.

\end{document}