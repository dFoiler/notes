\documentclass[../notes.tex]{subfiles}

\begin{document}

% !TEX root = ../notes.tex














He was safe, for now. But the dark thoughts would soon return.

\subsection{Introducing Unique Factorization}
We're talking factorization today.
\begin{warn}
	All rings today are commutative with identity and have no zero-divisors. In other words, $ab=0$ for $a,b$ in our rings will imply $a=0$ or $b=0.$
\end{warn}
Namely, we have the following definition.
\begin{definition}[Integral domain]
	A ring $R$ is an \textit{integral domain} if and only if it is nonzero, commutative with identity, and $ab=0$ implies $a=0$ or $b=0.$
\end{definition}
The main thing that integral domains gives us is a cancellation law for multiplication: if $ac=bc$ with $c\ne0,$ then $(a-b)c=0$ while $c\ne0,$ so $a=b.$

Here is the standard example of unique prime factorization.
\begin{example}
	For $\ZZ,$ we have unique prime factorization: every positive integer is the product of positive primes, uniquely (up to permutation). Speaking more abstractly, every nonzero integer is the product of primes and units, unique up to permutation and multiplication by some unit. For example, $1$ and $-1$ are both products of empty sets of primes.
\end{example}
Let's try to generalize our factorization.
\begin{defi}[Prime]
	Fix $R$ a commutative ring. Then $p\in R$ is \textit{prime} if and only if $p$ is nonzero, not a unit, and $p\mid ab$ implies $p\mid a$ or $p\mid b.$
\end{defi}
This is not the definition most of us are used to from elementary school. The other definition has a different name.
\begin{definition}[Irreducible]
	Fix $R$ a ring with identity. Then $p\in R$ is called \textit{irreducible} if and only if $p$ is nonzero, not a unit, and $p=ab$ implies $a$ or $b$ is a unit.
\end{definition}
Note that $1$ (and units more generally) are neither prime nor irreducible. It just turns out to be more convenient that way.
\begin{remark}
	Professor Borcherds thinks arguing about whether $1$ is prime or not is pointless. It is not prime by definition.
\end{remark}
We are going to talk about factorization in a few steps.
\begin{enumerate}[label=(\roman*)]
	\item We start with $\ZZ,$ which is everyone's favorite.
	\item It happens that $\ZZ$ is a Euclidean domain.
	\item We will show all Euclidean domains are principal ideal domains.
	\item Then we will show all principal ideal domains are unique factorization domains.
\end{enumerate}
And unique factorization domains are the ones that we want.
\begin{definition}[Unique factorization domain]
	A ring $R$ is a \textit{unique factorization domain} if and only if it is an integral domain and every element can be written as a product of irreducibles, where the product is unique up to permutation and multiplication by units.
\end{definition}

\subsection{Euclidean Domains}
So let's start with Euclidean domains.
\begin{definition}[Euclidean]
	A \textit{Euclidean domain} is an integral domain $R$ with a division algorithm. In other words, given $a,b$ with $a\ne0,$ we can divide
	\[b=aq+r\]
	where $0\le|r|<|a|$ for some notion of $|\cdot|.$ We also require that $|\cdot|:R\to\ZZ_{\ge0}.$
\end{definition}
\begin{warn}
	The above requirements on the Euclidean function are somewhat nonstandard. More typical would be $|\cdot|:R\setminus\{0\}\to\ZZ_{\ge0}$ satisfying a division algorithm and $|a|\le|ab|$ for any $a,b\in R.$
\end{warn}
The exact requirements on the ``norm'' $|\cdot|$ are not very standard and not worth memorizing. The main point is that we can write down a statement of the division algorithm, we want $0$ to be smaller than all the other elements, and we want there to be only finitely many elements of bounded norm.

Anyways, here are some examples.
\begin{example}
	We have that $\ZZ$ has a division algorithm, where $|\cdot|$ is the usual absolute value.
\end{example}
\begin{example}
	The ring $k[X]$ for a field $k,$ where we use $\deg$ for our size function. Technically we want $|0|=0$ and $|f|=\deg f+1$ for $f\ne0$ to make this work with the above definition.
\end{example}
\begin{example}
	The Gaussian integers $\ZZ[i]=\{a+bi:a,b\in\ZZ\}$ have a division algorithm, where $|a+bi|=a^2+b^2.$
\end{example}
In general, here is our idea.
\begin{idea}
	A Euclidean domain is an integral domain where we cannot have infinite descending chains of elements.
\end{idea}

\subsection{Principal Ideal Domains}
Recall the following definition.
\begin{definition}
	A ring $R$ is \textit{principal} if and only if all ideals are generated by one element, i.e., are principal.
\end{definition}
Lots of the rings we love are principal ideal domains: $\ZZ,$ $k[X]$ for a field $k,$ and so on. Let's see some rings which aren't.
\begin{nex}
	The ring $k[X,Y]$ is not a principal ideal domain: take $I$ to be $(X,Y),$ which cannot be reduced to be a single generator. In other words, $I$ is the ideal of polynomials with no constant term.

	Indeed, suppose that $(X,Y)\subseteq(f)$ for some $f\in k[X,Y].$ Then $f\mid X$ and $f\mid Y,$ and degree arguments show that $f\mid X$ implies there is some $c_x\in k^\times$ such that $f=c_x$ or $f=c_xX.$ But $c_xX\nmid Y$ because $X\nmid Y,$ so we must have $f\equiv c\in k^\times.$ But then $(f)=k[X,Y],$ so $(f)\ne(X,Y).$
\end{nex}
\begin{nex}
	The ring $\ZZ[X]$ is also not a principal ideal domain: take $I=(2,X).$ In other words, $I$ is the ideal of polynomials with even constant term.

	The proof that $I$ is not principal is similar to before. Suppose $f\in\ZZ[X]$ has $(2,X)\subseteq(f).$ Then $f\mid2,$ so $f=\pm1$ or $f=\pm2.$ Note $f=\pm2$ generates an ideal missing $X,$ so this does not work. So $f=\pm1,$ so $(f)=\ZZ[X],$ and $(f)\ne(2,X).$
\end{nex}
\begin{remark}[Nir]
	At a high level, what is happening with the above rings is that they are Noetherian of dimension $2.$
\end{remark}
Here is one step in the outline we gave at the start, which is the reason we brought up Euclidean domains to begin with.
\begin{prop}
	All Euclidean domains are principal ideal domains.
\end{prop}
\begin{proof}
	Fix $R$ a Euclidean domain, and pick up an ideal $I.$ Then by well-ordering we can find the minimum of
	\[\{|a|:a\in I\setminus\{0\}\}\subseteq\ZZ_{\ge0}\]
	as well as some $a\in I\setminus\{0\}$ with the minimal $|a|.$ 
	
	We claim $I=(a).$ In one direction, $a\in I$ implies $(a)\subseteq R.$ In the other direction, take any $b\in I.$ We note $a\ne0,$ so we can apply division, writing
	\[b=aq+r\]
	with $|r|<|a|.$ But then by minimality of $|a|,$ it follows that $r\notin I\setminus\{0\},$ so $r=0.$ Thus, $b=aq,$ and $b\in (a),$ which shows $I\subseteq(a),$ finishing.
\end{proof}
We can ask if the converse is true: are all principal ideal domains Euclidean? Usually the answer is yes in practice, but it is false in general.
\begin{exercise}
	The ring $R:=\ZZ\left[\frac{1+\sqrt{-19}}2\right]$ is a principal ideal domain but not a Euclidean domain.
\end{exercise}
\begin{proof}
	To see that $R$ is a principal ideal domain, see any course on algebraic number theory. The words to google are ``class group'' and ``Minkowski bound.''

	To show that $R$ is not Euclidean, we take the following lemma.
	\begin{lemma}[Universal side divisor criterion]
		Suppose that $R$ is a Euclidean domain. Then there exists a nonzero $a\in R\setminus R^\times$ such that the cosets $R/(a)$ can each be represented by unit or zero.
	\end{lemma}
	\begin{proof}
		The idea is to take $a$ to have the smallest norm, outside of units. Well-ordering implies that the set
		\[\left\{|a|:a\in R\setminus(\{0\}\cup R^\times)\right\}\subseteq\ZZ_{\ge0}\]
		has a minimum, so we can find a nonzero $a\in R\setminus R^\times$ with minimal norm.

		Now, pick up any coset $b+(a)\in R/(a).$ Applying division by $a,$ we see that
		\[b=aq+r\]
		for some $|r|<|a|.$ Then we see $b+(a)=r+(a)$ while the minimality of $|r|$ implies that $r\in\{0\}\cup R^\times.$ This finishes.
	\end{proof}
	\begin{remark}
		In fact, all elements of smallest norm (excluding $0$) are units. Indeed, well-ordering implies that
		\[\left\{|a|:a\in R\setminus\{0\}\right\}\]
		has a smallest element. Then for any $u\in R\setminus\{0\}$ minimizing $|u|,$ we claim that $u$ is a unit. Indeed, dividing $1$ by $u$ we find
		\[1=qu+r\]
		where $|r|<|u|.$ But by minimality of $|u|,$ we must have $r\notin R\setminus\{0\},$ so $r=0,$ implying that $1=qu,$ and $u$ is a unit.
	\end{remark}
	However, $R$ does not satisfy the universal side divisor criterion, so it cannot be Euclidean. Indeed, the only units\footnote{If $u\mid1,$ then $\overline u\mid1,$ so $u\overline u\mid1,$ and so $u=a+b\frac{1+\sqrt{-19}}2$ implies $\left(a+\frac12b\right)^2+\left(\frac{19}2b\right)^2=1,$ so $a=\pm1$ and $b=0$ by bounding.} of $R$ are $\{\pm1\}$ implying that we would need some $a\in R$ with $1<\#(R/(a))\le3.$

	But no such $a$ exists; the argument here is a bit technical and taken from \href{https://math.stackexchange.com/a/857983/869257}{here}. The point is that, if such an $a$ existed, there would be a ring homomorphism
	\[R\onto R/(a),\]
	but $1<\#(R/(a))\le3$ implies that $R/(a)$ is a ring with two or three elements, of which the only options are $\FF_2$ and $\FF_3.$
	
	The obstruction, now, is that $R$ has $\theta:=\frac{1+\sqrt{-19}}2,$ which is a root of $x^2-x+5=0,$ but $\FF_2$ and $\FF_3$ have no roots of this polynomial (this is checked by hand). Ring homomorphisms preserve polynomial equations, so no ring homomorphism may exist.
\end{proof}

\subsection{Getting Unique Factorization}
We now show that all principal ideal domains are unique factorization domains. This is done in steps.
\begin{proposition} \label{prop:irreddiv}
	Fix $R$ a principal ideal domain. Then all nonzero $a\in R\setminus R^\times$ are divisible by some irreducible. In fact, we may weaken the condition that $R$ is a principal ideal domain to require all ascending chains of principal ideals to stabilize.
\end{proposition}
\begin{proof}
	Roughly speaking, this is done by an induction-like argument. Fix $a_0\in R\setminus\{0\}.$ If $a_0\in R$ is irreducible, we are done. Otherwise, we can factor $a_0=a_1b_1$ with $a_1,b_1\in R\setminus R^\times$ and nonzero because $R$ is an integral domain. Then we can factor $a_1$ further, and so on. Formally, we have the following algorithm.
	\begin{enumerate}
		\item Starting with a nonzero $a_k\in R\setminus R^\times,$ we may factor $a_k=a_{k+1}b_{k+1}$ where $a_{k+1}$ and $b_{k+1}$ are not units and not zero.
		\item If $a_{k+1}$ is irreducible, then it is an irreducible factor of $a_k,$ which is a factor of $a_0$ by working our way back up the chain.
		\item Otherwise, return to the first step with $a_{k+1}.$ Any irreducible factor of $a_{k+1}$ will also be an irreducible factor of $a_k.$
	\end{enumerate}

	If this algorithm terminates, we are done. Otherwise, suppose for the sake of contradiction we can find an infinite strictly descending sequence of elements $\{a_0,a_1,\ldots\}$ where
	\[\frac{a_k}{a_{k+1}}\in R\setminus R^\times\]
	for each $k.$ Equivalently, we have the strictly ascending chain
	\[(a_0)\subsetneq(a_1)\subsetneq(a_2)\subsetneq\subsetneq\cdots.\]
	(This is strictly ascending because $(a_k)=(a_{k+1})$ implies $a_k/a_{k+1}\in R^\times.$) By hypothesis, this chain of ascending chain of principal ideals should stabilize, but we should show this is true for principal ideal domains.
	\begin{remark}
		The above condition is actually possible in ``big'' rings. For example,
		\[k\left[X,X^{1/2},X^{1/4},\ldots\right]\]
		has the infinite strictly ascending chain
		\[(X)\subsetneq\left(X^{1/2}\right)\subsetneq\left(X^{1/4}\right)\subsetneq\cdots.\]
		Of course this is ascending, and it is strictly ascending because no $X^{1/2^n}$ is a unit by ``degree'' arguments.
	\end{remark}
	Indeed, these infinite strictly ascending chains cannot happen for principal ideal domains for Noetherian reasons.
	\begin{lemma}
		Fix $R$ a principal ideal domain and suppose that we have an ascending sequence of ideals
		\[(a_0)\subseteq(a_1)\subseteq(a_2)\subseteq\cdots.\]
		Then there exists some $N$ such that $(a_n)=(a_N)$ for $n\ge N.$
	\end{lemma}
	\begin{proof}
		The trick is to look at the ideal
		\[\bigcup_{k=0}^\infty(a_k)=(a_0,a_1,\ldots)=(b),\]
		where $b\in R$ exists because all ideals are principal! But then
		\[b\in (a_n)\]
		for some $n$ by the definition of a union. It follows that
		\[(a_{n+1})\subseteq\bigcup_{k=0}^\infty(a_k)=(b)\subseteq(a_n),\]
		so we get $(a_n)=(a_{n+1}),$ 
	\end{proof}
	In light of the above lemma, there exists some $N$ in our chain so that $(a_N)=(a_{N+1}).$ But then $a_N/a_{N+1}\in R^\times,$ violating the construction of our chain, which is our contradiction.
\end{proof}
We continue.
\begin{proposition}[Existence of factorizations] \label{prop:existfact}
	Fix $R$ an integral domain in which every ascending chain of principal ideals must stabilize. Every nonzero $a\in R$ is the product of irreducibles.
\end{proposition}
\begin{proof}
	We do the same argument as above, factoring a nonzero $a_0\in R$ by stripping out one irreducible at a time. Formally, we have the following algorithm, for $k\ge0.$
	\begin{enumerate}
		\item If $a_k$ is a unit, then we take the empty product of irreducibles and are done; i.e., our factorization is ``$a_k.$''
		\item Otherwise, we know from \autoref{prop:irreddiv} that $a_k$ has an irreducible factor, say $\pi_k.$
		\item Now return to the first step with $a_{k+1}:=a_k/\pi_k.$ We note $a_k=\pi_k\cdot a_{k+1}.$
	\end{enumerate}
	This algorithm creates the strictly ascending chain of ideals
	\[(a_0)\subsetneq(a_1)\subsetneq(a_2)\subsetneq\cdots,\]
	where the ascending is strict because $(a_k)=(a_{k+1})$ would imply that $\pi_k=a_k/a_{k+1}$ is a unit, which is not the case because $\pi_k$ is irreducible.

	So eventually the strictly ascending chain must stop, so there is some $a_N$ which is a unit. So we have
	\[a_0=\pi_1a_1=\pi_1\pi_2a_2=\cdots=a_N\prod_{k=1}^{N-1}\pi_k,\]
	which after pushing the unit anywhere becomes a factorization of $a_0$ into irreducibles.
\end{proof}
\begin{remark}
	Being a product of irreducibles does not use the full power of being a principal ideal domain. We really only need to know the ring is ``Noetherian,'' which means every ideal is finitely generated. Indeed, the meat of the above argument is showing that there are no infinite strictly ascending chain of (principal) ideals.
\end{remark}
So the hard part is going to be showing uniqueness. The main claim will be that irreducibles are prime. It's easy to show that primes are irreducible, but the reverse is hard.
\begin{lemma}
	Fix $R$ an integral domain. Then a prime $p\in R$ is irreducible.
\end{lemma}
\begin{proof}
	Being prime already gives $p$ not a unit and nonzero. Now suppose that we can factor $p=ab$ so that we want to show one of the factors is a unit.

	Well, $p\mid ab,$ so $p$ prime implies $p\mid a$ or $p\mid b.$ Without loss of generality, take $p\mid a.$ Then we see $p=ab$ implies
	\[1=(a/p)\cdot b,\]
	so indeed, $b$ is a unit.
\end{proof}

Anyways, let's show uniqueness assuming that all irreducibles are prime.
\begin{prop}[Uniqueness of factorizations] \label{prop:uniqfact}
	Fix $R$ an integral domain in which all irreducibles are prime. Then factorization into irreducibles is unique up to permutation of the factors and multiplication by units.
\end{prop}
\begin{proof}
	Suppose we have two factorizations into irreducibles notated
	\[\prod_{k=1}^mp_k=\prod_{\ell=1}^nq_\ell.\]
	Without loss of generality, take $m\ge\ell.$ If $m=0,$ then both sides are empty, and there is nothing to show.

	Otherwise, we can pick up $p_m$ an irreducible. By hypothesis, $p_m$ is prime while dividing the right-hand side, so $p_m$ divides one of the factors. Without loss of generality (permuting the elements), we take
	\[p_m\mid q_n,\]
	so we write $q_n=p_mu.$ But now $q_n$ is irreducible, so one of $p_m$ or $u$ is a unit, but it cannot be $p_m,$ so $u$ is the unit. This means that we can divide out
	\[\prod_{k=1}^{m-1}p_k=u\prod_{\ell=1}^{n-1}q_\ell\]
	to get a smaller factorization and finish by induction. Intuitively, we can just keep stripping off irreducible factors from both sides, one at a time.
\end{proof}
So let's get into the meat of the proof.
\begin{remark}
	According to Professor Borcherds, most of what we have been doing has been book-keeping and has not required any ideas. What follows does.
\end{remark}
\begin{proposition}
	Fix $R$ a principal ideal domain. Then all irreducibles are prime.
\end{proposition}
\begin{proof}
	Fix $p$ an irreducible so that we want to show $p$ is prime. Well, suppose $p\mid ab$ so that we want $p\mid a$ or $p\mid b.$ The trick is to focus on
	\[(p,a)=(c),\]
	where $c\in R$ exists because we live in a principal ideal domain. We see $p\in(c)$ implies $c\mid p,$ so writing $p=cu,$ one of $c$ or $u$ is a unit. We now do casework.
	\begin{itemize}
		\item If $u$ is the unit, then $a\in(c)$ implies $c\mid a$ implies $cu\mid au$ implies $p\mid au$ implies $p\mid a.$
		\item Otherwise $c$ is the unit so that $(c)=R.$ We can write
		\[1=xp+ya\]
		for some $x,y\in R,$ which implies
		\[b=bxp+bya=(bx+yab/p)\cdot p,\]
		so $p\mid b.$ This finishes.
	\end{itemize}
	So in all cases, we have $p\mid a$ or $p\mid b,$ finishing.
\end{proof}
This finishes the proof.
\begin{theorem}[Unique factorization]
	Every principal ideal domain is a unique factorization domain.
\end{theorem}
\begin{proof}
	This follows from combining \autoref{prop:existfact} and \autoref{prop:uniqfact}.
\end{proof}
\begin{remark}
	This proof is more or less in Euclid's \textit{Elements}, but the statement was not. Euclid didn't have a good notion of multiplying more than three elements at once.
\end{remark}

\subsection{Gaussian Integers}
Let's work with some examples now.
\begin{theorem}
	The Gaussian integers $\ZZ[i]$ is a Euclidean domain and hence a unique factorization domain.
\end{theorem}
\begin{proof}
	Our norm function on $\ZZ[i]$ will be
	\[|x+yi|=x^2+y^2.\]
	We want to show that, given $a,b\in\ZZ[i]$ with $a\ne0,$ we can write
	\[b=aq+r\]
	where $|r|<|a|.$ Equivalently, we are saying that
	\[\frac ba=q+\frac ra,\]
	where we want $|r|<|a|,$ which is equivalent to $|r/a|<1$ because our norm is multiplicative in $\ZZ[i].$ (The norm is multiplicative in $\CC.$) So essentially we are asking if every Gaussian integer is off by a distance of at most one from a Gaussian integer.

	Well, geometrically, we place a unit circle around each Gaussian integer, as follows.
	\begin{center}
		\begin{asy}
			unitsize(0.8cm);
			for(int i = -2; i <= 2; ++i)
			{
				for(int j = -2; j <= 2; ++j)
				{
					dot((i,j));
					draw(circle((i,j),1), dotted);
				}
			}
			draw((-3.5,0)--(3.5,0));
			draw((0,-3.5)--(0,3.5));
		\end{asy}
	\end{center}
	Now it's pretty clear that, for any $z\in\CC,$ we can find some $x+yi\in\ZZ[i]$ such that the distance between $z$ and $x+yi$ is at most $1,$ which is what we wanted.
	
	Formally, we can define $q$ by dividing $b\overline a$ by $|b|$ coordinate-wise and rounding to get the components of $q.$ This argument is a bit long and annoying, so we will write it out exactly once. For concreteness, set $a=a_1+a_2i$ and $b=b_1+b_2i.$ Now,
	\[a\overline b=(a_1+a_2i)(b_1-b_2i)=\underbrace{(a_1b_1+a_2b_2)}_{s_1}+\underbrace{(a_2b_1-a_1b_2)}_{s_2}i.\]
	Now, we set $q_1$ and $q_2$ defined by
	\[s_1=|b|q_1+t_1\qquad\text{and}\qquad s_2=|b|q_2+t_2,\]
	where $-\frac12|b|\le t_1,t_2\le\frac12|b|$ by dividing in $\ZZ.$ Then we take $q:=q_1+q_2i$ and $t:=t_1+t_2i$ so that
	\[\frac ab=\frac{a\overline b}{|b|}=\frac{q|b|+t}{|b|}=q+\frac t{|b|}.\]
	In particular, our remainder comes out to $r:=\frac{b t}{|b|}=\frac t{\overline b},$ which has norm
	\[|r|=\left|\frac{t}{\overline b}\right|=\frac{|t|}{|b|}=\frac{t_1^2+t_2^2}{|b|}\le\left(\frac14+\frac14\right)\frac{|b|^2}{|b|}<|b|.\]
	This is what we wanted.
\end{proof}
So what are the primes in $\ZZ[i]$? Well, let's start with the units.
\begin{proposition}
	The units of $\ZZ[i]$ are $\{\pm1,\pm i\}.$
\end{proposition}
\begin{proof}
	Of course $\{\pm1,\pm i\}$ are units: $1\cdot1=-1\cdot-1=i\cdot-i=1.$ Now, suppose that $\alpha$ is a unit so that there exists $\beta$ with
	\[\alpha\beta=1.\]
	Taking norms, we find that $|\alpha|\cdot|\beta|=1,$ so $|\alpha|=1$ because the only units in $\ZZ$ are $\{\pm1\}.$ Now, letting $\alpha=x+yi,$ we see $x^2+y^2=1$ for size reasons. So $x^2\le1,$ and $x\in\{-1,0,1\}.$
	\begin{itemize}
		\item If $x=\pm1,$ then $y=0,$ so we get $\alpha\in\{\pm1\}.$
		\item If $x=0,$ then $y=\pm1,$ so we get $\alpha\in\{\pm i\}.$
	\end{itemize}
	This finishes the classification.
\end{proof}
Now let's classify primes.
\begin{lemma} \label{lem:pliesoverp}
	All primes in $\ZZ[i]$ divide a prime in $\ZZ.$
\end{lemma}
\begin{proof}
	Note that any Gaussian integer $\alpha$ divides 
	\[\alpha\overline\alpha=|\alpha|\in\ZZ,\]
	so in particular any Gaussian prime $\pi$ divides some integer $n.$ If we factor $n$ in $\ZZ,$ we see
	\[\pi\mid\prod_{k=1}^Np_k\]
	for some rational primes $p_k,$ from which it follows $\pi$ divides one of the rational primes.
\end{proof}
Observe that if $x+yi$ is a Gaussian prime dividing the rational prime $p,$ then taking norms tells us that
\[x^2+y^2\mid p^2.\]
In particular, $x^2+y^2\in\{1,p,p^2\},$ and $1$ is illegal because this would imply $x+yi$ is a unit. So part of this question is if we can write $p$ as the sum of two squares; for if we can, then
\[p=x^2+y^2=(x+yi)(x-yi)\]
will be the unique prime factorization of $p.$ (We can't factor $x\pm yi$ further because, taking norms, one of the factors would have norm $1$ and hence be a unit.)

So let's start factoring primes.
\begin{itemize}
	\item We can write $2=1^2+1^2,$ so $2=(1+i)(1-i),$ but these are really the same prime because they are a multiple of $i$ away.
	\item We cannot write $3$ as the sum of two squares, so it is prime.
	\item We can write $5=1^2+2^2=(1+2i)(1-2i).$
	\item We cannot write $7$ as the sum of two squares, so it is prime.
\end{itemize}
We can continue this list downwards; here is the general criterion.
\begin{lemma} \label{lem:psumofsqrs}
	A positive prime $p\in\ZZ$ is the sum of two squares if and only if $p=2$ or $p\equiv1\pmod4.$
\end{lemma}
\begin{proof}
	In one direction, if $p=x^2+y^2,$ then checking$\pmod4$ gives $p\equiv0,1,2\pmod4,$ so $p$ odd implies $p\equiv1\pmod4.$

	In the other direction, of course $2=1^2+1^2,$ so we take $p\equiv1\pmod4,$ and we have to show that $p$ can be written as the sum of two squares. We proceed in two steps.
	\begin{enumerate}
		\item We start by noting that $p\equiv1\pmod4$ implies that $-1\pmod p$ is a square, which is true because $\left(\ZZ/p\ZZ\right)^\times$ is cyclic of order $p-1,$ which is divisible by $4.$ So, say $a$ has order $4,$ and then $a^2=-1.$
		\item Now, we write $a^2+1=np$ for $n\in\ZZ,$ and we look at this in $\ZZ[i],$ where it factors as
		\[p\mid(a+i)(a-i).\]
		However, $p$ does not divide either of those factors, so $p$ is not prime, so $p$ is not irreducible. So $p$ factors as
		\[p=(x+yi)(x-yi),\]
		implying $p^2=\left(x^2+y^2\right)^2.$ It follows that $p=x^2+y^2$ by positivity.
		\qedhere
	\end{enumerate}
\end{proof}
\begin{remark}[Nir]
	The above argument is really a more concrete version of saying that, for $p$ an odd prime,
	\[\frac{\ZZ[i]}{(p)}\cong\frac{\ZZ[x]}{\left(p,x^2+1\right)}\cong\frac{\FF_p[x]}{\left(x^2+1\right)}.\]
	Now, $p\equiv1\pmod4$ if and only if $x^2+1$ has a root if and only if $\FF_p[x]/\left(x^2+1\right)$ has zero-divisors if and only if $\ZZ[i]/(p)$ has zero-divisors if and only if $p$ is not prime in $\ZZ[i].$
\end{remark}
\begin{remark}
	This gives us an algorithm to write $p$ as the sum of two squares. Trial and error would require about $O(\sqrt p)$ time. Namely, we can apply the Euclidean algorithm in $\ZZ[i]$ to find the greatest common divisor of $p$ and $a+i,$ which will yield a nontrivial factor in $\ZZ[i]$ of $p.$ (This is equivalent to doing lattice basis reduction in $\ZZ^2$ with the lattice $(a,1)\ZZ+(p,0)\ZZ.$)
\end{remark}
Anyways, we get the following classification of primes in $\ZZ[i].$
\begin{theorem}[Gaussian primes]
	All Gaussian primes $\pi$ come in one of the following forms.
	\begin{itemize}
		\item $\pi=up$ where $p$ is a rational $3\pmod4$ prime.
		\item $\pi=a+bi$ where $p:=a^2+b^2$ is a rational prime $p=2$ or $p\equiv1\pmod4.$
	\end{itemize}
\end{theorem}
\begin{proof}
	We quickly check that each of the promised forms yield primes; note that none of them have norm $1,$ so none are units.
	\begin{itemize}
		\item $\pi=1+i$ is prime because it has prime norm.
		\item $\pi=up$ for $p$ a rational $3\pmod4$ prime remains prime: if we factor $p=\alpha\beta,$ then norms imply $|\alpha|,|\beta|\in\{1,p,p^2\}.$ We cannot have $|\alpha|=p$ because this would make $p$ the sum of two squares, violating \autoref{lem:psumofsqrs}.

		So one of $|\alpha|$ or $|\beta|$ is $1,$ implying one of $\alpha$ or $\beta$ is a unit.
		\item $\pi=a+bi$ where $p:=a^2+b^2$ for $p$ a rational $1\pmod4$ prime is prime because $|\pi|=p$ is prime. Indeed, if $\pi=\alpha\beta,$ then $|\alpha|\cdot|\beta|=p,$ so one of $|\alpha|$ or $|\beta|$ is $1.$
	\end{itemize}
	We now check that we have all the primes. Suppose $\pi$ is a rational prime; by \autoref{lem:pliesoverp}, we may take $p$ so that $\pi\mid p.$ We have the following cases.
	\begin{itemize}
		\item If $p$ is the sum of two squares, we can factor $p=(a+bi(a-bi),$ and we checked above that these factors are irreducible. By uniqueness, $\pi$ must be one of these times a unit.
		\item If $p$ is not the sum of two squares, then $p\equiv3\pmod4,$ so we checked above that $p$ is prime, so $\pi$ is a unit times $p.$
		\qedhere
	\end{itemize}
\end{proof}

As an aside, we can use Gaussian integers to write general numbers as the sum of two squares.
\begin{example}
	Let's do $65=5\cdot13.$ We can factor $5=(2+i)(2-i)$ and $13=(3+2i)(3-2i).$ Now we have options: we could write
	\[\begin{cases}
		65=(2+i)(3+2i)\cdot(2-i)(3-2i)=(4+7i)(4-7i)=4^2+7^2, \\
		65=(2+i)(3-2i)\cdot(2-i)(3+2i)=(8-i)(8+i)=8^2+1^2.
	\end{cases}\]
	Namely, different ways to factor $65$ in $\ZZ[i]$ give different sums of squares.
\end{example}

\subsection{Going Further}
The theory we developed around $\ZZ[i]$ can be built for other number rings.

\subsubsection{Talking \texorpdfstring{$\ZZ[{\sqrt{-2}]}$}{}}
We start with $\ZZ[\sqrt{-2}].$
\begin{proposition}
	We have that $\ZZ[\sqrt{-2}]$ is a Euclidean domain.
\end{proposition}
\begin{proof}
	Essentially the same proof as in $\ZZ[i]$ will work here. Again, embedding $\ZZ[\sqrt{-2}]\into\CC,$ the division algorithm comes down to showing that each $z\in\CC$ is at most one unit away from a point on the $\ZZ[\sqrt{-2}]$ lattice.
	
	Well, we can cover each point in $\ZZ[\sqrt{-2}]$ by some unit disk and check
	\begin{center}
		\begin{asy}
			unitsize(0.8cm);
			for(int i = -2; i <= 2; ++i)
			{
				for(int j = -1; j <= 1; ++j)
				{
					dot((i,j*1.414));
					draw(circle((i,j*1.414),1), dotted);
				}
			}
			draw((-3.5,0)--(3.5,0));
			draw((0,-1*1.414-1.5)--(0,1*1.414+1.5));
		\end{asy}
	\end{center}
	So indeed, it looks like we can cover the entire plane by these disks. Again, the formal proof is somewhat technical, and I don't want to write it out again, so I won't.
\end{proof}
So we get that $\ZZ[\sqrt{-2}]$ is a Euclidean domain and hence a unique factorization domain.

The classification of primes now has to deal with representing primes in the form $x^2+2y^2.$ We won't write out the full proof explicitly, but here is the classification, for completeness.
\begin{theorem}[Primes in \texorpdfstring{$\ZZ[\sqrt{-2}]$}{}]
	A prime $\pi$ in $\ZZ[\sqrt{-2}]$ comes in one of the following forms.
	\begin{itemize}
		\item $\pi=u\sqrt2$ for some unit $u.$
		\item $\pi=up$ for some rational prime $p\equiv\pm3\pmod8$ and unit $u.$
		\item $\pi=a+b\sqrt{-2}$ where $p:=a^2+2b^2$ is some rational prime $\equiv\pm1\pmod8.$
	\end{itemize}
\end{theorem}

\subsubsection{Talking \texorpdfstring{$\ZZ{[\sqrt{-3}]}$}{}}
How about $\ZZ[\sqrt{-3}]$? Here, when we try to do the division algorithm and cover the plane in unit disks, it doesn't quite work. Here is the image.
\begin{center}
	\begin{asy}
		unitsize(0.8cm);
		for(int i = -2; i <= 2; ++i)
		{
			for(int j = -1; j <= 1; ++j)
			{
				dot((i,j*1.732));
				draw(circle((i,j*1.732),1), dotted);
			}
		}
		draw((-3.5,0)--(3.5,0));
		draw((0,-1*1.732-1.5)--(0,1*1.732+1.5));
	\end{asy}
\end{center}
The problem here is that the closed unit disks will cover the plane, but the open ones do not; e.g., $\frac12+\frac12\sqrt{-3}$ is missed. This causes the entire proof to break down, and in fact $\ZZ[\sqrt{-3}]$ is not a unique factorization domain due to this problem! For example,
\[\left(1+\sqrt{-3}\right)\left(1-\sqrt{-3}\right)=2\cdot2,\]
and we can check that all these elements are irreducible and do not differ by a unit, so this is a failure of unique factorization. In particular, these factors are irreducible but not prime.

This can be fixed by making our ring bigger: we work with $\ZZ[\omega]$ where $\omega:=\frac{1+\sqrt{-3}}2$ instead. This turns out to be a perfectly fine ring, isomorphic to $\ZZ[x]/\left(x^2-x-1\right).$ Now, when we embed $\ZZ[\omega]\into\CC,$ the points make a triangular lattice.
\begin{center}
	\begin{asy}
		unitsize(0.8cm);
		pair v1 = dir(0);
		pair v2 = dir(60);
		for(int i = -2; i <= 2; ++i)
		{
			for(int j = -1; j <= 1; ++j)
			{
				if(!(j==-1 & i==-2) && !(j==1 && i==2))
				{
					dot(i*v1+j*v2);
					draw(circle(i*v1+j*v2,1), dotted);
				}
			}
		}
		draw((-3.5,0)--(3.5,0));
		draw((0,-1*1.732/2-1.5)--(0,1*1.732/2+1.5));
	\end{asy}
\end{center}
The point is that every point $z\in\CC$ is now within one unit from a point in the lattice $\ZZ[\omega],$ so we retain our division algorithm.
\begin{prop}
	Fix $\omega:=\frac{1+\sqrt{-3}}2.$ Then $\ZZ[\omega]$ is a Euclidean domain.
\end{prop}
\begin{proof}
	This follows from the preceding discussion; as usual, imitate the proof in $\ZZ[i].$
\end{proof}
\begin{remark}[Nir]
	Something similar works for $\ZZ\left[\frac{1+\sqrt{-p}}2\right]$ where $p\in\{7,11\}.$ Notably, this does not work for $p=19,$ and it could not because we showed earlier that $\ZZ\left[\frac{1+\sqrt{-19}}2\right]$ is not Euclidean.
\end{remark}
We could classify the primes in $\ZZ[\omega],$ but we did not say anything about this in class, so I will not write it out here.

\subsubsection{Talking \texorpdfstring{$\ZZ[{\sqrt{-5}}]$}{}}
This ``make the ring bigger'' algorithm does not always work. For example, in $\ZZ[\sqrt{-5}]$ we have the failure of unique prime factorization
\[\left(1+\sqrt{-5}\right)\left(1-\sqrt{-5}\right)=2\cdot3.\]
For reference, here is the image of unit disks trying and failing to cover the plane.
\begin{center}
	\begin{asy}
		unitsize(0.6cm);
		pair v1 = dir(0);
		pair v2 = 2.236 * dir(90);
		for(int i = -3; i <= 3; ++i)
		{
			for(int j = -1; j <= 1; ++j)
			{
				dot(i*v1+j*v2);
				draw(circle(i*v1+j*v2,1), dotted);
			}
		}
		draw((-3.5,0)--(3.5,0));
		draw((0,-1*2.236-1.5)--(0,1*2.236+1.5));
	\end{asy}
\end{center}
However, $\ZZ\left[\frac{1+\sqrt{-5}}2\right]$ is not a good ring. One might hope that its lattice in $\CC$ is dense enough to cover the entire plane by unit disks, but the issue is that
\[\ZZ\left[\frac{1+\sqrt{-5}}2\right]\ne\left\{a+b\frac{1+\sqrt{-5}}2:a,b\in\ZZ\right\},\]
because the right-hand side isn't closed under multiplication.\footnote{$\left(\frac{1+\sqrt{-5}}2\right)^2=\frac{-2+i\sqrt5}{2}.$}

So we have that $\ZZ[\sqrt{-5}]$ is not a principal ideal domain, and we can't easily fix it either. Well, we are promised non-principal ideal domains, so let's try to see them. Visually, $\ZZ[\sqrt{-5}]$ is a rectangular lattice; let's put our ideals in there.

A principal ideal domain $\alpha\ZZ[\sqrt{-5}]$ will look like the $\ZZ[\sqrt{-5}]$ lattice scaled by $\sqrt{\alpha\overline\alpha}$ and rotated by the angle of $\alpha$ because that is how multiplication works in $\CC.$ For example, in red is the ideal $\left(1+\sqrt{-5}\right).$
\begin{center}
	\begin{asy}
		unitsize(0.6cm);
		pair v1 = dir(0);
		pair v2 = 2.236 * dir(90);
		draw((-7.8,0)--(7.8,0));
		draw((0,-2*2.236-1.3)--(0,2*2.236+1.3));
		for(int i = -7; i <= 7; ++i)
		{
			for(int j = -2; j <= 2; ++j)
			{
				dot(i*v1+j*v2);
				if((i-j) % 6 == 0)
					dot(i*v1+j*v2, 5+red);
			}
		}
	\end{asy}
\end{center}
Note that it looks like a rectangular lattice, as we expect from $\ZZ[\sqrt{-5}].$

In contrast, let's see a non-principal ideal domain. These tend to look like some kind of diamond lattice; for example, here is $\left(2,1+\sqrt{-5}\right),$ in red.
\begin{center}
	\begin{asy}
		unitsize(0.6cm);
		pair v1 = dir(0);
		pair v2 = 2.236 * dir(90);
		draw((-7.8,0)--(7.8,0));
		draw((0,-2*2.236-1.3)--(0,2*2.236+1.3));
		for(int i = -7; i <= 7; ++i)
		{
			for(int j = -2; j <= 2; ++j)
			{
				dot(i*v1+j*v2);
				if((i-j) % 2 == 0)
					dot(i*v1+j*v2, 5+red);
			}
		}
	\end{asy}
\end{center}
Similarly, any multiple of this ideal will rotate and magnify this ``diamond lattice,'' using the same logic as when we looked at principal ideals. So the principal and non-principal ideals really look irreconcilably different.

In $\ZZ[\sqrt{-5}]$ it happens that all ideals come with the flavor $(\alpha)$ or $(\alpha)\cdot\left(2,1+\sqrt{-5}\right)$ for some $\alpha\in\ZZ[\sqrt{-5}].$ To see this, take a course on algebraic number theory. The point is that all of our ideals either look like rectangular lattices or diamond lattices. In more complicated rings, there might be more kinds of ideals.

\end{document}