% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

\section{September 25}
Today we continue. We began class by saying a bit more about \Cref{thm:cong-selmer}, which I have placed in yesterday's notes.

\subsection{The Selmer Group of the Dual}
As usual, fix a number field $K$, and let $M$ be a Galois module. We would like to compare the Selmer group of $M$ and its dual $M^*$.
\begin{notation}
	Fix a number field $K$ and a finite discrete Galois module $M$ with local conditions $\mc L$. Then the dual module $M^*$ admits dual local conditions $\mc L^*\coloneqq\{\mc L_v^*\}_v$ defined by taking the annihilator along the duality of \Cref{thm:tate}. We say that $\mc L$ is \textit{self-dual} if and only if there is a choice of isomorphism $M\to M^*$ sending $\mc L$ to $\mc L^*$.
\end{notation}
\begin{remark}
	To check that $\mc L^*$ actually assembles into a local condition, we need to  check that $\mc L_v^*=\mathrm H^1_{\mathrm{ur}}(K_v;M^*)$ for all but finitely many places $v$. Well, $M$ is unramified at all but finitely places $v$ (by \Cref{rem:almost-unramified}), so $M^*$ is as well, and whenever $\mc L_v=\mathrm H^1_{\mathrm{ur}}(K_v;M)$, \Cref{prop:unramified-self-dual} tells us that the annihilator of $\mc L_v$ is
	\[\mc L_v^*=\mathrm H^1_{\mathrm{ur}}(K_v;M^*).\]
\end{remark}
\begin{remark}
	Taking annihilators is inclusion-reversing: if $\mc L\subseteq\mc L'$, then we can see place-by-place that $(\mc L')^*\subseteq\mc L^*$.
\end{remark}
\begin{example} \label{ex:self-dual-local-condition}
	Fix an elliptic curve $E$ over a number field $K$. Given a prime $p$, we let $\mc L_v\subseteq\mathrm H^1(K_v;E[p])$ be the image of $E(K_v)/mE(K_v)$. Then the Weil pairing provides an isomorphism $E[p]\cong E[m]^*$ of Galois modules (see \Cref{lem:weil-pairing}). Furthermore, this isomorphism makes $\mc L_v$ a maximal isotropic subspace by \Cref{prop:local-is-lagrangian}, so $\mc L_v$ is its own orthogonal complement; we conclude $\mc L$ is identified with $\mc L^*$.
\end{example}
For our main result, we will want to compare the Selmer group of $M$ and $M^*$. To state this appropriately, we will want the following exact sequence.
\begin{remark} \label{rem:selmer-les}
	For any inclusion of $\mc L\subseteq\mc L'$ of local conditions, we claim that there is a left-exact sequence
	\[0\to\op{Sel}_{\mc L}(M)\to\op{Sel}_{\mc L'}(M)\to\prod_v\frac{\mc L'_v}{\mc L_v}.\]
	The left map is induced by pulling back the inclusion $\prod_v\mc L_v\into\prod_v\mc L'_v$ along $\mathrm H^1(K;M)\to\mathrm H^1(\AA_K;M)$, and the right map is the canonical projection. The left map is injective by construction, and we are exact in the middle by definition of these Selmer groups: a class $c\in\op{Sel}_{\mc L'}(M)$ lives in $\op{Sel}_{\mc L}(M)$ if and only if $\op{loc}_vc\in\mc L_v$ for each place $v$.
\end{remark}
\begin{remark} \label{rem:selmer-pullback}
	An equivalent way to view \Cref{rem:selmer-les} is to say that the square
	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXG9we1NlbH1fe1xcbWMgTH0oTSkiXSxbMCwxLCJcXGRpc3BsYXlzdHlsZVxccHJvZF92XFxtYyBMX3YiXSxbMSwwLCJcXG9we1NlbH1fe1xcbWMgTCd9KE0pIl0sWzEsMSwiXFxkaXNwbGF5c3R5bGVcXHByb2RfdlxcbWMgTCdfdiJdLFswLDFdLFsxLDNdLFswLDJdLFsyLDNdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}[cramped]
		{\op{Sel}_{\mc L}(M)} & {\op{Sel}_{\mc L'}(M)} \\
		{\displaystyle\prod_v\mc L_v} & {\displaystyle\prod_v\mc L'_v}
		\arrow[from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
		\arrow[from=1-2, to=2-2]
		\arrow[from=2-1, to=2-2]
	\end{tikzcd}\]
	is a pullback square. Indeed, this is also equivalent to saying that an element $c\in\op{Sel}_{\mc L'}(M)$ in fact comes from $\op{Sel}_{\mc L}(M)$ if and only if $\op{loc}_vc\in\mc L_v$ for each place $v$.
\end{remark}
\begin{theorem} \label{thm:global-tate-application}
	Fix a number field $K$ and a Galois module $M$ with local conditions $\mc L\subseteq\mc L'$. Then
	% consider the perfect pairing of $\mc L_v$ and $\mathrm H^1(K_v;M^*)/\mc L^*$ induced by \Cref{thm:tate}. Then
	the image of the two canonical maps
	\[\op{Sel}_{\mc L'}(M)\to\prod_{v}\frac{\mc L_v'}{\mc L_v}\qquad\text{and}\qquad\op{Sel}_{\mc L^*}(M^*)\to\prod_v\frac{\mc L^*_v}{(\mc L')^*_v}\]
	are orthogonal complements of each other with respect to the pairing $\langle-,-\rangle\coloneqq\sum_v\langle-,-\rangle_v$, where $\langle-,-\rangle_v$ is induced by local Tate duality (\Cref{thm:tate}).
\end{theorem}
\begin{remark} \label{rem:global-tate-pairing}
	Let's explain why the given pairing is even well-defined. By \Cref{thm:tate}, we see that $\mc L_v$ and $\mc L_v^*$ are annihilators of each other (and similar for $(\mc L')^*$), so we can descend the local pairing to a well-defined perfect pairing
	\[\frac{\mc L'_v}{\mc L_v}\times\frac{\mc L_v^*}{(\mc L')^*_v}\to\QQ/\ZZ.\]
	In order to be able to sum this pairing over all $v$, we note that $\mc L_v=\mc L_v'=\mathrm H^1_{\mathrm{ur}}(K_v;M)$ for all but finitely many places $v$, so the product $\prod_v\mc L'_v/\mc L_v$ is actually a finite product; similarly, the product $\prod_v\mc L_v^*/(\mc L')^*_v$ is also finite.
\end{remark}
\begin{proof}
	Our exposition follows \cite[Theorem~1.7.3]{rubin-euler-systems}. We will use the middle three terms of the nine-term exact sequence arising from Pitou--Tate global duality, as stated in \Cref{thm:pitou-tate}.

	We now proceed with our argument. For brevity, let $\pi_M$ denote the map $\op{Sel}_{\mc L^\Sigma}(M)\to\prod_v\mc L'_v/\mc L_v$, and we define $\pi_{M^*}$ analogously. By symmetry of the situation (namely, we may replace $M$ with $M^*$), it is enough to show that
	\[(\im\pi_{M^*})^\perp\stackrel?=\im\pi_M.\]
	In other words, we would like to show that any $c\in\prod_v\mc L'_v/\mc L_v$ has $c\in\im\pi_M$ if and only if $\langle c,\pi_{M*}\widetilde c^*\rangle=0$ for all $\widetilde c'\in\op{Sel}_{\mc L^*}(M^*)$. This is then equivalent to saying that the sequence
	\[\op{Sel}_{\mc L'}(M)\stackrel{\pi_M}\to\prod_v\frac{\mc L'_v}{\mc L_v}\stackrel{\pi_{M^*}^\lor}\to\op{Sel}_{\mc L^*}(M^*)^\lor\]
	is exact, where $(-)^\lor\coloneqq\op{Hom}_\ZZ(-,\QQ/\ZZ)$ is the Pontryagin dual; here, the right map has identified $\mc L'_v/\mc L_v$ with $(\mc L_v^*/(\mc L')^*_v)^\lor$ via \Cref{thm:tate}.
	
	We now focus on the exactness of this sequence directly. We will have two cases: we start by handling large $\mc L'$ and small $\mc L$, and then we make a reduction to the general case. Let's begin with large $\mc L'$. Let $\Sigma$ be a finite set of places where $\mc L_v'\ne\mathrm H^1_{\mathrm{ur}}(K_v;M)$; for example, $\Sigma$ includes all archimedean places and all places where $M$ fails to be unramified. By enlarging $\mc L$, we are allowed to assume that $\mc L'_v=\mathrm H^1(K_v;M)$ for $v\in\Sigma$. Dually, we possibly expand $\Sigma$ (and so expand $\mc L'$) so that $\mc L_v=\mathrm H^1_{\mathrm{ur}}(K_v;M)$ for $v\notin\Sigma$ and $\mc L_v=0$ for $v\in\Sigma$.
	% To ease our notation, we observe that we may as well replace $\mc L$ with $\mc L^\Sigma$.
	% For example, we add to $\Sigma$ all archimedean places, all places where $M$ is ramified, and all places where $\mc L_v\ne\mathrm H^1(K_v;M)$. In particular, $\mc L_v^\Sigma=\mathrm H^1(K_v;M)$ for $v\in\Sigma$ and $\mc L_v^\Sigma=\mathrm H^1_{\mathrm{ur}}(K_v;M)$ for $v\notin\Sigma$; we find something similar for $(\mc L^*)^\Sigma$.
	We now have two steps.
	\begin{enumerate}
		\item The key claim is that
		\[\op{Sel}_{\mc L'}(M)\stackrel?=\mathrm H^1(K_\Sigma/K;M)\qquad\text{and}\qquad\op{Sel}_{\mc L^*}(M^*)\stackrel?=\mathrm H^1(K_\Sigma/K;M^*).\]
		By symmetry, it is enough to just handle the left equality. Well, $\op{Sel}_{\mc L'}(M)$ consists of the classes $c$ in $\mathrm H^1(K;M)$ which localize to unramified classes outside $\Sigma$. By the Inflation--Restriction exact sequence (\Cref{prop:inflation-restriction}), this is equivalent to asking for $c$ to vanish in $\mathrm H^1(I_v;M)$ for each inertia subgroup $I_v$ for $v\notin\Sigma$. Taking the union of these $I_v$s, it is equivalent to ask for $c$ to vanish in $\mathrm H^1(K_\Sigma;M)$, which by \Cref{prop:inflation-restriction} (again!) is equivalent to $c$ coming from $\mathrm H^1(K_\Sigma/K;M)$.

		\item We now apply \Cref{thm:pitou-tate}, which provides us with an exact sequence
		\[\op{Sel}_{\mc L'}(M)\stackrel{\pi_M}\to\bigoplus_{v\in\Sigma}\mathrm H^1(K_v;M)\stackrel{\pi_{M^*}^\lor}\to\op{Sel}_{\mc L^*}(M^*)^\lor.\]
		This is the desired exact sequence after replacing $\bigoplus_{v\in\Sigma}\mathrm H^1(K_v;M)$ with $\prod_v\mc L'_v/\mc L_v$, which is legal because
		\[\frac{\mc L_v'}{\mc L_v}=\begin{cases}
			\mathrm H^1(K_v;M) & \text{if }v\in\Sigma, \\
			0 & \text{otherwise}.
		\end{cases}\]
	\end{enumerate}
	We now turn to smaller $\mc L'$ and larger $\mc L$.
	% For these arguments, we note that \Cref{rem:selmer-les} allows us to view the desired exact sequence as a desired short exact sequence
	% \[0\to\frac{\op{Sel}_{\mc L'}(M)}{\op{Sel}_{\mc L}(M)}\stackrel{\pi_M}\to\prod_v\frac{\mc L'_v}{\mc L_v}\stackrel{\pi_{M^*}^\lor}\to\left(\frac{\op{Sel}_{\mc L^*}(M^*)}{\op{Sel}_{(\mc L')^*}(M^*)}\right)^\lor\to0,\]
	% where only exactness in the middle is up for debate. We now do our reductions in sequence.
	\begin{enumerate}
		\item We handle smaller $\mc L'$. Namely, suppose we have proven the statement for local conditions $\mc L\subseteq\mc L'_0$ (with $\mc L$ small and $\mc L'_0$ large), and we would like to show it for $\mc L\subseteq\mc L'$, where $\mc L'$ is between $\mc L$ and $\mc L'_0$. We note that we have a commutative diagram
		% https://q.uiver.app/#q=WzAsNixbMCwwLCJcXG9we1NlbH1fe1xcbWMgTCd9KE0pIl0sWzAsMSwiXFxvcHtTZWx9X3tcXG1jIEwnXzB9KE0pIl0sWzEsMCwiXFxkaXNwbGF5c3R5bGVcXHByb2RfdlxcZnJhY3tcXG1jIEwnX3Z9e1xcbWMgTF92fSJdLFsyLDAsIlxcb3B7U2VsfV97XFxtYyBMXip9KE1eKileXFxsb3IiXSxbMSwxLCJcXGRpc3BsYXlzdHlsZVxccHJvZF92XFxmcmFje1xcbWMgTCdfezB2fX17XFxtYyBMX3Z9Il0sWzIsMSwiXFxvcHtTZWx9X3tcXG1jIExeKn0oTV4qKV5cXGxvciJdLFswLDEsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoidG9wIn19fV0sWzIsNCwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoiaG9vayIsInNpZGUiOiJ0b3AifX19XSxbMCwyXSxbMSw0XSxbMyw1LCIiLDEseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDNdLFs0LDVdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}[cramped]
			{\op{Sel}_{\mc L'}(M)} & {\displaystyle\prod_v\frac{\mc L'_v}{\mc L_v}} & {\op{Sel}_{\mc L^*}(M^*)^\lor} \\
			{\op{Sel}_{\mc L'_0}(M)} & {\displaystyle\prod_v\frac{\mc L'_{0v}}{\mc L_v}} & {\op{Sel}_{\mc L^*}(M^*)^\lor}
			\arrow[from=1-1, to=1-2]
			\arrow[hook, from=1-1, to=2-1]
			\arrow[from=1-2, to=1-3]
			\arrow[hook, from=1-2, to=2-2]
			\arrow[equals, from=1-3, to=2-3]
			\arrow[from=2-1, to=2-2]
			\arrow[from=2-2, to=2-3]
		\end{tikzcd}\]
		where all vertical arrows are injective, and the bottom row is exact. By noting that limits commute with limits (or a direct diagram chase), it is enough to note that the left square is a pullback square, which follows from \Cref{rem:selmer-pullback}.

		\item We handle larger $\mc L$. Namely, suppose we have proven the statement for local conditions $\mc L_0\subseteq\mc L'$ (with $\mc L_0$ small), and we would like to show it for $\mc L\subseteq\mc L'$, where $\mc L$ is between $\mc L_0$ and $\mc L'$. Well, replacing $M$ with $M^*$ and dualizing all local conditions (and taking the Pontryagin dual of the desired exact sequence) allows us to repeat the argument of the previous case.
		% Now, we note that the diagram
		% % https://q.uiver.app/#q=WzAsNixbMCwxLCJcXG9we1NlbH1fe1xcbWMgTCd9KE0pIl0sWzEsMSwiXFxkaXNwbGF5c3R5bGVcXHByb2RfdlxcZnJhY3tcXG1jIEwnX3Z9e1xcbWMgTF92fSJdLFswLDAsIlxcb3B7U2VsfV97XFxtYyBMJ30oTSkiXSxbMSwwLCJcXGRpc3BsYXlzdHlsZVxccHJvZF92XFxmcmFje1xcbWMgTCdfdn17XFxtYyBMX3swdn19Il0sWzIsMCwiXFxvcHtTZWx9X3tcXG1jIExfMF4qfShNXiopXlxcbG9yIl0sWzIsMSwiXFxvcHtTZWx9X3tcXG1jIExeKn0oTV4qKV5cXGxvciJdLFsyLDAsIiIsMCx7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsMSwiIiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzQsNSwiIiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzAsMV0sWzEsNV0sWzIsM10sWzMsNF1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		% \[\begin{tikzcd}[cramped]
		% 	{\op{Sel}_{\mc L'}(M)} & {\displaystyle\prod_v\frac{\mc L'_v}{\mc L_{0v}}} & {\op{Sel}_{\mc L_0^*}(M^*)^\lor} \\
		% 	{\op{Sel}_{\mc L'}(M)} & {\displaystyle\prod_v\frac{\mc L'_v}{\mc L_v}} & {\op{Sel}_{\mc L^*}(M^*)^\lor}
		% 	\arrow[from=1-1, to=1-2]
		% 	\arrow[equals, from=1-1, to=2-1]
		% 	\arrow[from=1-2, to=1-3]
		% 	\arrow[two heads, from=1-2, to=2-2]
		% 	\arrow[two heads, from=1-3, to=2-3]
		% 	\arrow[from=2-1, to=2-2]
		% 	\arrow[from=2-2, to=2-3]
		% \end{tikzcd}\]
		% commutes, and all vertical arrows are surjective. We are given that the bottom row is exact, and we want to show that the top row is exact. By formally manipulating exact sequences, it is enough to show that the right square is a pushout. After taking $(-)^\lor$ everywhere, this reduces to the pullback square of \Cref{rem:selmer-pullback} for the local conditions $\mc L^*\subseteq\mc L_0^*$.
		\qedhere
	\end{enumerate}
\end{proof}
\begin{example} \label{ex:global-tate-application-surj}
	Given local conditions $\mc L\subseteq\mc L'$ of $M$, then \Cref{thm:global-tate-application} shows that one of the two maps
	\[\op{Sel}_{\mc L'}(M)\to\prod_v\frac{\mc L'_v}{\mc L_v}\qquad\text{and}\qquad\op{Sel}_{\mc L^*}(M^*)\to\prod_v\frac{\mc L^*_v}{(\mc L')^*_v}\]
	being surjective implies that the other one is zero. Indeed, the pairing between these two groups is the (finite) sum of perfect pairings and hence perfect (see \Cref{rem:global-tate-pairing}), so the orthogonal complement of a full space is zero.
	% Indeed, all groups in sight are finite (even the products, as noted in \Cref{rem:global-tate-pairing}), and the sizes of the images must be equal (because they are orthogonal complements of each other), so the result follows because the sizes of $\mc L'_v/\mc L_v$ and $\mc L^*_v/(\mc L')^*_v$ are the same (by duality, as in \Cref{rem:global-tate-pairing}).
\end{example}

\subsection{Modifying the Local Condition}
For our application, we will want some way to build inclusions of local conditions.
\begin{defihelper}[strict, relaxed] \nirindex{strict} \nirindex{relaxed}
	Fix a number field $K$ and a finite discrete Galois module $M$ with local conditions $\mc L$. For a finite set of places $\Sigma$, we define the \textit{strict local conditions $\mc L_\Sigma$} and the \textit{relaxed local conditions $\mc L_v^\Sigma$} by
	\[(\mc L_{\Sigma})_v\coloneqq\begin{cases}
		\mc L_v & \text{if }v\notin\Sigma, \\
		0 & \text{if }v\in\Sigma,
	\end{cases}\qquad\text{and}\qquad\big(\mc L^\Sigma\big)_v\coloneqq\begin{cases}
		\mc L_v & \text{if }v\notin\Sigma, \\
		\mathrm H^1(K_v;M) & \text{if }v\in\Sigma.
	\end{cases}\]
	If $\Sigma$ is a singleton $\{v_0\}$, we may abuse notation and write $\mc L_{v_0}$ and $\mc L^{v_0}$ for the strict and local conditions, respectively.
\end{defihelper}
\begin{remark}
	Of course, $\mc L^\Sigma$ and $\mc L_\Sigma$ continue to be local conditions because all but finitely many $v$ have $v\notin\Sigma$ and also $\mc L_v=\mathrm H^1_{\mathrm{ur}}(K_v;M)$.
\end{remark}
\begin{example} \label{ex:modify-dual-local-condition}
	We claim that $(\mc L_\Sigma)^*=(\mc L^*)^\Sigma$. Indeed, for any $v\notin\Sigma$, both sides are $\mc L_v^*$; and for any $v\in\Sigma$, both sides are $\{0\}^*=\mathrm H^1(K_v;M^*)$. Similarly, we see that $(\mc L^\Sigma)^*=(\mc L^*)_\Sigma$.
\end{example}
% \begin{remark} \label{rem:strict-include-relaxed}
% 	By checking place-by-place, we see that there are inclusions $\mc L_\Sigma\subseteq\mc L\subseteq\mc L^\Sigma$, so taking the pullback along $\mathrm H^1(K;M)\to\mathrm H^1(\AA_K;M)$ yields inclusions
% 	\[\op{Sel}_{\mc L_\Sigma}(M)\subseteq\op{Sel}_{\mc L}(M)\subseteq\op{Sel}_{\mc L^\Sigma}(M).\]
% \end{remark}
% \begin{remark}
% 	% Note that there is a short exact sequence
% 	% \[0\to\prod_v(\mc L_\Sigma)_v\to\prod_v\big(\mc L^\Sigma\big)_v\to\prod_{v\in\Sigma}\mc L_v\to0,\]
% 	% which can be checked at each place $v$ (where either the left or right maps are isomorphisms). Pulling this back along the map $\mathrm H^1(K;M)\to\mathrm H^1(\AA_K;M)$ produces
% 	We claim that there is a left-exact sequence
% 	\[0\to\op{Sel}_{\mc L_\Sigma}(M)\to\op{Sel}_{\mc L}(M)\to\bigoplus_{v\in\Sigma}\mc L_v.\]
% 	The left map is the inclusion of \Cref{rem:strict-include-relaxed}, and the right map is the canonical projection to $\prod_v\mc L_v$. Exactness in the middle follows by definition of these Selmer group: an element $c\in\op{Sel}_{\mc L}(M)$ comes from $\op{Sel}_{\mc L_\Sigma}(M)$ if and only if $\op{loc}_v(c)=0$ for $v\in\Sigma$ (because the other local conditions at $v\notin\Sigma$ are already satisfied).
% \end{remark}
\begin{example} \label{ex:selmer-surjective-to-zero-relax}
	Fix a finite set of places $\Sigma$. If the map $\op{Sel}_{\mc L}(M)\to\bigoplus_{v\in\Sigma}\mc L_v$ is surjective, then we claim that the map
	\[\op{Sel}_{(\mc L^*)^\Sigma}(M^*)\to\bigoplus_{v\in\Sigma}\frac{\mathrm H^1(K_v;M^*)}{\mc L_v^*}\]
	vanishes. Indeed, this follows from \Cref{ex:global-tate-application-surj} (and \Cref{ex:modify-dual-local-condition}) using the local conditions $\mc L_\Sigma\subseteq\mc L$.
\end{example}
For our application, we will explain how a Selmer rank changes as we modify the local condition ``one place at a time.'' For later use, we pick up a technical result, which finds its application in the next subsection.
\begin{lemma} \label{lem:basic-selmer-change}
	Fix a number field $K$ and a finite self-dual Galois module $M$ which is a vector space over $\FF_p$. Let $\mc L$ be a self-dual local condition. Letting $\Sigma$ be the singleton of a place $v_0$, we have
	\[\dim_{\FF_p}\op{Sel}_{\mc L^\Sigma}(M)-\dim_{\FF_p}\op{Sel}_{\mc L_\Sigma}(M)=\frac12\dim_{\FF_p}\mathrm H^1(K_{v_0};M).\]
\end{lemma}
\begin{proof}
	% The point is to use \Cref{ex:self-dual-local-condition}, which explains that the Weil pairing provides an isomorphism $M\cong M^*$ of Galois modules, and we are given that it also induces an identification $\mc L\cong\mc L^*$ of local conditions. %(see \Cref{lem:weil-pairing}). Furthermore, \Cref{prop:local-is-lagrangian} explains that $\mc L_v\subseteq\mathrm H^1(K_v;M)$ becomes maximal isotropic under the induced pairing, so $\mc L_v^*$ is identified with $\mc L_v$.
	%
	\Cref{rem:selmer-les} provides us with the exact sequences
	\[0\to\op{Sel}_{\mc L_\Sigma}(M)\to\op{Sel}_{\mc L^\Sigma}(M)\to\mathrm H^1(K_{v_0};M),\]
	and
	\[0\to\op{Sel}_{(\mc L^*)_\Sigma}(M^*)\to\op{Sel}_{(\mc L^*)^\Sigma}(M^*)\to\mathrm H^1(K_{v_0};M^*),\]
	and \Cref{thm:global-tate-application} tells us that the images in the rightmost terms are orthogonal complements (where we have silently used \Cref{ex:modify-dual-local-condition}). Now, via the duality $M\cong M^*$ discussed in the previous paragraph, the second exact sequence is identified with the first one. We conclude that
	\[\frac{\op{Sel}_{\mc L^\Sigma}(M)}{\op{Sel}_{\mc L_\Sigma}(M)}\subseteq\mathrm H^1(K_{v_0};M)\]
	is the orthogonal complement of itself, so the result follows.
	% (We have silently used \Cref{ex:modify-dual-local-condition}.)
\end{proof}
\begin{example}
	In the sequel, we will typically take $\mc L$ to be the local condition $\mc L_v\coloneqq E(K_v)/pE(K_v)$, which is self-dual as discussed in \Cref{prop:local-is-lagrangian}.
\end{example}
\begin{lemma} \label{lem:change-selmer-one-place}
	Fix an elliptic curve $E$ over a number field $K$. Choose a prime $p$, and set $\mc L$ to be a local condition on $E[p]$ with $\mc L=\mc L^*$. Further, for a given place $v_0$, let $\mc L'_{v_0}\subseteq\mathrm H^1(K_{v_0};E[p])$ be some self-dual subspace disjoint from $\mc L_{v_0}$, and extend it to the local condition $\mc L'$ given by $\mc L'_v=\mc L_v$ for $v\ne v_0$.
	% \[\mc L'_v\coloneqq\begin{cases}
	% 	\mc L'_{v_0} & \text{if }v=v_0, \\
	% 	\mc L_v & \text{otherwise}.
	% \end{cases}\]
	\begin{listalph}
		\item If $\op{Sel}_{\mc L}(E[p])\to\mathrm H^1(K_{v_0};E[p])$ vanishes, then
		\[\dim_{\FF_p}\op{Sel}_{\mc L'}(E[p])=\dim_{\FF_p}\op{Sel}_{\mc L}(E[p])+\frac12\dim_{\FF_2}\mathrm H^1(K_{v_0};E[p]).\]
		\item If $\op{Sel}_{\mc L}(E[p])\to\mathrm H^1(K_{v_0};E[p])$ surjects onto $\mc L_{v_0}$, then
		\[\dim_{\FF_p}\op{Sel}_{\mc L}(E[p])=\dim_{\FF_p}\op{Sel}_{\mc L'}(E[p])-\frac12\dim_{\FF_2}\mathrm H^1(K_{v_0};E[p]).\]
	\end{listalph}
\end{lemma}
\begin{proof}
	All the hypotheses will be used, though much care will be required. Set $M\coloneqq E[p]$ and $\Sigma\coloneqq\{v_0\}$ for brevity. The main point is to chase around a pullback square. Because $\mc L_{v_0}$ and $\mc L'_{v_0}$ are disjoint maximal isotropic subspaces, we see that $\mc L+\mc L'=\mc L^\Sigma$ and $\mc L\cap\mc L'=\mc L_\Sigma$. Pulling back the intersection along $\mathrm H^1(K;M)\to\mathrm H^1(\AA_K;M)$ produces the pullback square
	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXG9we1NlbH1fe1xcbWMgTF9cXFNpZ21hfShNKSJdLFsxLDAsIlxcb3B7U2VsfV97XFxtYyBMJ30oTSkiXSxbMCwxLCJcXG9we1NlbH1fe1xcbWMgTH0oTSkiXSxbMSwxLCJcXG9we1NlbH1fe1xcbWMgTF5cXFNpZ21hfShNKSJdLFswLDJdLFsyLDNdLFswLDFdLFsxLDNdLFswLDMsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\begin{equation}
		\begin{tikzcd}[cramped]
			{\op{Sel}_{\mc L_\Sigma}(M)} & {\op{Sel}_{\mc L'}(M)} \\
			{\op{Sel}_{\mc L}(M)} & {\op{Sel}_{\mc L^\Sigma}(M)}
			\arrow[from=1-1, to=1-2]
			\arrow[from=1-1, to=2-1]
			\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
			\arrow[from=1-2, to=2-2]
			\arrow[from=2-1, to=2-2]
		\end{tikzcd} \label{eq:pullback-of-selmers}
	\end{equation}
	of intersections inside $\mathrm H^1(K;M)$. We now show (a) and (b) separately.
	\begin{listalph}
		\item The exactness of
		\[0\to\op{Sel}_{\mc L_\Sigma}(M)\to\op{Sel}_{\mc L}(M)\to\mc L_\ell\]
		from \Cref{rem:selmer-les} implies that the inclusion $\op{Sel}_{\mc L_\Sigma}(M)\to\op{Sel}_\mc L(M)$ is an isomorphism. Thus, the left arrow of \eqref{eq:pullback-of-selmers} is an isomorphism, so the right arrow is also an isomorphism, and the result follows from \Cref{lem:basic-selmer-change}.

		\item We are given that $\op{Sel}_{\mc L}(M)\to\mc L_\ell$ is surjective,
		% \[0\to\op{Sel}_{\mc L_\Sigma}(E[2])\to\op{Sel}_2(E)\to\mc L_\ell\]
		% is surjective on the right,
		so \Cref{ex:selmer-surjective-to-zero-relax} implies that the exact sequence
		\[0\to\op{Sel}_{\mc L}(M)\to\op{Sel}_{\mc L^\Sigma}(M)\to\frac{\mathrm H^1(K_{v_0};M)}{\mc L_{v_0}}\]
		of \Cref{rem:selmer-les} maps to $0$ at the end, so the inclusion $\op{Sel}_{\mc L}(M)\to\op{Sel}_{\mc L^\Sigma}(M)$ is an isomorphism. (We are silently using $\mc L=\mc L^*$ and \Cref{ex:modify-dual-local-condition}.) Thus, the bottom arrow of \eqref{eq:pullback-of-selmers} is an isomorphism, so the top arrow is also an isomorphism. The claim now follows from \Cref{lem:basic-selmer-change}.
		\qedhere
	\end{listalph}
\end{proof}
% \begin{remark}
% 	By \Cref{prop:local-is-lagrangian}, the subspace $\mc L_{v_0}\subseteq\mathrm H^1(K_{v_0};E[p])$ is also the orthogonal complement of itself, so
% 	\[\dim_{\FF_p}\mc L_{v_0}=\frac12\dim_{\FF_p}\mathrm H^1(K_{v_0};E[p]).\]
% \end{remark}
% Fix a rational prime $p$, and take $\Sigma$ to be given by a single place $v_0\nmid p$. Given an elliptic curve $E$ over a number field $K$, we set $M\coloneqq E[p]$, which we recall is a self-dual Galois module. As usual, we take our local conditions $\mc L$ to be given by the image of the embedding
% \[E(K_v)/pE(K_v)\to\mathrm H^1(K_v;M)\]
% induced from the Kummer exact sequence. We now have exact sequences
% \[0\to\underbrace{\op{Sel}_{p_\Sigma}(E)}_{\op{Sel}_{\mc L_\Sigma}(E[p])\coloneqq}\to\op{Sel}_p(E)\to\mc L_{v_0}\]
% and
% \[0\to\op{Sel}_p(E)\to\underbrace{\op{Sel}_{p^\Sigma}(E)}_{\op{Sel}_{\mc L^\Sigma}(E[p])\coloneqq}\to\frac{\mathrm H^1(K_{v_0};E[p])}{\mc L_{v_0}}.\]
% By multiplying the size of the kernel and cokernel, we conclude that
% \[\dim_{\FF_p}\frac{\op{Sel}_{p^\Sigma}(E)}{\op{Sel}_{p_\Sigma}(E)}=\dim\mc L_{v_0}=\frac12\dim_{\FF_p}\mathrm H^1(K_{v_0};E[p])\]
% by \Cref{thm:global-tate-application}. For example, if $E$ has good reduction at $v_0$, then we see $\mc L_{v_0}=\mathrm H^1_{\mathrm{ur}}(K_{v_0};E[p])$, whose dimension can be computed after passing to the residue field as $E[p](k_{v_0})$. This dimension is in $\{0,1,2\}$ and only depends on some Frobenius eigenvalue.

\subsection{Application to Congruent Number Elliptic Curves}
As an application, we compare $2$-Selmer ranks of congruent number elliptic curves.
% \begin{proposition} \label{prop:selmer-change-1}
% 	Fix an odd positive squarefree integer $d$ and an odd prime $\ell$ not dividing $d$, and let $E$ and $E'$ be the projective closures of $y^2=x(x-d)(x+d)$ and $y^2=x(x-d\ell)(x+d\ell)$, respectively. Further, let $\mc L$ and $\mc L'$ be the associated local conditions on $\mathrm H^1(\QQ;H)$, where $H\subseteq\mu_2^{\oplus3}$ is the trace-zero hyperplane. Suppose further that $\mc L_v=\mc L'_v$ for all $v\ne\ell$.
% 	\begin{listalph}
% 		\item With $\Sigma\coloneqq\{\ell\}$, we have
% 		\[\dim_{\FF_2}\op{Sel}_{\mc L^\Sigma}(E[2])=\dim_{\FF_2}\op{Sel}_{\mc L_\Sigma}(E[2])+2.\]
% 		\item If the map $\op{Sel}_2(E)\to\mathrm H^1(\QQ_\ell;E[2])$ vanishes, then
% 		\[\dim_{\FF_2}\op{Sel}_2(E')=\dim_{\FF_2}\op{Sel}_2(E)+2.\]
% 		\item If the map $\op{Sel}_2(E)\to\mathrm H^1(\QQ_\ell;E[2])$ surjects onto $\mathrm H^1_{\mathrm{ur}}(\QQ_\ell;E[2])$, then
% 		\[\dim_{\FF_2}\op{Sel}_2(E')=\dim_{\FF_2}\op{Sel}_2(E)-2.\]
% 	\end{listalph}
% \end{proposition}
% \begin{proof}
% 	Note (a) follows immediately from \Cref{lem:basic-selmer-change} because $\mc L=\mc L^*$ by \Cref{prop:local-is-lagrangian}, and
% 	\[\frac12\dim_{\FF_2}\mathrm H^1(K_\ell;E[2])=2\]
% 	by the discussion in \Cref{ex:size-im-delta-v}.
%
% 	We now turn to (b) and (c). The key claim is that
% 	\[\mc L_\ell\cap\mc L_\ell'\stackrel?=\{(1,1,1)\}.\]
% 	Indeed, using \Cref{lem:cong-local-condition}, every nontrivial triple $(\alpha,\beta,\gamma)$ in $\mc L_\ell'$ has $1\in\{v(\alpha),v(\beta),v(\gamma)\}$ while $\mc L_\ell$ exclusively has triples $(\alpha,\beta,\gamma)$ for which $v(\alpha)=v(\beta)=v(\gamma)=0$. Thus, the only triple in the intersection is the trivial one. While we're here, we remark that we also have $\mc L_\ell+\mc L_\ell'=\mathrm H^1(\QQ_\ell;H)$ because each subspace has half the dimension of the total (by \Cref{prop:local-is-lagrangian}).
%
% 	Now, (b) and (c) will follow by considering the following pullback square
% 	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXG9we1NlbH1fezJfXFxTaWdtYX0oRSkiXSxbMSwwLCJcXG9we1NlbH1fMihFJykiXSxbMCwxLCJcXG9we1NlbH1fMihFKSJdLFsxLDEsIlxcb3B7U2VsfV97Ml5cXFNpZ21hfShFKSJdLFswLDJdLFsyLDNdLFswLDFdLFsxLDNdLFswLDMsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
% 	\begin{equation}
% 		\begin{tikzcd}[cramped]
% 			{\op{Sel}_{\mc L_\Sigma}(H)} & {\op{Sel}_2(E')} \\
% 			{\op{Sel}_2(E)} & {\op{Sel}_{\mc L^\Sigma}(H)}
% 			\arrow[from=1-1, to=1-2]
% 			\arrow[from=1-1, to=2-1]
% 			\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
% 			\arrow[from=1-2, to=2-2]
% 			\arrow[from=2-1, to=2-2]
% 		\end{tikzcd} %\label{eq:pullback-of-selmers}
% 	\end{equation}
% 	of intersections inside $\mathrm H^1(\QQ;H)$. To see that this is a pullback square, we note that it is the pullback of the two equations $\mc L\cap\mc L'=\mc L_\Sigma$ and $\mc L+\mc L'=\mc L^\Sigma$ (from the previous paragraph) along $\mathrm H^1(\QQ;H)\to\mathrm H^1(\AA_\QQ;H)$.
%
% 	We now show (b) and (c) separately.
% 	\begin{enumerate}[label=(\alph*)]
% 		\setcounter{enumi}{1}
% 		\item The exactness of
% 		\[0\to\op{Sel}_{\mc L_\Sigma}(H)\to\op{Sel}_2(E)\to\mc L_\ell\]
% 		from \Cref{rem:selmer-les} implies that the inclusion $\op{Sel}_{\mc L_\Sigma}(H)\to\op{Sel}_2(E)$ is an isomorphism. Thus, the left arrow of \eqref{eq:pullback-of-selmers} is an isomorphism, so the right arrow is also an isomorphism, and the result follows from (a).
%
% 		\item The assumption implies that $\op{Sel}_2(E)\to\mc L_\ell$ is surjective,
% 		% \[0\to\op{Sel}_{\mc L_\Sigma}(E[2])\to\op{Sel}_2(E)\to\mc L_\ell\]
% 		% is surjective on the right,
% 		so \Cref{ex:selmer-surjective-to-zero-relax} implies that the exact sequence
% 		\[0\to\op{Sel}_2(E)\to\op{Sel}_{\mc L^\Sigma}(H)\to\frac{\mathrm H^1(\QQ_{\ell};H)}{\mc L_{\ell}}\]
% 		of \Cref{rem:selmer-les} maps to $0$ at the end, so the inclusion $\op{Sel}_2(E)\to\op{Sel}_{\mc L^\Sigma}(H)$ is an isomorphism. Thus, the bottom arrow of \eqref{eq:pullback-of-selmers} is an isomorphism, so the top arrow is also an isomorphism. The claim now follows from (a).
% 		\qedhere
% 	\end{enumerate}
% \end{proof}
\begin{lemma} \label{lem:get-selmer-change-1}
	Fix an odd positive squarefree integer $d$ and an odd prime $\ell$ not dividing $d$, and let $E$ and $E'$ be the projective closures of $y^2=x(x-d)(x+d)$ and $y^2=x(x-d\ell)(x+d\ell)$, respectively. Further, let $\mc L$ and $\mc L'$ be the associated local conditions on $\mathrm H^1(\QQ;H)$, where $H\subseteq\mu_2^{\oplus3}$ is the trace-zero hyperplane.
	\begin{listalph}
		\item The local conditions $\mc L$ and $\mc L'$ are self-dual.
		\item The group $\mc L_\ell\cap\mc L_\ell'$ is trivial.
		\item We have $\mc L_v=\mc L'_v$ for all $v\ne\ell$ if and only if $\ell\equiv1\pmod8$ and $\ell\in\QQ_p^{\times2}$ for each prime $p\mid d$.
	\end{listalph}
\end{lemma}
\begin{proof}
	Quickly, (a) follows from \Cref{prop:local-is-lagrangian}. For (b), we use \Cref{lem:cong-local-condition}. Indeed, every nontrivial triple $(\alpha,\beta,\gamma)$ in $\mc L_\ell'$ has $1\in\{v(\alpha),v(\beta),v(\gamma)\}$ while $\mc L_\ell$ exclusively has triples $(\alpha,\beta,\gamma)$ for which $v(\alpha)=v(\beta)=v(\gamma)=0$. Thus, the only triple in the intersection is the trivial one. While we're here, we remark that we also have $\mc L_\ell+\mc L_\ell'=\mathrm H^1(\QQ_\ell;H)$ because each subspace has half the dimension of the total (by \Cref{prop:local-is-lagrangian}).

	We now show (c) by casework, going place-by-place; we will use \Cref{lem:cong-local-condition} freely throughout.
	\begin{itemize}
		\item For $v\nmid2d\ell\infty$, we see that $\mc L_v$ and $\mc L_v'$ both contain the triples $(\alpha,\beta,\gamma)$ with $v(\alpha)=v(\beta)=v(\gamma)=0$.
		\item For $v=\infty$, both are the same.
		\item For finite $v=p$ with $p\mid d$, we note that we certainly have $\#\mc L_v=\#\mc L_v'$, so it is enough to just get an inclusion. Comparing the two $\FF_2$-subspaces, it is enough to check $\{(-1,-d\ell,d\ell),(d\ell,2,2d\ell)\}\subseteq\mc L_p$, which is equivalent to having $\{(1,\ell,\ell),(\ell,1,\ell)\}\subseteq\mc L_p$. This inclusion forces $(1,\ell,\ell)=(1,1,1)$ by considering valuations, so $\ell$ must be a square in $\QQ_p^\times$; conversely, if $\ell$ is a square, then $(1,\ell,\ell)=(\ell,1,\ell)=(1,1,1)$.
		\item Lastly, for $v=2$, it is once again enough to achieve the inclusion $\{(1,\ell,\ell),(\ell,1,\ell)\}\subseteq\mc L_2$. This time, considering valuations (and the fact that $-1$ is not a square) implies that $(1,\ell,\ell)$ is either $(1,1,1)$ or $(1,5,5)$, which means that either $\ell$ or $5\ell$ is a square in $\QQ_2$. But if $5\ell$ is a square, then $(\ell,1,\ell)\notin\mc L_2$, so we must instead have $\ell$ be a square. Of course, having $\ell$ be a square is also sufficient.
	\end{itemize}
	Combining the above cases completes the argument.
\end{proof}
\begin{example}
	Let $E'$ be the projective closure of $y^2=x(x-\ell)(x+\ell)$, where $\ell$ is a prime equivalent to $1\pmod8$. Then we claim that $S_2(E')=2$, thereby recovering some of \Cref{thm:cong-selmer}. Indeed, let $E$ be the projective closure of $y^2=x(x-1)(x+1)$, and we know that $S_2(E)=0$ by \Cref{cor:selmer-trivial-bound}. In particular, it follows that $\op{Sel}_2(E)$ is represented by the triples coming from $E[2]$, which are
	\[\{(1,1,1),(-1,-1,1),(1,2,2),(-1,-2,2)\}.\]
	Because $\ell\equiv1\pmod8$, these all give the trivial class in $\mathrm H^1(\QQ_\ell;H)$, so all parts of \Cref{lem:get-selmer-change-1} are satisfied, so \Cref{lem:change-selmer-one-place} kicks in and yields $S_2(E')=S_2(E)+2=2$.
\end{example}
In fact, we can upgrade this argument as follows.
\begin{proposition}
	Fix a set $S$ of primes such that each pair $(\ell_1,\ell_2)$ of primes in $S$ have $\ell_1,\ell_2\equiv1\pmod8$ and $\ell_1\in\QQ_{\ell_2}^{\times2}$. Further, let $d$ be the product of the primes in $S$, and let $E$ be the projective closure of $y^2=x(x-d)(x+d)$. Then
	\[\dim_{\FF_2}\op{Sel}_2(E)=2\#S+2.\]
\end{proposition}
\begin{proof}
	We induct on $\#S$. For $\#S=0$, this follows from \Cref{cor:selmer-trivial-bound} because $\dim_{\FF_2}E[2](\QQ)=2$ already.

	For the induction, suppose we have the statement for $S$ and $d$, and we would like to show it for $S\cup\{\ell\}$ for some prime $\ell\notin S$ which is $1\pmod8$ and a square modulo every prime of $S$. Accordingly, let $E$ and $E'$ be the projective closures of $y^2=x(x-d)(x+d)$ and $y^2=x(x-d\ell)(x+d\ell)$. We would like to show that
	\[\dim_{\FF_2}\op{Sel}_2(E')\stackrel?=\dim_{\FF_2}\op{Sel}_2(E)+2.\]
	Note that all parts of \Cref{lem:get-selmer-change-1} are satisfied, so \Cref{lem:change-selmer-one-place} applies, so it remains to show that the map $\op{Sel}_2(E)\to\mathrm H^1(\QQ_\ell;E[2])$ vanishes.
	% For example, each triple
	% \[\{(1,1,1),(-1,-d,d),(d,2,2d),(-d,-2d,2)\}\]
	% arising from $E[2]$ is trivial in $\mathrm H^1(\QQ_\ell;H)$ because $-1$, $2$, and every prime dividing $d$ are all squares in $\QQ_\ell$: the first two arise because $\ell\equiv1\pmod8$, and the third is true by quadratic reciprocity.
	Well, the calculation of \Cref{thm:cong-selmer} shows that each class in $\op{Sel}_2(E)/E[2]$ is represented by a triple in
	\[\left\{(\alpha,\beta,\gamma)\in\ZZ:\alpha,\beta,\gamma\mid2d,\alpha\beta\gamma\text{ is square}\right\}.\]
	We now claim that each triple $(\alpha,\beta,\gamma)$ in the larger right-hand set is trivial in $\mathrm H^1(\QQ_\ell;H)$, which will complete the proof. To show the claim, it is enough to see that $-1$, $2$, and every prime dividing $d$ are all squares in $\QQ_\ell$. The first two arise because $\ell\equiv1\pmod8$, and the last is true by quadratic reciprocity.
\end{proof}
Here is a more involved application.
\begin{proposition}
	Fix a set $S$ of primes such that each pair $(\ell_1,\ell_2)$ of primes in $S$ have $\ell_1,\ell_2\equiv5\pmod8$ and $\ell_1\notin\QQ_{\ell_2}^{\times2}$. Further, suppose that $\#S$ is odd, and let $d$ be the product of the primes in $S$. Letting $E$ denote the projective closure of $y^2=x(x-d)(x+d)$, we have
	\[\dim_{\FF_2}\op{Sel}_2(E)=3.\]
\end{proposition}
\begin{proof}
	Using the notation of \Cref{thm:cong-selmer}, we will show the stronger statement that
	\[\op{Sel}_2(E)\stackrel?=\op{span}(E[2]\cup\{(1,d,d)\}).\]
	The rank claim then follows because the triples $\{(-1,-d,d),(d,2,2d),(1,d,d)\}$ form a basis. For this, we induct on $\#S$, where $\#S=1$ follows from \Cref{thm:cong-selmer}.

	For the induction, suppose we have the statement for $S$ and $d$, and we would like to show it for some set $S\cup\{\ell_1,\ell_2\}$ still satisfying the list of conditions; set $\ell\coloneqq\ell_1\ell_2$ for brevity. Accordingly, let $E$ and $E'$ be the projective closures of $y^2=x(x-d)(x+d)$ and $y^2=(x-d\ell)(x+d\ell)$. Let $\mc L$ and $\mc L'$ be the associated local conditions of $\mathrm H^1(\AA_K;H)$, where $E[2]$ and $E'[2]$ are identified with $H$ as in \Cref{thm:cong-selmer}.

	Quickly, let's compare our local conditions $\mc L$ and $\mc L'$, freely using \Cref{lem:cong-local-condition}.
	\begin{itemize}
		\item For $v\nmid2d\ell\infty$, we see that $\mc L_v$ and $\mc L'_v$ both contain the unramified triples.
		\item For $v=\infty$, both are the same.
		\item For finite $v=p$ with $p\mid d$, we claim that $\mc L_v=\mc L'_v$. Well, the sizes are the same, so it is enough to just get an inclusion, so it is enough to check $\{(-1,-d\ell,d\ell),(d\ell,2,2d\ell)\}\subseteq\mc L_p$, which is equivalent to having $\{(1,\ell,\ell),(\ell,1,\ell)\}\subseteq\mc L_p$. But this is true because $\ell=\ell_1\ell_2$ is a square in $\QQ_p^\times$.
		\item For $v=2$, it is once again enough to achieve the inclusion $\{(1,\ell,\ell),(\ell,1,\ell)\}\subseteq\mc L_2$. This is true because $\ell\equiv1\pmod8$, so $\ell\in\QQ_2^{\times2}$.
		% This time, considering valuations (and the fact that $-1$ is not a square) implies that $(1,\ell,\ell)$ is either $(1,1,1)$ or $(1,5,5)$, which means that either $\ell$ or $5\ell$ is a square in $\QQ_2$. But if $5\ell$ is a square, then $(\ell,1,\ell)\notin\mc L_2$, so we must instead have $\ell$ be a square. Of course, having $\ell$ be a square is also sufficient.
		\item Lastly, for $v\in\{\ell_1,\ell_2\}$, we see that $\mc L_v$ contains unramified triples, but the only unramified triple in $\mc L'_v$ is the trivial one, so $\mc L_v\cap\mc L'_v$ is trivial.
	\end{itemize}
	Thus, we see that we are going to use \Cref{lem:change-selmer-one-place} twice. Accordingly, let $\mc L''$ be an ``intermediate'' local condition given by
	\[\mc L''_v\coloneqq\begin{cases}
		\mc L_v & \text{if }v\ne\ell_1, \\
		\mc L_v' & \text{if }v=\ell_1.
	\end{cases}\]
	Thus, $\mc L$ and $\mc L''$ differ only at the place $v=\ell_1$, and $\mc L''$ and $\mc L'$ differ only at the place $v=\ell_2$. We now have two steps.
	\begin{enumerate}
		\item We claim that $\op{Sel}_{\mc L''}(H)=\{(1,1,1),(-1,-1,1)\}$. One inclusion is not so bad: certainly $(1,1,1)\in\op{Sel}_{\mc L''}(H)$. Additionally, $(1,-1,-1)\in\op{Sel}_{\mc L''}(H)$ because it is already in $\mc L_v$ for all $v$, and $(1,-1,-1)\in\mc L_{\ell_1}$ because $(-1,-1,1)$ equals $(1,1,1)$ up to squares in $\QQ_{\ell_1}^\times$.
		% by checking place-by-place: $v\nmid2d\ell_1$ has nothing to do, $v\mid2d$ follows because $(1,d,d)\in\op{Sel}_{\mc L}(H)$ and $\ell\in\QQ_v^{\times2}$, and $v=\ell_1$ follows because this is equivalent to $(-1,-d\ell,d\ell)$ up to squares.

		For the other inclusion, it is enough to check that
		\[\dim_{\FF_2}\op{Sel}_{\mc L''}(H)=\op{Sel}_{\mc L}(H)-2.\]
		For this, we use \Cref{lem:change-selmer-one-place}(b) at the place $v_0=\ell_1$. The hypotheses on the local conditions were checked above, so it remains to check that the map $\op{Sel}_{\mc L}(H)\to\mc L_{\ell_1}$ is surjective. This holds by the calculation of \Cref{lem:cong-local-condition} by using the global triples coming from $E[2]$.

		\item We claim that $\op{Sel}_{\mc L'}(H)=\op{span}(E'[2]\cup\{(1,d\ell,d\ell)\}$, which will complete the proof. Again, one inclusion is not so bad: certainly $E'[2]$ provides elements of the Selmer group. Additionally, we once again see that $(1,d\ell,d\ell)\in\op{Sel}_{\mc L'}(H)$ by checking place-by-place: along with the checks from the previous step, we merely have to check that $(1,d\ell,d\ell)\in\mc L'_{\ell_2}$, which is true because this triple is equivalent to $(-1,-d\ell,d\ell)$ up to squares.

		For the other inclusion, we will again use ranks, noting that it is enough to check that
		\[\dim_{\FF_2}\op{Sel}_{\mc L'}(H)=\op{Sel}_{\mc L''}(H)+2,\]
		which will follow from \Cref{lem:change-selmer-one-place}(b) at the place $v_0=\ell_2$. Again, the hypotheses on the local conditions are satisfied, so it remains to check that the map $\op{Sel}_{\mc L''}(H)\to\mc L''_{\ell_2}$ is trivial. Well, from the calculation in the previous step, we know that $\op{Sel}_{\mc L''}(H)=\{(1,1,1),(-1,-1,1)\}$, and both of these elements are trivial up to squares in $\QQ_{\ell_2}^\times$.
		\qedhere
	\end{enumerate}
\end{proof}
\begin{remark}
	Many of these techniques can be made to work in more generality. For example, we refer to \cite[Sections~2 and~3]{mazur-rubin-rank-twist} for a taste of such results.
\end{remark}



% We now compare the Selmer groups of some quadratic twists. Fix an elliptic curve $E$ over $\QQ$, and let $E'$ be its quadratic twist by some integer $d$, which we assume to be of the form $\pm\ell$ where $\ell$ is a prime. We will compare some Selmer groups for the prime $p=2$. In the sequel, we will take $E$ to be the congruent number elliptic curve $E_{d_0}$ with $\ell\nmid d_0$. Accordingly, we will be able to take $\Sigma\coloneqq\{\ell\}$.

% Now, fix a finite subset $T$ of places of $\QQ$ containing the places of bad reduction of $E$, $2$, and $\infty$, but we will require $\ell\notin T$. We would like to choose our local conditions $\mc L$ and $\mc L'$ for $E[2]=E'[2]=(\ZZ/2\ZZ)^2$ as follows.
% \begin{itemize}
% 	\item We take $\mc L_v=\mc L_v'$ for $v\in T$. (This can be achieved by enforcing some congruence conditions on $\ell$.)
% 	\item We take $\mc L_\ell(E)=\mathrm H^1_{\mathrm{ur}}(K_\ell;E[2])$ and $\mc L_\ell'$ to be given by the image of $2$-torsion described in \Cref{lem:cong-local-condition}.
% 	\item Otherwise, we can take $\mc L_v=\mc L_v'=\mathrm H^1_{\mathrm{ur}}(K_v;E[2])$.
% \end{itemize}
% \begin{lemma}
% 	Fix everything as above.
% 	\begin{listalph}
% 		\item The dimension of the quotient $\op{Sel}_{2^\Sigma}(E)/\op{Sel}_{2_\Sigma}(E)$ is two.
% 		\item If the map $\op{Sel}_2(E)\to\mathrm H^1(K_\ell;E[2])$ has two-dimensional image (i.e., it surjects onto $\mathrm H^1_{\mathrm{ur}}(K_\ell;E[2])$), then
% 		\[\dim_{\FF_2}\op{Sel}_2(E')=\dim_{\FF_2}\op{Sel}_2(E)-2.\]
% 	\end{listalph}
% \end{lemma}
% \begin{proof}
% 	The key observation is that
% 	\[\mc L_\ell=\mc L_\ell'=0.\]
% 	Indeed, the image of $2$-torsion in \Cref{lem:cong-local-condition} adds a bunch of $\ell$s causing no intersection to be possible. Then (a) follows by applying the discussion of the previous subsection.

% 	For (b), the assumption tells us that
% 	\[0\to\op{Sel}_{2_\Sigma}(E)\to\op{Sel}_2(E)\to\mc L_{v_0}\]
% 	is surjective on the right, so \Cref{thm:global-tate-application} implies that
% 	\[0\to\op{Sel}_2(E)\to\op{Sel}_{2^\Sigma}(E)\to\frac{\mathrm H^1(K_{v_0};E[2])}{\mc L_{v_0}}\]
% 	maps to $0$ at the end, so it is an isomorphism on the left. Now, by our constructions of the local conditions, we have a pullback diagram
% 	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXG9we1NlbH1fezJfXFxTaWdtYX0oRSkiXSxbMSwwLCJcXG9we1NlbH1fMihFJykiXSxbMCwxLCJcXG9we1NlbH1fMihFKSJdLFsxLDEsIlxcb3B7U2VsfV97Ml5cXFNpZ21hfShFKSJdLFswLDJdLFsyLDNdLFswLDFdLFsxLDNdLFswLDMsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
% 	\[\begin{tikzcd}[cramped]
% 		{\op{Sel}_{2_\Sigma}(E)} & {\op{Sel}_2(E')} \\
% 		{\op{Sel}_2(E)} & {\op{Sel}_{2^\Sigma}(E)}
% 		\arrow[from=1-1, to=1-2]
% 		\arrow[from=1-1, to=2-1]
% 		\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
% 		\arrow[from=1-2, to=2-2]
% 		\arrow[from=2-1, to=2-2]
% 	\end{tikzcd}\]
% 	where all arrows are inclusions. Thus, because we know that the bottom arrow is an isomorphism, the top arrow is also an isomorphism, so this dimension can be computed from our earlier exact sequence.
% \end{proof}
% \begin{example}
% 	One can compute that $S_2(E_1)=0$ (using \Cref{cor:selmer-trivial-bound}), so $S_2(E_p)=2$ follows for $p\equiv1\pmod8$ by tracking through a similar argument. Similarly, there is a congruence condition on $p_2$ so that $S_2(E_{p_1p_2})=0$ by using the above arguments.
% \end{example}

\end{document}