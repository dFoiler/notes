% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

\section{September 26}

The second problem set has been graded. I had a few typos.

\subsection{Finiteness Conditions}
We continue our discussion of finiteness properties. Here is our strongest.
\begin{definition}[Finite]
	A scheme morphism $\pi\colon X\to Y$ is \textit{finite} if and only if an affine open subset $U\subseteq Y$ makes $\pi^{-1}(U)$ also affine in such a way that the induced ring morphism $\pi^\sharp_U\colon\OO_Y(U)\to\OO_X(\pi^{-1}U)$ on makes $\OO_X(\pi^{-1}U)$ a finitely generated $\OO_Y(U)$-module.
\end{definition}
In particular, being finite includes being affine.
\begin{example}
	Suppose that the ring map $f\colon A\to B$ makes $B$ a finitely generated $A$-module. We will show later that the associated scheme map $\varphi\colon\Spec B\to\Spec A$ is finite.
\end{example}
Here is the weakest.
\begin{definition}[Locally of finite type]
	A scheme morphism $\pi\colon X\to Y$ is \textit{locally of finite type} if and only if an affine open subset $V\subseteq Y$ with affine open subset $U\subseteq\pi^{-1}(U)$ inducing the ring morphism $\OO_Y(V)\to\OO_X(\pi^{-1}V)\to\OO_X(U)$ makes $\OO_X(U)$ a finitely generated $\OO_Y(V)$-algebra.
\end{definition}
Note that there is a key difference between being finitely generated as a module and an algebra.
% \begin{example}
% 	The inclusion of fields $K\into L$ has $L$ as a finitely generated $K$-module, so the induced map $\Spec L\to\Spec K$ is a finite morphism.
% \end{example}
\begin{example}
	The ring $k[x,y]$ is finitely generated as $k$-algebra but not as a $k$-module. We will see shortly that this means the induced map $\Spec k[x,y]\to\Spec k$ is (locally) of finite type but is not finite.
\end{example}
Lastly, here is our medium-strength morphism.
\begin{definition}[Finite type]
	A scheme morphism $\pi\colon X\to Y$ is of \textit{finite type} if and only if $\pi$ is locally of finite type and quasicompact.
\end{definition}
\begin{example}
	Suppose that $f\colon A\to B$ makes $B$ a finitely generated $A$-algebra, and let $\pi\colon\Spec B\to\Spec A$ be the induced scheme morphism. We will be able to show shortly that $\pi$ is of finite type: of course, $\pi$ is affine by \autoref{ex:affine-morphisms-are-affine} and so quasicompact by \autoref{rem:affine-is-qc}, and $\pi$ is locally of finite type by \autoref{cor:affine-locally-ft}.
\end{example}
\begin{example}
	Suppose that $\pi\colon X\to Y$ is finite; we show $\pi$ is of finite type. Note $\pi$ is affine and therefore quasicompact by \autoref{rem:affine-is-qc}. To see that $\pi$ is locally of finite type, note that for any affine open $U\subseteq Y$, we know $\OO_X(\pi^{-1}U)$ is finitely generated as an $\mathbb O_Y(U)$-module by $\pi^\sharp_U$, so the same generators convince us that $\OO_X(\pi^{-1}U)$ is a finitely generated $\OO_Y(U)$-algebra.
\end{example}
\begin{example}
	As usual, isomorphisms have all these adjectives. In particular, an isomorphism $\pi\colon X\to Y$ is finite because $\pi^\sharp_V$ is an isomorphism for any affine open subscheme $V\subseteq Y$, so $\OO_X(\pi^{-1}V)$ is of course affine and finitely generated as an $\mathcal O_Y(V)$-module.
\end{example}
We now slowly run all of our checks.
% \begin{remark}
% 	Of course, being finite implies being of finite type, and being of finite type implies being locally of finite type.
% \end{remark}

\subsection{Locally of Finite Type is Reasonable}
We will now run the usual checks on morphisms which are locally of finite type.
\begin{lemma} \label{lem:restrict-locally-ft}
	Fix a scheme morphism $\pi\colon X\to Y$ locally of finite type. Then, for any open subsets $U\subseteq X$ and $V\subseteq Y$ contained in $\pi(U)$, the restricted map $\pi|_U\colon U\to V$ is still locally of finite type.
\end{lemma}
\begin{proof}
	Fix affine open subsets $\Spec A\cong V'\subseteq V\subseteq Y$ and $\Spec B\cong U'\subseteq\pi|_U^{-1}(V')\subseteq X$. Notably, we still see that $V'$ is an affine open subscheme of $Y$, and $U'$ is an affine open subscheme of $X$. Thus, because $\pi$ is locally of finite type, we see that $B$ is a finitely generated $A$-algebra.
\end{proof}
The following lemma will find some utility.
\begin{lemma} \label{lem:locally-ft-local-on-source}
	Fix a scheme morphism $\pi\colon X\to Y$, where $Y$ is an affine scheme. Suppose that $X$ has an affine open cover $\mc U$ such that, for each $U\in\mc U$, we have $\OO_X(U)$ is a finitely generated $\OO_Y(Y)$-algebra by $\pi^\sharp$. Then each affine open subset of $X$ has this property.
\end{lemma}
\begin{proof}
	We use the Affine communication lemma. Say that an affine open subset $U\subseteq X$ is \textit{acceptable} if and only if $\OO_X(U)$ is a finitely generated $A$-algebra by $\pi^\sharp$. Here are our checks; set $A\coloneqq\OO_Y(Y)$.
	\begin{listroman}
		\item Suppose $U$ is acceptable and $f\in\OO_X(U)$; we show $U_f$ is acceptable. Well, by hypothesis, we may find finitely many generators $b_1,\ldots,b_n$ generating $\OO_X(U)$ as an $A$-algebra by $\pi^\sharp$. However, $\OO_X(U_f)\simeq\OO_X(U)_f$ is generated over $\OO_X(U)$ as an $\mathcal O_X(U)$-algebra by the generator $1/f$, so it follows that $\OO_X(U_f)$ is generated by $b_1,\ldots,b_n,1/f$ as an $A$-algebra. This is what we wanted.
		\item Suppose an affine open subset $U\subseteq X$ has elements $w_1,\ldots,w_n\in\OO_X(U)$ such that $(w_1,\ldots,w_n)=\OO_X(U)$, and $U_{f_i}$ is acceptable for each $i$. We show that $U$ is acceptable.

		For brevity, set $C\coloneqq\OO_X(U)$. Translating everything over to commutative algebra, we see that we are given $C_{w_k}$ is a finitely generated $A$-algebra for each $k$, and we want to show that $C$ is a finitely generated $A$-algebra. Well, we can find finitely many elements
		\[\left\{c_{k,1}/w_k^{e_{k,1}},\ldots,c_{k,N_k}/w_k^{e_{k,N_k}}\right\}\]
		of $C_{w_k}$ to generate $C_{w_k}$ as an $A$-algebra. However, we can also generate all the above generators by the elements
		\[\left\{c_{k,1},\ldots,c_{k,N_k},1/w_k\right\},\]
		so we will elect to use these generators instead. By artificially adding in $1$s to the end of each $S_k$ without changing the fact we generate, so we may assume that all the $S_k$ have the same size, so set $N\coloneqq N_k$ to be this uniform length.
	
		We will want a few more elements in our generating set. Note that the $D(w_k)$ cover $C$ by construction, so no prime $\mf p\in\Spec C$ contains all the $w_k$, so $(w_1,\ldots,w_m)=C$, so we can find elements $d_{1,1},\ldots,d_{m,1}\in C$ such that
		\[\sum_{k=1}^mw_kd_{k,1}=1.\]
		Taking this equation to the $mM$th power, each term has a power of $w_k^M$ for some $k$ by the pigeonhole principle, so we see that we can write
		\[\sum_{k=1}^mw_k^Md_{k,M}=1,\]
		where each $d_{k,M}$ is some polynomial in the $w_k$ and the $d_{k,1}$.
	
		We now let our set of generators be $S\coloneqq\bigcup_{k=1}^m\{c_{k,1},\ldots,c_{k,N},w_k,d_{k,1}\}$, which is the finite union of finite sets and therefore finite. We claim that $S$ generates $C$ as an $A$-algebra. Indeed, pick up some $c\in C$, and we know that in $C_{w_k}$ we may write
		\[\frac c1=p_k\left(c_{k,1},\ldots,c_{k,N},1/w_k\right)\]
		for some polynomial $p_k\in A[x_1,\ldots,x_{N+1}]$. Collecting denominators, we can find some $M_k$ such that
		\[\frac c1=\frac{q_k(c_{k,1},\ldots,c_{k,N},w_k)}{w_k^{M_k}},\]
		where $q_k\in A[x_1,\ldots,x_{N+1}]$. Thus, there is some $M_k',M_k''$ such that
		\[w_k^{M'_k}c=w_k^{M''_k}q_k(c_{k,1},\ldots,c_{k,N},w_k).\]
		It follows that $w_k^{M'_k}c$ is generated by $S$. Letting $M$ be the maximum over all the $M'_k$, we see that $w_k^Mc$ is still generated by $S$, so each term of
		\[c=\sum_{k=1}^m\left(w_k^Mc\right)d_{k,M}\]
		is still a polynomial with coefficients in $A$ of the terms in $S$. It follows that $c$ is generated by $S$. This is what we wanted.

		\item We have an open cover of acceptable affine open subschemes by hypothesis.
	\end{listroman}
	The above checks complete the proof by \autoref{lem:affine-comm}.
\end{proof}
We now use \autoref{lem:locally-ft-local-on-source} for fun and profit.
\begin{lemma} \label{lem:locally-ft-comp}
	The class of morphisms locally of finite type is preserved by composition.
\end{lemma}
\begin{proof}
	Suppose that we have morphisms $\varphi\colon X\to Y$ and $\psi\colon Y\to Z$ which are locally of finite type. We want to show that the composite $\beta\circ\alpha$ is also locally of finite type.

	Fix some affine open subset $\Spec\OO_Z(U)\simeq U$ of $Z$; set $A\coloneqq\OO_Z(U)$. Pulling back to $\psi^{-1}(U)$, given $\psi^{-1}(U)$ an affine open cover $\{V_\alpha\}_{\alpha\in\lambda}$, where $V_\alpha\simeq\Spec\OO_Y(V_\alpha)$; set $B_\alpha\coloneqq\OO_Y(V_\alpha)$. We are given that the map $\psi^\sharp_\alpha\colon A\to B_\alpha$ on global sections makes $B_\alpha$ into a finitely-generated $A$-algebra.

	Going further, for any affine open subset $W_{\alpha,\beta}\subseteq\varphi^{-1}(V_\alpha)$ will have $\OO_X(W_{\alpha,\beta})$ finitely generated as a $B_\alpha$-algebra by $\varphi^\sharp$, which is finitely generated as an $A$-algebra by $\psi^\sharp$, so it follows that each $\OO_X(W_{\alpha,\beta})$ is finitely generated as an $A$-algebra by $(\psi\circ\varphi)^\sharp$.

	However, we are now done: because the collection of all affine open subschemes $V_\alpha\subseteq\psi^{-1}(U)$ cover the open subscheme $\psi^{-1}(U)$, the collection of all affine open subschemes $W_{\alpha,\beta}\subseteq\varphi^{-1}(V_\alpha)$ for all $\alpha$ will cover the open subscheme $(\psi\circ\varphi)^{-1}(U)$. But each $W_{\alpha,\beta}$ has $\OO_X(W_{\alpha,\beta})$ finitely generated as an $A$-algebra, so \autoref{lem:locally-ft-local-on-source} kicks in to tell us that all affine open subschemes $W\subseteq(\psi\circ\varphi)^{-1}(U)$ have $\OO_X(W)$ finitely generated as an $A$-algebra by $(\psi\circ\varphi)^\sharp$.
\end{proof}
\begin{lemma} \label{lem:almost-locally-ft-affine-local-target}
	Fix a scheme morphism $\pi\colon X\to Y$ and an affine open cover $\mc V$ such that any $V\in\mc V$ and affine open $U\subseteq\pi^{-1}V$ has $\OO_X(U)$ a finitely generated $\OO_Y(V)$-algebra by $\pi^\sharp$. Then $\pi$ is locally of finite type.
\end{lemma}
\begin{proof}
	Say that an affine open subscheme $V\subseteq Y$ (with $V\cong\Spec\OO_Y(V)$) is ``smallish'' if and only if any affine open subscheme $U\subseteq\pi^{-1}(V)$ makes $\OO_X(U)$ a finitely generated $\OO_Y(V)$-algebra by $\pi^\sharp$. We would like to show that all affine open subscheme of $Y$ are smallish, for which we use \autoref{lem:affine-comm}. Here are our checks.
	\begin{listroman}
		\item Fix a smallish affine open subscheme $V\subseteq Y$ and some $f\in\OO_Y(V)$. We would like to show that $V_f$ is also smallish. Well, find some affine open subscheme $U\subseteq\pi^{-1}(V_f)$. Then $V_f\subseteq V$ means that $U\subseteq\pi^{-1}(V)$, so because $V$ is smallish, we conclude that $\OO_X(U)$ is a finitely generated $\OO_Y(V)$-algebra by $\pi^\sharp$.

		Namely, we have some set finite set of generators $b_1,\ldots,b_n\in\OO_X(U)$ generating $\OO_X(U)$ as an $\mathcal O_Y(V)$-algebra. But then any $b\in\OO_X(U)$ can be written as a polynomial in the $b_i$ with coefficients in $\OO_Y(V)$, so the same polynomial shows that any $b\in\OO_X(U)$ can be written as a polynomial in the $b_i$ with coefficients in $\OO_Y(V_f)\simeq\OO_Y(V)_f$.
		\item Fix an affine open subscheme $V\subseteq Y$ and some elements $(f_1,\ldots,f_n)\subseteq\OO_Y(V)$ generating $\OO_Y(V)$. Given that each $V_{f_i}$ is smallish, we would like to show that $V$ is smallish. For brevity, set $A\coloneqq\OO_Y(V)$.

		At this point, we remark that we may essentially restrict $\pi$ to $\pi|_{\pi^{-1}V}$, though we will not do this.

		Anyway, arguing as before, for any affine open subset $W_{i,\beta}\subseteq\varphi^{-1}(V_{f_i})$ will have $\OO_X(W_{i,\beta})$ finitely generated as an $A_{f_i}$-algebra by $\pi^\sharp$. However, $A_{f_i}\simeq A[1/f_i]$ is certainly finitely generated as an $A$-algebra, so it follows that each $\OO_X(W_{i,\beta})$ is finitely generated as an $A$-algebra by $\pi^\sharp$ as well.

		However, we are now done: because the collection of all affine open subschemes $V_{f_i}\subseteq V$ cover $V$ (because $(f_1,\ldots,f_n)=1$), the collection of all affine open subschemes $W_{i,\beta}\subseteq\varphi^{-1}(V_i)$ for all $i$ will cover the open subscheme $\pi^{-1}(V)$. But each $W_{i,\beta}$ has $\OO_X(W_{i,\beta})$ finitely generated as an $A$-algebra, so \autoref{lem:locally-ft-local-on-source} kicks in to tell us that all affine open subschemes $W\subseteq\pi^{-1}(U)$ have $\OO_X(W)$ finitely generated as an $A$-algebra by $\pi^\sharp$.
		\item Lastly, we see that $Y$ has an affine open cover by smallish affine open subschemes.
	\end{listroman}
	The above checks complete the proof by \autoref{lem:affine-comm}.
\end{proof}
Here are the usual applications of a lemma like this.
\begin{corollary} \label{cor:locally-ft-affine-local-target}
	The class of morphisms locally of finite type is affine local on the target.
\end{corollary}
\begin{proof}
	One direction of being affine-local on the target is covered by \autoref{lem:restrict-locally-ft}.

	In the other direction, fix a scheme morphism $\pi\colon X\to Y$ and an affine open cover $\{V_\alpha\}_{\alpha\in\lambda}$ such that $\pi|_{\pi^{-1}V_\alpha}\colon\pi^{-1}V_\alpha\to V_\alpha$ is locally of finite type for each $V_\alpha$. Then, fixing some $V_\alpha$, any affine open subset $U\subseteq\pi^{-1}V_\alpha$ will have $\OO_X(U)$ a finitely generated $\OO_Y(V)$-algebra by $\pi^\sharp$ because $\pi|_{\pi^{-1}V_\alpha}$ is locally of finite type. Thus, $\pi$ is locally of finite type by \autoref{lem:almost-locally-ft-affine-local-target}.
\end{proof}
\begin{corollary} \label{cor:affine-locally-ft}
	A morphism $\pi\colon X\to Y$ of affine schemes is locally of finite type if and only if $\OO_X(X)$ is a finitely generated $\OO_Y(Y)$-algebra by $\pi^\sharp_Y$.
\end{corollary}
\begin{proof}
	In one direction, if $\pi$ is locally of finite type, then the affine open subset $Y\subseteq Y$ forces $\OO_X(X)$ to be a finitely generated $\OO_Y(Y)$-algebra by $\pi^\sharp_Y$. In the other direction, if $\OO_X(X)$ is a finitely generated $\OO_Y(Y)$-algebra by $\pi^\sharp_Y$, then the affine open cover $\{Y\}$ of $Y$ tells us that $\pi$ is locally of finite type by \autoref{lem:almost-locally-ft-affine-local-target}.
\end{proof}
% \begin{example} \label{ex:distinguished-open-is-locally-ft}
% 	Given an affine scheme $Y$ and an element $f\in\OO_Y(Y)$, we note that $\OO_Y(Y)_f=\OO_Y(Y)[1/f]$, so $\OO_Y(Y)_f$ is finitely generated as an $A$-algebra. Thus, the open embedding $Y_f\into Y$ is locally of finite type by \autoref{cor:affine-locally-ft}, where are noting $\OO_Y(Y_f)\simeq\OO_Y(Y_f)$ corresponds to the affine open subscheme $D(f)\subseteq\Spec\OO_Y(Y)$ using \autoref{cor:the-affine-iso}.
% \end{example}
\begin{corollary}
	Open embeddings are locally of finite type.
\end{corollary}
\begin{proof}
	Fix an open embedding $\iota\colon X\into Y$, where $X\subseteq Y$ is an open subscheme; notably, $\iota^\sharp_U\colon\OO_Y(U)\to\OO_X(U)$ is just the restriction map $\OO_Y(U)\to\OO_Y(X\cap U)$. Giving $Y$ an affine open cover $\mc U$, it suffices by \autoref{cor:locally-ft-affine-local-target} to show that each $\iota|_{\iota^{-1}U}\colon\iota^{-1}U\to U$ is locally of finite type.

	Thus, we may rename our variables: set $X\coloneqq\iota^{-1}U$ and $Y\coloneqq U$ and $\iota\coloneqq\iota|_{\iota^{-1}U}$ so that $X\to Y$ is still an open embedding because we just have $\iota^{-1}U=U\cap X$, and the structure sheaves still match because $\OO_{\iota^{-1}U}=\OO_X|_{\iota^{-1}U}=\OO_Y|_X|_{\iota^{-1}U}=\OO_Y|_{\iota^{-1}U}$.

	In other words, we may assume that $Y$ is affine. But now we may use the distinguished open base $Y_f\simeq D(f)\subseteq\Spec\OO_Y(Y)$ (under \autoref{cor:the-affine-iso}) of an affine scheme to write
	\[X=\bigcup_{\alpha\in\lambda}Y_{f_\alpha}\]
	for some elements $\{f_\alpha\}_{\alpha\in\lambda}\subseteq\OO_Y(Y)$. However, for each $\alpha$, we see
	\[\OO_Y(Y_{f_\alpha})\simeq\OO_Y(Y)_{f_\alpha}=\OO_Y(Y)[1/f_\alpha]\]
	is a finitely generated $\OO_Y(Y)$-algebra, given by ``restriction'' $\OO_Y(Y)\to\OO_Y(Y_f)$, which is just the localization at $f$ map as coming from \autoref{cor:the-affine-iso}. Thus, we conclude that $\iota$ is locally of finite type by \autoref{lem:locally-ft-local-on-source}.
\end{proof}
And here is base change.
\begin{lemma} \label{lem:locally-ft-base-change}
	The class of morphisms locally of finite type is preserved by base change.
\end{lemma}
\begin{proof}
	Suppose we have a pullback square
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJYXFx0aW1lc19TWSJdLFsxLDAsIlgiXSxbMCwxLCJZIl0sWzEsMSwiUyJdLFsyLDMsIlxccHNpX1kiXSxbMCwxLCJcXHBpX1giXSxbMCwyLCJcXHBpX1kiXSxbMSwzLCJcXHBzaV9YIl0sWzAsMywiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{X\times_SY} & X \\
		Y & S
		\arrow["{\psi_Y}", from=2-1, to=2-2]
		\arrow["{\pi_X}", from=1-1, to=1-2]
		\arrow["{\pi_Y}", from=1-1, to=2-1]
		\arrow["{\psi_X}", from=1-2, to=2-2]
		\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
	\end{tikzcd}\]
	of schemes such that $\psi_Y$ is locally of finite type. We would like to show that $\pi_X$ is locally of finite type. Notably, because being locally of finite type is affine-local on the target by \autoref{cor:locally-ft-affine-local-target}, we may use \autoref{lem:base-change-reduce-to-affine} to assume that $X$ and $S$ are affine.

	Well, fix an affine open subscheme $U\subseteq X$, and we would like to show that all affine open subschemes $V\subseteq\pi_X^{-1}(U)$ have $\OO_{X\times_SY}(V)$ finitely generated as an $\mathcal O_X(V)$-algebra by $\pi_X^\sharp$. Using \autoref{lem:locally-ft-local-on-source}, it suffices to just give an open cover of such affine open subschemes $V$. Well, note that we have built the tower
	% https://q.uiver.app/?q=WzAsNixbMSwyLCJTIl0sWzEsMSwiWCJdLFswLDIsIlkiXSxbMCwxLCJYXFx0aW1lc19TWSJdLFsxLDAsIlUiXSxbMCwwLCJcXHBpX1heey0xfVUiXSxbMiwwLCJcXHBzaV9ZIl0sWzEsMCwiXFxwc2lfWCJdLFszLDEsIlxccGlfWCJdLFszLDIsIlxccGlfWSJdLFs0LDEsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoidG9wIn19fV0sWzUsMywiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoiaG9vayIsInNpZGUiOiJ0b3AifX19XSxbNSw0LCJcXHBpX1h8X3tcXHBpX1heey0xfVV9Il1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\pi_X^{-1}U} & U \\
		{X\times_SY} & X \\
		Y & S
		\arrow["{\psi_Y}", from=3-1, to=3-2]
		\arrow["{\psi_X}", from=2-2, to=3-2]
		\arrow["{\pi_X}", from=2-1, to=2-2]
		\arrow["{\pi_Y}", from=2-1, to=3-1]
		\arrow[hook, from=1-2, to=2-2]
		\arrow[hook, from=1-1, to=2-1]
		\arrow["{\pi_X|_{\pi_X^{-1}U}}", from=1-1, to=1-2]
	\end{tikzcd}\]
	where once again the bottom square is a pullback square by \autoref{lem:fp-open-cover-base}, the top square is a pullback square by \autoref{lem:open-fp}, so the total rectangle is a pullback square by \autoref{lem:smalls-to-big-pullback}. Thus, we may think about $\pi^{-1}U$ as canonically isomorphic to $U\times_SY$.

	Now, using \autoref{lem:keyfibercase}, we can give $Y$ an affine open cover $Y_\alpha$ so that the affine open schemes $U\times_SY_\alpha$ will manage to cover $U\times_SY$. As such, \autoref{lem:locally-ft-local-on-source} tells us that we would like for each $U\times_SY_\alpha$ to have global sections finitely generated as an $\mathcal O_U(U)$-algebra.

	But now everything is affine! Set $R\coloneqq\OO_S(S)$ and $A_\alpha\coloneqq\OO_Y(Y_\alpha)$ and $B\coloneqq\OO_U(U)$. Then \autoref{lem:affine-fp} tells us that
	\[U\times_SY_\alpha\simeq\Spec B\otimes_RA_\alpha.\]
	Because $A_\alpha$ is finitely generated as an $R$-algebra (by $\psi_Y^\sharp$), we may write $A_\alpha\simeq R[x_1,\ldots,x_n]/I$ for some $n$ and some ideal $I$. Chasing our maps around, we see
	\[B\otimes_RA_\alpha\simeq B\otimes_R\frac{R[x_1,\ldots,x_n]}I\simeq\frac{B[x_1,\ldots,x_n]}{IB},\]
	where the last isomorphism is by $b\otimes r(x_1,\ldots,x_n)\mapsto b\cdot r(x_1,\ldots,x_n)$. Thus, $B\otimes_RA_\alpha$ is a finitely generated $B$-algebra, so we are done.
\end{proof}
% There are the usual equivalent conditions.
% \begin{lemma}
% 	Being finite is affine local on the target: a scheme morphism $\pi\colon X\to Y$ is finite if and only if there is an affine open cover $\{U_\alpha\}_{\alpha\in\lambda}$ with $U_\alpha=\Spec B_\alpha$ and $\pi^{-1}(U_\alpha)=\Spec A_i$ in such a way that $A_\alpha$ is finitely generated as a $B_\alpha$-module.
% \end{lemma}
% \begin{proof}
% 	Omitted.
% \end{proof}
% \begin{lemma}
% 	Being locally of finite type is affine local on the target: a scheme morphism $\pi\colon X\to Y$ is locally of finite type if and only if there is an affine open cover $\{U_\alpha\}_{\alpha\in\lambda}$ with $U_\alpha=\Spec B_i$ such that any affine open subset $\Spec B_i\subseteq\pi^{-1}(U_\alpha)$ in such a way that $A_\alpha$ is finitely generated as a $B_\alpha$-module.
% \end{lemma}
% \begin{proof}
% 	Omitted.
% \end{proof}
% There is a similar result for being locally of finite type by just requiring that the affine open cover of $\pi^{-1}(U_\alpha)$ be finite.

\subsection{Integral Is Reasonable}
We are currently building up towards showing that finite morphisms have the usual properties. We could show this directly, but it will be productive to take an intermediate step through integral morphisms. Here is our definition.
\begin{definition}
	A scheme morphism $\pi\colon X\to Y$ is \textit{integral} if and only if $\pi$ is affine and all affine open $U\subseteq Y$ makes $\OO_X(\pi^{-1}U)$ an integral extension of $\OO_Y(U)$ by $\pi^\sharp_U$.
\end{definition}
\begin{example}
	If $f\colon A\to B$ is an integral extension of rings, the induced scheme morphism $\Spec B\to\Spec A$ is an integral morphism of schemes. We will show this in \autoref{cor:affine-integral-condition}, after we show that being integral is affine-local on the target.
\end{example}
\begin{example} \label{ex:finite-is-integral}
	If $\pi\colon X\to Y$ is a finite morphism, then $\pi$ is also integral. Indeed, for any affine open subscheme $U\subseteq X$, we see $\pi^{-1}U\subseteq Y$ is affine, and $B\coloneqq\OO_X(\pi^{-1}U)$ is a finitely generated $A\coloneqq\OO_Y(U)$-algebra by $f\coloneqq\pi^\sharp_U$. Namely, for each $b\in B$, we see that $f(A)[b]$ is finite over $A$, so $b$ is integral over $A$, so $B$ is an integral extension of $A$.
\end{example}
As usual, we go ahead and show that the class of integral morphisms is affine-local on the target, preserved by composition, and preserved by base change.

We begin with composition, which easier this time.
\begin{lemma} \label{lem:integral-comp}
	The class of integral morphisms is preserved by composition.
\end{lemma}
\begin{proof}
	Fix integral morphisms $\varphi\colon X\to Y$ and $\psi\colon Y\to Z$. We would like to show that $\psi\circ\varphi$ is integral. Well, fix some affine open subscheme $W\subseteq Z$.
	
	Then $\psi^{-1}W\subseteq Y$ is an affine open subscheme because $\psi$ is affine, and $\psi^\sharp_W\colon\OO_Z(W)\to\OO_Y(\psi^{-1}W)$ is an integral extension because $\psi$ is integral. Continuing, $\varphi^{-1}\psi^{-1}W\subseteq X$ is an affine open subscheme because $\varphi$ is affine, and $\varphi^\sharp_{\psi^{-1}W}\colon\OO_Y(\psi^{-1}W)\to\OO_X(\varphi^{-1}\psi^{-1}W)$ is an integral extension because $\psi$ is integral. It follows that the composite
	\[\OO_Z(W)\stackrel{\psi^\sharp_W}\to\OO_Y(\psi^{-1}W)\stackrel{(\psi_*\varphi)^\sharp_W}\to\OO_X(\varphi^{-1}\psi^{-1}W)\]
	is an integral extension of rings.\footnote{This is a commutative algebra fact: if $f\colon A\to B$ and $g\colon B\to C$ are integral extensions, then $g\circ f$ is an integral extension. One sees by finding $c\in C$, giving $c$ a monic polynomial in $B[x]$ with coefficients $b_0,\ldots,b_d$, and now we note that $g(f(A))[g(b_0),\ldots,g(b_d),c]$ is finite over $A$, so $c$ is integral over $A$.} Because the above composite is $(\psi\circ\varphi)^\sharp_W$, we are done.
\end{proof}
We now move towards to showing that the class of integral morphisms is affine-local on the target.
\begin{lemma} \label{lem:restrict-integral}
	Fix an integral morphism $\pi\colon X\to Y$ and open subset $V\subseteq Y$. Then $\pi|_{\pi^{-1}V}\colon\pi^{-1}V\to V$ is an integral morphism for each affine open subscheme $U\subseteq Y$.
\end{lemma}
\begin{proof}
	Given an affine open subscheme $V'\subseteq V$, we need to show that $\pi^{-1}V'\subseteq\pi^{-1}V$ is affine and has $\OO_X(\pi^{-1}V')$ an integral extension of $\OO_Y(V')$ by $(\pi|_{U})^\sharp_{V'}=\pi^\sharp_{V'}$. Well, note that $V'\subseteq V\subseteq Y$ is an affine open subscheme of $Y$, so the fact that $\pi$ is integral tells us that $\OO_X(\pi^{-1}V')$ is indeed an integral extension of $\OO_Y(V')$ by $\pi^\sharp_{V'}$.
\end{proof}
\begin{lemma} \label{lem:almost-integral-affine-local-target}
	Fix a scheme morphism $\pi\colon X\to Y$ and an affine open cover $\mc U$ of $Y$ such that $\pi^{-1}U$ is affine for each $U\in\mc U$, and $\pi^\sharp_U\colon\OO_Y(U)\to\OO_X(\pi^{-1}U)$ is an integral morphism of rings. Then $\pi$ is integral.
\end{lemma}
\begin{proof}
	We use \autoref{lem:affine-comm}. To begin, we note that the open cover $\mc U$ tells has $\pi^{-1}U$ affine for each $U\in\mc U$, so we immediately get to say that $\pi$ is affine by \autoref{cor:affine-is-affine-local}.
	
	Say that an affine open subset $U\subseteq Y$ is ``acceptable'' if and only if $\OO_X(\pi^{-1}U)$ is an integral extension of $\OO_Y(U)$ by $\pi^\sharp_U$. We would like to show that all affine open subsets of $Y$ are acceptable, for which we use \autoref{lem:affine-comm}.
	\begin{listroman}
		\item Suppose the affine open subscheme $U\subseteq Y$ is acceptable. Then, for some $f\in\OO_Y(U)$, we need to show that $U_f$ is also acceptable. Well, we recall from \autoref{rem:pre-image-xfs} that
		\[\pi^{-1}(U_f)=\pi^{-1}(U)_{\pi^\sharp_U(f)}.\]
		Now, because $\pi$ is affine, we see that $\pi^{-1}(U)$ is affine, so it follows that $\pi^{-1}(U_f)=\pi^{-1}(U)_{\pi^\sharp_U(f)}$ is also affine and (canonically) isomorphic to $\Spec\OO_X(\pi^{-1}U)_{\pi^\sharp_U(f)}$.
		
		Further, we know that $B\coloneqq\OO_X(\pi^{-1}U)$ is an integral extension of $A\coloneqq\OO_Y(U)$ by $\pi^\sharp_U$. We want to show that $B_{\pi^\sharp_Uf}$ is an integral extension of $A_f$. Well, any $b/(\pi^\sharp_Uf)^n$ has $b\in B$ integral over $A$ and therefore satisfying some monic polynomial
		\[\sum_{k=0}^d\pi^\sharp_U(a_k)b^k=0\]
		with $a_d=1$ and $\{a_k\}_{k=1}^d\subseteq A$. It follows that $b/(\pi^\sharp_Uf)^n$ satisfies
		\[\sum_{k=0}^d\pi^\sharp_U(a_k)\pi^\sharp_U(f^{nk})\left(\frac b{(\pi^\sharp_Uf)^n}\right)^k=0,\]
		so we see that $b/(\pi^\sharp_Uf)^n$ satisfied a monic polynomial in $A_f$ after multiplying both sides above by $\pi^\sharp_U(f^{-nd})$.
		\item Suppose the affine open subscheme $U\subseteq Y$ has sections $f_1,\ldots,f_n\in\OO_Y(U)$ generating $\OO_Y(U)$ such that each $U_{f_i}$ is acceptable. We would like to show $U$ is acceptable. Note that we already know $\pi^{-1}U$ is affine because $\pi$ is affine.

		For brevity, we set $A\coloneqq\OO_Y(U)$ and $B\coloneqq\OO_X(\pi^{-1}U)$ and $\iota\coloneqq\pi^\sharp_U$. Because $U$ is affine, we see $\OO_Y(U_{f_i})\simeq A_{f_i}$ for each $i$, and above we computed that
		\[\pi^{-1}(U_{f_i})=\pi^{-1}(U)_{\iota(f_i)},\]
		so $\OO_X(\pi^{-1}(U)_{\iota f_i})\simeq B_{\iota f_i}$. Namely, the localization map $B\to B_{\iota f_i}$ is just a restriction map, so we see that the induced map $A_{f_i}\to B_{\iota f_i}$ is just the localization (i.e., restriction) of $\iota\colon A\to B$.

		Thus, because the $U_{f_i}$ are acceptable, we see that the maps $\iota_{f_i}\colon A_{f_i}\to B_{\iota f_i}$ give integral extensions of rings. We want to show that $U$ is acceptable, which translates into showing that $\iota\colon A\to B$ is an integral extension of rings.

		Well, pick up some $b\in B$. Fixing some $i$, we are given that $B_{\iota f_i}$ is an integral $A_{f_i}$-algebra, so $b/1\in B_{\iota f_i}$ is the root of some monic polynomial
		\[\sum_{k=0}^d\iota(a_k)(b/1)^k=0\]
		where $a_d=1$ and $\{a_k\}_{k=1}^n\subseteq A_{f_i}$. Combining the left-hand side into a single fraction (the coefficient in front of $(b/1)^d$ will be some power of $f_i$) and then expanding out the equality in $A_{f_i}$ tells us that there is some $M_i$ and elements $a'_1,\ldots,a'_d\in A$ with $b_d=1$ such that
		\[f_i^{M_i}\sum_{k=0}^d\iota(a'_i)b^k=0.\]
		Multiplying both sides by enough $f_i$s, we see
		\[\sum_{k=0}^d\iota\left(a'_if_i^{dM_i-kM_i}\right)\left(\iota(f_i)^{M_i}b\right)^k=0,\]
		so $\iota(f_i)^{M_i}b$ satisfies a monic polynomial with coefficients in $A$ and is therefore integral over $A$.

		Now looping through all $i$, we see that
		\[\iota(A)\left[\iota(f_1)^{M_1}b,\ldots,\iota(f_n)^{M_n}b\right]\subseteq B\]
		is an extension of $A$ generated by integral elements and therefore integral. To show that $b$ is integral over $A$, it suffices to show that $b\in\iota(A)\left[\iota(f_1)^{M_1}b,\ldots,\iota(f_n)^{M_n}b\right]$.

		Well, we note that $(f_1,\ldots,f_n)=A$ implies that $A=\rad(f_1,\ldots,f_n)=\rad(f_1^{M_1},\ldots,f_n^{M_n})$, so it follows $V((f_1,\ldots,f_n))=V(\rad(f_1,\ldots,f_n))=V((f_1^{M_1},\ldots,f_n^{M_n}))$, so $(f_1^{M_1},\ldots,f_n^{M_n})=A$. So we may find constants $c_1,\ldots,c_n\in A$ such that
		\[\sum_{k=1}^nc_kf_k^{M_k}=1.\]
		Thus,
		\[b=\sum_{k=1}^n\iota(c_k)\iota(f_k)^{M_k}b\in\iota(A)\left[\iota(f_1)^{M_1}b,\ldots,\iota(f_n)^{M_n}b\right].\]
		\item The assumption on $\pi$ grants us an acceptable affine open cover.
	\end{listroman}
	The above checks allow \autoref{lem:affine-comm} to kick in, completing the proof.
\end{proof}
\begin{corollary} \label{cor:integral-affine-local-target}
	The class of integral morphisms is affine-local on the target.
\end{corollary}
\begin{proof}
	One direction of being affine-local on the target is covered by \autoref{lem:restrict-integral}.

	In the other direction, fix a scheme morphism $\pi\colon X\to Y$ and an affine open cover $\{V_\alpha\}_{\alpha\in\lambda}$ such that $\pi|_{\pi^{-1}V_\alpha}\colon\pi^{-1}V_\alpha\to V_\alpha$ is integral for each $V_\alpha$. Fixing some $V_\alpha$, we see $\pi^{-1}V_\alpha$ is affine and makes $\OO_X(\pi^{-1}V_\alpha)$ an integral $\OO_Y(V_\alpha)$-algebra by $\pi^\sharp$ because $\pi|_{\pi^{-1}V_\alpha}$ is integral. Thus, $\pi$ is integral by \autoref{lem:almost-integral-affine-local-target}.
\end{proof}
\begin{corollary} \label{cor:affine-integral-condition}
	Fix an affine scheme $Y$ and a morphism of schemes $\pi\colon X\to Y$. Then $\pi$ is integral if and only if $X$ is affine and $\OO_X(X)$ is an integral $\OO_Y(Y)$ algebra by $\pi^\sharp_Y$.
\end{corollary}
\begin{proof}
	If $\pi$ is integral, then $\pi$ is affine, so the affine open subscheme $Y\subseteq Y$ must make $\pi^{-1}Y=X$ an affine open subscheme of $X$, so $X$ is affine. Further, because $\pi$ is integral, so $\OO_X(X)$ must be an integral $\OO_Y(Y)$-algebra by $\pi^\sharp_Y$.

	Conversely, suppose that $X$ is affine, and $\pi^\sharp_Y\colon\OO_Y(Y)\to\OO_X(X)$ is an integral extension of rings. Then the affine open cover $\{Y\}$ of $Y$ has $X=\pi^{-1}Y$ affine and makes $\OO_X(X)$ an integral $\OO_Y(Y)$-algebra by $\pi^\sharp_V$, so we finish by \autoref{lem:almost-integral-affine-local-target}.
\end{proof}
We are now ready to prove that being integral is preserved by base change.
\begin{lemma} \label{lem:integral-base-change}
	The class of integral morphisms is preserved by base change.
\end{lemma}
\begin{proof}
	Suppose we have a pullback square
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJYXFx0aW1lc19TWSJdLFsxLDAsIlgiXSxbMCwxLCJZIl0sWzEsMSwiUyJdLFsyLDMsIlxccHNpX1kiXSxbMCwxLCJcXHBpX1giXSxbMCwyLCJcXHBpX1kiXSxbMSwzLCJcXHBzaV9YIl0sWzAsMywiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{X\times_SY} & X \\
		Y & S
		\arrow["{\psi_Y}", from=2-1, to=2-2]
		\arrow["{\pi_X}", from=1-1, to=1-2]
		\arrow["{\pi_Y}", from=1-1, to=2-1]
		\arrow["{\psi_X}", from=1-2, to=2-2]
		\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
	\end{tikzcd}\]
	of schemes such that $\psi_Y$ is integral. We would like to show that $\pi_X$ is integral. Notably, because being integral is affine-local on the target by \autoref{cor:integral-affine-local-target}, we may use \autoref{lem:base-change-reduce-to-affine} to assume that $X$ and $S$ are affine.

	However, $\psi_Y$ is integral and therefore affine, so we conclude that $Y$ is affine because $Y$ is. Thus, because now all of $X$ and $Y$ and $S$ are affine, we set $A\coloneqq\OO_X(X)$ and $B\coloneqq\OO_Y(Y)$ and $R\coloneqq\OO_S(S)$ so that we may set $X\times_SY=\Spec A\otimes_RB$ by \autoref{lem:affine-fp}. Namely, we are now looking at the push-out diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJSIl0sWzEsMCwiQSJdLFswLDEsIkIiXSxbMSwxLCJBXFxvdGltZXNfUkIiXSxbMCwxLCJcXHBzaV5cXHNoYXJwX0EiXSxbMSwzLCJcXHBpXlxcc2hhcnBfQSJdLFswLDIsIlxccHNpXlxcc2hhcnBfQiIsMl0sWzIsMywiXFxwaV5cXHNoYXJwX0IiXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		R & A \\
		B & {A\otimes_RB}
		\arrow["{\psi^\sharp_A}", from=1-1, to=1-2]
		\arrow["{\pi^\sharp_A}", from=1-2, to=2-2]
		\arrow["{\psi^\sharp_B}"', from=1-1, to=2-1]
		\arrow["{\pi^\sharp_B}", from=2-1, to=2-2]
	\end{tikzcd}\]
	where $\psi^\sharp_B$ is integral; note we are abusing our notation with the sheaf morphisms here. Observe that $\pi^\sharp_A={\id_A}\otimes1$ and $\pi^\sharp_B=1\otimes{\id_B}$.

	We now proceed directly. Because $X$ is integral, we may use \autoref{cor:affine-integral-condition} so that showing $\pi_X$ is integral is equivalent to showing that $X\times_SY$ is affine--which we know because $X\times_SY=\Spec A\otimes_RB$---such that $\pi^\sharp_B\colon B\to A\otimes_RB$ is an integral extension.
	
	Well, $A\otimes_RB$ is generated by finite sums of the form $(a\otimes 1)(1\otimes b)$, so it suffices to show that each $a\otimes 1$ and $1\otimes b$ is integral over $B$. (Namely, the elements of $B$ integral over $A$ is ``the integral closure'' of $B$ in $A$ and is a subring of $B$.) On one hand, we see that
	\[(1\otimes b)-\pi^\sharp_B(b)=0\]
	provides a monic polynomial for $1\otimes b$. On the other hand, for $a\otimes 1$, we note that $\psi^\sharp_A\colon R\to A$ is an integral extension, so $a$ is the root of some monic polynomial
	\[\sum_{k=0}^d\psi^\sharp_A(r_k)a^k=0\]
	where $r_1,\ldots,r_d\in R$. Thus,
	\[\sum_{k=0}^d\pi^\sharp_A(\psi^\sharp_Ar_k)(a\otimes1)^k=\Bigg(\sum_{k=0}^d\psi^\sharp_A(r_k)r^k\Bigg)\otimes1=0\otimes1=0,\]
	so $a\otimes1$ is indeed integral over $B$. This finishes.
\end{proof}

\subsection{Reasonability Loose Ends}
We now show that morphisms of finite type and finite morphisms form reasonable classes. This will be optimized by the following lemma.
\begin{lemma} \label{lem:class-intersection-is-reasonable}
	Fix some classes $\{P_\alpha\}_{\alpha\in\lambda}$ of morphisms, and let $P$ be the class of morphisms which live in $P_\alpha$ for each $\alpha$.
	\begin{listalph}
		\item If each $P_\alpha$ is preserved by composition, then $P$ is as well.
		\item If each $P_\alpha$ is preserved by base change, then $P$ is as well.
		\item If each $P_\alpha$ is affine-local on the target, then $P$ is as well.
	\end{listalph}
\end{lemma}
\begin{proof}
	We proceed directly.
	\begin{listalph}
		\item Suppose $\varphi\colon A\to B$ and $\psi\colon B\to C$ are both in $P$. Then $\varphi,\psi\in P_\alpha$ for each $\alpha$, so $\psi\circ\varphi\in P_\alpha$ for each $\alpha$ because $P_\alpha$ is preserved by composition, so $\psi\circ\varphi\in P$.
		\item Suppose $\varphi_X\colon X\to S$ lives in $P$ and therefore in $P_\alpha$ for each $\alpha$. Given a scheme $Y$ with a morphism $\psi_Y\colon Y\to S$, we note that the canonical projection $\pi_X\colon X\times_SY\to X$ lives in $P_\alpha$ for each $\alpha$ because $P_\alpha$ is preserved by base change. It follows $\pi_X\in P$.
		\item Suppose $\varphi\colon X\to Y$, and fix an (affine) open cover $\mc U$ of $Y$.

		In one direction, if $\varphi\colon X\to Y$ is in $P$, then $\varphi$ is in $P_\alpha$ for each $\alpha$, so $\varphi|_{\varphi^{-1}U}$ is in $P_\alpha$ for each $\alpha$ and each $U\in\mc U$ because $P_\alpha$ is affine-local on the target, so $\varphi|_{\varphi^{-1}U}$ is in $P$ for each $U\in\mc U$.

		In the other direction, if $\varphi|_{\varphi^{-1}U}$ is in $P$ for each $U\in\mc U$, then $\varphi|_{\varphi^{-1}U}$ is in $P_\alpha$ for each $\alpha$ and each $U$, so $\varphi$ is in $P_\alpha$ for each $\alpha$ because $P_\alpha$ is affine-local on the target, so $\varphi$ is in $P$.
		\qedhere
	\end{listalph}
\end{proof}
This gives morphisms of finite type immediately.
\begin{corollary} \label{cor:ft-is-reasonable}
	The class of morphisms of finite type is preserved by composition, is preserved by base change, and is affine-local on the target.
\end{corollary}
\begin{proof}
	By definition, a morphism $\varphi$ is of finite type if and only if $\varphi$ is quasicompact and locally of finite type.
	
	Thus, \autoref{lem:class-intersection-is-reasonable} tells us that it suffices to show the classes of quasicompact morphisms and of morphisms locally of finite type are both preserved by composition, are preserved by base change, and are affine-local on the target.
	\begin{itemize}
		\item For quasicompact morphisms, these are by \autoref{cor:qc-is-comp-preserve}, \autoref{lem:qc-base-change}, and \autoref{ex:qc-is-affine-local}.
		\item For morphisms locally of finite type, these are by \autoref{lem:locally-ft-comp}, \autoref{lem:locally-ft-base-change}, and \autoref{cor:locally-ft-affine-local-target}.
		\qedhere
	\end{itemize}
\end{proof}
To extend this approach to finite morphisms, we have the following lemma.
\begin{lemma} \label{lem:finite-is-integral-locally-ft}
	A scheme morphism $\varphi\colon X\to Y$ is finite if and only if $\varphi$ is both integral and locally of finite type.
\end{lemma}
\begin{proof}
	Fix an affine open subscheme $V\subseteq Y$. We need to show that $U\coloneqq\varphi^{-1}V$ is an affine open subscheme of $X$ and that $\OO_X(U)$ is finitely generated as an $\mathcal O_Y(V)$-algebra by $\varphi^\sharp$.
	
	Well, $\varphi$ is integral, so $U=\varphi^{-1}V$ is indeed affine, and in fact  $\OO_X(U)$ is an integral $\mathcal O_Y(V)$-algebra by $\varphi^\sharp_V$. Further, because $\varphi$ is locally of finite type, the affine open subscheme $U$ of $U$ must have $\OO_X(U)$ a finitely generated $\mathcal O_Y(V)$-algebra by ${\op{res}_{U,U}}\circ\varphi^\sharp_V=\varphi^\sharp_V$.

	Now, for brevity, set $A\coloneqq\OO_Y(V)$ and $B\coloneqq\OO_X(U)$ and $f\coloneqq\varphi^\sharp_V$ so that $f\colon A\to B$ gives
	\[B=f(A)[b_1,\ldots,b_n]\]
	for some $b_1,\ldots,b_n\in B$ because $B$ is finitely generated over $A$. However, $B$ is integral over $A$ as well, so each of the $b_i$ are integral over $A$, so bounded polynomials in the $b_i$ will finitely generate $B$ as an $A$-module, finishing. More explicitly, each extension of
	\[f(A)\subseteq f(A)[b_1]\subseteq f(A)[b_1,b_2]\subseteq\cdots\subseteq f(A)[b_1,\ldots,b_n]=B\]
	is finite, so the total extension is finite.
\end{proof}
\begin{corollary} \label{cor:finite-is-reasonable}
	The class of finite morphisms is preserved by composition, is preserved by base change, and is affine-local on the target.
\end{corollary}
\begin{proof}
	This proof is essentially the same as \autoref{cor:ft-is-reasonable} with some references changed. By \autoref{lem:finite-is-integral-locally-ft}, a morphism $\varphi$ is finite if and only if $\varphi$ is integral and locally of finite type.
	
	Thus, \autoref{lem:class-intersection-is-reasonable} tells us that it suffices to show the classes of integral morphisms and of morphisms locally of finite type are both preserved by composition, are preserved by base change, and are affine-local on the target.
	\begin{itemize}
		\item For integral morphisms, these are by \autoref{lem:integral-comp}, \autoref{lem:integral-base-change}, and \autoref{cor:integral-affine-local-target}.
		\item For morphisms locally of finite type, these are by \autoref{lem:locally-ft-comp}, \autoref{lem:locally-ft-base-change}, and \autoref{cor:locally-ft-affine-local-target}.
		\qedhere
	\end{itemize}
\end{proof}

\subsection{Fun with Integral Morphisms}
Integral morphisms are important mostly because finite morphisms are integral by \autoref{ex:finite-is-integral}, but they enjoy some nice properties on their own.
\begin{lemma}
	Fix an integral scheme morphism $\pi\colon X\to Y$. Then $\pi$ is a closed map of topological spaces.
\end{lemma}
\begin{proof}
	Give $Y$ an affine open cover $\{Y_\alpha\}_{\alpha\in\lambda}$. Quickly, we claim that a subset $S\subseteq Y$ is closed if and only if $S\cap Y_\alpha\subseteq Y_\alpha$ is closed for each $\alpha$. Indeed, $S\cap Y_\alpha\subseteq Y_\alpha$ is closed if and only if $Y_\alpha\setminus S\subseteq Y_\alpha$ is open for each $\alpha\in\lambda$, which is equivalent to $Y_\alpha\setminus S\subseteq Y$ being open. In this case, we see
	\[Y\setminus S=\Bigg(\bigcup_{\alpha\in\lambda}Y_\alpha\Bigg)\setminus S=\bigcup_{\alpha\in\lambda}(Y_\alpha\setminus S)\]
	is open, making $S$ is closed. Conversely, if $S$ is closed, then $Y_\alpha\setminus S=Y_\alpha\cap(Y\setminus S)$ is open for each $\alpha\in\lambda$.

	The above argument allows us to reduce to the affine case: fix some closed subset $V\subseteq X$, and we want to show that $\pi(V)\subseteq Y$ is closed. It suffices to show that
	\[\pi(V)\cap Y_\alpha=\pi(V\cap\pi^{-1}Y_\alpha)\cap Y_\alpha\]
	is closed in $Y$ for each $\alpha\in\lambda$. Namely, it suffices to show that $\pi|_{\pi^{-1}Y_\alpha}\colon\pi^{-1}Y_\alpha\to Y_\alpha$ is closed.

	Thus, we rename our variables: replace $Y$ with $Y_\alpha$ and $X$ with $\pi^{-1}Y_\alpha$ and $\pi$ with $\pi|_{\pi^{-1}Y_\alpha}$. Notably, because being integral is affine-local on the target by \autoref{cor:integral-affine-local-target}, we see $\pi$ is still integral. But now, $Y$ is affine, so \autoref{cor:affine-integral-condition} tells us that $X$ is affine, and $B\coloneqq\OO_X(X)$ is an integral $A\coloneqq\OO_Y(Y)$-algebra by $f\coloneqq\pi^\sharp_Y$.

	At this point, we are essentially asking a commutative algebra. We are given some closed subset $V(I)\subseteq\Spec B$, and we want to know that
	\[\pi(V(I))=\{\pi(\mf q):\mf q\in V(I)\}=\left\{f^{-1}\mf q:\mf q\supseteq I\right\}\]
	is a closed subset of $\Spec A$. Well, we claim that this set is equal to $V\left(f^{-1}(I)\right)$. Certainly any $\mf q\in\Spec B$ with $\mf q\supseteq I$ will have $f^{-1}\mf q\supseteq f^{-1}(I)$, so $\pi(V(I))\supseteq V\left(f^{-1}(I)\right)$.
	
	For the other inclusion, we pick up the following result from commutative algebra.
	\begin{lemma}[Lying over] \label{lem:lying-over}
		Fix an integral extension of rings $f\colon A\to B$. Then each prime $\mf p\in\Spec A$ has some prime $\mf q\in\Spec S$ such that $f^{-1}\mf q=\mf p$.
	\end{lemma}
	\begin{proof}
		This proof is mildly technical, so we cite \cite[\S4.4]{eisenbud-comm-alg}. (We did cover this result in Math~250B.)
	\end{proof}
	To apply the above lemma, we note that $\overline f\colon A/f^{-1}(I)\to B/I$ is an integral extension: any element $[b]\in B/I$ is represented by some $b\in B$, which is the root of some monic polynomial in $A[x]$; reducing this polynomial to $A/f^{-1}(I)$ makes $[b]$ the root of some monic polynomial in $A/f^{-1}(I)[x]$.

	Thus, for each $\mf p\in V\left(f^{-1}(I)\right)$, we see that $\mf p$ reduces to a prime $\overline{\mf p}\in A/f^{-1}(I)$ by \autoref{exe:closedaffinesubscheme}, so \autoref{lem:lying-over} tells us that there is a prime $\overline{\mf q}\in B/I$ such that
	\[\overline f^{-1}\overline{\mf q}=\overline{\mf p}.\]
	But then \autoref{exe:closedaffinesubscheme} again gives us a prime $\mf q\in\Spec B$ containing $I$ which reduces down to $\overline{\mf q}$. Notably, $a\in\mf p$ if and only if $[a]\in\overline{\mf p}$, which is equivalent to $[a]\in\overline f^{-1}\overline{\mf q}$, which is now equivalent to $[f(a)]\in\mf q$, which is equivalent to $f(a)\in\mf q$, so we do indeed have $\mf p=f^{-1}\mf q$. It follows $\mf p\in\pi(V(I))$. This finishes.
\end{proof}
\begin{remark}
	Later in life, there will be ring maps we care about which are integral but not finite. For example, $\QQ\into\overline\QQ$ is an integral ring map.
\end{remark}
Here is another good property of integral morphisms.
\begin{prop}
	Fix an integral scheme morphism $\pi\colon X\to Y$. Then each closed $Z\subseteq X$ has $\pi(Z)$ closed and $\dim Z=\dim\pi(Z)$.
\end{prop}
\begin{proof}
	That $\pi(Z)$ is closed follows from our previous proof. As usual, we reduce to the affine case, where we have an integral extension of rings $\pi^\sharp\colon R\to S$ (where $\pi(Z)=\Spec R$ and $S=\Spec Z$), and we would like to show that $\dim R=\dim S$.

	For this, we combine two commutative algebra results.
	\begin{lemma}
		Fix an integral extension of rings $R\subseteq S$. If $\mf q_1\subsetneq\mf q_2\subseteq S$ are prime ideals, then their intersections of $R$ are still distinct.
	\end{lemma}
	The above result tells us that $\dim Z\le\dim\pi(Z)$. For the other inequality, we need to be able to go up.
	\begin{lemma}[Going up]
		Fix an integral extension of rings $R\subseteq S$. If there are primes
		\[\mf p_1\subsetneq\mf p_2\subsetneq\cdots\subsetneq\mf p_n\subseteq R,\]
		with a partial lift of $\mf q_i$ such that $\mf q_i\cap R=\mf p_i$ for $1\le i\le m$, then we can extend the chain all the way up to $n$.
	\end{lemma}
	The above result gives us $\pi(Z)\le\dim Z$.
\end{proof}
The point is that integral morphisms are similar to finite ones.

\subsection{Quasifinite Morphisms}
Here's an example of our finiteness conditions doing their job.
\begin{lemma} \label{lem:finite-is-qf}
	Fix a finite scheme morphism $\pi\colon X\to Y$. For any $y\in Y$, the set $\pi^{-1}(\{y\})$ is finite.
\end{lemma}
\begin{proof}
	There are arguments avoiding the fiber product, but let's just go ahead and use it. Let $X_y\coloneqq X\times_Y\{y\}$ so that the topological space of $X_y$ is $\pi^{-1}(\{y\})$. Here is our diagram.
	% https://q.uiver.app/?q=WzAsNCxbMSwwLCJYIl0sWzEsMSwiWSJdLFswLDEsIlxce3lcXH0iXSxbMCwwLCJYX3kiXSxbMywwXSxbMCwxLCJcXHBpIl0sWzIsMSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoiaG9vayIsInNpZGUiOiJ0b3AifX19XSxbMywyLCJcXHBpX3kiXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{X_y} & X \\
		{\{y\}} & Y
		\arrow[from=1-1, to=1-2]
		\arrow["\pi", from=1-2, to=2-2]
		\arrow[hook, from=2-1, to=2-2]
		\arrow["{\pi_y}", from=1-1, to=2-1]
	\end{tikzcd}\]
	Namely, the canonical projection $X_y\to\{y\}$ is finite because finite morphisms are preserved by base change by \autoref{cor:finite-is-reasonable}. Because $X_y$ is homeomorphic to $\pi^{-1}(\{y\})$ by \autoref{lem:topological-fiber}, it suffices to show that $X_y$ is a finite topological space.

	Well, $\{y\}$ is the affine scheme $\Spec k(y)$, so because the canonical map $\pi_y\colon X_y\to\{y\}$ is finite, we conclude that $X_y$ is affine, and
	\[(\pi_y)^\sharp_{\{y\}}\colon k(y)\to\OO_X(X_y)\]
	makes $\OO_X(X_y)$ finitely generated as a $k(y)$-module. Thus, we set $A\coloneqq\OO_X(X_y)$ and $k\coloneqq k(y)$ so that $A$ is finitely generated as a $k$-module, and we want to show $X_y\cong\Spec A$ is finite.

	For this, we appeal to commutative algebra: ideals of $A$ must be $k$-subspaces of $A$, so because $A$ is a finite-dimensional $k$-vector space, we conclude that the ideals of $A$ have the descending chain condition. Thus, $A$ is Artinian and therefore has only finitely many prime ideals.
\end{proof}
Motivated by the above statement, here is yet another finiteness condition.
\begin{definition}[Quasifinite]
	A scheme morphism $\pi\colon X\to Y$ is \textit{quasifinite} if and only if $\pi$ is of finite type and each $y\in Y$ has $\pi^{-1}(\{y\})$ a finite set.
\end{definition}
\begin{example}
	If $\pi\colon X\to Y$ is a finite morphism of locally Noetherian schemes and $U\subseteq X$ is quasicompact, then the restriction $\pi|_U\colon U\to Y$ is quasifinite.
\end{example}
\begin{remark}
	Being quasifinite is stable under composition, base change, and is affine local on the target. I will not show this, for now, because it is somewhat hard, and I have not been convinced to care about quasifinite morphisms.
\end{remark}
\begin{remark}
	A morphism is finite if and only if it is quasifinite and integral. We have seen the forward direction: finite morphisms are integral by \autoref{ex:finite-is-integral} and quasifinite by \autoref{lem:finite-is-qf}. The converse is much harder to prove.
\end{remark}

\subsection{Chevalley's Theorem}
We close lecture by stating Chevalley's theorem.
\begin{theorem}[Chevalley]
	Fix a scheme morphism $\pi\colon X\to Y$ of finite type. If $C\subseteq X$ is constructible, then $\pi(C)$ is also constructible.
\end{theorem}
Here is the appropriate definition.
\begin{definition}[Constructible]
	Fix a Noetherian topological space $X$. Then a subset $C\subseteq X$ is constructible if and only if it is the union of subsets of the form $U\subseteq V$ where $U\subseteq X$ is open and $V\subseteq X$ is closed.
\end{definition}
There is a different definition on the homework; in particular, the collection of constructible sets
\begin{remark}
	It is somewhat important for constructible sets to be living in a Noetherian topological space. The definition must change otherwise.
\end{remark}

\end{document}