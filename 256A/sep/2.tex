% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

It is another day.
\begin{remark}
	Facts used on the homework from Vakil which are in Vakil without proof should be proven on the homework.
\end{remark}
We begin lecture by providing an example which we don't quite have the language to describe yet, but we will elaborate on it more later.\todo{elaborate}
\begin{example} \label{ex:protoses}
	Fix $X=\CC$ with the usual topology, and give it the sheaf $\mc O_X$ of holomorphic functions. There is a constant sheaf $\underline\ZZ$ returning $\ZZ$ at its stalks. Then there is an exact sequence of sheaves
	\begin{equation}
		0\to\underline\ZZ\stackrel{2\pi i}\to\OO_X\stackrel{\exp}\to\OO_X^\times\to1 \label{eq:protoses}
	\end{equation}
	even though the last map is not always surjective for any $U\subseteq\CC$; for example, take $U=\CC\setminus\{0\}$. (However, if $U$ is simply connected, then the map will be surjective.)
\end{example}
\begin{remark}
	Cohomology applied to \autoref{eq:protoses} (with $X$ some smooth projective curve) shows a special case of the Hodge conjecture.
\end{remark}
The point here is that surjectivity cannot be checked on open sets the way that injectivity can. At some level, the issue here is that the cokernel presheaf is not a sheaf, so we have to apply a sheafification operation to fix this.
\begin{remark}
	Setting
	\[\mc F(U)\coloneqq\im\exp(U)\]
	makes $\mc F$ a presheaf but does not give a sheaf.
\end{remark}

\subsection{Sheafification}
We introduce sheafification by its universal property.
\begin{definition}[Sheafification]
	Fix a presheaf $\mc F$ on $X$ valued in a (concrete) category $\mc C$. The \textit{sheafification} of $\mc F$ is a pair $(\mc F^{\op{sh}},{\op{sh}})$ where ${\op{sh}}\colon\mc F\to\mc F^{\op{sh}}$ satisfies the following universal property: any sheaf $\mc G$ with a presheaf morphism $\varphi\colon\mc F\to\mc G$ has a unique sheaf morphism $\overline\varphi\colon\mc F^{\op{sh}}\to\mc G$ making the following diagram commute.
	% https://q.uiver.app/?q=WzAsMyxbMCwwLCJcXG1jIEYiXSxbMSwwLCJcXG1jIEZee1xcb3B7c2h9fSJdLFsxLDEsIlxcbWMgRyJdLFswLDIsIlxcdmFycGhpIiwyXSxbMCwxLCJcXG9we3NofSJdLFsxLDIsIlxccHNpIl1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc F^{\op{sh}}} \\
		& {\mc G}
		\arrow["\varphi"', from=1-1, to=2-2]
		\arrow["{\op{sh}}", from=1-1, to=1-2]
		\arrow["\overline\varphi", from=1-2, to=2-2]
	\end{tikzcd}\]
\end{definition}
Of course, there are some checks we should do before using this object.
\begin{lemma}
	The sheafification of a presheaf $\mc F$ on $X$ exists and is unique up to (a suitable notion of) unique isomorphism.
\end{lemma}
\begin{proof}
	The idea of the construction is to set $\mc F^{\op{sh}}(U)$ to be systems of compatible germs; precisely,
	\[\mc F^{\op{sh}}(U)\coloneqq\Bigg\{(f_p)_{p\in U}\in\prod_{p\in U}\mc F_p:(f_p)_{p\in U}\text{ is a compatible system of germs}\Bigg\}.\]
	Given open sets $V\subseteq U$, we define the restriction map
	\[\arraycolsep=1.4pt\begin{array}{cccc}
		{\op{res}_{U,V}}\colon & \mc F^{\op{sh}}(U) &\to& \mc F^{\op{sh}}(V) \\
		& (f_p)_{p\in U} &\mapsto& (f_p)_{p\in V}
	\end{array}\]
	though we do have to check this is well-defined: to show $(f_p)_{p\in V}\in\mc F^{\op{sh}}(V)$, we note $(f_p)_{p\in U}\in\mc F^{\op{sh}}(U)$ promises that each $p\in U$ has $U_p\subseteq U$ containing $p$ with a lift $\widetilde f_p\in\mc F(U_p)$ so that $\widetilde f_p|_q=f_q$ for each $q\in U_p$. As such, each $p\in V$ has $V_p\coloneqq U_p\cap V$ containing $p$ with a lift $\widetilde f_p|_{U_p\cap V}\in\mc F(U_p\cap V)$ so that $\widetilde f_p|_{U_p\cap V}|_q=\widetilde f_p|_q=f_q$ for each $q\in U_p\cap V$. Thus, $(f_p)_{p\in V}$ is indeed a system of compatible germs.

	We now check that $\mc F^{\op{sh}}$ is a presheaf.
	\begin{itemize}
		\item Identity: given $(f_p)_{p\in U}\in\mc F^{\op{sh}}(U)$, we see $(f_p)_{p\in U}|_U=(f_p)_{p\in U}$.
		\item Functoriality: given open sets $W\subseteq V\subseteq U$, we see $(f_p)_{p\in U}|_V|_W=(f_p)_{p\in V}|_W=(f_p)_{p\in W}=(f_p)_{p\in U}|_W$.
	\end{itemize}
	Next up, we check that $\mc F^{\op{sh}}$ is a sheaf. Fix an open cover $\mc U$ of an open set $U\subseteq X$.
	\begin{itemize}
		\item Identity: suppose that $(f_p)_{p\in U},(g_p)_{p\in U}\in\mc F^{\op{sh}}(U)$ have $(f_p)_{p\in U}|_V=(g_p)_{p\in U}|_V$ for each $V\in\mc U$. Now, for each $q\in U$, there is some $V\in\mc U$ containing $q$, so we note
		\[(f_p)_{p\in V}=(f_p)_{p\in U}|_V=(g_p)_{p\in U}|_V=(g_p)_{p\in V}\]
		forces $f_q=g_q$. Thus, $(f_p)_{p\in U}=(g_p)_{p\in U}$.
		\item Gluability: suppose we have $(f_{V,p})_{p\in V}\in\mc F^{\op{sh}}(V)$ for each $V\in\mc U$ so that
		\[(f_{V,p})_{p\in V\cap V'}=(f_{V,p})_{p\in V}|_{V\cap V'}=(f_{V',p})_{p\in V'}|_{V\cap V'}=(f_{V',p})_{p\in V\cap V'}.\]
		Now, for each $q\in U$, find any $V\in\mc U$ containing $q$, and set $f_q\coloneqq f_{V,q}$. Note that this is independent of the choice of $V$: if we have $q\in V\cap V'$ with $V,V'\in\mc U$, then $(f_{V,p})_{p\in V\cap V'}=(f_{V',p})_{p\in V\cap V'}$ tells us that $f_{V,q}=f_{V',q}$. Further, we note that $(f_p)_{p\in U}|_V=(f_p)_{p\in V}=(f_{V,p})_{p\in V}$ for any $V\in\mc U$.
		
		So it remains to show that $(f_p)_{p\in U}\in\mc F^{\op{sh}}(U)$. Well, for each $p\in U$, find some $V\in\mc U$ containing $p$. Then $(f_{V,p})_{p\in V}$ is a system of compatible germs, so we can find $U_p\subseteq V$ containing $p$ and a lift $\widetilde f_p\in\mc F(U_p)$ such that
		\[\widetilde f_{p}|_q=f_{V,q}=f_q\]
		for each $q\in U_p$. This finishes checking that $(f_p)_{p\in U}$ is a compatible system of germs.
	\end{itemize}
	We now begin showing the universal property. The sheafification map is defined as
	\[\arraycolsep=1.4pt\begin{array}{ccccccccc}
		{\op{sh}_U}\colon & \mc F(U) &\to& \mc F^{\op{sh}}(U) \\
		& f &\mapsto& (f|_p)_{p\in U}
	\end{array}\]
	for any open set $U\subseteq X$. Note $f\in\mc F(U)$ does indeed give $(f|_p)_{p\in U}\in\mc F^{\op{sh}}(U)$ because each $p\in U$ can choose $U_p\coloneqq U$ (which contains $p$) with lift $\widetilde f_p\coloneqq f$ so that $\widetilde f_p|_q=f|_q$ for each $q\in U_p$.

	Additionally, it is fairly quick to check that $\op{sh}$ is actually a presheaf morphism: given open sets $V\subseteq U$ and $f\in\mc F(U)$, we compute
	\[\op{sh}_U(f)|_V=(f|_p)_{p\in U}|_V=(f|_p)_{p\in V}=(f|_V|_p)_{p\in V}=\op{sh}_V(f|_V).\]
	We are now ready to prove the universal property. Fix any sheaf $\mc G$ with a presheaf morphism $\varphi\colon\mc F\to\mc G$. We need to show there is a unique sheaf morphism $\overline\varphi\colon\mc F^{\op{sh}}\to\mc G$ such that $\varphi=\overline\varphi\circ\op{sh}$. We show these separately.
	\begin{itemize}
		\item Uniqueness: fix an open set $U\subseteq X$ and $(f_p)_{p\in U}\in\mc F^{\op{sh}}(U)$, and we will solve for $\overline\varphi_U((f_p)_{p\in U})$. Well, each $p\in U$ has some $U_p\subseteq U$ containing $p$ with a lift $\widetilde f_p\in\mc F(U_p)$ such that $\widetilde f_p|_q=f_q$ for each $q\in U_p$. As such, for each $q\in U$,
		\[\overline\varphi_U((f_p)_{p\in U})|_{U_q}=\overline\varphi_{U_q}((f_p)_{p\in U}|_{U_q})=\overline\varphi_{U_q}((f_p)_{p\in U_q})=\overline\varphi_{U_q}\big((\widetilde f_q|_p)_{p\in U_q}\big)=\overline\varphi_{U_q}(\op{sh}_{U_q}\widetilde f_q)=\varphi_{U_q}(\widetilde f_q).\]
		Thus, restrictions $\overline\varphi_U((f_p)_{p\in U})|_{U_q}$ are fixed by $\varphi$, so the identity axiom on $\mc G$ makes $\overline\varphi_U((f_p)_{p\in U})$ unique.
		\item Existence: fix an open set $U\subseteq X$ and $(f_p)_{p\in U}\in\mc F^{\op{sh}}(U)$, and we will define $\overline\varphi_U((f_p)_{p\in U})$. Well, $(\varphi_pf_p)_{p\in U}$ is a system of compatible germs in $\mc G(U)$ by \autoref{lem:movecompatibles}, so there is a unique $g\in\mc G(U)$ such that $g|_p=\varphi_p(f_p)$ for each $p\in U$. (Uniqueness is by \autoref{prop:stalkinjection}.) Thus, we set $\overline\varphi_U((f_p)_{p\in U})\coloneqq g$ so that $\overline\varphi_U((f_p)_{p\in U})$ is the unique section in $\mc G(U)$ such that
		\[\overline\varphi_U((f_p)_{p\in U})|_q=\varphi_q(f_q)\]
		for each $q\in U$. Note any section $f\in\mc F(U)$ has
		\[(\overline\varphi\circ{\op{sh}})_U(f)|_q=\overline\varphi_U((f|_p)_{p\in U})|_q=\varphi_q(f|_q)=\varphi_U(f)|_q\]
		for any $q\in U$, so \autoref{prop:stalkinjection} applied to the sheaf $\mc G$ forces equality, implying $\overline\varphi\circ{\op{sh}}=\varphi$.

		So we will be done as soon as we can show $\overline\varphi_U$ is a (pre)sheaf morphism. Well, given open sets $V\subseteq U$ and some $(f_p)_{p\in U}\in\mc F^{\op{sh}}(U)$, we note any $q\in V$ has
		\[\overline\varphi_U((f_p)_{p\in U})|_V|_q=\overline\varphi_U((f_p)_{p\in U})|_q=\varphi_q(f_q),\]
		so the uniqueness of $\overline\varphi_V((f_p)_{p\in V})$ forces $\overline\varphi_U((f_p)_{p\in U})|_V=\overline\varphi_V((f_p)_{p\in U}|_V),$ as desired.
		\qedhere
	\end{itemize}
\end{proof}
Here are some basic properties.
\begin{proposition}
	Fix a presheaf $\mc F$ on $X$ with a sheafification ${\op{sh}}\colon\mc F\to\mc F^{\op{sh}}$. For given $p\in X$, the induced map ${\op{sh}_p}\colon\mc F_p\to(\mc F^{\op{sh}})_p$ on stalks is an isomorphism.
\end{proposition}
\begin{proof}
	We use the explicit description of the sheafification. To be explicit, our map ${\op{sh}_p}\colon\mc F_p\to(\mc F^{\op{sh}})_p$ sends $[(U,f)]$ to $[(U,(f|_q)_{q\in U})]$.

	For the inverse morphism $\pi_p\colon(\mc F^{\op{sh}})_p\to\mc F_p$, we simply send
	\[\pi_p\colon[(U,(f_q)_{q\in U})]\mapsto f_p.\]
	Notably, this is well-defined: $[(U,(f_q)_{q\in U})]=[(U',(f_q')_{q\in U})]$, then there is $V\subseteq U\cap U'$ such that $(f_q)_{q\in U})|_V=(f'_q)_{q\in U'}|_V$, which implies $f_p=f'_p$.

	It remains to show that these are inverse. Well, for $[(U,f)]\in\mc F_p$, we see
	\[\pi_p(\op{sh}_p([(U,f)]))=\pi_p([(U,(f|_q)_{q\in U})])=f|_p.\]
	And for $[(U,(f_q)_{q\in U})]\in(\mc F^{\op{sH}})_p$, we see
	\[\op{sh}_p(\pi_p([(U,(f_q)_{q\in U})]))=\op{sh}_p(f_p).\]
	Now, because $(f_q)_{q\in U}$ is a compatible system of germs, we may find $U_p\subseteq U$ containing $p$ with a lift $\widetilde f_p\in\mc F(U_p)$ such that $\widetilde f_p|_q=f_q$ for each $q\in U_p$. It follows
	\[\op{sh}_p(f_p)=\op{sh}_p(\widetilde f_p|_p)=[(U_p,(\widetilde f_p|_q)_{q\in U_p})]=[(U_p,(f_q)_{q\in U})]=[(U,(f_q)_{q\in U})],\]
	finishing this check.
\end{proof}
\begin{proposition}
	Sheafification $\mc F\mapsto\mc F^{\op{sh}}$ defines a functor $(-)^{\op{sh}}\colon\mathrm{PreSh}_X\to\mathrm{Sh}_X$ which is left adjoint to the forgetful functor $U\colon\mathrm{Sh}_X\to\mathrm{PreSh}_X$.
\end{proposition}
\begin{proof}
	We begin by describing the functor $(-)^{\op{sh}}$. We know its behavior on objects, so we still need to know its behavior on morphisms $\eta\colon\mc F\to\mc G$. Well, note that we have a composite map $\mc F\to\mc G\to\mc G^{\op{sh}}$, and $\mc G^{\op{sh}}$ is a sheaf, so the universal property of $\mc F^{\op{sh}}$ induces a unique map $\eta^{\op{sh}}\colon\mc F^{\op{sh}}\to\mc G^{\op{sh}}$ making the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXG1jIEYiXSxbMCwxLCJcXG1jIEciXSxbMSwwLCJcXG1jIEZee1xcb3B7c2h9fSJdLFsxLDEsIlxcbWMgR157XFxvcHtzaH19Il0sWzAsMl0sWzEsM10sWzAsMSwiXFxldGEiLDJdLFsyLDMsIlxcZXRhXntcXG9we3NofX0iLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc F^{\op{sh}}} \\
		{\mc G} & {\mc G^{\op{sh}}}
		\arrow[from=1-1, to=1-2]
		\arrow[from=2-1, to=2-2]
		\arrow["\eta"', from=1-1, to=2-1]
		\arrow["{\eta^{\op{sh}}}", dashed, from=1-2, to=2-2]
	\end{tikzcd}\]
	commute. We quickly check functoriality.
	\begin{itemize}
		\item Identity: note $\id_{\mc F^{\op{sh}}}$ makes the diagram
		% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXG1jIEYiXSxbMCwxLCJcXG1jIEYiXSxbMSwwLCJcXG1jIEZee1xcb3B7c2h9fSJdLFsxLDEsIlxcbWMgRl57XFxvcHtzaH19Il0sWzAsMl0sWzEsM10sWzAsMSwiXFxpZF97XFxtYyBGfSIsMl0sWzIsMywiXFxpZF97XFxtYyBGXntcXG9we3NofX19IiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{\mc F} & {\mc F^{\op{sh}}} \\
			{\mc F} & {\mc F^{\op{sh}}}
			\arrow[from=1-1, to=1-2]
			\arrow[from=2-1, to=2-2]
			\arrow["{\id_{\mc F}}"', from=1-1, to=2-1]
			\arrow["{\id_{\mc F^{\op{sh}}}}", dashed, from=1-2, to=2-2]
		\end{tikzcd}\]
		commute, so by definition, we see $({\id_\mc F})^{\op{sh}}=\id_{\mc F^{\op{sh}}}$.
		\item Functoriality: given presheaf morphisms $\varphi\colon\mc F\to\mc G$ and $\psi\colon\mc G\to\mc H$, we note that $\psi^{\op{sh}}\circ\varphi^{\op{sh}}$ makes the outer rectangle of
		% https://q.uiver.app/?q=WzAsNixbMCwwLCJcXG1jIEYiXSxbMCwxLCJcXG1jIEciXSxbMSwwLCJcXG1jIEZee1xcb3B7c2h9fSJdLFsxLDEsIlxcbWMgR157XFxvcHtzaH19Il0sWzAsMiwiXFxtYyBIIl0sWzEsMiwiXFxtYyBIXntcXG9we3NofX0iXSxbMCwyXSxbMSwzXSxbMCwxLCJcXHZhcnBoaSJdLFsyLDMsIlxcdmFycGhpXntcXG9we3NofX0iLDJdLFsxLDQsIlxccHNpIl0sWzMsNSwiXFxwc2lee1xcb3B7c2h9fSIsMl0sWzQsNV0sWzIsNSwiXFxwc2lee1xcb3B7c2h9fVxcY2lyY1xcdmFycGhpXntcXG9we3NofX0iLDAseyJjdXJ2ZSI6LTIsInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFswLDQsIlxccHNpXFxjaXJjXFx2YXJwaGkiLDIseyJjdXJ2ZSI6Mn1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{\mc F} & {\mc F^{\op{sh}}} \\
			{\mc G} & {\mc G^{\op{sh}}} \\
			{\mc H} & {\mc H^{\op{sh}}}
			\arrow[from=1-1, to=1-2]
			\arrow[from=2-1, to=2-2]
			\arrow["\varphi", from=1-1, to=2-1]
			\arrow["{\varphi^{\op{sh}}}"', from=1-2, to=2-2]
			\arrow["\psi", from=2-1, to=3-1]
			\arrow["{\psi^{\op{sh}}}"', from=2-2, to=3-2]
			\arrow[from=3-1, to=3-2]
			\arrow["{\psi^{\op{sh}}\circ\varphi^{\op{sh}}}", curve={height=-12pt}, dashed, from=1-2, to=3-2]
			\arrow["\psi\circ\varphi"', curve={height=12pt}, from=1-1, to=3-1]
		\end{tikzcd}\]
		commute, so by definition, we see $\psi^{\op{sh}}\circ\varphi^{\op{sh}}=(\psi\circ\varphi)^{\op{sh}}$.
	\end{itemize}
	We will not check that the forgetful functor $U$ is a functor; the main point is that it does nothing to morphisms. Also, we will not formally check the adjoint pair, but we will say that it requires exhibit a natural isomorphism
	\[\op{Mor}_{\mathrm{Sh}_X}(F^{\op{sh}},\mc G)\simeq\op{Mor}_{\mathrm{PreSh}_X}(F,U\mc G)\]
	where $F\in\mathrm{PreSh}_X$ and $\mc G\in\mathrm{Sh}_X$. And we will describe this isomorphism: if ${\op{sh}}\colon F\to F^{\op{sh}}$ is the sheafification map, the isomorphism is given by
	\[\arraycolsep=1.4pt\begin{array}{ccc}
		\op{Mor}_{\mathrm{Sh}_X}(F^{\op{sh}},\mc G) &\simeq& \op{Mor}_{\mathrm{PreSh}_X}(F,U\mc G) \\
		\varphi &\mapsto& \varphi\circ{\op{sh}} \\
		\overline\psi &\mapsfrom& \psi
	\end{array}\]
	where $\overline\psi$ is the morphism induced by the universal property of sheafification applied to the presheaf morphism $\psi\colon F\to\mc G$. That this is an isomorphism follows from the universal property, and the naturality checks for the adjoint pair are a matter of writing down the squares and checking them.
\end{proof}
\begin{remark}
	Sheafification being a left adjoint means that it preserves limits. Kernels and limits, so we see that the sheafification of the presheaf kernel is just the presheaf kernel again. The point here is that we don't need to sheafify the kernel, which is why we could talk about them before sheafification, but we will not be so lucky with cokernels.
\end{remark}

\subsection{Sheaf Cokernels}
Now that we have sheafification, we may continue showing that the category sheaves valued in an abelian category is abelian. For this, we need to understand cokernels.
\begin{definition}[Sheaf cokernel]
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of presheaves on $X$. Then the \textit{presheaf cokernel} $\coker\varphi$ is the sheaf found by setting
	\[(\coker^{\op{pre}}\varphi)(U)\coloneqq\coker\varphi_U=\mc G(U)/\im\varphi_U.\]
	If $\mc F$ and $\mc G$ are sheaves, we define the \textit{sheaf kernel} as the sheafification of the presheaf $\coker^{\op{pre}}\varphi$.
\end{definition}
We begin by running our checks on the presheaf cokernel.
\begin{lemma} \label{lem:presheafcoker}
	Fix a presheaf morphism $\varphi\colon\mc F\to\mc G$. Then $\coker^{\op{pre}}\varphi$ is a presheaf, and it is the cokernel of $\varphi$ in the category $\mathrm{PreSh}_X$.
\end{lemma}
\begin{proof}
	To begin, we must exhibit our restriction maps. Given open sets $V\subseteq U$ and $[g]\in(\coker^{\op{pre}}\varphi)(U)=\coker\varphi_U$, we define
	\[\op{res}_{U,V}([g])\coloneqq[g|_V].\]
	Note this is well-defined: if $[g]=[g']$, then $g-g'\in\im\varphi_U$, so write $g-g'=\varphi_U(f)$ for $f\in\mc F(U)$. Thus, $g|_V-g'|_V=(g-g')|_V=\varphi_U(f)|_V=\varphi_V(f|_V)$ is in the image of $\varphi_V$, so $[g|_V]=[g'|_V]$.

	We quickly check that this data assembles into a presheaf.
	\begin{itemize}
		\item Identity: given $g\in(\coker^{\op{pre}}\varphi)(U)$, note $[g]|_U=[g|_U]=[g]$.
		\item Functoriality: given open sets $W\subseteq V\subseteq U$ and some $g\in(\coker^{\op{pre}}\varphi)(U)$, we see $[g]|_V|_W=[g|_V]|_W=[g|_V|_W]=[g|_W]=[g]|_W$.
	\end{itemize}
	It remains to check the universal property: we need $\coker^{\op{pre}}\varphi$ to be the colimit of the following diagram.
	% https://q.uiver.app/?q=WzAsMyxbMCwwLCJcXG1jIEYiXSxbMSwwLCJcXG1jIEciXSxbMCwxLCJcXG1jIFoiXSxbMCwxLCJcXHZhcnBoaSJdLFswLDJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc G} \\
		{\mc Z}
		\arrow["\varphi", from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
	\end{tikzcd}\]
	To begin, we define a morphism $\pi\colon\mc G\to\coker^{\op{pre}}\varphi$. Well, for each open $U\subseteq X$, there is a natural projection $\pi_U\colon\mc G(U)\onto\coker\varphi_U$ by $\pi_U\colon g\mapsto[g]$, which we need to assemble into a natural transformation. Indeed, given open sets $V\subseteq U$ and a section $g\in\mc G(U)$, we compute
	\[\pi_U(g)|_V=[g]|_V=[g|_V]=\pi_V(g|_V).\]
	This map $\pi\colon\mc G\to\coker^{\op{pre}}\varphi$ induces the other needed maps $\mc F\to\coker^{\op{pre}}\varphi$ (as $\pi\circ\varphi$) and $\mc Z\to\coker^{\op{pre}}\varphi$ (which is the zero map). Further, note that any open $U\subseteq X$ has $(\pi\circ\varphi)_U=\pi_U\circ\varphi_U=0$ because $\pi_U$ returns $0$ on $\im\varphi_U$; thus, $\pi\circ\varphi=0$. Thus, the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXG1jIEYiXSxbMSwwLCJcXG1jIEciXSxbMCwxLCJcXG1jIFoiXSxbMSwxLCJcXGNva2VyXntcXG9we3ByZX19XFx2YXJwaGkiXSxbMCwxLCJcXHZhcnBoaSJdLFswLDJdLFsxLDMsIlxccGkiLDJdLFsyLDNdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc G} \\
		{\mc Z} & {\coker^{\op{pre}}\varphi}
		\arrow["\varphi", from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
		\arrow["\pi"', from=1-2, to=2-2]
		\arrow[from=2-1, to=2-2]
	\end{tikzcd}\]
	commutes.

	We are now ready to show the universal property. Fix a presheaf $\mc H$ with a map $\psi\colon\mc G\to\mc H$ such that $\psi\circ\varphi=0$. Then we need a unique map $\overline\psi\colon(\coker^{\op{pre}}\varphi)\to\mc H$ such that $\psi=\overline\psi\circ\pi$; i.e., such that the diagram
	% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXG1jIEYiXSxbMSwwLCJcXG1jIEciXSxbMCwxLCJcXG1jIFoiXSxbMSwxLCJcXGNva2VyXntcXG9we3ByZX19XFx2YXJwaGkiXSxbMiwyLCJcXG1jIEgiXSxbMCwxLCJcXHZhcnBoaSJdLFswLDJdLFsxLDMsIlxccGkiLDJdLFsyLDNdLFszLDQsIlxcb3ZlcmxpbmVcXHBzaSIsMSx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsxLDQsIlxccHNpIiwwLHsiY3VydmUiOi0yfV0sWzIsNCwiIiwwLHsiY3VydmUiOjJ9XV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc G} \\
		{\mc Z} & {\coker^{\op{pre}}\varphi} \\
		&& {\mc H}
		\arrow["\varphi", from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
		\arrow["\pi"', from=1-2, to=2-2]
		\arrow[from=2-1, to=2-2]
		\arrow["\overline\psi"{description}, dashed, from=2-2, to=3-3]
		\arrow["\psi", curve={height=-12pt}, from=1-2, to=3-3]
		\arrow[curve={height=12pt}, from=2-1, to=3-3]
	\end{tikzcd}\]
	commutes. We show uniqueness and existence of $\overline\psi$ separately.
	\begin{itemize}
		\item Uniqueness: given an open set $U\subseteq X$ and some $[g]\in(\coker^{\op{pre}})(U)$, we must have
		\[\overline\psi_U([g])=\overline\psi_U(\pi_Ug)=\psi_U(g),\]
		so $\overline\psi_U$ is uniquely determined.
		\item Existence: given an open set $U\subseteq X$ and some $[g]\in(\coker^{\op{pre}}\varphi)(U)$, we simply define
		\[\overline\psi_U([g])\coloneqq\psi_U(g).\]
		Note this is well-defined: if $[g]=[g']$, then $g-g'\in\im\varphi_U$, so write $g-g'=\varphi_U(f)$. Then $\psi_U(g)-\psi_U(g')=\psi_U(\varphi_Uf)=0$, so $\psi_U(g)=\psi_U(g')$.
		
		Additionally, we note that any $g\in\mc G(U)$ will have $\overline\psi_U(\pi_Ug)=\overline\psi_U([g])=\psi_U(g)$, so we conclude $\overline\psi\circ\pi=\psi$. It remains to show that $\overline\psi$ is actually a presheaf morphism. Well, any open sets $V\subseteq U$ and $[g]\in(\coker^{\op{pre}}\varphi)(U)$ has
		\[\overline\psi_U([g])|_V=\psi_U(g)|_V=\psi_V(g|_V)=\overline\psi_V([g|_V])=\overline\psi_V([g]|_V),\]
		finishing.
		\qedhere
	\end{itemize}
\end{proof}
And now we run the checks on the sheaf kernel.
\begin{lemma} \label{lem:sheafcoker}
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. Then $\coker\varphi$ is the cokernel in the category $\mathrm{Sh}_X$.
\end{lemma}
\begin{proof}
	Let $\pi^{\op{pre}}\colon\mc G\to\coker^{\op{pre}}\varphi$ be the projection map of \autoref{lem:presheafcoker} and ${\op{sh}}\colon\coker^{\op{pre}}\varphi\to\coker\varphi$ be the sheafification map. Then we define $\pi\coloneqq{\op{sh}}\circ\pi^{\op{pre}}$, so we claim that this map makes $\coker\varphi$ the colimit of the following diagram.
	% https://q.uiver.app/?q=WzAsMyxbMCwwLCJcXG1jIEYiXSxbMSwwLCJcXG1jIEciXSxbMCwxLCJcXG1jIFoiXSxbMCwxLCJcXHZhcnBoaSJdLFswLDJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc G} \\
		{\mc Z}
		\arrow["\varphi", from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
	\end{tikzcd}\]
	Notably, we have $\pi\circ\varphi={\op{sh}}\circ\pi^{\op{pre}}\circ\varphi={\op{sh}}\circ0=0$, so $\pi$ at least works as a candidate morphism.

	To show the universal property, fix a sheaf $\mc H$ with a map $\psi\colon\mc G\to\mc H$ such that $\psi\circ\varphi=0$. Then we need a unique map $\overline\psi\colon\coker\varphi\to\mc H$ such that $\psi=\overline\psi\circ\pi$, or equivalently, making
	\[\begin{tikzcd}
		{\mc F} & {\mc G} \\
		{\mc Z} & {\coker\varphi} \\
		&& {\mc H}
		\arrow["\varphi", from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
		\arrow["\pi"', from=1-2, to=2-2]
		\arrow[from=2-1, to=2-2]
		\arrow["\overline\psi"{description}, dashed, from=2-2, to=3-3]
		\arrow["\psi", curve={height=-12pt}, from=1-2, to=3-3]
		\arrow[curve={height=12pt}, from=2-1, to=3-3]
	\end{tikzcd}\]
	commute. We show existence and uniqueness separately.
	\begin{itemize}
		\item Existence: working in $\mathrm{PreSh}_X$ for a moment, the fact that $\psi\circ\varphi=0$ promises a map $\overline\psi^{\op{pre}}\colon\coker^{\op{pre}}\varphi\to\mc H$ such that $\overline\psi^{\op{pre}}\circ\pi^{\op{sh}}=\psi$. Now, from the definition of sheafification, we get a map $\overline\psi\colon\coker\varphi\to\mc H$ such that
		\[\overline\psi\circ{\op{sh}}=\overline\psi^{\op{pre}}.\]
		Thus, $\overline\psi\circ\pi=\overline\psi\circ{\op{sh}}\circ\pi^{\op{pre}}=\overline\psi^{\op{pre}}\circ\pi^{\op{pre}}=\psi$, as needed.
		\item Uniqueness: suppose $\overline\psi_1,\overline\psi_2\colon\coker\varphi\to\mc H$ have $\psi=\overline\psi_1\circ\pi=\overline\psi_2\circ\pi$. Then we see that actually
		\[\psi=(\overline\psi_1\circ{\op{sh}})\circ\pi^{\op{pre}}=(\overline\psi_2\circ{\op{sh}})\circ\pi^{\op{pre}},\]
		but the universal property of $\coker^{\op{pre}}\varphi$ has a uniqueness forcing $\overline\psi_1\circ{\op{sh}}=\overline\psi_2\circ{\op{sh}}$. But then the universal property of sheafification says there is a unique map $\overline\psi\colon\coker\varphi\to\mc H$ such that
		\[\overline\psi\circ{\op{sh}}=\overline\psi_1\circ{\op{sh}}=\overline\psi_2\circ{\op{sh}},\]
		so $\overline\psi=\overline\psi_1=\overline\psi_2$ follows.
		\qedhere
	\end{itemize}
\end{proof}
As before, we take a moment to verify that vanishing cokernel does indeed mean epic.
\begin{lemma} \label{lem:epiiszerocoker}
	Let $\mc C$ be a category with a zero object and cokernels. Then a morphism $\varphi\colon A\to B$ is epic if and only if $\coker\varphi$ vanishes.
\end{lemma}
\begin{proof}
	Reverse all the arrows in \autoref{lem:moniciszeroker}. Notably, the dual of the kernel is the cokernel, the dual of a monic map is an epic map, and the dual of the zero object is still the zero object.
\end{proof}

\subsection{Surjectivity at Stalks}
We are now ready to fix our surjectivity. Just like injectivity, we can check surjectivity at stalks.
\begin{lemma} \label{lem:cokerstalk}
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of presheaves on $X$. Then, for any $p$, the projection $\mc G\to\coker^{\op{pre}}\varphi$ induces an isomorphism
	\[\coker\varphi_p\to(\coker^{\op{pre}}\varphi)_p.\]
	Thus, if $\mc F$ and $\mc G$ are sheaves, then the projection $\mc G\to\coker\varphi$ induces an isomorphism $\coker\varphi_p\simeq(\coker\varphi)_p$.
\end{lemma}
\begin{proof}
	Let $\pi^{\op{pre}}\colon\mc G\to\coker^{\op{pre}}\varphi$ be the natural projection witnessing that $\coker^{\op{pre}}\varphi$ is the presheaf cokernel.

	To show the second sentence note $\pi^{\op{pre}}$ induces a map $\mc G_p\to(\coker^{\op{pre}}\varphi)_p$ as
	\[\pi^{\op{pre}}_p\colon[(U,g)]\mapsto[(U,\pi^{\op{pre}}_Ug)].\]
	Note that, if $[(U,g)]\in\im\varphi_p$, then we can write $[(U,g)]=[(V,\varphi_Vf)]$ for some $f\in\mc F(V)$, so
	\[\pi^{\op{pre}}_p(f|_p)=(\pi^{\op{pre}}_Vf)|_p=0|_p=0,\]
	so $\im\varphi_p\subseteq\ker\pi^{\op{pre}}_p$, so we have actually induced a map $\coker\varphi_p\to(\coker^{\op{pre}}\varphi)_p$.

	In the other direction, we define $\varphi_p\colon(\coker^{\op{pre}}\varphi)_p\to\coker\varphi_p$ by
	\[\varphi_p\colon[(U,[g])]\mapsto(g|_p+\im\varphi_p).\]
	We do need to check that this is well-defined: if $(U,[g])\sim(U',[g'])$, then we can find $V\subseteq U\cap U'$ such that $[(g-g')|_V]=[g]|_V-[g']|_V=0$, so there is $f\in\mc F(V)$ such that $(g-g')|_V=\varphi_V(f)$. Thus, $g|_p-g'|_p=(g-g')|_p=(g-g')|_V|_p=\varphi_V(f)|_p$ is in $\im\varphi_p$.

	Lastly, we need to check that $\pi^{\op{pre}}_p$ and $\varphi_p$ are inverse. Given $[(U,g)]+\im\varphi_p\in\coker\varphi_p$, we note
	\[\varphi_p\left(\pi^{\op{pre}}([(U,g)]+\im\varphi_p)\right)=\varphi_p([(U,[g])])=g|_p+\im\varphi_p.\]
	Conversely, given $[(U,[g])]\in(\coker^{\op{pre}}\varphi)_p$, we note
	\[\pi^{\op{pre}}_p(\varphi_p([(U,[g])]))=\pi^{\op{pre}}([(U,g)]+\im\varphi_p)=[(U,[g])],\]
	finishing.

	We now show the last sentence. Let ${\op{sh}}\colon\coker^{\op{pre}}\varphi\to\coker\varphi$ be the sheafification map. Then $\pi_p=({\op{sh}}\circ\pi^{\op{pre}})_p$ we can check to be ${\op{sh}}_p\circ\pi^{\op{pre}}_p$ (by, say, \autoref{rem:stalkfunctor}). Stringing these isomorphisms together, we see
	\[\coker\varphi_p\to(\coker^{\op{pre}}\varphi)_p\simeq(\coker\varphi)_p,\]
	which is what we wanted.
\end{proof}
And here is our result.
\begin{proposition} \label{lem:surjonstalks}
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. The following are equivalent.
	\begin{listalph}
		\item $\varphi$ is epic.
		\item $(\coker\varphi)(U)$ vanishes for all open $U\subseteq X$.
		\item $\varphi_p$ is epic for all $p\in X$.
	\end{listalph}
\end{proposition}
\begin{proof}
	By \autoref{lem:epiiszerocoker}, these are equivalent to the following.
	\begin{enumerate}[label=(\alph*')]
		\item $\coker\varphi$ vanishes.
		\item $(\coker\varphi)(U)$ vanishes for all open $U\subseteq X$.
		\item $\coker\varphi_p$ vanishes for all $p\in X$. By \autoref{lem:cokerstalk}, this is equivalent to $(\coker\varphi)_p$ vanishing for all $p\in X$.
	\end{enumerate}
	These are equivalent by \autoref{lem:checkzerolocally}.
\end{proof}

\subsection{The Category of Sheaves Is Abelian}
Now that our category of sheaves (valued in an abelian category) has kernels and cokernels for our morphisms, we have two more conditions to check.
\begin{lemma} \label{lem:kercoker}
	Fix a monic morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. Then actually $\varphi\colon\mc F\to\mc G$ makes $\mc F$ the kernel of the cokernel $\pi\colon\mc G\to\coker\varphi$.
\end{lemma}
\begin{proof}
	We need to show that $\mc F$ is the limit of the following diagram.
	% https://q.uiver.app/?q=WzAsMyxbMSwwLCJcXG1jIEciXSxbMCwxLCJcXG1jIFoiXSxbMSwxLCJcXGNva2VyXFx2YXJwaGkiXSxbMCwyLCJcXHBpIl0sWzEsMl1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		& {\mc G} \\
		{\mc Z} & \coker\varphi
		\arrow["\pi", from=1-2, to=2-2]
		\arrow[from=2-1, to=2-2]
	\end{tikzcd}\]
	To begin, note that $\varphi\colon\mc F\to\mc G$ makes the diagram
	% https://q.uiver.app/?q=WzAsNCxbMSwwLCJcXG1jIEciXSxbMCwxLCJcXG1jIFoiXSxbMSwxLCJcXGNva2VyXFx2YXJwaGkiXSxbMCwwLCJcXG1jIEYiXSxbMCwyLCJcXHBpIl0sWzEsMl0sWzMsMCwiXFx2YXJwaGkiXSxbMywxXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F} & {\mc G} \\
		{\mc Z} & \coker\varphi
		\arrow["\pi", from=1-2, to=2-2]
		\arrow[from=2-1, to=2-2]
		\arrow["\varphi", from=1-1, to=1-2]
		\arrow[from=1-1, to=2-1]
	\end{tikzcd}\]
	commute by the construction of $\pi\colon\mc G\to\coker\varphi$. We now show that $\mc F$ satisfies the universal property. Fix a sheaf morphism $\psi\colon\mc H\to\mc G$ such that $\pi\circ\psi=0$. Then we need a unique map $\overline\psi\colon\mc H\to\mc F$ making the diagram
	% https://q.uiver.app/?q=WzAsNSxbMiwxLCJcXG1jIEciXSxbMSwyLCJcXG1jIFoiXSxbMiwyLCJcXGNva2VyXFx2YXJwaGkiXSxbMSwxLCJcXG1jIEYiXSxbMCwwLCJcXG1jIEgiXSxbMCwyLCJcXHBpIl0sWzEsMl0sWzMsMCwiXFx2YXJwaGkiXSxbMywxXSxbNCwzLCJcXG92ZXJsaW5lXFxwc2kiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCwwLCJcXHBzaSIsMCx7ImN1cnZlIjotMn1dLFs0LDEsIiIsMCx7ImN1cnZlIjoyfV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc H} \\
		& {\mc F} & {\mc G} \\
		& {\mc Z} & \coker\varphi
		\arrow["\pi", from=2-3, to=3-3]
		\arrow[from=3-2, to=3-3]
		\arrow["\varphi", from=2-2, to=2-3]
		\arrow[from=2-2, to=3-2]
		\arrow["\overline\psi"{description}, dashed, from=1-1, to=2-2]
		\arrow["\psi", curve={height=-12pt}, from=1-1, to=2-3]
		\arrow[curve={height=12pt}, from=1-1, to=3-2]
	\end{tikzcd}\]
	commute; i.e., we need $\psi=\varphi\circ\overline\psi$. We show uniqueness and existence separately.
	\begin{itemize}
		\item Uniqueness: this follows because $\varphi$ is monic. Indeed, if $\overline\psi_1,\overline\psi_2$ have $\varphi\circ\overline\psi_1=\psi=\varphi\circ\overline\psi_2$, then $\overline\psi_1=\overline\psi_2$ because $\varphi$ is monic.
		\item Existence: this is trickier. Let $\pi^{\op{pre}}\colon\mc G\to\coker^{\op{pre}}\varphi$ be the natural projection, and let ${\op{sh}}\colon\coker^{\op{pre}}\varphi\to\coker\varphi$ be the sheafification map.
		
		Now, given $U\subseteq X$ and $h\in\mc H(U)$, set $g\coloneqq\psi_U(h)$ for brevity. Notably, we have $\pi_U\circ\psi_U=0$, so $\pi_U(g)=0$. It follows $\pi_p(g|_p)=\pi_U(g)|_p=0$ for each $p\in U$, so $g|_p\in\ker\pi_p$ for each $p\in U$. Now, for each $p\in U$, by \autoref{lem:cokerstalk}, $\ker\pi_p=\im\varphi_p$, and by \autoref{prop:injonstalks}, $\varphi_p$ is monic, so is a unique $f_p\in\mc F_p$ such that
		\[\varphi_p(f_p)=g|_p.\]
		We claim that $(f_p)_{p\in U}$ is a system of compatible germs. To begin, choose some representative $f_p=[(U'_p,\widetilde f'_p)]$ and note that we have
		\[[(U,g)]=g|_p=\varphi_p(f_p)=[(U'_p,\varphi_{U'_p}(\widetilde f'_p))],\]
		so we can find $U_p\subseteq U'_p$ containing $p$ with $\widetilde f_p=\widetilde f'_p|_{U_p}$ small enough so that $g|_{U_p}=\varphi_{U_p}(\widetilde f_p)$. As such, any $q\in U_p$ has
		\[\varphi_q(\widetilde f_p|_q)=[(U_p,\varphi_{U_p}(\widetilde f_p))]=[(U_p,g|_{U_p})]=g|_p,\]
		so $\widetilde f_p|_q=f_q$ follows.

		Thus, \autoref{prop:stalkinjection} promises a unique $f\in\mc F(U)$ such that $f|_p=f_p$ for each $p\in U$. So we define $\overline\psi_U(h)\coloneqq f$ to be the unique element such that
		\[\varphi_p(\overline\psi_U(h)|_p)=\psi_U(h)|_p\]
		for all $p\in U$.
		
		It remains to show that $\overline\psi$ assembles into a presheaf morphism. Well, for open sets $V\subseteq U$ and $h\in\mc H(U)$, we see that any $p\in V$ will have
		\[\varphi_p(\overline\psi_U(h)|_V|_p)=\varphi_p(\overline\psi_U(h)|_p)=\psi_U(h)|_p=\psi_V(h|_V)|_p,\]
		so the uniqueness of $\psi_V(h|_V)$ forces $\overline\psi_U(h)|_V=\psi_V(h|_V)$.
		\qedhere
	\end{itemize}
\end{proof}
\begin{lemma} \label{lem:cokerker}
	Fix an epic morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. Then actually $\varphi\colon\mc F\to\mc G$ makes $\mc G$ the cokernel of the kernel $\iota\colon\ker\varphi\to\mc F$.
\end{lemma}
\begin{proof}
	We need to show that $\mc G$ is the colimit of the following diagram.
	% https://q.uiver.app/?q=WzAsMyxbMCwxLCJcXG1jIEYiXSxbMCwwLCJcXGtlclxcdmFycGhpIl0sWzEsMCwiXFxtYyBaIl0sWzEsMCwiXFxpb3RhIiwyXSxbMSwyXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		\ker\varphi & {\mc Z} \\
		{\mc F}
		\arrow["\iota"', from=1-1, to=2-1]
		\arrow[from=1-1, to=1-2]
	\end{tikzcd}\]
	To begin, note that $\varphi\colon\mc F\to\mc G$ makes the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwxLCJcXG1jIEYiXSxbMCwwLCJcXGtlclxcdmFycGhpIl0sWzEsMCwiXFxtYyBaIl0sWzEsMSwiXFxtYyBHIl0sWzEsMCwiXFxpb3RhIiwyXSxbMSwyXSxbMCwzLCJcXHZhcnBoaSJdLFsyLDNdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		\ker\varphi & {\mc Z} \\
		{\mc F} & {\mc G}
		\arrow["\iota"', from=1-1, to=2-1]
		\arrow[from=1-1, to=1-2]
		\arrow["\varphi", from=2-1, to=2-2]
		\arrow[from=1-2, to=2-2]
	\end{tikzcd}\]
	commute by the construction of $\iota\colon\ker\varphi\to\mc G$. We are now ready to show that $\mc G$ satisfies the universal property. Fix a sheaf $\mc H$ with a morphism $\psi\colon\mc F\to\mc H$ such that $\psi\circ\iota=0$. We need a unique map $\overline\psi\colon\mc G\to\mc H$ such that $\psi=\overline\psi\circ\varphi$, or equivalently, making the diagram
	% https://q.uiver.app/?q=WzAsNSxbMCwxLCJcXG1jIEYiXSxbMCwwLCJcXGtlclxcdmFycGhpIl0sWzEsMCwiXFxtYyBaIl0sWzEsMSwiXFxtYyBHIl0sWzIsMiwiXFxtYyBIIl0sWzEsMCwiXFxpb3RhIiwyXSxbMSwyXSxbMCwzLCJcXHZhcnBoaSJdLFsyLDNdLFsyLDQsIiIsMix7ImN1cnZlIjotMn1dLFswLDQsIlxccHNpIiwyLHsiY3VydmUiOjJ9XSxbMyw0LCJcXG92ZXJsaW5lXFxwc2kiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		\ker\varphi & {\mc Z} \\
		{\mc F} & {\mc G} \\
		&& {\mc H}
		\arrow["\iota"', from=1-1, to=2-1]
		\arrow[from=1-1, to=1-2]
		\arrow["\varphi", from=2-1, to=2-2]
		\arrow[from=1-2, to=2-2]
		\arrow[curve={height=-12pt}, from=1-2, to=3-3]
		\arrow["\psi"', curve={height=12pt}, from=2-1, to=3-3]
		\arrow["\overline\psi"{description}, dashed, from=2-2, to=3-3]
	\end{tikzcd}\]
	commute. We show uniqueness and existence separately.
	\begin{itemize}
		\item Uniqueness: this follows because $\varphi$ is epic. Indeed, if $\overline\psi_1,\overline\psi_2\colon\mc G\to\mc H$ have $\overline\psi_1\circ\varphi=\psi=\overline\psi_2\circ\varphi$, then $\overline\psi_1=\overline\psi_2$ because $\varphi$ is epic.
		\item Existence: given $U\subseteq X$ and $g\in\mc G(U)$, we define $\overline\psi_U(g)$ by hand. By \autoref{lem:surjonstalks}, we see that $\varphi$ being epic means that $\varphi_p$ is surjective for each $p\in U$, we can find $f_p\in\mc F_p$ with $\varphi_p(f_p)=g|_p$ for each $p$. We now set
		\[h_p\coloneqq\psi_p(f_p).\]
		We claim that $h_p$ is independent of the choice for $f_p$. Indeed, if we have $[(U,f)]$ and $[(U',f')]$ in $\mc F_p$ with $[(U,\varphi_Uf)]=[(U',\varphi_{U'}f')]=g|_p$, then there is an open $V\subseteq U\cap U'$ such that $\varphi_V(f|_V-f'|_V)=0$. Thus, $f-f'\in\ker\varphi_V=(\ker\varphi)(V)$, so it follows $\psi_V((f-f')|_V)=0$. Thus, so
		\[\psi_p([(U,f)])-\psi_p([(U',f')])=\psi_p([(V,\psi_V((f-f')|_V))])=\psi_p([(V,0)])=0.\]
		Next, we claim that the $(h_p)_{p\in U}$ forms a compatible system of germs. Well, for each $p\in U$, we can find a sufficiently small open set $U_p$ with a lift $\widetilde f_p\in\mc F(U_p)$ such that $\varphi_{U_p}(\widetilde f_p)=g|_{U_p}$. Set $\widetilde h_p\coloneqq\psi_{U_p}(\widetilde f_p)$ so that for each $q\in U_p$ has $\varphi_q(\widetilde f_p|_q)=\varphi_{U_p}(\widetilde f_p)|_q=g|_q$ and thus
		\[h_q=\psi_q(\widetilde f_p|_q)=\psi_{U_p}(\widetilde f_p)|_q.\]
		It follows \autoref{prop:stalkinjection} that we have a unique $h\in\mc H(U)$ such that $h|_p=h_p$ for each $p\in U$, so we define $\overline\psi_U(g)\coloneqq h$. Explicitly, $\overline\psi_U(g)$ is the unique element of $\mc H(U)$ such that
		\[\overline\psi_U(g)|_p=\psi_p\left(\varphi_p^{-1}(g|_p)\right)\]
		for each $p\in U$.

		We now run checks on $\overline\psi$. To see that we have a morphism $\mc G\to\mc H$, note that any opens $V\subseteq U$ and $g\in\mc G(U)$ will have, for each $p\in U$,
		\[\overline\psi_U(g)|_V|_p=\overline\psi_U(g)|_p=\psi_p\left(\varphi_p^{-1}(g|_p)\right)=\psi_p\left(\varphi_p^{-1}(g|_V|_p)\right),\]
		so the uniqueness of $\overline\psi_V(g|_V)$ forces $\overline\psi_U(g)|_V=\overline\psi_V(g|_V)$.

		Lastly, we note that $\psi=\overline\psi\circ\varphi$: for any open $U\subseteq X$ and $f\in\mc F(U)$, all points $p\in U$ give
		\[\overline\psi_U(\varphi_U(f))|_p=\psi_p\left(\varphi_p^{-1}(\varphi_U(f)|_p)\right)=\psi_p\left(\varphi_p^{-1}(\varphi_p(f|_p))\right)=\psi_p(f|_p)=\psi_U(f)|_p,\]
		so the injectivity of \autoref{prop:stalkinjection} forces our equality.
		\qedhere
	\end{itemize}
\end{proof}
And here is our result.
\begin{theorem}
	The category $\mathrm{Sh}_X$ of sheaves on a topological space $X$ valued in a (concrete) abelian category $\mc C$ is additive.
\end{theorem}
\begin{proof}
	The category is additive by \autoref{cor:sheavesadditive}. Kernels exist by \autoref{lem:sheafker}, and cokernels exist by \autoref{lem:sheafcoker}. The last conditions to check are \autoref{lem:kercoker} and \autoref{lem:cokerker}.
\end{proof}

\subsection{Passing to Stalks}
We are now ready to fix our surjectivity. We start by fixing the image.
\begin{defi}[Sheaf image]
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. Then the \textit{sheaf image $\im\varphi$} of $\varphi$ is the sheafification of the presheaf image
	\[(\im^{\op{pre}}\varphi)(U)=\im\varphi_U.\]
\end{defi}
And now we get the following analogue to \autoref{prop:injonstalks}.
\begin{proposition}
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. The following are equivalent.
	\begin{listalph}
		\item $\varphi_p$ is surjective for each $p$.
		\item $\im\varphi=\mc G$.
		\item $\varphi\colon\mc F\to\mc G$ is an epimorphism in the category of sheaves.
	\end{listalph}
\end{proposition}
\begin{proof}
	Omitted. The main point is to hit everything with the universal property and the fact that stalks don't change under sheafification.
\end{proof}
\begin{remark}
	One can use the above proposition to show that the last map of \autoref{eq:protoses} is an epimorphism.
\end{remark}
And now we fix the cokernel.
\begin{definition}[Sheaf cokernel]
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$. Then the \textit{sheaf cokernel $\coker\varphi$} of $\varphi$ is the sheafification of the presheaf cokernel
	\[(\coker^{\op{pre}}\varphi)(U)=\coker\varphi_U.\]
\end{definition}
And so we get some nice results by passing to stalks.
\begin{proposition}
	The category of sheaves on $X$ valued in an abelian category $\mc C$ is abelian. Notably, we have to use the sheaf kernel and sheaf cokernel.
\end{proposition}
\begin{proof}
	Pass all the checks to the stalks, where we get what we want for free because $\mc C$ is abelian.
\end{proof}
\begin{proposition}
	Fix a morphism $\varphi\colon\mc F\to\mc G$ of sheaves on $X$ has
	\[\im\varphi\simeq\ker\coker\varphi.\]
\end{proposition}
\begin{proof}
	Pass to stalks.
\end{proof}
\begin{proposition}
	A sequence
	\[0\to\mc F\to\mc G\to\mc H\to0\]
	of sheaves on $X$ is exact if and only if it is exact at all stalks.
\end{proposition}
\begin{proof}
	Unsurprisingly, pass to stalks.
\end{proof}

\subsection{Sheaf Functors}
We now discuss how to build some new sheaves from old.
\begin{definition}[Direct image sheaf]
	Fix a continuous map $f\colon X\to Y$ of topological spaces. Given a sheaf $\mc F$ on $X$, we define the \textit{direct image sheaf} on $Y$ to be
	\[f_*\mc F(V)\coloneqq\mc F\left(f^{-1}(V)\right).\]
\end{definition}
\begin{remark} \label{rem:directimagefunctor}
	One can check that, given continuous maps $f\colon X\to Y$ and $g\colon Y\to Z$, we have
	\[(f\circ g)_*=f_*\circ g_*\]
	as maps from sheaves to sheaves. As a hint, one should check this on stalks.
\end{remark}
\begin{definition}[Inverse image sheaf]
	Fix a continuous map $f\colon X\to Y$ of topological spaces. Given a sheaf $\mc G$ on $Y$, we define the \textit{inverse image sheaf} $f^{-1}\mc G$ on $X$ to be the sheafification of the presheaf
	\[U\mapsto\colimit_{V\supseteq f(U)}\mc G(V).\]
\end{definition}
\begin{remark}
	One can check, as in \autoref{rem:directimagefunctor}, that $(f\circ g)^{-1}=g^{-1}\circ f^{-1}$ as maps from sheaves to sheaves.
\end{remark}
Here is another way to verify our last remark.
\begin{proposition}
	There is a natural bijection
	\[\op{Mor}_X\left(f^{-1}\mc G,\mc F\right)\simeq\op{Mor}_Y\left(\mc G,f_*\mc F\right).\]
	In other words, we have a pair of adjoint functors.
\end{proposition}
\begin{proof}
	Omitted.
\end{proof}
\begin{remark}
	The functor $f^{-1}$ also has a right adjoint, which will appear on the homework. Thus, $f^{-1}$ as a functor is exact.
\end{remark}

\subsection{More Sheaves}
Let's see a few more examples, for fun.
\begin{definition}[Constant sheaf]
	Fix a set $S$ and a topological space $X$. Then the \textit{constant sheaf} is
	\[\underline S(U)\coloneqq S^{\oplus\pi_0(U)},\]
	where $\pi_0(U)$ is the number of connected components in $U$. Notably, all the stalks of $\underline S$ are $S$.
\end{definition}
\begin{definition}[Skyscraper sheaf]
	Fix a topological space $Y$ and a set $S$. For $y\in Y$, set $X\coloneqq\{y\}$ so that there is a continuous map $\iota\colon X\into Y$. Then we define the \textit{skyscraper sheaf} as
	\[\iota_*S(U)\coloneqq\begin{cases}
		S & y\in U, \\
		\{*\} & y\notin U.
	\end{cases}\]
\end{definition}
\begin{remark}
	For $z\in Y$, we can compute the stalk of the skyscraper sheaf as
	\[(\iota_*S)_z=\begin{cases}
		S & z\in\overline{\{y\}}, \\
		\{*\} & z\notin\overline{\{y\}}.
	\end{cases}\]
\end{remark}
For another remark, we pick up the following definition.
\begin{definition}[Support]
	Fix a sheaf $\mc F$ on a topological space $x$. Then we define the \textit{support} of $\mc F$ to be
	\[\op{supp}\mc F\coloneqq\{x\in X:\#\mc F_x>1\}.\]
\end{definition}
\begin{remark}
	The support of $\iota_*S$ is $\overline{\{y\}}$.
\end{remark}
Here is another result, which explains why we care about the skyscraper sheaf.
\begin{proposition}
	There is a natural bijection
	\[\op{Mor}_{\{y\}}(\mc F_y,\mc G)\simeq\op{Mor}_Y(\mc F,\iota_*\mc G).\]
	In other words, understanding maps from stalks is roughly the same as understanding maps to the corresponding skyscraper sheaf.
\end{proposition}

\subsection{Schemes}
We close lecture by defining schemes. We begin by defining a locally ringed space.
\begin{definition}[Locally ringed space]
	A \textit{locally ringed space} is a sheaf of rings $\mc O_X$ on a topological space $X$ such that all stalks are local rings.
\end{definition}
\begin{example}
	Affine schemes give locally ringed spaces.
\end{example}
\begin{definition}[Morphism of locally ringed spaces]
	A \textit{morphism $\varphi\colon(X,\mc O_X)\to(Y,\mc O_Y)$ of locally ringed spaces} consists of an ordered pair $(f,f^\sharp)$ in such a way that $f\colon X\to Y$ is continuous, and $f^\sharp\colon\mc O_Y\to f_*\mc O_X$ is a morphism of sheaves in such a way that the induced map
	\[f^\sharp_p\colon\mc O_{Y,p}\to(f_*\mc O_X)_p\]
	of stalks is a map of local rings.
\end{definition}
Notably, a morphism of local rings $\varphi\colon(R,\mf m)\to(S,\mf n)$ requires $\varphi^{-1}\mf n=\mf m$.
\begin{definition}[Scheme]
	A \textit{scheme} is a pair $(X,\mc O_X)$ of a topological space $X$ and a locally ringed space $\mc O_X$ such that each $p\in X$ has a $U_p\subseteq X$ such that $(U_p,\mc O_X|_{U_p})$ is isomorphic (as a locally ringed space) to an affine scheme.
\end{definition}

\end{document}