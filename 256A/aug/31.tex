% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

We finish defining the structure sheaf $\mc O_{\Spec A}$ of an affine scheme today.
% \begin{remark}
% 	Let $X$ be a topological space. One can write the conditions for $F$ being a sheaf on a base $\mc B$ as the exactness of
% 	\[0\to F(B_0)\to\prod_{B\in\mc U}F(B)\to\prod_{B,B'\in\mc U}F(B\cap B'),\]
% 	where $\mc U$ is a basic cover for $B_0$. Notably, the map into $F(B\cap B')$ is well-defined by using the gluability axiom.
% \end{remark}
\begin{remark}
	One complaint about sheaves on a base is that we have to choose a base. To be more canonical, we will discuss stalks today, which treats all points the same.
\end{remark}

\subsection{The Structure Sheaf}
We are now ready to define the structure sheaf $\mc O_{\Spec A}$ of a ring $A$, which we will define a sheaf on a base. Recall from \autoref{rem:distinguishedbase} that $\{D(f)\}_{f\in A}$ forms a base of the Zariski topology of $\Spec A$, so it will suffice to set
\[\mc O_{\Spec A}(D(f))\coloneqq A_{S(D(f))},\]
where
\[S(D(f))\coloneqq\{g\in A:V(\{g\})\subseteq(\Spec A)\setminus D(f)\}.\]
In other words, $S(D(f))$ consists of the set of functions in $A$ which only vanish outside $D(f)$ so that we can invert them on $D(f)$.
\begin{remark}
	In essence, $\mc O_{\Spec A}(D(f))$ is supposed to be the functions on $D(f)$, which is why we want to be able to invert functions which only vanish on $(\Spec A)\setminus D(f)$.
\end{remark}
\begin{remark}
	The subset $S(D(f))$ only depends on $D(f)$, not $f$, so $\mc O_{\Spec A}(D(f))$ is well-defined. With that said, we note that $f\in S(D(f))$ gives a natural localization map $A_f\to A_{S(D(f))}$ induced by $\id_A$. Similarly, any $g\in S(D(f))$ has $V((g))\subseteq V((f))$ and so \autoref{prop:easynullstellensatz} tells us that
	\[\rad(f)=I(V((f)))\subseteq I(V((g)))=\rad(g),\]
	so $f\in\rad(g)$, so $f^n=ag$ for some positive integer $n$ and $a\in A$; this means $g\in A_f^\times$, so actually $S(D(f))\subseteq A_f^\times$, allowing another natural localization map $A_{S(D(f))}\to A_f$ induced by $\id_A$. These natural localization maps are inverse (their compositions are induced by $\id_A$), so $\mc O_{\Spec A}(D(f))\cong A_f$.
\end{remark}
\begin{remark}[Nir]
	In class, Professor Tang defined the structure sheaf on a base by $\mc O_{\Spec A}(D(f))\coloneqq A_f$. I have chosen to follow \cite{rising-sea} here because I don't like $\mc O_{\Spec A}(D(f))$ to depend on $f\in A$ when it should only depend on $D(f)$.
\end{remark}
To define our (pre)sheaf on a base, we also need to provide restriction maps. Well, for $f,f'\in A$ with $D(f')\subseteq D(f)$, we see that
\[S(D(f))=\{g\in A:V(\{g\})\subseteq(\Spec A)\setminus D(f)\}\subseteq\{g\in A:V(\{g\})\subseteq(\Spec A)\setminus D(f')\}=S(D(f')),\]
so there is a natural localization map
\[\op{res}_{D(f),D(f')}\colon A_{S(D(f))}\to A_{S(D(f'))}\]
induced by $\id_A$. These data give all the data we need to define a sheaf on a base. We will throw the remaining checks into the following lemma.
\begin{lemma}
	Fix a ring $A$. The above data define a sheaf $\mc O_{\Spec A}$ on the base $\{D(f)\}_{f\in A}$.
\end{lemma}
\begin{proof}
	We begin by showing that the data gives a presheaf.
	\begin{itemize}
		\item Identity: if $D(f)=D(f')$, then $S(D(f))=S(D(f'))$, so the localization map
		\[\op{res}_{D(f),D(f)}\colon A_{S(D(f))}\to S_{D(f)}\]
		is simply $\id_{A_{S(D(f))}}$.
		\item Functoriality: suppose $D(f'')\subseteq D(f')\subseteq D(f)$. Then we note that the diagram
		% https://q.uiver.app/?q=WzAsNixbMCwwLCJBX3tTKEQoZikpfSJdLFsxLDAsIkFfe1MoRChmJykpfSJdLFsxLDEsIkFfe1MoRChmJycpKX0iXSxbMiwwLCJhL2ciXSxbMywwLCJhL2ciXSxbMywxLCJhL2ciXSxbMCwxLCJcXG9we3Jlc30iXSxbMSwyLCJcXG9we3Jlc30iXSxbMCwyLCJcXG9we3Jlc30iLDJdLFszLDQsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XSxbNCw1LCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtYXBzIHRvIn19fV0sWzMsNSwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibWFwcyB0byJ9fX1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{A_{S(D(f))}} & {A_{S(D(f'))}} & {a/g} & {a/g} \\
			& {A_{S(D(f''))}} && {a/g}
			\arrow["{\op{res}}", from=1-1, to=1-2]
			\arrow["{\op{res}}", from=1-2, to=2-2]
			\arrow["{\op{res}}"', from=1-1, to=2-2]
			\arrow[maps to, from=1-3, to=1-4]
			\arrow[maps to, from=1-4, to=2-4]
			\arrow[maps to, from=1-3, to=2-4]
		\end{tikzcd}\]
		commutes because everything is induced by $\id_A$, so we are done.
	\end{itemize}
	It remains to check the identity and gluability axioms. For this, we will need a basis set $D(f)$ and a basic cover $\{D(f_\alpha)\}_{\alpha\in\lambda}$. To access this cover, we have the following lemma.
	\begin{lemma} \label{lem:finitesubcover}
		Fix a ring $A$. Then, given $f\in A$ and $\{f_\alpha\}_{\alpha\in\lambda}\subseteq A$, the following are equivalent.
		\begin{listalph}
			\item $D(f)\subseteq\bigcup_{\alpha\in\lambda}D(f_\alpha)$.
			\item $f\in\rad(f_\alpha)_{\alpha\in\lambda}$.
		\end{listalph}
	\end{lemma}
	\begin{proof}
		Note that
		\[\bigcup_{\alpha\in\lambda}D(f_\alpha)=\Spec A\setminus\bigcap_{\alpha\in\lambda}V((f_\alpha))=\Spec A\setminus V((f_\alpha)_{\alpha\in\lambda}),\]
		so (a) is equivalent to $V((f_\alpha)_{\alpha\in\lambda})\subseteq V((f))$. Now, \autoref{prop:easynullstellensatz} tells us that (a) implies
		\[\rad(f)=I(V((f)))\subseteq I(V((f_\alpha)_{\alpha\in\lambda}))=\rad(f_\alpha)_{\alpha\in\lambda},\]
		from which (b) follows. Conversely, if (b) holds, then $\rad(f)\subseteq\rad(f_\alpha)_{\alpha\in\lambda}$ by taking radicals, so \autoref{prop:easynullstellensatz} again promises
		\[V((f_\alpha)_{\alpha\in\lambda})=V(\rad(f_\alpha)_{\alpha\in\lambda})\subseteq V(\rad(f))=V((f)),\]
		which we showed is equivalent to (a).
	\end{proof}
	\begin{corollary} \label{cor:easycompactness}
		Fix a ring $A$. Then any cover $\{D(f_\alpha)\}_{\alpha\in\lambda}$ of $D(f)$ has a finite subcover.
	\end{corollary}
	\begin{proof}
		Note \autoref{lem:finitesubcover} tells us that $f\in\rad(f_\alpha)_{\alpha\in\lambda}$, so there is a positive integer $n$ and finite subset $\lambda\subseteq\lambda'$ so that
		\[f^n=\sum_{\alpha\in\lambda'}a_\alpha f_\alpha,\]
		but then $f\in\rad(f_\alpha)_{\alpha\in\lambda'}$, so $D(f)$ is covered by the (finite) cover $\{D(f_\alpha)\}_{\alpha\in\lambda'}$. 
	\end{proof}
	We now show the identity and gluability axioms separately.
	\begin{itemize}
		\item Identity: note \autoref{cor:easycompactness} promises us some $\lambda'\subseteq\lambda$ such that the $\{D(f_\alpha)\}_{\alpha\in\lambda'}$ still covers $D(f)$. We will now forget about $\lambda$ entirely and deal with the finite $\lambda'$ instead.

		For identity, we suppose that we have $s\in\OO_{\Spec A}(D(f))$ such that $s|_{D(f_\alpha)}=0$ for all $\alpha\in\lambda'$, and we want to show that $s=0$. Under the (canonical) isomorphism $\OO_{\Spec A}(D(f_\alpha))\simeq A_{f_\alpha}$, we see that we must have
		\[f_\alpha^{d_\alpha}s=0\]
		for some $d_\alpha$, for each $\alpha$. Now, $D(f_\alpha)=D\left(f_\alpha^{d_\alpha}\right)$, so the $D\left(f_\alpha^{d_\alpha}\right)$ still cover $D(f)$; it follows from \autoref{lem:finitesubcover} that there is some $d$ for which
		\[f^d=\sum_{\alpha\in\lambda'}c_\alpha f_\alpha^{d_\alpha}.\]
		Multiplying both sides by $s$ (after embedding in $A_{S(D(f))}$) tells us that $f^ds=0$ in $A_{S(D(f))}$, so $s=0$ because $f\in A_{S(D(f))}^\times$.

		\item Finite gluability: fix sections $s_\alpha\in\OO_{\Spec A}(D(f_\alpha))$ such that
		\[s_\alpha|_{D(f_\alpha)\cap D(f_\beta)}=s_\beta|_{D(f_\alpha)\cap D(f_\beta)}.\]
		For concreteness, use $\OO_{\Spec A}(D(f))\simeq A_f$ to write $s_\alpha\coloneqq a_\alpha/f_\alpha^n$, where $n$ is the maximum of all the possibly needed denominators.
		
		Noting that $D(f_\alpha)\cap D(f_\beta)=D(f_\alpha f_\beta)$, our coherence is equivalent to asking for
		\[(f_\alpha f_\beta)^m\left(f_\beta^na_\alpha-f_\alpha^na_\beta\right)=0,\]
		where again $m$ is chosen to be large enough among the finitely many possibilities for $\alpha$ and $\beta$. We now notice that
		\[s_\alpha=\frac{a_\alpha}{f_\alpha^n}=\frac{f_\alpha^ma_\alpha}{f_\alpha^{n+m}},\]
		so we set $b_\alpha\coloneqq f_\alpha^ma_\alpha$ and $g_\alpha\coloneqq f_\alpha^{n+m}$, which means
		\[g_\beta b_\alpha=g_\alpha b_\beta\]
		for all $\alpha,\beta$. Notably, $\rad(f_\alpha)=\rad(g_\alpha)$, so $D(f_\alpha)=D(g_\alpha)$, so the $\{D(g_\alpha)\}_{\alpha\in\lambda}$ still cover $D(f)$, so \autoref{lem:finitesubcover} tells us that we can write
		\[f^n=\sum_{\alpha\in\lambda}c_\alpha g_\alpha\]
		for some positive integer $n$. In particular, we set $s\in\OO_{\Spec A}(D(f))\simeq A_f$ by
		\[s\coloneqq\frac1{f^n}\sum_{\alpha\in\lambda}c_\alpha b_\alpha.\]
		In particular, for any $\beta\in\lambda$, we see
		\[g_\beta s=\frac1{f^n}\sum_{\alpha\in\lambda}c_\alpha g_\beta b_\alpha=\frac1{f^n}\sum_{\alpha\in\lambda}c_\alpha g_\alpha b_\beta=b_\beta\]
		in $A_f$, so our restriction is $s|_{D(g_\beta)}=b_\beta/g_\beta=s_\beta$, which is what we wanted.

		\item Gluability: we show general gluability from finite gluability. Fix sections $s_\alpha\in\mc O_{\Spec A}(D(f_\alpha))$ such that
		\begin{equation}
			s_\alpha|_{D(f_\alpha)\cap D(f_\beta)}=s_\beta|_{D(f_\alpha)\cap D(f_\beta)} \label{eq:sectioncoherence}
		\end{equation}
		for each $\alpha,\beta\in\lambda$. Using \autoref{cor:easycompactness}, we can find a finite subcover using $\lambda'\subseteq\lambda$, and the sections $\{s_\alpha\}_{\alpha\in\lambda'}$ still satisfy \autoref{eq:sectioncoherence}, so finite gluability (and identity!) gives a unique $s\in\OO_{\Spec A}(D(f))$ with
		\[s|_{D(f_\alpha)}=s_\alpha.\]
		We claim that actually $s|_{D(f_\alpha)}=s_\alpha$ for all $\alpha\in\lambda$. Well, for any $\beta\in\lambda$, apply finite gluability to $\lambda'\cup\{\beta\}$ to find $s'\in\OO_{\Spec A}(D(f))$ such that $s'|_{D(f_\alpha)}=s_\alpha$ for all $\alpha\in\lambda'\cup\{\beta\}$.
		
		It follows from the identity axiom that on the open cover $\{D(f_\alpha)\}_{\alpha\in\lambda'}$ that $s=s'$, so we conclude
		\[s|_{D(f_\beta)}=s'|_{D(f_\beta)}=s_\beta\]
		for any $\beta\in\lambda$.
		\qedhere
	\end{itemize}
\end{proof}
Having finished the last of our checks, we see that our data make a sheaf on a base, so \autoref{prop:sheaffrombase} promises a unique sheaf extending this sheaf on a base. This is the (affine) structure sheaf, and it finishes our definition of an affine scheme.
\begin{definition}[Affine scheme]
	Fix a ring $A$. An \textit{affine scheme} is the topological space $\Spec A$ (given the Zariski topology) together with the sheaf of rings $\mc O_{\Spec A}$ such that
	\[\mc O_{\Spec A}(D(f))=A_{S(D(f))}\]
	for each $f\in A$; here $S(D(f))=\{g\in A:D(f)\subseteq D(g)\}$.
\end{definition}
Note that we are somewhat sloppily identifying the outputs of the structure sheaf with its outputs on the base.

\subsection{Stalks}
To define a morphism of schemes, we will want to discuss stalks.
\begin{remark}
	We might expect a morphism of (affine) schemes to be merely a continuous map together with a natural transformation of the structure sheaves (perhaps with some coherence conditions). However, this will not be enough data. Namely, we want all of our morphisms of affine schemes to be induced by ring homomorphisms, and this will require exploiting a little more data.
\end{remark}
The extra data in those morphisms will come from stalks.
\begin{definition}[Stalk]
	Fix a presheaf $\mc F$ on a topological space $X$. For a point $p\in X$, we define the \textit{stalk of $\mc F$ at $p\in X$} to be the direct limit
	\[\mc F_p\coloneqq\colimit_{U\ni p}\mc F(U).\]
	Concretely, elements of $\mc F_p$ are ordered pairs $(U,s)$ where $s\in\mc F(U)$ with $p\in U$, modded out by an equivalence relation $\sim$; here, $(U,s)\sim(U',s')$ if and only if there is $W\subseteq U\cap U'$ such that $s|_W=s'|_W$.
\end{definition}
\begin{remark}[Nir]
	In some sense, the stalk is intended to encode ``local information'' at the point $p\in X$ in a particularly violent way: whenever two functions $s_1\in\mc F(U_1)$ and $s_2\in\mc F(U_2)$ (where $p\in U_1\cap U_2$) are equal locally on some open set $U$ containing $p$, then we identify $s_1$ and $s_2$. As such, $\mc F_p$ can really study functions locally at $p$.
\end{remark}
\begin{remark}
	We go ahead and check that $\sim$ forms an equivalence relation. Fix $(U_i,s_i)$ with $s_i\in\mc F(U_i)$ for $i\in\{1,2,3\}$.
	\begin{itemize}
		\item Reflexive: note $U_1\subseteq U_1$ and $s_1|_{U_1}=s_1=s_1|_{U_1}$, so $(U_1,s_1)\sim(U_1,s_1)$.
		\item Symmetry: if $(U_1,s_1)\sim(U_2,s_2)$, we can find an open $V\subseteq U_1\cap U_2$ with $s_1|_V=s_2|_V$, which implies $s_2|_V=s_1|_V$, so $(U_2,s_2)\sim(U_1,s_1)$.
		\item Transitive: if $(U_1,s_1)\sim(U_2,s_2)$ and $(U_2,s_2)\sim(U_3,s_3)$, we can find open $V_1\subseteq U_1\cap U_2$ and $V_2\subseteq U_2\cap U_3$ such that $s_1|_{V_1}=s_2|_{V_1}$ and $s_2|_{V_2}=s_3|_{V_2}$. Then $V_1\cap V_2\subseteq U_1\cap U_3$, and we can see
		\[s_1|_{V_1\cap V_2}=s_1|_{V_1}|_{V_1\cap V_2}=s_2|_{V_1}|_{V_1\cap V_2}=s_2|_{V_1\cap V_2}=s_2|_{V_2}|_{V_1\cap V_2}=s_3|_{V_2}|_{V_1\cap V_2}=s_3|_{V_1\cap V_2}.\]
	\end{itemize}
\end{remark}
\begin{definition}[Germ]
	Fix a presheaf $\mc F$ on a topological space $X$. For a point $p\in X$ and section $s\in\mc F(U)$ with $p\in U$, the \textit{germ of $s$ at $p$} is the element
	\[[(U,s)]\in\mc F_p.\]
\end{definition}
\begin{notation}
	I will write the germ of $f\in\mc F(U)$ at $p\in U$ as $f|_p$. This notation is not standard, but I like it because I think of taking the germ of a section at $p$ as analogous to ``restricting'' to the point $p$.
\end{notation}
As a warning, later on, we will want to consider tuples of sections $(f_p)_p$, and we will want to distinguish the notation for an element of this tuple as $f_p$ with the notation for the corresponding germ $f|_p$.
\begin{remark}
	As justification for my notation, if $f\in\mc F(U)$ while $p\in V\subseteq U$, then
	\[f|_p=f|_V|_p\]
	because $[(U,f)]=[(V,f|_V)]$ can be witnessed by $f|_V=f|_V|_V$.
\end{remark}
Here are some examples of stalks.
\begin{lemma} \label{lem:stalkbybase}
	Fix a presheaf $\mc F$ on a topological space $X$, and give the topology on $X$ a base $\mc B$. For a point $p\in X$, we have the isomorphism
	\[\arraycolsep=1.4pt\begin{array}{cccc}
		\varphi\colon& \displaystyle\colimit_{B\ni p}\mc F(B) &\simeq& \mc F_p \\
		& [(B,s)] &\mapsto& [(B,s)]
	\end{array}\]
	where the colimit is taken over $B\in\mc B$ such that $p\in B$.
\end{lemma}
\begin{proof}
	The main point to show that $\varphi$ is well-defined is that the system of maps $\mc F(B)\to\mc F_p$ for each $B\in\mc B$ containing $p$ induce the map $\varphi$ by the universal property. Concretely, if $(B_1,s_1)\sim(B_2,s_2)$, then we can find $B\subseteq B_1\cap B_2$ such that $s_1|_B=s_2|_B$, which means that $[(B_1,s_1)]=[(B_2,s_2)]$ in $\colimit_{B\ni p}\mc F(B)$ implies the equality in $\mc F_p$. Now, any structure that $\varphi$ needs to preserve (e.g., being a homomorphism of some kind) will be immediately preserved.

	We now exhibit the map in the reverse direction. Note that any $U\subseteq X$ containing $p$ can find some basis element $B\in\mc B$ such that $p\in B\subseteq U$. As such, we define $\psi\colon\mc F_p\to\colimit_{B\ni p}\mc F(B)$ by
	\[\psi\colon[(U,s)]\mapsto[(B,s|_B)].\]
	To show that this map is well-defined, first note that $\psi$ does not depend on $B$: if we have basis sets $B_1$ and $B_2$ inside $U$ containing $p$, we can find basis sets $B\subseteq B_1\cap B_2$ giving $s|_{B_1}|_B=s|_B=s|_{B_2}|_B$, so
	\[[(B_1,s|_{B_1})]=[(B_2,s|_{B_2})].\]
	Second, note that $\psi$ does not depend on the representative of $[(U,s)]$. Indeed, if $(U_1,s_1)\sim(U_2,s_2)$, then we are promised $U\subseteq U_1\cap U_2$ such that $s_1|_U=s_2|_U$. Now, find $B$ contained in $U$ containing $p$, so we see $s_1|_B=s_2|_B$, so
	\[[(B,s_1|_B)]=[(B,s_2|_B)].\]
	So we have a well-defined map $\psi$.

	We now show that $\psi$ and $\varphi$ are inverse. In one direction, given some $[(B,s)]$, we note we can write
	\[\psi(\varphi([(B,s)]))=\psi([(B,s)])=[(B,s)],\]
	where the last equality is legal because $B$ is a basis set containing $p$ which is contained in $B$. In the other direction, given some $[(U,s)]$, find a basis set $B\subseteq U$ containing $p$ so that
	\[\varphi(\psi([(U,s)]))=\varphi([(B,s|_B)])=[(B,s|_B)],\]
	and we note that $[(B,s|_B)]=[(U,s)]$ because $B\subseteq U$ has $s|_B|_B=s|_B$.
\end{proof}
\begin{lemma}
	Fix a ring $A$. Then, for any prime $\mf p$, $A_\mf p\simeq\mc O_{\Spec A,\mf p}$ induced by $a\mapsto a|_\mf p$.
\end{lemma}
\begin{proof}
	The point here is that $\OO_{\Spec A,\mf p}$ permits denominators from anyone in $A\setminus\mf p$. In one direction, note that $A=\OO_{\Spec A}(\Spec A)$, so there is a canonical map
	\[\arraycolsep=1.4pt\begin{array}{cccc}
		\OO_{\Spec A}(\Spec A) &\to& \mc O_{\Spec A,\mf p} \\
		s &\mapsto& s|_{\mf p}
	\end{array}\]
	because $\mf p\in\Spec A$. Call this map $\varphi$. Note, for any $f\in A\setminus\mf p$, we see that $\mf p\in D(f)$, so the canonical map
	\[\OO_{\Spec A}(D(f)) \to \OO_{\Spec A,\mf p}\]
	permits us to write
	\[[(\Spec A,f)]\cdot[(D(f),1/f)]=[(D(f),f)]\cdot[(D(f),1/f)]=[(D(f),1)]\]
	is the unit element of $\OO_{\Spec A,\mf p}$. Thus, $\varphi(f)\in\OO_{\Spec A,\mf p}^\times$ for each $f\in A\setminus\mf p$, so $\varphi$ induces a natural map $\varphi\colon A_\mf p\to\OO_{\Spec A,\mf p}$ sending $a/f$ to $[(D(f),a/f)]$.

	In the other direction, we can directly pick up any $\left[(D(f),a/f^n)\right]\in\OO_{\Spec A,\mf p}$, where we are thinking about the colimit as happening over the distinguished base according to \autoref{lem:stalkbybase}. Now, $\mf p\in D(f)$ is equivalent to $f\notin\mf p$, so $f\in A_\mf p^\times$, so we can define $\psi\colon\OO_{\Spec A,\mf p}\to A_\mf p$ by
	\[\psi\colon\left[(D(f),a/f^n)\right]\mapsto a/f^n.\]
	To see that $\psi$ is well-defined, note $(D(f_1),a_1/f_1^{n_1})\sim(D(f_2),a_2/f_2^{n_2})$ means we can find $D(f)\subseteq D(f_1)\cap D(f_2)$ containing $\mf p$ with
	\[f^n\left(f_2^{n_2}a_1-f_1^{n_1}a_2\right)=0\]
	in $A$. Rearranging, it follows that $a_1/f_1^{n_1}=a_2/f_2^{n_2}$ in $A_\mf p$.

	We won't bother checking that $\psi$ is a ring map; just look at it. However, we will check that $\psi$ and $\varphi$ are inverses (which tells us that $\psi$ is a ring map automatically). Well, given $a/f\in A_\mf p$, we see
	\[\psi(\varphi(a/f))=\psi([(D(f),a/f)])=a/f.\]
	On the other hand, given $[(D(f),a/f^n)]\in\OO_{\Spec A,\mf p}$, write
	\[\varphi(\psi([(D(f),a/f^n)]))=\varphi\left(a/f^n\right)=[(D(f^n),a/f^n)]=[(D(f),a/f)],\]
	where the last equality holds because $D(f^n)=(\Spec A)\setminus V((f^n))=(\Spec A)\setminus V(\rad(f^n))=(\Spec A)\setminus V((f))=D(f)$.
\end{proof}
\begin{remark} \label{rem:sheafislocalring}
	Notably, $\mc O_{\Spec A,\mf p}$ is always a local ring, and the maximal ideal $\mf pA_\mf p$ corresponds to germs $[(D(f),a/f)]$ such that $a/f\in\mf pA_\mf p$, or equivalently, such that $a\in\mf p$. Namely, the maximal ideal consists of our germs which vanish at $\mf p$.
\end{remark}
\begin{example}
	Continuing from \autoref{exe:diffgeo}, set $X\coloneqq\CC$ and $\mc O_X$ to be the sheaf of holomorphic functions. Then, for any $z_0\in X$, we have
	\[\mc O_{X,z_0}=\Bigg\{\sum_{n=0}^\infty a_n(z-z_0)^n\text{ with positive radius of convergence}\Bigg\}.\]
	Indeed, any germ $[(U,f)]$ with $f$ holomorphic actually has $f$ analytic, so $f$ is equal to a (unique) power series of the given form in some small enough neighborhood. And of course, each power series with positive radius of convergence gives rise to a germ.
\end{example}
\begin{remark}[Nir]
	As in \autoref{rem:sheafislocalring}, we note that $\mc O_{X,z_0}$ is a local ring with maximal ideal
	\[\mf m_{X,z_0}=\Bigg\{\sum_{n=1}^\infty a_n(z-z_0)^n\text{ with positive radius of convergence}\Bigg\}.\]
	Of course $\mf m_{X,z_0}\subseteq\OO_{X,z_0}$ is an ideal. Conversely, one can see that any germ $[(f,U)]$ with $f(z_0)\ne0$ is nonzero in some neighborhood around $z_0$ (by continuity) and therefore is invertible in $\OO_{X,z_0}$, so $\OO_{X,z_0}\setminus\mf m_{X,z_0}=\OO_{X,z_0}^\times$.
\end{remark}

\subsection{Stalk Memory}
Here is why we care about stalks.
\begin{idea} \label{idea:stalks}
	Stalks remember everything about a sheaf.
\end{idea}
Again, the reason why we expect \autoref{idea:stalks} to be true is that the stalk is able to remember local information, so having all the local information should be able to recover the original sheaf. Here is a rigorization.
\begin{proposition} \label{prop:stalkinjection}
	Fix a sheaf $\mc F$ and a presheaf $\mc G$ on $X$. Also, fix an open subset $U\subseteq X$.
	\begin{listalph}
		\item The natural embedding
		\[\arraycolsep=1.4pt\begin{array}{cccc}
			\iota\colon& \mc F(U) &\to& \displaystyle\prod_{p\in U}\mc F_p \\
			& f &\mapsto& (f|_p)_{p\in U}
		\end{array}\]
		is injective.
		\item A tuple $(f_p)_{p\in U}\in\prod_{p\in U}\mc F_p$ is in $\im\iota$ if and only if, for each $p\in U$, there is an open set $U_p$ containing $p$ such that w can find $\widetilde f_p\in\mc F(U_p)$ such that all $q\in U_p$ have $f_q=\widetilde f_p|_q$.
	\end{listalph}
\end{proposition}
\begin{remark}
	Intuitively, part (b) is saying that all stalks in a small neighborhood come from a single section.
\end{remark}
\begin{proof}
	Here we go.
	\begin{listalph}
		\item We use the identity axiom on $\mc F$. Suppose that $f,g\in\mc F(U)$ have $f|_p=g|_p$ for all $p\in U$. Thus, for each $p\in U$, we can find $U_p\subseteq U$ containing $p$ such that $f|_{U_p}=g|_{U_p}$.

		Now, $U\subseteq\bigcup_{p\in U}U_p\subseteq U$, so $\{U_p\}_{p\in U}$ is an open cover for $U$, so the identity axiom on $\mc F$ forces $f=g$.
		
		\item We use the gluability axiom on $\mc F$. In one direction, suppose $\iota(f)=(f_p)_{p\in U}$ so that $f|_p=f_p$ for each $p\in U$. This means that, for each $p\in U$, we can set $U_p\coloneqq U$ and $\widetilde f_p\coloneqq f\in\mc F(U_p)$ so that any $q\in U_p$ have
		\[f_q=f|_q=\widetilde f_p|_q.\]
		In the other direction, suppose we have germs $(f_p)_{p\in U}\in\prod_{p\in U}\mc F_p$ such that any $p\in U$ has an open set $U_p$ and a section $\widetilde f_p\in\mc F(U_p)$ such that $f_q=\widetilde f_p|_q$ for any $q\in U_p$. We claim that
		\begin{equation}
			\widetilde f_p|_{U_p\cap U_q}\stackrel?=\widetilde f_q|_{U_p\cap U_q}. \label{eq:getcoherence}
		\end{equation}
		Well, for any $r\in U_p\cap U_q$, we know that $\widetilde f_p|_{U_p\cap U_q}|_r=f_r=\widetilde f_q|_{U_p\cap U_q}|_r$, so there is an open set $V_r\subseteq U_p\cap U_q$ containing $r$ such that
		\[\widetilde f_p|_{U_p\cap U_q}|_{V_r}=\widetilde f_q|_{U_p\cap U_q}|_{V_r}.\]
		Now, applying the identity axiom of $\mc F$ on the open cover $\{V_r\}_{r\in U_p\cap U_q}$ forces \autoref{eq:getcoherence}. Thus, the gluability axioms grants $f\in\mc F(U)$ such that $f|_{U_p}=\widetilde f_p$ for each $p\in U$, so it follows that
		\[f|_p=f|_{U_p}|_p=f_p\]
		for each $p\in U$.
		\qedhere
	\end{listalph}
\end{proof}
In addition to sections, stalks also remember morphisms.
\begin{proposition}
	Fix presheaves $\mc F$ and $\mc G$ on a topological space $X$ with a morphism $\varphi\colon\mc F\to\mc G$.
	\begin{listalph}
		\item For any $p\in X$, there is a natural map $\varphi_p\colon\mc F_p\to\mc G_p$.
		\item Suppose $\mc G$ is a sheaf. Given presheaf morphisms $\varphi,\varphi'\colon\mc F\to\mc G$ such that $\varphi_p=\varphi'_p$ for all $p\in X$, we have $\varphi=\varphi'$.
	\end{listalph}
\end{proposition}
\begin{proof}
	We go in sequence.
	\begin{listalph}
		\item It is possible to induce this map from abstract nonsense. Alternatively, we can write this explicitly as being induced by
		\[\varphi_p\colon[(U,s)]\mapsto[(U,\varphi_U(s))].\]
		To see that $\varphi_p$ is well-defined, suppose $(U_1,s_1)\sim(U_2,s_2)$ so that we have some $U\subseteq U_1\cap U_2$ with $s_1|_U=s_2|_U$. Then
		\[\varphi_{U_1}(s_1)|_U=\varphi_U(s_1|_U)=\varphi_U(s_2|_U)=\varphi_{U_2}(s_2)|_U,\]
		so $(U_1,\varphi_U(s_1))\sim(U_2,\varphi_U(s_2))$. Now, $\varphi_p$ will preserve whatever extra structure we need it to because it is essentially induced by the $\varphi_U$.
		\item Fix an open set $U\subseteq X$ so that we need $(\varphi_1)_U=(\varphi_2)_U$. Now, the point is that any $\psi\colon\mc F\to\mc G$ will make the diagram
		% https://q.uiver.app/?q=WzAsOCxbMCwwLCJcXG1jIEYoVSkiXSxbMSwwLCJcXGRpc3BsYXlzdHlsZVxccHJvZF97cFxcaW4gVX1cXG1jIEZfcCJdLFswLDEsIlxcbWMgRyhVKSJdLFsxLDEsIlxcZGlzcGxheXN0eWxlXFxwcm9kX3twXFxpbiBVfVxcbWMgR19wIl0sWzMsMCwiZiJdLFszLDEsIlxcdmFycGhpX1VmIl0sWzQsMCwiKGZ8X3ApX3twXFxpbiBVfSJdLFs0LDEsIigoXFx2YXJwaGlfVWYpfF9wKV97cFxcaW4gVX0iXSxbMiwzLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJob29rIiwic2lkZSI6InRvcCJ9fX1dLFswLDFdLFsxLDMsIlxccHJvZFxcdmFycGhpX3AiXSxbMCwyLCJcXHZhcnBoaV9VIiwyXSxbNCw2LCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtYXBzIHRvIn19fV0sWzYsNywiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibWFwcyB0byJ9fX1dLFs0LDUsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XSxbNSw3LCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtYXBzIHRvIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{\mc F(U)} & {\displaystyle\prod_{p\in U}\mc F_p} && f & {(f|_p)_{p\in U}} \\
			{\mc G(U)} & {\displaystyle\prod_{p\in U}\mc G_p} && {\psi_Uf} & {((\psi_Uf)|_p)_{p\in U}}
			\arrow[hook, from=2-1, to=2-2]
			\arrow[from=1-1, to=1-2]
			\arrow["{\prod\psi_p}", from=1-2, to=2-2]
			\arrow["{\psi_U}"', from=1-1, to=2-1]
			\arrow[maps to, from=1-4, to=1-5]
			\arrow[maps to, from=1-5, to=2-5]
			\arrow[maps to, from=1-4, to=2-4]
			\arrow[maps to, from=2-4, to=2-5]
		\end{tikzcd}\]
		commute. In particular, if $\varphi_p=\varphi'_p$ for all $p\in X$, then we see that $\varphi_U(f)|_p=\varphi_p(f)=\varphi'_p(f)=\varphi_U(f)|_p$. Thus, the injectivity of the map $\mc G(U)\to\prod_{p\in U}\mc G_p$ of \autoref{prop:stalkinjection} forces $\varphi_U(f)=\varphi_U(f)$.
		\qedhere
	\end{listalph}
\end{proof}
% \begin{remark}
% 	The sheaf conditions on (b) and (c) are unnecessary.
% \end{remark}

\subsection{The Category of Sheaves Is Additive}
We are going to want to do category theory on sheaves, so let's begin. Our end goal is to show that the category of (pre)sheaves over a topological space $X$ valued in an abelian category is itself abelian. Throughout, our target category for our sheaves will be abelian (and concrete). Explicitly, the target category will essentially be a subcategory of $\mathrm{Mod}_R$ always.

To begin, we need to show that we can give morphisms of sheaves an abelian group structure.
\begin{lemma} \label{lem:addmorphisms}
	Fix presheaves $\mc F$ and $\mc G$ on a topological space $X$. Then, given morphisms $\varphi,\psi\colon\mc F\to\mc G$, we can define
	\[(\varphi+\psi)_U\coloneqq\varphi_U+\psi_U\]
	for each $U\subseteq X$. Then $(\varphi+\psi)\colon\mc F\to\mc G$ is a presheaf morphism. This operation $+$ makes $\op{Mor}(\mc F,\mc G)$ an abelian group, and composition of morphisms distributes over addition.
\end{lemma}
\begin{proof}
	To check that $\varphi+\psi$ is a presheaf morphism, pick up a containment of open sets $V\subseteq U$, and we need to check that the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXG1jIEYoVSkiXSxbMSwwLCJcXG1jIEcoVSkiXSxbMCwxLCJcXG1jIEYoVikiXSxbMSwxLCJcXG1jIEcoQikiXSxbMCwxLCIoXFx2YXJwaGkrXFxwc2kpX1UiXSxbMiwzLCIoXFx2YXJwaGkrXFxwc2kpX1YiXSxbMCwyLCJcXG9we3Jlc31fe1UsVn0iLDJdLFsxLDMsIlxcb3B7cmVzfV97VSxWfSJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mc F(U)} & {\mc G(U)} \\
		{\mc F(V)} & {\mc G(B)}
		\arrow["{(\varphi+\psi)_U}", from=1-1, to=1-2]
		\arrow["{(\varphi+\psi)_V}", from=2-1, to=2-2]
		\arrow["{\op{res}_{U,V}}"', from=1-1, to=2-1]
		\arrow["{\op{res}_{U,V}}", from=1-2, to=2-2]
	\end{tikzcd}\]
	commutes. Well, for any $s\in\mc F(U)$, we note
	\[(\varphi+\psi)_U(s)|_V=(\varphi_Us+\psi_Us)|_V=\varphi_U(s)|_V+\psi_U(s)|_V\stackrel*=\varphi_V(s|_V)+\psi_V(s|_V)=(\varphi+\psi)_V(s|_V),\]
	where we have used the fact that $\varphi$ and $\psi$ are presheaf morphisms in $\stackrel*=$.

	To check that $\op{Mor}(\mc F,\mc G)$ is an abelian group under $+$, we note that
	\[\op{Mor}(\mc F,\mc G)\subseteq\prod_{U\subseteq X}\op{Mor}(\mc F(U),\mc G(U)),\]
	where the latter is a product group under the same addition operation. We have already established that $\op{Mor}(\mc F,\mc G)$ is closed under the addition operation. So we have two more checks to establish that we have a subgroup.
	\begin{itemize}
		\item Zero: the zero element $0\in\op{Mor}(\mc F,\mc G)$ is then made of the zero morphisms $0_U\colon\mc F(U)\to\mc G(U)$. The uniqueness of zero morphisms ensures that $0\colon\mc F\to\mc G$ is a presheaf morphism. Namely, any $V\subseteq U$ and $s\in\mc F(U)$ gives $0_U(s)|_V=0=0_V(s|_V)$.
		\item Inverses: given a sheaf morphism $\varphi\colon\mc F\to\mc G$, we define $(-\varphi)_U\coloneqq-\varphi_U$ for each $U\subseteq X$. The $(-\varphi)$ assembles into a presheaf morphism: for any $V\subseteq U$ and $s\in\mc F(U)$, we see that $(-\varphi)_U(s)|_V=-\varphi_U(s)|_V=-\varphi_V(s|_V)=(-\varphi)_V(s|_V)$.
	\end{itemize}
	It remains to check distributivity. Let $\varphi_1,\varphi_1\colon\mc F\to\mc G$ and $\psi_1,\psi_2\colon\mc G\to\mc H$ be presheaf morphisms. Then, for any $U\subseteq X$ and $s\in\mc F(U)$, we compute
	\begin{align*}
		((\psi_1+\psi_2)\circ(\varphi_1+\varphi_2))_U(s) &= (\psi_1+\psi_2)_U\big((\varphi_1+\varphi_2)_U(s)\big) \\
		&= ((\psi_1)_U+(\psi_2)_U)\big((\varphi_1)_U(s)+(\varphi_2)_U(s)\big) \\
		&= ((\psi_1)_U+(\psi_2)_U)\big((\varphi_1)_U(s)\big)+((\psi_1)_U+(\psi_2)_U)\big((\varphi_2)_U(s)\big) \\
		&= (\psi_1\circ\varphi_1)_U(s)+(\psi_2\circ\varphi_1)_U(s)+(\psi_1\circ\varphi_2)_U(s)+(\psi_2\circ\varphi_2)_U(s) \\
		&= (\psi_1\circ\varphi_1+\psi_2\circ\varphi_1+\psi_1\circ\varphi_2+\psi_2\circ\varphi_2)_U(s),
	\end{align*}
	so $(\psi_1+\psi_2)\circ(\varphi_1+\varphi_2)=\psi_1\circ\varphi_1+\psi_2\circ\varphi_1+\psi_1\circ\varphi_2+\psi_2\circ\varphi_2$ follows.
\end{proof}
\begin{remark} \label{rem:pretosheaf}
	Of course, replacing all presheaves with sheaves in \autoref{lem:addmorphisms} makes the statement still true because sheaf morphisms are just presheaf morphisms. This will be a recurring theme.
\end{remark}
Continuing, we should define a zero presheaf.
\begin{definition}[Zero presheaf]
	Given a topological space $X$, the \textit{zero presheaf} on $X$ is the presheaf $\mc Z$ such that $\mc Z(U)=0$ for all open $U\subseteq X$.
\end{definition}
\begin{lemma} \label{lem:presheafzero}
	The zero presheaf $\mc Z$ on $X$ is the zero object in the category of presheaves on $X$.
\end{lemma}
\begin{proof}
	The restriction maps for $\mc Z$ are all zero maps; the functoriality checks are all immediate because zero maps are unique (namely, ${\id_0}=0$ and $0\circ0=0$). Now, given any presheaf $\mc F$, we need to exhibit unique presheaf morphisms to and from $\mc Z$.
	\begin{itemize}
		\item Initial: we show there is a unique sheaf morphism $\varphi\colon\mc Z\to\mc F$. For uniqueness, note that any $U\subseteq X$ needs a map
		\[\varphi_U\colon\mc Z(U)\to\mc F(U),\]
		so because $\mc Z(U)=0$ is initial, there is a unique possible map. To check that this data actually assembles into a presheaf morphism, we need to check that any containment of open sets $V\subseteq U$ causes the diagram
		% https://q.uiver.app/?q=WzAsOCxbMCwwLCJcXG1jIFooVSkiXSxbMCwxLCJcXG1jIFooVikiXSxbMSwwLCJcXG1jIEYoVSkiXSxbMSwxLCJcXG1jIEYoVikiXSxbMiwwLCIwIl0sWzMsMCwiXFxtYyBGKFUpIl0sWzMsMSwiXFxtYyBGKFYpIl0sWzIsMSwiMCJdLFswLDIsIjAiXSxbMSwzLCIwIl0sWzAsMSwiXFxvcHtyZXN9X3tVLFZ9IiwyXSxbMiwzLCJcXG9we3Jlc31fe1UsVn0iXSxbNCw1LCIwIl0sWzQsN10sWzcsNiwiMCJdLFs1LDZdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{\mc Z(U)} & {\mc F(U)} & 0 & {\mc F(U)} \\
			{\mc Z(V)} & {\mc F(V)} & 0 & {\mc F(V)}
			\arrow["0", from=1-1, to=1-2]
			\arrow["0", from=2-1, to=2-2]
			\arrow["{\op{res}_{U,V}}"', from=1-1, to=2-1]
			\arrow["{\op{res}_{U,V}}", from=1-2, to=2-2]
			\arrow["0", from=1-3, to=1-4]
			\arrow[from=1-3, to=2-3]
			\arrow["0", from=2-3, to=2-4]
			\arrow[from=1-4, to=2-4]
		\end{tikzcd}\]
		commutes, which is clear by the uniqueness of our zero maps. Namely, the map $0\to0\to\mc F(V)$ and $0\to\mc F(U)\to\mc F(V)$ must both just be the map $0\to\mc F(V)$.
		\item Terminal: one merely has to reverse all the arrows in the previous argument. Notably, the zero object $0$ in the target category of $\mc Z$ is terminal in addition to being initial.
		\qedhere
	\end{itemize}
\end{proof}
As in \autoref{rem:pretosheaf}, we can quickly move the zero presheaf to being the zero sheaf.
\begin{cor} \label{cor:zerosheaf}
	The zero presheaf $\mc Z$ on a topological space $X$ is a sheaf and hence the zero object in the category of sheaves on $X$.
\end{cor}
\begin{proof}
	The main point here is that the zero presheaf $\mc Z$ is in fact a sheaf. This is easy to check: fix an open cover $\mc U$ of an open set $U\subseteq V$. If we are given sections $f,g\in\mc Z(U)$, then we don't even need any other conditions to know that
	\[f=g\in\mc Z(U)=0\]
	because there is only one element in the zero object. Similarly, given sections $f_V\in\mc Z(V)$ for each $V\in\mc U$, we note that $f_V=0$ everywhere, so we can set $f_U=0\in\mc Z(U)$ so that $f|_V=f_V$; this proves the gluability axiom.

	We now check the universal property. Given any sheaf $\mc F$, we know from \autoref{lem:presheafzero} that there are unique presheaf morphisms $\mc F\to\mc Z$ and $\mc Z\to\mc F$. Because sheaf morphisms are presheaf morphisms, it follows that there are unique sheaf morphisms as well.
\end{proof}
To show that our category of (pre)sheaves is additive, it remains to exhibit (finite) products.
\begin{definition}[Product presheaf]
	Given presheaves $\mc F_1$ and $\mc F_2$ on a topological space $X$, the \textit{product presheaf} $\mc F_1\times\mc F_2$ by
	\[(\mc F_1\times\mc F_2)(U)\coloneqq\mc F_1(U)\times\mc F_2(U)\]
	with the restriction maps induced by $\mc F_1$ and $\mc F_2$.
\end{definition}
\begin{lemma}
	Given presheaves $\mc F_1$ and $\mc F_2$ on $X$, the product presheaf $\mc F_1\times\mc F_2$ is the categorical product.
\end{lemma}
\begin{proof}
	We begin by showing that $\mc F_1\times\mc F_2$ is in fact a presheaf. To be explicit, our restriction maps for opens $V\subseteq U\subseteq X$ are
	\[\arraycolsep=1.4pt\begin{array}{cccc}
		{\op{res}_{U,V}}\colon & (\mc F_1\times\mc F_2)(U) &\to& (\mc F_1\times\mc F_2)(V) \\
		& (f_1,f_2) &\mapsto& (f_1|_V,f_2|_V).
	\end{array}\]
	Here are our presheaf checks.
	\begin{itemize}
		\item Identity: with an open $U\subseteq X$ and $(f_1,f_2)\in(\mc F_1\times\mc F_2)(U)$, we have $(f_1,f_2)|_U=(f_1|_U,f_2|U)=(f_1,f_2)$.
		\item Functoriality: with opens $W\subseteq V\subseteq U$ and $(f_1,f_2)\in(\mc F_1\times\mc F_2)(U)$, we have
		\[(f_1,f_2)|_V|_W=(f_1|_V|_W,f_2|_V|_W)=(f_1|_W,f_2|_W)=(f_1,f_2)|_W.\]
	\end{itemize}
	It remains to show our universal property for products. Given an open $U\subseteq X$, define $(\pi_1)_U\colon(\mc F_1\times\mc F_2)(U)\to\mc F_1(U)$ by projection onto the first coordinate. To show that $\pi_1$ assembles into a presheaf morphism, pick up opens $V\subseteq U\subseteq X$ and $(f_1,f_2)\in(\mc F_1\times\mc F_2)(U)$ and check
	\[(\pi_1)_U((f_1,f_2))|_V=f_1|_V=(\pi_1)_V((f_1|_V,f_2|_V)).\]
	We can define the presheaf morphism $\pi_2\colon(\mc F_1\times\mc F_2)\to\mc F_2$ by projection onto the second coordinate, which is a presheaf morphism by symmetry.

	For our presheaf morphism, suppose that we have a presheaf $\mc G$ with maps $\varphi_1\colon\mc G\to\mc F_1$ and $\varphi_2\colon\mc G\to\mc F_2$. We need a unique presheaf morphism $\varphi\colon\mc G\to(\mc F_1\times\mc F_2)$ making the diagram
	% https://q.uiver.app/?q=WzAsNCxbMSwyLCJcXG1jIEZfMSJdLFsyLDEsIlxcbWMgRl8yIl0sWzEsMSwiXFxtYyBGXzFcXHRpbWVzXFxtYyBGXzIiXSxbMCwwLCJcXG1jIEciXSxbMiwwLCJcXHBpXzEiXSxbMiwxLCJcXHBpXzIiLDJdLFszLDAsIlxcdmFycGhpXzEiLDIseyJjdXJ2ZSI6Mn1dLFszLDEsIlxcdmFycGhpXzIiLDAseyJjdXJ2ZSI6LTJ9XSxbMywyLCJcXHZhcnBoaSIsMSx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\begin{equation}
		\begin{tikzcd}
			{\mc G} \\
			& {\mc F_1\times\mc F_2} & {\mc F_2} \\
			& {\mc F_1}
			\arrow["{\pi_1}", from=2-2, to=3-2]
			\arrow["{\pi_2}"', from=2-2, to=2-3]
			\arrow["{\varphi_1}"', curve={height=12pt}, from=1-1, to=3-2]
			\arrow["{\varphi_2}", curve={height=-12pt}, from=1-1, to=2-3]
			\arrow["\varphi"{description}, dashed, from=1-1, to=2-2]
		\end{tikzcd} \label{eq:sheafproductup}
	\end{equation}
	commute. We show uniqueness and existence separately.
	\begin{itemize}
		\item Uniqueness: if $\varphi\colon\mc G\to(\mc F_1\times\mc F_2)$ makes \autoref{eq:sheafproductup} commute, at any given open $U\subseteq X$ and $g\in\mc G(U)$, we must have
		\[(\pi_1)_U(\varphi_Ug)=(\varphi_1)_U(g)\qquad\text{and}\qquad(\pi_2)_U(\varphi_Ug)=(\varphi_2)_U(g),\]
		so $\varphi_U(g)\coloneqq((\varphi_1)_Ug,(\varphi_2)_Ug)$ is forced.
		\item Existence: as above, given an open $U\subseteq X$ and $g\in\mc G(U)$, define
		\[\varphi_U(g)\coloneqq((\varphi_1)_Ug,(\varphi_2)_Ug).\]
		We can see, as above, that $(\pi_1)_U\circ\varphi_U=(\varphi_1)_U$ and similar for $\pi_2$, so \autoref{eq:sheafproductup} will commute as long as $\varphi$ actually assembles into a presheaf morphism.

		Well, given $V\subseteq U\subseteq X$ and $g\in\mc G(U)$, note
		\[\varphi_U(g)|_V=((\varphi_1)_Ug,(\varphi_2)_Ug)|_V=((\varphi_1)_U(g)|_V,(\varphi_2)_U(g)|_V)=((\varphi_1)_V(g|_V),(\varphi_2)_V(g|_V))=\varphi_V(g|_V),\]
		which finishes.
		\qedhere
	\end{itemize}
\end{proof}
\begin{corollary} \label{cor:sheafprod}
	Given sheaves $\mc F_1$ and $\mc F_2$ on $X$, the product presheaf $\mc F_1\times\mc F_2$ is a sheaf and hence the categorical product.
\end{corollary}
\begin{proof}
	As in \autoref{cor:zerosheaf}, the main point is to show that $\mc F_1\times\mc F_2$ is in fact a sheaf. Fix an open cover $\mc U$ of $U$.
	\begin{itemize}
		\item Identity: given $(f_1,f_2)\in(\mc F_1\times\mc F_2)(U)$ with $(f_1,f_2)|_V=0$ for all $V\in\mc U$, we see $f_1|_V=f_2|_V=0$ is forced for all $V\in\mc U$, so the identity axiom on $\mc F_1$ and $\mc F_2$ forces $f_1=f_2=0$. Thus, $(f_1,f_2)=0$.
		\item Gluability: pick up sections $(f_{1,V},f_{2,V})(\mc F_1\times\mc F_2)(V)$ for each $V\in\mc U$ such that any $V,V'\in\mc U$ have
		\[(f_{1,V}|_{V\cap V'},f_{2,V}|_{V\cap V'})=(f_{1,V},f_{2,V})|_{V\cap V'}=(f_{1,V'},f_{2,V'})|_{V\cap V'}=(f_{1,V'}|_{V\cap V'},f_{2,V'}|_{V\cap V'}).\]
		Thus, the gluability axiom on $\mc F_1$ and $\mc F_2$ promises $f_1\in\mc F_1(U)$ and $f_2\in\mc F_2(U)$ such that $f_1|_V=f_{1,V}$ and $f_2|_V=f_{2,V}$ for each $V\in\mc U$. Thus, $(f_1,f_2)|_V=(f_1|_V,f_2|_V)=(f_{1,V},f_{2,V})$ for each $V\in\mc U$, as needed.
	\end{itemize}
	We now discuss the universal property. This immediately follows from the corresponding statement in the category of presheaves, but for completeness, we will say out loud what's going on. Let $\pi_1\colon(\mc F_1\times\mc F_2)\to\mc F_1$ and $\pi_2\colon(\mc F_1\times\mc F_2)\to\mc F_2$ be the projection (pre)sheaf morphisms.
	
	Suppose we have a sheaf $\mc G$ with sheaf morphisms $\varphi_1\colon\mc G\to\mc F_1$ and $\varphi_2\colon\mc G\to\mc F_2$. Then we are promised a unique presheaf morphism $\varphi\colon\mc G\to(\mc F_1\times\mc F_2)$ such that $\varphi_1=\pi_1\circ\varphi$ and $\varphi_2=\pi_2\circ\varphi$. Thus, there is also a unique sheaf morphism $\varphi$ satisfying the same constraint because sheaf morphisms are just presheaf morphisms.
\end{proof}
\begin{remark}
	The above discussion immediately generalizes to arbitrary products, but we will not need these.
\end{remark}
\begin{corollary}
	The category of (pre)sheaves on a topological space $X$ valued in a (concrete) abelian category $\mc C$ is additive.
\end{corollary}
\begin{proof}
	Combine \autoref{lem:addmorphisms}, \autoref{cor:zerosheaf}, and \autoref{cor:sheafprod}.
\end{proof}

\subsection{Sheaf Kernels}
We continue working with (pre)sheaves valued in a concrete abelian category. The next step to show that the category is abelian is to exhibit kernels and cokernels. Cokernels will turn out to be difficult, so we begin with kernels.
\begin{definition}[Presheaf kernel]
	Given a morphism of presheaves $\varphi\colon\mc F\to\mc G$ on a topological space $X$, we define the \textit{presheaf kernel} as
	\[(\ker\varphi)(U)\coloneqq\ker\varphi_U\]
	for each $U\subseteq X$, where restriction maps are induced by $\mc F$. Then $\ker\varphi$ is our \textit{presheaf kernel}.
\end{definition}
\begin{lemma}
	Given a morphism of presheaves $\varphi\colon\mc F\to\mc G$ on a topological space $X$, the presheaf kernel $\ker\varphi$ is a categorical kernel.
\end{lemma}
\begin{proof}
	We haven't actually defined the restriction maps for the presheaf kernel, so we do this now: for each open $U\subseteq X$ with $V\subseteq U$, note $\ker\varphi_U\subseteq\mc F(U)$, so we can restrict the map ${\op{res}_{U,V}}\colon\mc F(U)\to\mc F(V)$ to a map
	\[\ker\varphi_U\to\mc F(V).\]
	Now, for any $s\in\ker\varphi_U$, we note that actually $\varphi_V(s|_V)=\varphi_U(s)|_V=0$, so our restriction map restricts to ${\op{res}_{U,V}}\colon\ker\varphi_U\to\ker\varphi_V$ as needed. The presheaf checks on $\ker\varphi$ of identity and functoriality checks are inherited from $\mc F$.

	It remains to check the universal property: we need $\ker\varphi$ to be the limit of the following diagram.
	% https://q.uiver.app/?q=WzAsMyxbMCwxLCJcXG1jIEYiXSxbMSwxLCJcXG1jIEciXSxbMSwwLCIwIl0sWzAsMSwiXFx2YXJwaGkiXSxbMiwxXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		& \mc Z \\
		{\mc F} & {\mc G}
		\arrow["\varphi", from=2-1, to=2-2]
		\arrow[from=1-2, to=2-2]
	\end{tikzcd}\]
	There is an inclusion $(\ker\varphi)(U)\subseteq\mc F(U)$ for each open $U\subseteq X$, which induces the arrows in the rest of the diagram. Checking the universal property is routine.
\end{proof}
Having a kernel gives us a definition.
\begin{definition}[Injective]
	A morphism of presheaves $\varphi\colon\mc F\to\mc G$ is \textit{injective} if and only if the kernel presheaf $\ker\varphi$ is identically zero. Equivalently, we are asking for $\varphi_U$ to be injective everywhere.
\end{definition}
In our stalk philosophy, we might hope we can detect injectivity at stalks. Indeed, we can.
\begin{proposition} \label{prop:injonstalks}
	Fix a morphism of presheaves $\varphi\colon\mc F\to\mc G$. Given that $\mc F$ is a sheaf, we have that $\varphi$ is injective if and only if it is injective on stalks.
\end{proposition}
\begin{proof}
	Use the embedding
	\[\mc F(U)\into\prod_{p\in U}\mc F_p\]
	for each $U\subseteq X$.
\end{proof}
There is also the following result.
\begin{proposition}
	Fix a morphism of sheaves $\varphi\colon\mc F\to\mc G$. Then $\varphi$ is an isomorphism if and only if $\varphi_U$ is an isomorphism for all $U\subseteq X$ if and only if $\varphi_p$ is an isomorphism for all $p\in X$.
\end{proposition}
\begin{proof}[Sketch]
	The hard part is showing that if we have isomorphisms at each stalk, then we have an isomorphism of full sheaves. We already know about injectivity, so let's focus on surjectivity. Well, for any $g\in\mc G(U)$, we get a system of compatible germs $(g|_p)_{p\in U}$, and because $\varphi_p$ is an isomorphism, we may set
	\[f_p\coloneqq\varphi_p^{-1}(f|_p).\]
	Then we claim that $f_p$ is a set of compatible germs, which gives rise to a section $f\in\mc F(U)$. Indeed, for each $p\in U$, we can find $U_p\subseteq U$ small enough so that $f_p\in\mc F(U_p)$ and $\varphi_{U_p}(f_p)=g|_{U_p}$. Then we simply have to use gluability directly to take these $f_p\in\mc F(U_p)$ to give our section; for this, we need to check
	\[f_p|_{U_p\cap U_q}=f_q|_{U_p\cap U_q}.\]
	However, $\varphi_{U_p\cap U_q}$ is injective, so it suffices to throw this through $\varphi$ and check equality there. However, both of these equal
	\[g|_{U_p\cap U_q}\]
	when passed through $\varphi$, so we are safe. Note we used the injectivity of $\varphi$ at the end here!
\end{proof}
\begin{remark}
	We are avoiding surjectivity for the moment because it is a little trickier. In particular, a morphism $\varphi$ will be able to be surjective without being each $\varphi_U$ being surjective. However, surjectivity will still be equivalent to surjectivity on the stalks.
\end{remark}

\end{document}