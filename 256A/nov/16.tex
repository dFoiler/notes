% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

\section{November 16}

Today we continue to blow up. Last class we defined blow-ups by universal property. Today we will actually show that it exists.

\subsection{Blow-Up Fact Collection}
Continuing our fact-collection, we will finish up a proof from last time.
\openblowup*
\begin{proof}
	The map $U\into X$ grants us a map $\op{Bl}_{Z\cap U}U\to\pi^{-1}U$ because $\pi^{-1}U$ is a fiber product. We would like to construct an inverse for this map. Well, $\pi^{-1}U$ fits into the pullback square
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXHBpXnstMX1VIl0sWzEsMCwiVSJdLFswLDEsIlxcb3B7Qmx9X1pYIl0sWzEsMSwiWCJdLFsxLDMsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoidG9wIn19fV0sWzAsMiwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoiaG9vayIsInNpZGUiOiJ0b3AifX19XSxbMiwzLCJcXHBpIl0sWzAsMSwiXFxwaSJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\pi^{-1}U} & U \\
		{\op{Bl}_ZX} & X
		\arrow[hook, from=1-2, to=2-2]
		\arrow[hook, from=1-1, to=2-1]
		\arrow["\pi", from=2-1, to=2-2]
		\arrow["\pi", from=1-1, to=1-2]
	\end{tikzcd}\]
	where facts about intersections of locally closed embeddings tell us that the pre-image of $Z\cap U$ in $\pi^{-1}U$ is $\pi^{-1}Z\cap\pi^{-1}U$. However, this is now an effective Cartier divisor in $\pi^{-1}U$, so the universal property grants us a map $\pi^{-1}U\to\op{Bl}_{Z\cap U}U$. Because both of our maps were defined by universal property, it's not too hard to check that these maps are inverse.
\end{proof}
\begin{remark}
	Technically, one can weaken the open embedding $U\into X$ to merely be a flat morphism. We haven't defined what a flat morphism is, so we won't say more about this.
\end{remark}
\begin{lemma} \label{lem:blow-up-carries-irred-red}
	Fix a closed subscheme $Z$ of a scheme $X$ with blow-up $\pi\colon\op{Bl}_ZX\to X$. If $X$ is reduced or irreducible, then so is $\op{Bl}_ZX$.
\end{lemma}
\begin{proof}
	The point is to reduce to the affine case. Namely, with $X=\Spec A$, we set $U\coloneqq X\setminus Z$ so that $\pi^{-1}U$ will contain some $D(t)$ for a single $t\in A$, using the distinguished base. However, our closed subscheme is a Cartier divisor and therefore locally generated by a single element, so looking sufficiently locally, $Z$ is $V(t)$ for some non-zero-divisor $t$. It follows that $D(t)=\Spec A_t$ is reduced or irreducible following from $A$.\todo{What?}
\end{proof}
\begin{lemma}
	Fix a closed subscheme $Z$ of an integral scheme $X$ with $U\coloneqq X\setminus Z$ open and dense. Then the blow-up $\pi\colon\op{Bl}_ZX\to X$ restricts to a map $\pi|_U\colon U\to\pi^{-1}U$ which defines a birational map $X\dashrightarrow\op{Bl}_ZX$.
\end{lemma}
\begin{proof}
	This is an isomorphism from \autoref{lem:open-blow-up}, so the difficulty here is showing that $\pi^{-1}U$ is open and dense in $\op{Bl}_ZX$. Well, we see that
	\[\op{Bl}_ZX\setminus\pi^{-1}U=\pi^{-1}Z\]
	is an effective Cartier divisor, so $\pi^{-1}U\subseteq\op{Bl}_ZX$ is fact open and dense scheme-theoretically, which is what we wanted. Note that being birational as a notion makes sense because $\op{Bl}_ZX$ is still integral by \autoref{lem:blow-up-carries-irred-red}.
\end{proof}
\begin{lemma}
	Fix a closed subscheme $Z$ of a scheme $X$ with blow-up $\pi\colon\op{Bl}_ZX\to X$. Given a closed subscheme $i\colon Y\subseteq X$, the induced map $\widetilde i\colon\op{Bl}_{Y\cap Z}Y\to\op{Bl}_ZX$ is a closed embedding, where the image is the scheme-theoretic image of $\pi^{-1}(Y\setminus Z)$ in $\op{Bl}_ZX$.
\end{lemma}
\begin{proof}
	One can use the universal property (there's a hint in Vakil), but we will prove this by construction later.
\end{proof}
\begin{remark}
	The above result is how we compute for closed subschemes. Explicitly, when we wanted to blow up the nodal curve in the affine plane, we were able to blow up the affine plane first and then take the (scheme-theoretic image of the) pre-image of the nodal curve.
\end{remark}

\subsection{How to Blow Up}
We now construct the blow-up. Fix a closed subscheme $f\colon Z\subseteq X$ which is an effective Cartier divisor, where $\mc I\coloneqq\mc I_Z=\ker(\OO_X\to f_*\OO_Z)$. Now, we construct
\[\mc B\coloneqq\OO_X\oplus\mc I\oplus\mc I^2\oplus\mc I^3\oplus\cdots.\]
Note $\mc B$ is a graded quasicoherent $\OO_X$-algebra (where ``$\OO_X$-algebra'' has the obvious definition) generated in degree $1$, by construction. We are going to construct $\Proj\mc B$, as a generalization of our previous $\Proj$ over graded algebras.
% GW 13.7
% V 18.2

Well, to do this construction, we unsurprisingly glue locally. Fix an affine open subscheme $U\subseteq X$, and set $A\coloneqq\OO_X(U)$. Then, note
\[\mc B(U)=\bigoplus_{n\ge0}\Gamma\left(U,\mc I^n\right)\]
is a graded $A$-algebra. So we note that there is a map $\pi\colon\Proj\mc B(U)\to U$. Further, note that open $V\subseteq U$ induces an isomorphism $\pi^{-1}V\simeq\Proj\mc B(V)$, so we can glue these affine pieces together to build $\Proj\mc B$ with a map $\pi\colon\Proj\mc B\to X$.
\begin{remark}
	The above construction will work for any graded quasicoherent $\OO_X$-algebra $\mc B$.
\end{remark}
We now use the fact that $\mc B$ is generated in degree $1$. Namely, we define the quasicoherent sheaf $\OO(1)$ on $\Proj\mc B$ by gluing together the various $\widetilde{\mc B(U)(1)}$ on $\Proj\mc B(U)$.
\begin{remark}
	One can check that $\OO(1)$ is a line bundle on $\Proj\mc B$ when $\mc B$ is generated in degree $1$ and is of finite type.
\end{remark}
\begin{remark}
	One can check that $\Proj$ is compatible with base-change: given a scheme morphism $\varphi\colon X\to X'$, where $\mc B$ is a graded quasicoherent $\OO_X$-module, then the square
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXFByb2pcXHZhcnBoaV4qXFxtYyBCIl0sWzAsMSwiXFxQcm9qXFxtYyBCIl0sWzEsMCwiWCciXSxbMSwxLCJYIl0sWzAsMl0sWzEsM10sWzAsMV0sWzIsMywiXFx2YXJwaGkiXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\Proj\varphi^*\mc B} & {X'} \\
		{\Proj\mc B} & X
		\arrow[from=1-1, to=1-2]
		\arrow[from=2-1, to=2-2]
		\arrow[from=1-1, to=2-1]
		\arrow["\varphi", from=1-2, to=2-2]
	\end{tikzcd}\]
	is a pullback square. In fact, we can check that $\pi_{\Proj\mc B}^*\OO_{\Proj\mc B}(1)=\OO_{\Proj\varphi^*\mc B}(1)$.
\end{remark}
\begin{example}
	In particular, the above square tells us that $\PP^n_X=\PP^n_\ZZ\times X$ is a reasonable definition (where $X$ is a scheme). Namely, we are defining
	\[\PP^n_X=\Proj\OO_X[x_0,\ldots,x_n].\]
\end{example}
\begin{proposition} \label{prop:construct-blow-up}
	Fix a closed subscheme $Z$ of $X$ which is an effective Cartier divisor. Then the $\OO_X$-algebra $\mc B\coloneqq\bigoplus_{n\ge0}\mc I^n$ from earlier has $\Proj\mc B\simeq\op{Bl}_ZX$.
\end{proposition}
Before proving this, let's give an example.
\begin{example}
	Take $X=\AA^n_k=\Spec k[x_1,\ldots,x_n]$ with $Z=(0,\ldots,0)$ so that $I\coloneqq(x_1,\ldots,x_n)$ gives $\mc I_Z=\widetilde I$. Now, we can compute that
	\[\bigoplus_{n\ge0}\mc I_Z\simeq k[x_1,\ldots,x_n][X_1,\ldots,X_n]/(x_iX_j-x_jX_i),\]
	where the $X_i$ are the elements of $\mc I_Z$ living in the degree-$1$ component of our ring. One can check that this aligns with our blow-up of $\AA^2_k$ at the origin.
\end{example}
\begin{remark}
	In general, if we are blowing up an affine space along $Z\subseteq X$ of dimension $Z$, then $\pi^{-1}Z$ will be $\PP^{n-1-\dim Z}$. For example, if we are blowing up along a line, then we want to mod out by the direction of the line first, which drops the dimension.
\end{remark}
We now prove \autoref{prop:construct-blow-up}.
\begin{proof}
	We can reduce to the affine case: being an effective Cartier divisor can be checked locally, and showing the universal property will then be something that we can glue together affine-locally because morphisms can be proven to exist and be unique affine-locally. The proof will be finished next class.
\end{proof}
\begin{remark}
	Hartshorne and Vakil prove this when $\mc I$ is of finite type because these are associated to having our line bundle being finitely generated, which turns into projective morphisms, which we understand.
\end{remark}
\begin{remark}
	One can understand morphisms to $\Proj\mc B$ similar to morphisms to $\PP^n_S$, though we will not need this.
	% Stacks 01N4, 01NS
\end{remark}

\end{document}