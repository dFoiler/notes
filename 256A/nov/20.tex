% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

\section{November 20}

Today we discuss the sheaf of differentials.
% H II.8, V S22

\subsection{Affine Differentials}
For simplicity, we begin with the affine case. Throughout, we fix an $A$-algebra $B$ and a $B$-module $A$.
\begin{definition}[Derivation]
	Fix an $A$-algebra $B$ and a $B$-module $M$. Then an \textit{$A$-derivation from $B$ to $M$} is an $A$-linear map $d\colon B\to M$ such that
	\[d(b_1b_2)=b_1d(b_2)+b_2d(b_1).\]
	We let $\op{Der}_A(B,M)$ denote the set of $A$-derivations from $B$ to $M$.
\end{definition}
\begin{remark}
	We can check that $\op{Der}_A(B,M)$ is a $B$-module with the pointwise action from $B$.
\end{remark}
\begin{remark}
	The coherence condition for derivations $d\colon B\to M$ is called the ``Leibniz rule,'' and it is unsurprisingly pretty important. For example, setting $b_1=b_2=1$ tells us $d(1)=d(1)+d(1)$ and thus $d(1)=0$. As such, for any $a\in A$, we see $d(a)=a\cdot d(1)=a\cdot0=0$.
\end{remark}
\begin{example}
	Take $A\coloneqq\CC$ and $B=M=\coloneqq\CC[x]$. Then $d\colon B\to M$ defined by
	\[d\colon\sum_{i=0}^\infty a_ix^i\mapsto\sum_{i=0}^\infty (i+1)a_{i+1}x^i\]
	is the usual derivative of polynomials. In fact, one can check that $\op{Der}_\CC(\CC[x],\CC[x])$ is a free $\CC[x]$-module generated by $d$ above.
\end{example}
We are now ready to give the first definition of our differentials.
\begin{definition}[Sheaf of differentials]
	Fix an $A$-algebra $B$ and a $B$-module $M$. Define $I$ to be the kernel of the diagonal embedding $B\otimes_AB\to B$. Then the \textit{sheaf of differentials} is the $B$-module $\Omega^1_{B/A}\coloneqq I/I^2$.
\end{definition}
\begin{remark}
	In the general case, we will take a separated morphism $X\to Y$ and define $\mc I$ to be the ideal sheaf of the closed embedding $\Delta\colon X\to X\times_YX$. One can check that $\mc I/\mc I^2$ is in fact an $\mathcal O_X$-module because we've modded out by $\mc I^2$.
\end{remark}
\begin{remark}
	There is a map $d_{B/A}\colon B\to\Omega^1_{B/A}$ by sending $b\in B$ to $(1\otimes b-b\otimes1)$. Notably, $1\otimes b-b\otimes1$ is in fact in the kernel of the diagonal map $B\otimes_AB\to B$. In fact, $d_{B/A}$ is a derivation: this is $A$-linear by our tensor products. To check the Leibniz rule, we note that $\Omega^1_{B/A}$ has two $B$-module structures by $b\mapsto(b\otimes1)$ or $b\mapsto(1\otimes b)$, but these are the same. As such,
	\[d_{B/A}(b_1b_2)=1\otimes(b_1b_2)-(b_1b_2)\otimes1=b_1(1\otimes b_2)-b_2(b_1\otimes1)=b_1d_{B/A}(b_2)+b_2d_{B/A}(b_1).\]
\end{remark}
\begin{remark}
	Let's try to motivate our definition of $\Omega^1_{B/A}$. Fix a morphism $X\to Y$ of complex manifolds. Letting $T_\bullet$ denote the tangent bundle, we have a short exact sequence
	\[0\to T_{\Delta X}\to T_{X\times X}|_{\Delta X}\to N_{\Delta/(X\times X)}\to0.\]
	However, $N_{\Delta/(X\times X)}$ is isomorphic to $T_X$ by sending the vector corresponding to $(v_1,v_2)$ to $v_1-v_2$. As such, our $I/I^2$ is some kind of dual of the normal bundle isomorphic to the tangent bundle, which is roughly we want out of $\Omega^1$.
\end{remark}

\subsection{Scheme Differentials}
Throughout, fix a morphism $f\colon X\to Y$ of schemes. We want to define $\Omega^1_{X/Y}$. The point is to pay attention to directions only in $X$ for our derivations.
\begin{definition}[Sheaf of differentials]
	Fix a scheme morphism $f\colon X\to Y$. Because $\Delta\colon X\to X\times_YX$ is a locally closed embedding, we can decompose it into a closed embedding $i\colon X\into U$ and an open embedding $U\into X\times_YX$. Then we define $\mc I$ as the kernel of the map $\OO_U\onto i_*\OO_X$ and set $\Omega^1_{X/Y}\coloneqq\mc I/\mc I^2$. Notably, $\Omega^1_{X/Y}$ is quasicoherent.
\end{definition}
It's a little difficult to handle this, so we define a few more objects.
\begin{definition}[Infinitesimal neighborhood]
	Fix a scheme morphism $f\colon X\to Y$. Then we define the \textit{first infinitesimal neighborhood $P^1_{X/Y}$ of $X$ in $X\times_YX$} is the closed subscheme of $U$ corresponding to $\mc I^2$ in the above definition.
\end{definition}
\begin{remark}
	One can check that $P^1_{X/Y}$ satisfies the following universal property: for any closed embedding $T_0\into T_1$ making the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJUXzAiXSxbMSwwLCJUXzEiXSxbMCwxLCJYIl0sWzEsMSwiWFxcdGltZXNfWVgiXSxbMCwxLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJob29rIiwic2lkZSI6InRvcCJ9fX1dLFsxLDNdLFsyLDMsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoidG9wIn19fV0sWzAsMl1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{T_0} & {T_1} \\
		X & {X\times_YX}
		\arrow[hook, from=1-1, to=1-2]
		\arrow[from=1-2, to=2-2]
		\arrow[hook, from=2-1, to=2-2]
		\arrow[from=1-1, to=2-1]
	\end{tikzcd}\]
	commute, where $T_0\into T_1$ has ``square zero.''
\end{remark}
\begin{remark}
	Expanding out our definitions, we get a short exact sequence
	\[0\to\mc I/\mc I^2\to\OO_{P^1_{X/Y}}\to\OO_X\to0\]
	of sheaves on $X$.
\end{remark}
We would now like to give the derivation $d\colon B\to\Omega^1_{B/A}$. To see this, we check affine-locally, where we are looking at
\[0\to\Omega^1_{B/A}\to P^1_{B/A}\to B\to0.\]
Explicitly, $P^1_{B/A}=(B\otimes_AB)/I^2$. Now, there are two maps $B\to P^1_{B/A}$ which split this short exact sequence, given by $p_1\colon b\mapsto b\otimes1$ and $p_2\colon b\mapsto1\otimes b$, and the derivation in the affine case is the difference between these two.

Gluing these affine pieces together, we see that the short exact sequence
\[0\to\mc I/\mc I^2\to P^1_{B/A}\to B\to0\]
will have two splittings $p_i\colon P^1_{B/A}\to X\times_YX\to X$, where the last map is the projection onto the $i$th coordinate. As such, we define $d_{X/Y}\colon\OO_X\to\Omega^1_{X/Y}$ as $p_2^*-p_1^*$, which we can see is an $f^{-1}\OO_Y$-derivation.
\begin{remark}
	One can check by hand that $\Omega^1_{B/A}$ is generated by $B$ over the image $d_{B/A}(B)$. Indeed, we can write
	\[\sum_i(b_i\otimes x_i)=\sum_i(b_i\otimes1)(1\otimes x_i-x_i\otimes1)+\sum_i(b_ix_i)\otimes1,\]
	but the rightmost term vanishes because $\sum_i(b_i\otimes x_i)$ living in $\Omega^1_{B/A}$ requires $\sum_ib_ix_i=0$.
\end{remark}
\begin{example}
	Take $B=A[x_1,\ldots,x_n]$. Then we can show that $\Omega^1_{B/A}$ is a free $B$-module generated by the $d_{B/A}(x_i)$.
\end{example}

\subsection{Differentials by Universal Property}
We now define differentials by universal property.
\begin{definition}[Derivation]
	Fix a scheme morphism $f\colon X\to Y$. Then an $\mathcal O_X$-module $\mc F$, a \textit{$Y$-derivation from $\OO_X$ to $\mc F$} is an $f^{-1}\OO_Y$-linear map $d\colon\OO_X\to\mc F$ satisfying the Leibniz rule on affine open subschemes.
\end{definition}
And here is our universal property.
\begin{restatable}{proposition}{differentialup} \label{prop:diff-up}
	Fix a scheme morphism $f\colon X\to Y$. Then the derivation $d_{X/Y}\colon\OO_X\to\Omega^1_{X/Y}$ is universal in the following sense: for any $\OO_X$-module $\mc F$, we see
	\[\op{Hom}_{\OO_X}(\Omega^1_{X/Y},\mc F)\simeq\op{Der}_Y(\OO_X,\mc F)\]
	by $\alpha\mapsto\alpha\circ d_{X/Y}$.
\end{restatable}
Philosophically, what's happening is that $\Omega^1_{X/Y}$ can ``see'' all possible derivations.
% Stacks 08S2, 08RM; EGA 4.16

\end{document}