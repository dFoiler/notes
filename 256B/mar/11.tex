% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

Today we continue with divisors.

\subsection{Principal Divisors}
Now that we've defined valuations, we can define zeroes and poles.
\begin{defihelper}[zero, pole] \nirindex{zero} \nirindex{pole}
	Fix a smoothish scheme $X$ and some $Y\in X^{(1)}$. We say that $f\in K(X)^\times$ has a \textit{zero} at $Y$ if and only if $\nu_Y(f)>0$, and $f$ has a \textit{pole} at $Y$ if and only if $\nu_Y(f)<0$.
\end{defihelper}
We now imagine fixing the function $f$ and letting $Y$ vary.
\begin{lemma} \label{lem:function-has-finite-supp}
	Fix a smoothish scheme $X$. Given $f\in K(X)^\times$, the set
	\[\left\{Y\in X^{(1)}:\nu_Y(f)\ne0\right\}\]
	is finite.
\end{lemma}
\begin{proof}
	Note that $K(X)=\OO_{X,\xi}$ where $\xi$ is the generic point of $X$, so we are granted an open subset $U\subseteq X_f\cap X_{1/f}$ of $X$ such that $f,1/f\in \OO_X(U)$; we may even assume that $U$ is affine. Notably, if $Y\in X^{(1)}$ achieves $Y\cap U\ne\emp$, then $\OO_X(U)\subseteq\OO_{X,Y}$ because the generic point of $Y$ will live in $U$, meaning $\nu_Y(f)\ge0$; a similar argument shows $1/f\in\OO_{X,Y}$ thus yielding $\nu_Y(1/f)\ge0$, so we are actually receiving $\nu_Y(f)=0$.

	Thus, $\nu_Y(f)\ne0$ actually requires $Y\subseteq X\setminus U$. Because $X\setminus U$ has strictly smaller dimension than $X$ and $Y$ has codimension $1$, we see that $Y$ must actually be one of the irreducible components of $X\setminus U$, of which there are finitely many because $X$ is Noetherian.
\end{proof}
The above lemma makes the following definition make sense.
\begin{definition}[principal divisor]
	Fix a smoothish scheme $X$ and some $f\in K(X)^\times$. Then we define the \textit{principal divisor}
	\[\op{div}(f)\coloneqq\sum_{Y\in X^{(1)}}\nu_Y(f)Y.\]
	We say that a divisor $D$ is \textit{principal} if and only if it takes the form $\op{div}(f)$.
\end{definition}
\begin{example}
	On the smoothish scheme $X=\Spec\ZZ$, we see $f=6$ shows that $(2)+(3)$ is a principal divisor.
\end{example}
One can generalize the above construction to use line bundles.
\begin{definition}[rational section]
	Fix a smoothish scheme $X$. Given a line bundle $\mc L$ on $X$, a \textit{rational section} is an element $s$ of the stalk $\mc L_\xi$ where $\xi$ is the generic point of $X$.
\end{definition}
\begin{remark}
	Fix a smoothish scheme $X$ and a rational section $s$ of a line bundle $\mc L$ on $X$. Given a prime divisor $Y$ of $X$, let $U,U'\subseteq X$ be nonempty open subsets such that $U\cap Y\ne\emp$ and $U'\cap Y\ne\emp$ with isomorphisms $\varphi\colon\mc L|_U\to\OO_U$ and $\varphi'\colon\mc L|_{U'}\to\OO_{U'}$. Then there is some global section $g\in\OO_{U\cap U'}^\times$ such that $\varphi'=g\varphi$. However, we see $\nu_Y(g)=0$ by the argument of \Cref{lem:function-has-finite-supp} (note $U\cap U'\cap Y\ne\emp$), so
	\[\nu_Y(\varphi(s))=\nu_Y(\varphi'(s)).\]
	The point is that we can make sense of the term $\nu_Y(s)$ because this is independent of the choice of trivializing isomorphism $\nu_Y$.
\end{remark}
\begin{remark}
	Fix a smoothish scheme $X$ and a rational section $s$ of a line bundle $\mc L$ on $X$. Then the set
	\[\left\{Y\in X^{(1)}:\nu_Y(f)\ne0\right\}\]
	remains finite: one can give $X$ a finite open cover $\{U_\alpha\}_{\alpha\in\kappa}$ trivializing $\mc L$ so that $\nu_Y(s)$ becomes $\nu_Y(s|_{U_\alpha})$, where we know our set is finite (for $U_\alpha$) by \Cref{lem:function-has-finite-supp}. Combining our sets for all $U_\alpha$ for $\alpha\in\kappa$ keeps our set finite.
\end{remark}
\begin{definition}
	Fix a smoothish scheme $X$ and a rational section $s$ of a line bundle $\mc L$ on $X$. Then we define
	\[\op{div}_{\mc L}(s)\coloneqq\sum_{Y\in X^{(1)}}\nu_Y(f)Y.\]
\end{definition}
\begin{example}
	We note that ${\op{div}}={\op{div}_{\mc O_X}}$.
\end{example}
\begin{remark}
	Given rational sections $s$ and $s'$ of the line bundles $\mc L$ and $\mc L'$, we see
	\[\op{div}_{\mc L\otimes\mc L'}(s\otimes s')=\op{div}_\mc L(s)+\op{div}_{\mc L'}(s').\]
	The point is that we can find an open cover $\mc U$ of $X$ which trivializes $\mc L$ and $\mc L'$ simultaneously, where $s\otimes s'$ just becomes the product of two sections, whereupon it is enough to note that $\nu_Y(ss')=\nu_Y(s)+\nu_Y(s')$ for each prime divisor $Y$ and then sum over all $Y$.
\end{remark}
\begin{example}
	By taking $\mc L=\mc L'=\OO_X$ in the prior remark, we see that
	\[\op{div}(ss')=\op{div}s+\op{div}s',\]
	so $\op{div}$ is a homomorphism $K(X)^\times\to\op{Div}X$. In particular, the set of principal divisors is a subgroup of $\op{Div}X$.
\end{example}

\subsection{The Class Group}
Now that we have a subgroup, we can consider the quotient.
\begin{definition}[linearly equivalent]
	Fix a smoothish scheme $X$. Then two Weil divisors $D$ and $D'$ are \textit{linearly equivalent}, denoted $D\sim D'$ if and only if $D-D'$ is a principal divisor. In particular, we define the \textit{class group} $\op{Cl}X$ as the quotient of $\op{Div}(X)$ by the principal divisors, so $D\sim D'$ if and only if $[D]=[D']$ in $\op{Cl}X$.
\end{definition}
\begin{example}
	A Noetherian domain $A$ is a unique factorization domain if and only if $A$ is normal (and hence smoothish by an argument) with $\op{Cl}(\Spec A)=0$. Indeed, under normality hypotheses, commutative algebra shows that to check that $A$ is a unique factorization domain has it enough to check that the codimension $1$ primes of $A$ to be principal, which is exactly what $\op{Cl}(\Spec A)=0$ promises.

	For example,
	\[\op{Cl}\AA^n_k=\op{Cl}(\Spec k[x_1,\ldots,x_n])=0\]
	for any field $k$.
\end{example}
We also recall the following fact from commutative algebra.
\begin{proposition} \label{prop:algebraic-hartogs}
	Fix a normal Noetherian domain $A$. Then
	\[\bigcap_\mf pA_\mf p=A,\]
	where the intersection is over all minimal nonzero primes.
\end{proposition}
\begin{proof}
	Omitted.
\end{proof}
Let's see some applications of \Cref{prop:algebraic-hartogs}.
\begin{corollary}
	If $A$ is a normal Noetherian domain with $X\coloneqq\Spec A$, then we see that $f\in K(X)^\times$ has $\op{div}(f)$ effective if and only if $f\in A$.
\end{corollary}
\begin{proof}
	Having $\nu_Y(f)\ge0$ just means that $f\in A_\mf p$ where $\mf p$ is the prime cutting out $Y$, so the result now follows from \Cref{prop:algebraic-hartogs}.
\end{proof}
We would like to compute $\op{Cl}X$ in some non-affine cases. We will do this by reducing to the affine case, for which we want the following exact sequence.
\begin{proposition} \label{prop:div-exact-seq}
	Fix a smoothish scheme $X$ and a nonempty open subscheme $U\subseteq X$. Setting $Z\coloneqq X\setminus U$, there is an exact sequence
	\[0\to\bigoplus_{\substack{Y\in X^{(1)}\\Y\subseteq Z}}\ZZ[Y]\to\op{Div}X\to\op{Div}U\to0.\]
	Here, the right-hand map is given by $Y\mapsto(Y\cap U)$.
\end{proposition}
\begin{proof}
	Exactness on the left is just the definition of the map on the right: some prime divisor $Y$ vanishes on $\op{Div}U$ if and only if $Y\cap U$ is empty, which is equivalent to $Y\subseteq Z$. Lastly, surjectivity is not so bad: for prime divisor $Y_0$ of $U$, we note that $\ov Y_0$ is a prime divisor of $X$ satisfying $\ov Y_0\cap U=Y_0$ (indeed, these subsets share their unique generic point!).
\end{proof}
\begin{proposition} \label{prop:cl-exact-seq}
	Fix a smoothish scheme $X$ and a nonempty open subscheme $U\subseteq X$, and set $Z\coloneqq X\setminus U$.
	\begin{listalph}
		\item The induced map $\op{Cl}X\to\op{Cl}U$ is surjective.
		\item If $\op{codim}_XZ\ge2$, then the induced map of (a) is an isomorphism.
		\item If $Z$ is a prime divisor of $X$, then the sequence
		\[\ZZ[Z]\to\op{Cl}X\to\op{Cl}U\to0\]
		is exact.
	\end{listalph}
\end{proposition}
\begin{proof}
	Here we go.
	\begin{listalph}
		\item We already know that the map $\op{Div}X\to\op{Div}U$ is surjective, so it remains to check that the principal divisors of $X$ go to principal divisors of $U$. Well, for $f\in K(X)$, we note that $\nu_Y(f)=\nu_{Y\cap U}(f|_U)$ whenever $Y\cap U$ is nonempty because $Y$ and $Y\cap U$ share a generic point; for other $Y\subseteq Z$, the component simply vanishes as $Y\mapsto0$ in $\op{Div}U$ anyway. So $\op{div}(f)$ does go to $\op{div}(f|_U)$.
		\item The point is that every prime divisor $Y$ of $X$ fails to live in $Z$. As such, \Cref{prop:div-exact-seq} produces an isomorphism $\op{Div}X\to\op{Div}U$, and (a) tells us that the principal divisors of $U$ exactly are the principal divisors of $X$.
		\item We already have surjectivity on the left for the map $\op{Cl}X\to\op{Cl}U$, so it remains to show that the kernel of this map is generated by $Z$. Well, any prime divisor of $X$ vanishing in $U$ will arise from $Z$ because $Z$ is a prime divisor, so we are okay.
		\qedhere
	\end{listalph}
\end{proof}

\end{document}