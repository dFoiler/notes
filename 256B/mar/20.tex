% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

We now discuss divisors on curves.

\subsection{Weil Divisors on Curves}
Fix an algebraically closed field $k$ and regular $k$-curve $X$. As such, $X$ is smoothish, and integral codimension $1$ subschemes are just points (indeed, they are dimension $0$), so a divisor is just a linear combination of points.
\begin{definition}[degree]
	Fix a smoothish scheme $X$. Given a Weil divisor $D\coloneqq\sum_{i=1}^nn_i[Y_i]$, we define the \textit{degree} of $D$ as
	\[\deg D\coloneqq\sum_{i=1}^nn_i.\]
	Note that $\deg\colon\op{Div}X\to\ZZ$ is a group homomorphism by definition.
\end{definition}
It will be helpful to understand how degree changes functorially.
\begin{defihelper}[pullback] \nirindex{pullback!Weil divisor}
	Fix an algebraically closed field $k$ and a finite morphism $f\colon X\to Y$ of regular $k$-curves. Then we define the \textit{pullback} $f^*\colon\op{Div}Y\to\op{Div}X$ in the following way. Given a closed point $q\in Y$, we must define $f^*(q)$, which is done by the following recipe: choose a uniformizer $\pi_q$ of the discrete valuation ring $\OO_{Y,q}$, and then we set
	\[f^*(q)\coloneqq\sum_{p\in f^{-1}(\{q\})}\nu_p(\pi_q)p.\]
\end{defihelper}
\begin{remark}
	We note that $f^*$ descends to a map $\op{Cl}Y\to\op{Cl}X$. Indeed, it is enough to show that principal divisors $\op{div}g$ on $Y$ go to principal divisors on $X$. Indeed, we claim that
	\[f^*(\op{div}g)\stackrel?=\op{div}f^*g,\]
	where the right-hand side is viewing $f^*g$ as a rational function in $K(X)^\times$. To see the claim, we compute by hand: if $g$ has a zero/pole of order $n$ at some $q\in Y$ (i.e., $\nu_q(g)=n$), then say $g=\pi_q^n$ at this point, and we see that $(g\circ f)$ will have a zero/pole also of order $n$ at any $p\in f^{-1}(\{q\})$ but now scaled by $\nu_p(\pi_q)$ because $\nu_p(f^*g)=\nu_p(\pi_q^n)=n\nu_p(\pi_q)$. Because any zero/pole of $f^*g$ must come from a zero/pole of $g$, we are done.
\end{remark}
\begin{proposition} \label{prop:pullback-deg}
	Fix an algebraically closed field $k$ and a finite morphism $f\colon X\to Y$ of regular $k$-curves. Then
	\[\deg f^*D=(\deg f)(\deg D).\]
\end{proposition}
\begin{proof}
	By linearity, it suffices to prove this in the case where $D$ is a point $p$. By finiteness of $f$, we may replace $Y$ with an affine open neighborhood $\Spec A$ of $Y$, where $\Spec B=f^{-1}(\Spec A)$ is the pre-image, and now we know that the ring extension $A\to B$ is finite. Further, $f$ is dominant (these are dimension $1$ schemes), so $A\to B$ is injective. Also, an argument similar to \Cref{prop:curve-maps} allows us to say that actually $B$ is the integral closure of $A$ in $K(X)$.

	Now, to get us thinking in commutative algebra, write $\mf p\in\Spec A$ for $p$. Then $f^{-1}(\{p\})$ consists of the nonzero prime ideals $\mf a$ of $B$ with $\mf q\cap A=\mf p$. Setting $S\coloneqq A\setminus\mf p$, we may localize $B$ at $S$ so that $S^{-1}B$ is a semi-local ring with maximal ideals exactly $f^{-1}(\{p\})$. Because $B$ is finite over $A$, we see that, we see $S^{-1}B$ is finite over $S^{-1}A$; notably, $S^{-1}A$ is now a discrete valuation ring and hence a principal ideal domain. So we may let $n$ be the rank of $S^{-1}B$ over $S^{-1}A$. In total, we have built the following diagram.
	% https://q.uiver.app/#q=WzAsNixbMCwxLCJBIl0sWzAsMCwiQiJdLFsxLDEsIlNeey0xfUEiXSxbMSwwLCJTXnstMX1CIl0sWzIsMCwiSyhYKSJdLFsyLDEsIksoWSkiXSxbMCwyLCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzIsNSwiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDEsIiIsMix7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSwzLCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsNCwiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDMsIiIsMSx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbNSw0LCIiLDAseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		B & {S^{-1}B} & {K(X)} \\
		A & {S^{-1}A} & {K(Y)}
		\arrow["\subseteq"{marking, allow upside down}, draw=none, from=2-1, to=2-2]
		\arrow["\subseteq"{marking, allow upside down}, draw=none, from=2-2, to=2-3]
		\arrow[no head, from=2-1, to=1-1]
		\arrow["\subseteq"{marking, allow upside down}, draw=none, from=1-1, to=1-2]
		\arrow["\subseteq"{marking, allow upside down}, draw=none, from=1-2, to=1-3]
		\arrow[no head, from=2-2, to=1-2]
		\arrow[no head, from=2-3, to=1-3]
	\end{tikzcd}\]
	Further localizing will not change our rank, so
	\[\deg f=[K(Y):K(X)]=\op{rank}_{S^{-1}A}S^{-1}B,\]
	which can then be computed by taking the quotient at our maximal ideal as $S^{-1}B/\mf p$. To compute this last rank, we see
	\[S^{-1}B/\mf p\cong\prod_\mf q\OO_{X,\mf q}/\pi_\mf p\OO_{X,\mf p}=\prod_\mf p\OO_{X,\mf p}/\pi_\mf p^{\nu_p(\mf q)}\]
	by the Chinese remainder theorem. So on the right-hand side we are computing $\deg f^*(q)$, and the left-hand side is $\deg f$ as previously discussed, so we are done.
\end{proof}
\begin{corollary}
	Fix an algebraically closed field $k$. For any proper regular $k$-curve $X$, then $\deg\op{div}f=0$ for any rational function $f\in K(X)$.
\end{corollary}
\begin{proof}
	If $f$ is constant, then $\op{div}f=0$, so there is nothing to say. Otherwise, because $k$ is algebraically closed, we see that $f$ is transcendental, so we get a $k$-algebra homomorphism $k(t)\to K(X)$ sending $t\mapsto f$. Now, the adjunction tells us that this produces a rational map $X\to\AA^1_k$, which then extends to a full morphism $X\to\PP^1_k$ where $\op{div}f=\varphi^*(\op{div}t)$ by construction. But $\deg\op{div}t=0$, so the result follows from \Cref{prop:pullback-deg}.
\end{proof}
\begin{remark}
	The above corollary tells us that if $X$ is proper, then $\deg$ descends to a morphism
	\[\deg\colon\op{Cl}X\to\ZZ.\]
\end{remark}
\begin{remark}
	Outside the setting of curves, it does not make sense to pull back Weil divisors in general. But there is a pushforward operation: suppose $f\colon X\to Y$ is a dominant morphism of smoothish schemes of the same dimension. Then any prime divisor $Z$ on $X$ either has $\ov{f(Z)}$ a prime divisor (in which case we'll set $f_*(Z)\coloneqq[K(Z):K(\ov{f(Z)})]\ov{f(Z)}$) or $\ov{f(Z)}$ has higher codimension (in which case we will make $f_*(Z)\coloneqq0$).
\end{remark}

\subsection{Cartier Divisors}
We said that pulling back Weil divisors does not make sense in general. The correct setting to be able to do pullback is Cartier divisors.
\begin{definition}[Cartier divisor]
	Fix an integral scheme $X$. Then the sheaf $\mc K^\times$ of quotients denotes the constant sheaf $K(X)^\times$ on $X$, and the sheaf $\OO_X^\times$ denotes the sheaf of units on $X$. Then a \textit{Cartier divisor} is a global section of the quotient sheaf $\mc K^\times/\mc O_X^\times$. We let $\mathrm{CDiv}(X)$ denote the group of Cartier divisors on $X$.
\end{definition}
\begin{remark} \label{rem:concrete-cartier}
	Let's give a more concrete description of a Cartier divisor. By general nonsense of sheafification, and global section can be defined locally on some Zariski open cover by genuine sections of the presheaf. So a global section of $\mc K^\times/\OO_X^\times$ has equivalent data to an open cover $\mc U$ of $X$ and sections $(f_U)_{U\in\mc U}$ such that $f_U\in\mc K^\times(U)$ which agree on intersections, meaning that $f_U/f_V\in\OO_X^\times(U\cap V)$ for each $U,V\in\mc U$.
\end{remark}

\end{document}