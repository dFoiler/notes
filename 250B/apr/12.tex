% !TEX root = ../notes.tex

We continue.

\subsection{The Hilbert Function}
Today we are discussing the Hilbert--Samuel function and its relation to dimension. Here is the main result for today.
\begin{definition}[Hilbert function]
	Fix a local Noetherian ring $R$ with unique maximal ideal $\mf m$. Let $\kappa:=R/\mf m$ be the residue class field. Then the function
	\[H_R(n):=\dim_\kappa\mf m^n/\mf m^{n+1}\]
	is called the \textit{Hilbert function} of $R$.
\end{definition}
\begin{theorem} \label{thm:hilpoly}
	Fix a local Noetherian ring $R$ with unique maximal ideal $\mf m$. Let $\kappa:=R/\mf m$ be the residue class field. Then the Hilbert function of $R$ agrees with a polynomial $P_R(n)$ for sufficiently large $n$, and $\dim R=1+\deg P_R$.
\end{theorem}
As such, we have the following definition.
\begin{definition}[Hilbert polynomial]
	Fix a local Noetherian ring $R$. Then the polynomial $P_R$ which agrees with the Hilbert function $H_R$ is called the \textit{Hilbert polynomial}.
\end{definition}
\begin{remark}
	If $R$ is not local, then we could get different dimensions out of $H_R(n)$ by various localizations, but we want to talk about $\dim R$ ``globally.'' As such, we need the ring to be local.
\end{remark}
\begin{example}
	Fix $R:=k[x_1,\ldots,x_r]_{(x_1,\ldots,x_r)}$ which has maximal ideal $\mf m:=(x_1,\ldots,x_r)$. Then
	\[H_R(n)=\dim_k\mf m^n/\mf m^{n+1}\]
	Another way to view this computation is by noting $\op{gr}_\mf mR\cong k[x_1,\ldots,x_r]$. As such, we are counting the number of monomials of degree $n$ in $r$ variables, which is
	\[P_R(n):=\binom{n+r-1}{r-1}\]
	by a counting argument: from $n+r-1$ slots, choose $r-1$ dividers, which uniquely determines a tuple of nonnegative integers which sum to $n$. As such, we see that $\deg P_R(n)=r-1=\dim R-1$, which is what we wanted.
\end{example}
\begin{example} \label{ex:dimzerohilpoly}
	If $\dim R=0$, then $R$ is Artinian, so the filtration
	\[\mf m\supseteq\mf m^2\supseteq\mf m^3\supseteq\cdots\]
	must stabilize, so $\mf m^{n+1}=\mf m^n$ for sufficiently large $n$. As such, we see that $H_R(n)=0$ for sufficiently large $n$, so $P_R\equiv0$. As such, we set by convention $\deg P_R=\deg0=-1$ to agree with $\dim R=0$.
\end{example}

\subsection{The Hilbert--Samuel Function}
To prove \autoref{thm:hilpoly}, we work in higher generality. First, we will replace $R$ with a finitely generated module; second, we will replace $\mf m$ by a more arbitrary ideal. To start, recall the following definitions.
\begin{definition}[Krull dimension, modules]
	Fix a finitely generated module $M$ over a Noetherian ring $R$. Then we define the \textit{dimension}
	\[\dim M:=\dim R/\op{Ann}M.\]
\end{definition}
\begin{definition}[Finite colength]
	Fix a finitely generated module $M$ over a Noetherian ring $R$. Then an ideal $\mf q\subseteq R$ is of \textit{finite colength} if and only if $\ell(M/\mf qM)<\infty$.
\end{definition}
For example, if $M$ is a faithful module (i.e., with trivial annihilator), then there exists $d$ such that
\[\mf m^d\subseteq\mf q\subseteq\mf m,\]
where $\mf q$ can be generated by $\dim M$ total elements, by the Principal ideal theorem. More generally, if we first mod out $R$ by $\op{Ann}M$, we can say that
\[\mf m^d\subseteq\mf q+\op{Ann}M\subseteq\mf m.\]
As such, we take the following definition.
\begin{definition}[Hibert--Samuel function]
	Fix a local Noetherian ring $R$ with finitely generated $R$-module $M$ and some prime of finite colength $\mf q$. Then we define the \textit{Hilbert--Samuel function} by
	\[H_{\mf q,M}(n):=\ell\left(\mf q^nM/\mf q^{n+1}\right).\]
\end{definition}
We start by checking that this is well-defined.
\begin{lemma}
	The value $\ell\left(\mf q^nM/\mf q^{n+1}M\right)$ is finite.
\end{lemma}
\begin{proof}
	Without loss of generality, we know immediately that $M$ is faithful (by first modding out by $\op{Ann}M$). We start by noting that $M/\mf qM$ has finite length by hypothesis on $\mf q$. Now, $R/\mf q$ embeds into $\op{End}_R(M/\mf qM)$, the latter of which is finite length because $M/\mf qM$ is of finite length, so we conclude that $R/\mf q$ is of finite length and in particular Artinian. It follows that $\mf q^nM/\mf q^{n+1}M$, which is finitely generated over $R/\mf q$, must also be Artinian and in particular of finite length because everything involved is Noetherian.
\end{proof}
The point is that, provided that our module is faithful, we see that we get to replace $\mf m$ with any ideal containing some power of $\mf m$.
\begin{remark}
	We can replace $R$ with $\op{gr}_\mf qR$ and $M$ with $\op{gr}_\mf qM$.
\end{remark}

\subsection{Finite Differences}
We now have a short digression into finite differences.
\begin{definition}[Discrete derivative]
	Given a function $f:\NN\to\CC$, we define the \textit{discrete derivative}
	\[\delta(f):=f(n+1)-f(n).\]
\end{definition}
We have the following result.
\begin{lemma} \label{lem:findiffs}
	Suppose that we have some $f:\NN\to\CC$ such that $\delta(f)$ is a polynomial of degree $d$, for sufficiently large $n$. Then $f$ is a polynomial of degree $d+1$, for sufficiently large $n$.
\end{lemma}
\begin{proof}
	By shifting, we may assume that $\delta(f)$ is a polynomial of degree $d$. Now, note that the functions
	\[\binom nk\]
	form a basis of the set of polynomials $\NN\to\CC$. In fact,
	\[\delta\left(\binom nk\right)=\binom{n+1}k-\binom nk=\binom{n}{k-1},\]
	so $\delta$ is very well-behaved here. As such, writing
	\[\delta(f)(n)=\sum_{k=0}^da_k\binom nk,\]
	we can use our evaluation of $\delta$ on the binomials to read back the coefficients of $f$.
\end{proof}

\subsection{The Hilbert--Samuel Polynomial}
And so ends our intermission. Here is a proposition.
\begin{proposition} \label{prop:onesideofhilsampoly}
	Fix a finitely generated module $M$ over a local Noetherian ring $R$. Given an ideal $\mf q=(x_1,\ldots,x_r)$ of finite colength on $M$, we have the following.
	\begin{listalph}
		\item The function $H_{\mf q,M}(n)$ agrees with a polynomial $P_{\mf q,M}$ for sufficiently large $n$.
		\item $\deg P_{\mf q,M}\le r$.
	\end{listalph}
\end{proposition}
\begin{proof}
	We induct on $r$. The point is that we can apply an inductive hypothesis to $M/x_1M$ so that $\mf q':=(x_2,\ldots,x_r)$ has finite colength on $M/x_1M$. As such, we have the following exact sequence.
	\[0\to\ker x_1\to M\stackrel{x_1}\to M(1)\to(\coker x_1)(1)\to0.\]
	Notably, we are using $M(1)$ (which is the twist of $M$ by $M(1)_n:=M_{n+1}$) by reducing to the graded case where $\op{gr}_\mf qM\mapsto M$ and $\op{gr}_\mf qR\mapsto R$. Taking the length everywhere in the $n$th component, we find that
	\[H_{\mf q,\ker x_1}(n)-H_{\mf q,M}(n)+H_{\mf q,M(1)}(n)-H_{\mf q,\coker x_1(1)}(n)=0.\]
	Applying the shifting, we see that
	\[\delta(H_{\mf q,M})(n)=H_{\mf q,M}(n+1)-H_{\mf q,M}(n)=H_{\mf q,\coker x_1}(n+1)-H_{\mf q,\ker x_1}(n).\]
	Now, both $\coker x_1=M/x_1M$ and $H_{\mf q,\ker x_1}$ will have degree at most $r-1$ by the inductive hypothesis, so we are done by \autoref{lem:findiffs}.
\end{proof}
To prove \autoref{thm:hilpoly}, we will need to be a little more careful in the above argument. We start by keeping track of the degree in short exact sequences.
\begin{lemma} \label{lem:hilpolyadditive}
	Fix a local Noetherian ring $R$. Given a short exact sequence of finitely generated modules
	\[0\to A\to B\to C\to 0,\]
	Then
	\[P_{\mf q,B}(n)=P_{\mf q,A}(n)+P_{\mf q,C}(n)-F,\]
	where $F$ is some polynomial of degree strictly less than $\deg P_{\mf q,A}(n)$. In fact, the coefficients of $F$ are all positive.
\end{lemma}
\begin{remark}
	The main idea here is to generalize the fact that we get an exact equality when we are looking at just lengths.
\end{remark}
\begin{proof}
	We construct an auxiliary function
	\[L_{\mf q,M}(n):=\ell\left(M/\mf q^nM\right)=\sum_{i=0}^{n-1}H_{\mf q,M}(i)\]
	to more easily keep track of the length in our filtration. In particular, $\delta(L_{\mf q,M})=H_{\mf q,M}$, so $\deg L_{\mf q,M}=1+\deg H_{\mf q,M}$, assuming things are nonzero. Now, we would like to quotient our short exact sequence by $\mf q^nB$, but we cannot do that because that doesn't preserve exactness. So we instead write
	\[0\to (A\cap\mf q^nB)/\mf q^nA\to A/\mf q^nA\to B/\mf q^nB\to C/\mf q^nC\to0.\]
	As such, we see that
	\[L_{\mf q,B}(n)=L_{\mf q,A}(n)+L_{\mf q,C}(n)-\ell\left(\frac{A\cap\mf q^nM}{\mf q^nA}\right).\]
	We would like to understand the object $\frac{A\cap\mf q^nM}{\mf q^nA}$, for which we use the Artin--Rees lemma. Recall the statement.
	\begin{theorem}
		Fix $R$ a Noetherian ring and $I\subseteq R$ an ideal with $M$ a finitely generated $R$-module granted a stable $I$-filtration $\mathcal J$ denoted by
		\[M=M_0\supseteq M_1\supseteq M_2\supseteq\cdots.\]
		Then given a submodule $M'\subseteq M$, the induced filtration by $M_k':=M_k\cap M'$ is also a stable $I$-filtration.
	\end{theorem}
	In particular, we see that the $\mf q$-filtration on $B$ induces a $\mf q$-stable filtration on $A$. In other words, there is an $m$ so that $n\ge m$ will have
	\[A\cap\mf q^nB=\mf q^{n-m}\left(A\cap\mf q^nB\right)=\mf q^{n-m}A,\]
	so the length
	\[\ell\left(\frac{A\cap\mf q^nM}{\mf q^nA}\right)\le L_{\mf q,A}(n)-L_{\mf q,A}(n-m),\]
	which agrees with a polynomial of smaller degree, so we are done because $F$ is a polynomial for free as it is the difference of polynomials.
\end{proof}
And here is our theorem.
\begin{theorem}
	Fix a local Noetherian ring $R$ with unique maximal ideal $\mf m$. Further, take a finitely generated module $M$ and an ideal $\mf q$ of finite colength on $M$. Then
	\[\dim M=1+\deg P_{\mf q,M}.\]
\end{theorem}
\begin{proof}
	The proof, like the original Star Wars, comes in three parts.
	\begin{enumerate}
		\item We show that $\deg P_{\mf q,M}$ does not depend on $\mf q$. Being finite colength means that we can write
		\[\mf m^d\subseteq\mf q+\op{Ann}M\subseteq\mf m\]
		for each $d$. This implies that
		\[H{\mf m,M}(n)\le H_{\mf q,M}(n)\le H{\mf m,M}(dn),\]
		but the Hilbert polynomials on the left and right have the same degree.
		\item We show $1+\deg P_{\mf q,M}\le\dim M$. By modding out by $\op{Ann}M$ everywhere, we may assume that $M$ is faithful, meaning $\dim M=\dim R$. For brevity, set $\dim M:=r$ so that we can choose $\mf q$ so that
		\[\mf m^d\subseteq\mf q\subseteq\mf m\]
		to have $r$ generators, by the Principal ideal theorem. So we are done by \autoref{prop:onesideofhilsampoly}.
		\item We show $1+\deg P_{\mf q,M}\ge\dim M$. Again, modding out by $\op{Ann}M$ everywhere lets us assume that $M$ is faithful, giving $\dim M=\dim R$.

		Now, choose $\mf p$ to be a prime associated to $M$ so that $\dim M=\dim R/\mf p$. In practice, this means that $\mf p$ is minimal over $(0)$ to minimize $\dim R/\mf p$. Now, if $M$ has dimension zero, then we are done by \autoref{ex:dimzerohilpoly}. Otherwise, $\mf q\supsetneq\mf p$, so we may find $x\in\mf q\notin\mf p$.

		Further, note that $x$ can be chosen to not be a zero-divisor, yielding
		\[0\to M\stackrel x\to M\to M/xM\to0.\]
		In particular, \autoref{lem:hilpolyadditive} tells us that
		\[P_{\mf q,M}=P_{\mf q,M}+P_{\mf q,M/xM}-F.\]
		We now appeal to the following lemma to give $\deg P_{\mf q,M/xM}<\deg P_{\mf q,M}\le\dim M$ exactly.
	\end{enumerate}
	\begin{lemma}
		If $M$ is a finitely generated $R$-module with $x\in\mf m$, then
		\[\dim M/xM\ge\dim M-1.\]
	\end{lemma}
	\begin{enumerate}
		\item[] Thus, we get $\deg P_{\mf q,M/xM}=\dim M-1$, so we are done by an induction on $M$, from this last statement.
	\end{enumerate}
	The above steps finish the proof.
\end{proof}
\begin{corollary}
	Fix a local Noetherian ring $R$ and a finitely generated module $M$. Then $\dim M=\dim\widehat M$. In particular, $\dim R=\dim\widehat R$.
\end{corollary}
\begin{proof}
	This follows from the fact that $P_R=P_{\widehat R}$ because $H_R=H_{\widehat R}$ because
	\[\op{gr}_\mf mR=\op{gr}_{\widehat{\mf m}}\widehat R,\]
	so we are done.
\end{proof}

\subsection{An Example}
We close class with an example.
\begin{exe}[Eisenbud 12.2]
	Consider the ideal $I\subseteq k[x,y,z,w]$ generated by the $2\times 2$ minors of
	\[\begin{bmatrix}
		x & y & z \\
		y & z & w
	\end{bmatrix}.\]
	In particular, $I:=\left(xz-y^2,yw-z^2,xw-yz\right)$. We work out the Hilbert polynomial $P_{R,\mf q}$ for $R=k[x,y,z,w]_\mf m/I_\mf m$, where $\mf m=(x,y,z,w)$ and $\mf q=(x,w)$.
\end{exe}
\begin{proof}
	We start by checking that $\mf q$ is in fact of finite colength on $R$. Indeed, we are computing $\ell(R/\mf q)$, in which case (after taking the completion), we find
	\[\ell(R/\mf q)=\ell\left(\widehat{k[y,z]}/\left(y^2,z^2,yz\right)\right)\]
	by sending $z$ and $w$ to $0$. Because we can make three monomials, we see that this length is $3<\infty$.

	So we do indeed have a legitimate Hilbert function $H_{\mf q,R}$. The trick is to inject
	\[R\to\widehat{k[s,t]}\]
	by $x\mapsto s^3$ and $y\mapsto s^2t$ and $z\mapsto st^2$ and $w\mapsto t^3$. We can check that this is an embedding. It follows that the image is all polynomials of degree divisible by $3$, which for sufficiently large $n$ agrees with a polynomial of degree $2$ because we can compute directly as $3m+1$ different monomials of prescribed degree. So our dimension comes out to be $\boxed2$.
\end{proof}