% !TEX root = ../notes.tex

Today we are talking associated primes.

\subsection{Associated Primes}
Fix $M$ an $R$-module. Then given $m\in M$, recall that we can look at
\[\op{Ann}m=\{r\in R:rm=0\}.\]
Observe that $m\ne0$ promises $\op{Ann}m\ne R$ because $1_Rm\ne0$. In particular, these ideals are proper most of the time.

It will turn out to be productive to give require some structure out of these annihilators.
\begin{definition}[Associated primes]
	Fix $M$ an $R$-module. Then a prime ideal $\mf p\in\op{Spec}R$ is \textit{associated to $M$} if and only if $\mf p=\op{Ann}m$ for some $m\in M$. We denote $\op{Ass}M\subseteq\op{Spec}R$ to be the set of all associated primes to $M$.
\end{definition}
As usual, let's see some examples.
\begin{example}
	We have that $\op{Ass}(0)=\emp$ because the annihilator of any element in $(0)$ is $R$ (because all elements are $0$), which is not a prime ideal.
\end{example}
\begin{exe}
	Let $n$ be a nonzero integer. Fix $M:=\ZZ/n\ZZ$ as a $\ZZ$-module. Then $\op{Ass}M=\{(p):\text{prime }p\mid n\}$.
\end{exe}
\begin{proof}
	Let $(p)$ be a prime. Then $(p)$ is associated to $M$ if and only if there exists some $m\in M$ such that
	\[\op{Ann}m=(p).\]
	If $p\mid n$, then we note that $\op{Ann}\left[\frac np\right]_n=(p)$ because $n\mid\frac np\cdot k$ if and only if $p\mid k$. Thus, $\{(p):\text{prime }p\mid n\}\subseteq\op{Ass}M$.
	
	Conversely, if $\op{Ann}m=:(p)$ is prime, then we see that we have a $\ZZ$-module map $\varphi:\ZZ\to\ZZ/n\ZZ$ by $r\mapsto rm$, which has kernel $\op{Ann}m=(p)$. Namely, we have an injection
	\[\ZZ/p\ZZ\into\ZZ/n\ZZ,\]
	so $p\mid n$ by Lagrange's theorem on groups.
\end{proof}
We can generalize the trick at the end of the proof to give the following characterization of associated primes; this characterization will be easier to use for more element-free proofs.
\begin{lemma} \label{lem:betterassociated}
	Fix $M$ an $R$-module. Then a prime $\mf p\in\op{Spec}R$ is associated to $M$ if and only if there is an injective $R$-module homomorphism $R/\mf p\into M$.
\end{lemma}
\begin{proof}
	We take the directions separately.
	\begin{itemize}
		\item Suppose that $\mf p$ is associated to $M$. Then there exists $m\in M$ such that $\mf p=\op{Ann}m$, so we consider the map $\varphi:R\to M$ by
		\[\varphi:r\mapsto rm\]
		If $r_1,r_2\in R$ and $x_1,x_2\in R$, then $\varphi(r_1x_1+r_2x_2)=r_1x_1m+r_2x_2m=r_1\varphi(x_1)+r_2\varphi(x_2)$, so $\varphi$ is indeed an $R$-linear map. Then, by definition of $\op{Ann}m$ we see that $\mf p=\op{Ann}m=\ker\varphi$, so there is an induced injection
		\[\overline\varphi:R/\mf p\into M,\]
		which is what we wanted.
		\item Suppose that there is an embedding $\varphi:R/\mf p\into M$. Then define $m:=\varphi([1]_\mf p)$. Now, $rm=0$ if and only if $r\varphi([1]_\mf p)=\varphi([r]_\mf p)$ is equal to $0=\varphi([0]_\mf p)$, so $rm=0$ is equvalent to $r\in\mf p$. Thus, $\op{Ann}m=\mf p$, as desired.
		\qedhere
	\end{itemize}
\end{proof}
\begin{remark}[Nir]
	The embedding
	\[\frac{\QQ[x]}{(x-2)}\cong\QQ\cong\frac{\QQ[x]}{(x)}\]
	does not mean that $(x-2)$ is an associated prime of $\QQ[x]/(x)$ because the above embedding is of $\QQ$-modules, not $\QQ[x]$-modules. Explicitly, $[x]_{(x-2)}$ goes to $2$ goes to $[2]_{(x)}$, but $x\cdot[1]_{(x-2)}$ goes to $x\cdot1$ goes to $x\cdot[1]_{(x)}=[0]_{(x)}$.
\end{remark}
We close our introduction with another example.
\begin{example}
	Fix $\mf p\subseteq R$ a prime ideal and fix $M:=R/\mf p$. Certainly $\mf p\in\op{Ass}M$ because $\op{Ann}[1]_\mf p=\mf p$. (Alternatively, use \autoref{lem:betterassociated} and note $R/\mf p\into R/\mf p=M$.) Conversely, fix some $b\in R\setminus\mf p$, and we want to know what primes can arise as
	\[\op{Ann}([b]_\mf p)=\{a\in R:ab\in\mf p\}.\]
	But with $b\notin\mf p$, the primality of $\mf p$ means that $ab\in\mf p$ implies $a\in\mf p$. (And conversely, $a\in\mf p$ implies $ab\in\mf p$.) So $\op{Ann}([b]_\mf p)=\mf p$ for any $b\notin\mf p$, so $\op{Ass}M=\{\mf p\}$.
\end{example}
So indeed, any prime of $R$ can arise as an associated prime.

\subsection{Associated Primes in Localization}
In the spirit of the above example, we have the following proposition.
\begin{proposition} \label{prop:generateass}
	Fix $M$ an $R$-module. Suppose $\mf p\subseteq R$ is an ideal maximal in
	\[\mathcal P:=\{\op{Ann}m:m\in M\setminus\{0\}\}.\]
	Then we claim $\mf p$ is prime.
\end{proposition}
\begin{proof}
	% Because $\mf p\in\mathcal P$, we can say $\mf p=\op{Ann}m$, so we have a natural map
	% \[\varphi:R/\mf p\into M\]
	% by $\varphi:[r]_\mf p\mapsto rm$. (This is the same map that appears in \autoref{lem:betterassociated}.)
	Now take $ab\in\mf p$ and $a\notin\mf p$, and we show that $ab\notin I$ implies $b\in I$. Well, $ab\in\mf p$ implies that $a(bm)=(ab)m=0$, so $a\in\op{Ann}bm$. But certainly any $x\in\mf p$ will have
	\[x(bm)=b(xm)=0,\]
	so $x\in\op{Ann}bm$, so $\mf p\subseteq\op{Ann}bm$. However, we now see that $\op{Ann}bm$ is an annihilator strictly containing $\mf p$ (because $a\in\op{Ann}bm\setminus\mf p$). This looks like a contradiction, but it is not: instead we merely must have $bm=0$, which means $b\in\mf p$.
\end{proof}
We have the following corollary.
\begin{corollary}
	Fix $R$ a Noetherian ring and $M$ a nonzero $R$-module. Then $\op{Ass}M$ is nonempty.
\end{corollary}
\begin{proof}
	As in \autoref{prop:generateass}, set
	\[\mathcal P:=\{\op{Ann}m:m\in M\setminus\{0\}\}.\]
	Because $R$ is Noetherian, $\mathcal P$ will contain a maximal element, which will be a prime $\mf p=\op{Ann}m$ for some $m\in M$. So $\mf p\in\op{Ass}M$, meaning $\op{Ass}M\ne\emp$.
\end{proof}
\begin{remark}[Nir]
	It is possible to have a nonzero module with no associated primes; we follow the example given in \href{https://math.stackexchange.com/a/3365952/869257}{sx2931719}. Consider $R:=C(\RR,\RR)$ the ring of continuous functions $\RR\to\RR$ as a module over itself. Fix any $f\in R\setminus\{0\}$, and we show $\op{Ann}f$ is not prime.

	Because $f\ne0$, find $a\in\RR$ such that $f(a)\ne0$, and by contuity some $b>a$ close to $a$ also has $f(b)\ne0$. (Here we use continuity of $f$.) Then set $m:=\frac{a+b}2$ and
	\[g(x)=\begin{cases}
		(x-m)^2 & x \le m, \\
		0 & x \ge m,
	\end{cases}\qquad\text{and}\qquad h(x)=\begin{cases}
		0 & x \le m, \\
		(x-m)^2 & x \ge m.
	\end{cases}\]
	Then $g,h\in C(\RR,\RR)$ and $gh=0\in\op{Ann}f$. However, $(gf)(a)\ne0$ an $(hf)(b)\ne0$, so $g,h\notin\op{Ann}f$.
\end{remark}

\begin{remark}
	For the sake of comparison, let's compare $\op{Supp}M$ with $\op{Ass}M$. For example, when $R$ is a domain, then $\op{Ass}_RR=\{(0)\}$ by the integral domain condition. However, the support $\op{Supp}R=\op{Spec}R$, so the associated primes appear smaller.
\end{remark}
Indeed, we will find that the associated primes will be smaller than $\op{Supp}M$.

Localization was able to tell us about maps by looking locally everywhere: an element was $0$ if and only if zero on all localizations. However, it turns out that we can limit what we have to focus on.
\begin{proposition} \label{prop:localassprimes}
	Fix $R$ Noetherian and $M$ an $R$-module. Then, given $m\in M$, we have $m=0$ if and only if $\frac m1=0$ in $M_\mf p$ for each $\mf p\in\op{Ass}M$.
\end{proposition}	
\begin{proof}
	The forwards direction here is easy: if $m=0$, then $\frac m1=\frac01=0$ in $M_\mf p$ for any prime $\mf p$ and therefore for any prime $\mf p\in\op{Ass}M$.

	In the other direction, suppose $m\ne0$, and we need to find an associated prime $\mf p\in\op{Ass}M$ for which $\frac m1\ne0$ in $M_\mf p$. But we note that $\frac m1=\frac01$ in $M_\mf p$ if and only if there exists $u\in M\setminus\mf p$ such that $um=0$ if and only if $(M\setminus\mf p)\cap\op{Ann}m\ne\emp$ if and only if
	\[\op{Ann}m\not\subseteq\mf p.\]
	So our goal is to construct an associated prime $\mf p$ such that $\op{Ann}m\subseteq\mf p$.
	
	The main idea is to use \autoref{prop:generateass} to give us our ptime. We set
	\[\mathcal P_m:=\{\op{Ann}m':\op{Ann}m'\supseteq\op{Ann}m\text{ and }m'\ne0\}.\]
	Note that $\mathcal P_m$ is nonempty because $\op{Ann}m\in\mathcal P_m$, so $\mathcal P_m$ will have a maximal element nameed $\mf p$. (Here we are using the condition that $R$ is Noetherian.) We now note that $\mf p$ is also maximal in
	\[\mathcal P:=\{\op{Ann}m':m'\ne0\}.\]
	Indeed, if $\mf p\subseteq\op{Ann}m'$, then $\op{Ann}m\subseteq\op{Ann}m'$, so $\op{Ann}m'\in\mathcal P_m$, so $\mf p=\op{Ann}m'$ by maximality of $\mf p$. It follows from \autoref{prop:generateass} that $\mf p$ is indeed prime, so it is an associated prime containing $\op{Ann}m$.
\end{proof}
Here are some corollaries.
\begin{corollary} \label{cor:localasssubmod}
	Fix $R$ Noetherian and $M$ an $R$-module. Then a submodule $N\subseteq M$ has $N=0$ if and only if $N_\mf p=0$ for each $\mf p\in\op{Ass}M$.
\end{corollary}
\begin{proof}
	Again, in the forwards direction, note that $N=0$ implies $N_\mf p=0$ for each prime $\mf p$.

	In the reverse direction, suppose that $N_\mf p=0$ for each $\mf p\in\op{Ass}M$. Then any $m\in N$ has $\frac m1=0$ in $N_\mf p$ for each $\mf p\in\op{Ass}M$, but this means that there exists $u\in R\setminus\mf p$ such that $um=0$, which also holds in $M_\mf p$. This is to say that $\frac m1=0$ in $M_\mf p$ for each $\mf p\in\op{Ass}M$, so $m=0$ by \autoref{prop:localassprimes}.
\end{proof}
\begin{corollary}
	Fix $R$ Noetherian and $M,N$ as $R$-modules. Then a map $\varphi:M\to N$ is injective if and only if $\varphi:M_\mf p\to N_\mf p$ is injective if and only if $\mf p\in\op{Ass}M$.
\end{corollary}
\begin{proof}
	By \autoref{cor:localasssubmod}, $\ker\varphi\subseteq M$ vanishes if and only if $(\ker\varphi)_\mf p=0$ for each $\mf p\in\op{Ass}M$. But $(\ker\varphi)_\mf p=\ker\varphi_\mf p$ by \autoref{cor:localizekercoker}, so $\ker\varphi=0$ if and only if $\ker\varphi_\mf p$ for each $\mf p\in\op{Ass}M$, which is what we wanted.
\end{proof}

\subsection{Finding All Associated Primes}
Let's try as hard as we can to find all associated primes. To start, we note that associated primes also behave in short exact sequences, somewhat.
\begin{lemma} \label{lem:assses}
	Suppose
	\[0\to A\to B\to C\to 0\]
	is a short exact sequence of $R$-modules. Then $\op{Ass}A\subseteq\op{Ass}B\subseteq\op{Ass}A\cup\op{Ass}C$.
\end{lemma}
\begin{proof}
	Denote our morphisms by
	\[\to A\stackrel\iota\to B\stackrel\pi\to C\to 0.\]
	We have that $\op{Ass}A\subseteq\op{Ass}B$ because any annihilator in $A$ will end up being any annihilator in $B$ as well. We note that any $a\in A$ has
	\[\op{Ann}\iota(a)=\{r\in R:r\iota(a)=0\}=\{r\in R:\iota(ra)=0\}\stackrel*=\{r\in R:ra=0\}=\op{Ann}a,\]
	where in $\stackrel*=$ we have used the injectivity of $\iota$. So any associated prime $\mf p=\op{Ann}a$ of $A$ will also be an associated prime $\mf p=\op{Ann}\iota(a)$ of $B$.
	\begin{remark}[Nir]
		Alternatively, any associated prime $\mf p\in\op{Ass}A$ induces an $R$-embedding $R/\mf p\into A$ (by \autoref{lem:betterassociated}). Post-composing with $\iota$ gives an $R$-embedding $R/\mf p\into B$, so \autoref{lem:betterassociated} gives $\mf p\in\op{Ass}B$.
	\end{remark}

	It remains to show $\op{Ass}B\subseteq\op{Ass}A\cup\op{Ass}C$. Well, suppose $\mf p\in\op{Ass}B\setminus\op{Ass}A$, and we show that $\mf p\in\op{Ass}C$. Namely, we can find $b\in B$ such that
	\[\op{Ann}b=\mf p.\]
	To make some of our language easier, we note that this $b\in B$ induces $f:R/\mf p\into B$ by $f:[r]_\mf p\mapsto rb$ (as in \autoref{lem:betterassociated}); note $\im f=Rb$. It will be enough to show that $\pi f:R/\mf p\to C$ is injective to show that $\mf p\in\op{Ass}C$ by \autoref{lem:betterassociated}.
	
	We compute
	\[\ker(\pi f)=\{[r]_\mf p\in R/\mf p:\pi f([r]_\mf p)=0\}=\{[r]_\mf p\in R/\mf p:rb\in\ker\pi=\im\iota\}.\]
	In particular, because $f:R/\mf p\to Rb$ is an isomorphism, $\ker(\pi f)$ will vanish if and only if each $rb\in Rb$ with $rb\in\im\iota$ has $rb=0$. That is, we want to show that
	\[Rb\cap\im\iota\stackrel?=\{0\}.\]
	Indeed, each $rb\in Rb\setminus\{0\}$ (so that $r\notin\mf p$) has $s\in\op{Ann}rb$ if and only if $sr\in\mf p$ if and only if $s\in\mf p$, so any nontrivial intersection above would induce an annihilator $\mf p\in\op{Ass}A$, which we assumed is not the case.
\end{proof}
\begin{corollary} \label{cor:dirsumass}
	Suppose $B=A\oplus C$ as $R$-modules. Then $\op{Ass}B=\op{Ass}A\cup\op{Ass}C$.
\end{corollary}
\begin{proof}
	Note the split short exact sequences
	\[0\to A\to B\to C\to 0\]
	and
	\[0\to C\to B\to A\to 0\]
	give that $\op{Ass}A,\op{Ass}C\subseteq\op{Ass}B$ by \autoref{lem:assses}. In particular, $\op{Ass}A\cup\op{Ass}C\subseteq\op{Ass}B$, but \autoref{lem:assses} implies $\op{Ass}B\subseteq\op{Ass}A\cup\op{Ass}C$ already, so equality follows.
\end{proof}

Let's build towards the statement that the associated primes are finite. Before this, let's do an example.
\begin{ex}
	We work with $\ZZ$-modules. Then $\op{Ass}\ZZ=\{(0)\}$ and $\op{Ass}\ZZ/p^\bullet\ZZ=\{(p)\}$. Then from here we can build all finitely generated abelian groups as a direct sum of these and get our associated primes by \autoref{cor:dirsumass}.
\end{ex}
Now here is our main lemma.
\begin{lemma} \label{lem:fingenfiltration}
	Fix $M$ a finitely generated module over a Noetherian ring $R$. Then $M$ has a finite filtration
	\[0=:M_0\subseteq M_1\subseteq\cdots\subseteq M_n=M\]
	such that each quotient $M_{k+1}/M_k\cong R/\mf p_k$ for some prime ideals $\{\mf p_k\}_{k=0}^{n-1}$.
\end{lemma}
\begin{proof}
	Because $R$ is Noetherian, $\op{Ass}M$ is nonempty. So find some $\mf p_0=\op{Ann}m_0$ and set $M_1:=Rm_1\cong R/\mf p_1$. Then we can continue this process to $M/M_1$ and pull back along the projection to get $M_2$. This gives us an ascending chain of $R$-submodules
	\[M_0\subseteq M_1\subseteq\cdots,\]
	which must eventually terminate because $M$ is Noetherian (as it is finitely generated over $R$).
\end{proof}
\begin{theorem}
	Fix $M$ a finitely generated module over a Noetherian ring $R$. The following are true.
	\begin{listalph}
		\item If $M$ is nonzero, then $\op{Ass}M$ is finite.
		\item Fix $U\subseteq R$ a multiplicatively closed subset. Then we have that
		\[\op{Ass}_{R\left[U^{-1}\right]}M\left[U^{-1}\right]=\{\mf p\left[U^{-1}\right]:\mf p\in\op{Ass}M,\mf p\cap U=\emp\}.\]

		(Recall that $\op{Spec}R\left[U^{-1}\right]$ consists of localizations of primes of $R$.)
		\item We have that
		\[\bigcup_{\mf p\in\op{Ass}M}\mf p=\bigcup_{m\in M\setminus\{0\}}\op{Ann}m.\]
		\item If $\mf p$ is a minimal prime ideal containing $\op{Ann}M$, then $\mf p\in\op{Ass}M$.
	\end{listalph}
\end{theorem}
\begin{proof}
	Here we go.
	\begin{listalph}
		\item Decompose the filtration for $M$ from \autoref{lem:fingenfiltration} and use \autoref{lem:assses} to upper-bound $\op{Ass}M$. In particular, if the factors of the filtration as $R/\mf p_k$ for primes $\{\mf p_k\}_{k=0}^{n-1}$, then
		\[\op{Ass}M\subseteq\{\mf p_0,\ldots,\mf p_{n-1}\}.\]
		\item In one direction, suppose that $\mf p\in\op{Ass}M$ and $\mf p\cap U=\emp$. We already know that $\mf p\left[U^{-1}\right]$ is prime. Because $\mf p\in\op{Ass}M$, we are promised some $m\in M$ such that
		\[R/\mf p\cong Rm\subseteq M,\]
		so localization provides an injection $R\left[U^{-1}\right]/\mf p\left[U^{-1}\right]\into M\left[U^{-1}\right]$, which can again be read off to be an associated prime. % \todo{it looks like this is the "real condition" for associated prime}

		In the other direction, suppose that $\mf p\left[U^{-1}\right]\in\op{Ass}_{R\left[U^{-1}\right]}M\left[U^{-1}\right]$, so we are promised some injection
		\[\varphi:R\left[U^{-1}\right]/\mf p\left[U^{-1}\right]\into M\left[U^{-1}\right].\]
		Here is the key trick: because everything here is finitely generated and in particular finitely presented, we get an isomorphism
		\[\op{Hom}_{R\left[U^{-1}\right]}\left(R\left[U^{-1}\right]/\mf p\left[U^{-1}\right],M\left[U^{-1}\right]\right)\cong\op{Hom}_R(R/\mf p)\left[U^{-1}\right].\]
		So we are promised some $\widetilde\varphi=\frac\psi u$ where $\psi:R/\mf p\to M$ and for some $u\in U$. But because $\varphi$ was an injection, $\widetilde\varphi$ will be an injection, so $\psi$ will be an injection, and we do get that $\mf p$ is an associated prime.
		\item In oe direction, suppose that $a\in\op{Ann}m$. Then we can choose $\mf p$ to be the ideal maximal among all annihilators connecting $\op{Ann}m$, which makes $\mf p$ an associated prime by \autoref{prop:generateass}. So $a\in\mf p$ here.
		\item We leave this as an exercise. The main idea is to localize at $\mf p$ so that $\op{Ass}M_\mf p$ is $\{\mf p_\mf p\}$.
		\qedhere
	\end{listalph}
\end{proof}
\begin{quot}
	I hope you see how powerful this idea is, of localization.
\end{quot}
\begin{corollary}
	Fix $M$ a finitely generated module over a Noetherian ring $R$, and fix any ideal $J\subseteq R$ and $m\in M$. Then $J\subseteq\op{Ann}m$ (for some $m\notin M$) or there exists $a\in J$ such that $am=0$ implies $m=0$ for each $m\in M$.
\end{corollary}
\begin{proof}
	The idea is to use (c) of the theorem. If every $a\in J$ annihilates some nonzero element of $M$, then
	\[J\subseteq\bigcup_{m\in M\setminus\{0\}}\op{Ann}m=\bigcup_{\mf p\in\op{Ass}M}\mf p.\]
	We claim that $J\subseteq\mf p$ for some $\mf p\in\op{Ass}M$; otherwise, we can find $x_i\in\mf p_j\setminus J$ for each $\mf p_i\ne\mf p_i$ while $x_i\in\mf p_i$, for which $x_1+x_2+\cdots+x_n$ will not lie in any prime ideal.
\end{proof}

\subsection{Motivating Primay Decomposition}
Let's give some motivational remarks for the primary decomposition. As an example, we consider $\ZZ$, where it happens that
\[(m)\cap(n)=(mn)=(m)(n).\]
This is a very nice property to have, with respect to proving unique prime factorization and such. Namely, to state unique prime factorization, we call an ideal ``primary'' if it is the power of some prime ideal, and then we see that any ideal $I$ is the intersection of finitely many ``primary'' ideals.

We will try to generalize this. Here is our definition of ``primary.''
\begin{definition}[\texorpdfstring{$\mf p$}{p}-primary]
	Fix $\mf p\in\op{Spec}R$ a prime ideal and $R$-modules $N\subseteq M$. Then $N$ is a \textit{$\mf p$-primary} submodule of $M$ if and only if
	\[\op{Ass}M/N=\{\mf p\}.\]
\end{definition}
\begin{example}
	The ideals $\left(p^\bullet\right)$ are $p$-primary in $\ZZ$.
\end{example}
\begin{example}
	Any prime ideal $\mf p$ is $\mf p$-primary in $R$ because $\op{Ass}(R/\mf p)=\{\mf p\}$.
\end{example}
Let's prove one nice lemma to finish off today.
\begin{lemma}
	Fix $N_1,\ldots,N_m$ a finite collection of $\mf p$-primary submodules of an $R$-module $M$. Then
	\[\bigcap_{k=1}^nN_k\]
	is also $\mf p$-primary.
\end{lemma}
\begin{proof}
	By induction, it suffices to show the result for $m=2$ so that we want to show $N_1\cap N_2$ is $\mf p$-primary. Now, we have the right-exact sequence
	\[0\to N_1\cap N_2\to M\to\frac M{N_1}\oplus\frac M{N_2},\]
	which tells us that $\frac M{N_1\cap N_2}$ is a submodule of $\frac M{N_1}\oplus\frac M{N_2}$. But then
	\[\op{Ass}\frac M{N_1\cap N_2}\subseteq\op{Ass}M/N_1\cup\op{Ass}M/N_2=\{\mf p\},\]
	so we are done.
\end{proof}
And we close by stating the theorem.
\begin{theorem}
	Any finitely generated module $M$ over a Noetherian ring $R$ is an intersection of finitely many primary submodules.
\end{theorem}