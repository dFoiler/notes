% !TEX root = ../notes.tex

We will finish up homological algebra today by talking more about flatness. We will then shift over to talk about completions.

\subsection{A Criterion for Flatness}
Let's review the following result.
\flatcondition*
\begin{proof}
	We proceed with the following steps.
	\begin{enumerate}
		\item From the long exact sequence of $\op{Tor}$, the injectivity of $I\otimes M\to M$ is equivalent to
		\[\op{Tor}_1^R(R/I,M)=0\]
		for all finitely generated ideals $I$. In particular, we use the short exact sequence
		\[0\to I\to R\to R/I\to 0\]
		and consider the long exact sequence we get upon applying $-\otimes_RM$.
		\item We extend to all ideals $I=(x_\alpha)_{\alpha\in\lambda}$. Well, if we have a nontrivial element $x\otimes m$ of the kernel of $I\otimes M\to M$, then we can write
		\[x=\sum_{i=1}^nr_ix_{\alpha_i}\otimes m,\]
		because $x$ only uses finitely many of the $x_\alpha$, so we see that the finitely generated (!) ideal $(x_{\alpha_1},\ldots,x_{\alpha_n})$ will also have a kernel.
		\item We reduce checking that, for all submodule $N'\into N$, we have that $M\otimes_RN'\into M\otimes_RN$, to the case where $N$ is finitely generated. Well, if there is a nontrivial kernel, then we write a nontrivial element of the kernel as
		\[\sum_{i=1}^nm_i\otimes n_i'\mapsto0,\]
		so the same trick lets us assume that both $M$ and $N'$ are finitely generated.

		\item We would like to check that $\op{Tor}_1^R(M,N)=0$ for finitely generated $N$. Well, let $n$ be the minimal number of generators for $N$. For $n=0$, we have $N=0$ and are done. For $n=1$, we use step 1. Then for our induction, we write
		\[0\to N''\to N\to N'\to0\]
		where $N''$ and $N'$ have fewer than $n$ generators. Then the long exact sequence tells us that
		\[\op{Tor}_1^R(M,N'')\to\op{Tor}_1^R(M,N)\to\op{Tor}_1^R(M,N)\]
		is exact, so the induction forces the left and right terms to vanish, so $\op{Tor}_1^R(M,N)=0$.
		\qedhere
	\end{enumerate}
\end{proof}
Let's see some example.
\begin{exe}
	Set $R:=k[x]/\left(x^2\right)$. We show that an $R$-module $M$ is flat if and only if $M$ is free.
\end{exe}
\begin{proof}
	We use \autoref{thm:flatcondition}. Certainly if $I=R$ or $I=0$ we are done. The only other ideal to check is $(x)$, so we just need to verify that
	\[(x)M\to M\]
	is injective. In particular, we need to check that $\ker(x)/\im(x)=0$, which amounts to verifying that $M$ is free because $x$ is the only element that could provide us with a kernel.
\end{proof}
\begin{remark}[Serganova]
	In fact, we can show that any $R$-module $M$ can be written as $M_0\oplus F$ where $M_0\cong\ker(x)/\im(x)$ and $F$ is free.
\end{remark}
\begin{exe}
	Fix $R$ a principal ideal domain. Then an $R$-module $M$ is flat if and only if $M$ is torsion-free.
\end{exe}
\begin{proof}
	All ideals take the form $(a)$, but $(a)\cong R$ because $R$ is a principal ideal domain, so we are merely verifying that the map $R\otimes_RM\to M$ is injective, which is true if and only if $M$ is torsion free.
\end{proof}
\begin{example}
	If a $\ZZ$-module $M$ is finitely generated and torsion free, then $M$ must actually be free. Also, $\QQ$ is torsion free and hence flat.
\end{example}

\subsection{Flatness Locally}
We note the following.
\begin{lemma}
	Fix $R$ a ring and $\mf p$ a prime. If $M$ is a flat $R$-module, then $M_\mf p$ is a flat $R_\mf p$-module.
\end{lemma}
\begin{proof}
	Use the $\op{Tor}$ condition for flatness and note that $R_\mf p$ being flat allows us to simply tensor in the projective resolution for $M$ to give a projective resolution for $M_\mf p$. Alternatively, simply note that $R_\mf p\otimes_RM$ is the tensor product of two flat modules.
\end{proof}
We might hope the converse holds. Indeed, it does.
\begin{proposition}
	Fix $R$ a ring and $M$ an $R$-module. If $M_\mf p$ is flat for all primes $\mf p$, then $M$ is also flat.
\end{proposition}
\begin{proof}
	Well, fix some inclusion $N\subseteq N'$ so that we want to show that
	\[M\otimes_R N'\to M\otimes_RN\]
	is also an inclusion. Well, we know that, upon localization, we have an inclusion
	\[M_\mf p\otimes_{R_\mf p}N'_\mf p\to M_\mf p\otimes_{R_\mf p}N_\mf p,\]
	so because this is an inclusion locally, it becomes an inclusion globally as we showed a while ago.
\end{proof}
So we are motivated to study how flat modules behave under localization.
\begin{prop}
	Fix $R$ a local ring with maximal ideal $\mf p$. Further, let $M$ be a finitely presented $R$-module. If $M$ is flat, then $M$ is free.
\end{prop}
\begin{proof}
	The idea is to use Nakayama's lemma. Because $M$ is finitely presented, we can build a short exact sequence
	\[0\to N\to F\to M\to 0,\]
	where $N$ is finitely generated, and $F$ is free. Upon tensoring with $R/\mf p$, we get the right-exact sequence
	\[N/\mf pN\to F/\mf pF\to M/\mf pM\to 0.\]
	Now, choose $F$ such that $\dim F/\mf pF=\dim M/\mf pM$, for otherwise we could use Nakayama's lemma to generate $F$ by fewer (namely, $\dim F/\mf pF$ many) elements.
	
	It follows that $N/\mf pN$ must vanish, so because $N$ is finitely generated, Nakayama's lemma promises that $N=0$. Thus, $F=M$, so $M$ is free, so we are done.
\end{proof}
\begin{remark}
	In fact, any projective module over a local ring is free. The case for finitely generated modules is on the homework. The homework also includes some examples of flatness checks.
\end{remark}