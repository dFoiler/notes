% !TEX root = ../notes.tex

Welcome back everyone. The average and median for the exam was 32/50.

\subsection{Krull's Intersection Theorem}
Last time we showed the following.
\krullintersectii*
\noindent The Noetherian condition is necessary here; consider the following example.
\begin{exe}
	Let $R$ consist of the ring of germs of infinitely differentiable functions $f:\RR\to\RR$ at $0$. Namely, two functions $f,g:\RR\to\RR$ are equivalent in $R$ if and only if they coincide on an open neighborhood around $0$. Then $R$ is local with unique maximal ideal
	\[\mf m:=\{f\in R:f(0)=0\}.\]
	However,
	\[\bigcap_{s\ge0}\mf m^s\]
	is nonzero.
\end{exe}
\begin{proof}
	We start with the checks on $R$.
	\begin{itemize}
		\item We describe how to check that $R$ is actually a ring, but we will not do so. To begin, the set of infinitely differentiable functions $C^\infty(\RR)$ is a ring with addition and multiplicative defined pointwise; e.g., our identity is $f\equiv1$. Then we define the ideal
		\[I=\{f:f(x)=0\text{ for all }x\in U\text{ for some open }U\text{ containing }0\}.\]
		It is not hard to check that $I$ is an ideal: if $f,g\in I$ and $r,s\in C^\infty(\RR)$ with $f|_U=0$ and $g|_V=0$ where $0\in U\cap V$, then $(rf+sg)|_{U\cap V}=0$.

		Now, we simply define $R:=C^\infty(\RR)/I$. In particular, $[f]_I=[g]_I$ for $f,g\in C^\infty(\RR)$ if and only if $(f-g)$ vanishes on some neighborhood $U$ of $0$, which is equivalent to $f$ and $g$ agreeing on some neighborhood $U$ of $0$.

		\item We check that $R$ is local with the given maximal ideal $\mf m$. For this, we show that all elements outside $\mf m$ are units, which will be enough because it will show that any proper ideal (which only contains non-units) is contained in $\mf m$.

		Indeed, pick up some $u\notin\mf m$ so that $u(0)\ne1$. Because $u$ is continuous, $u(\RR\setminus\{0\})$ is open and contains $0$, so there exists an $\varepsilon>0$ such that $u$ is nonzero on the compact set $[-\varepsilon,\varepsilon]$. Then $1/u$ is an infinitely differentiable function $v$ on $(-\varepsilon,\varepsilon)$, which we can then extend to a function in $C^\infty(\RR)$.\footnote{I think some kind of uniformity condition is needed here to make sure that $1/u$ can be extended as claimed, but I won't bother making this rigorous.} So indeed, $uv$ agrees with the function $1$ on $(-\varepsilon,\varepsilon)$, so $uv\equiv1\pmod I$.
	\end{itemize}
	It remains to check that
	\[\bigcap_{s\ge0}\mf m^s\ne0.\]
	Indeed, set, for given $m$,
	\[g_m(x):=\begin{cases}
		e^{-1/x^2}/x^m & x\ne0, \\
		0 & x=0.
	\end{cases}\]
	An induction shows that, on $\RR\setminus\{0\}$, we have $g_m^{(n)}(x)=p_n(1/x)e^{-1/x^2}$ some $p_n\in\QQ[x]$, for any $n\ge0$. Indeed, it holds for $n=0$ by taking $p_0(x)=x^m$, and the inductive step merely needs to write
	\[g_m^{(n+1)}(x)=\frac d{dx}g_m^{(n)}(x)=\frac d{dx}p_n(1/x)e^{-1/x^2}=\underbrace{\left(p_n'\left(\frac1x\right)\cdot-\frac1{x^2}+\frac{-2}{x^3}\right)}_{p_{n+1}(1/x)}e^{-1/x^2}.\]
	Thus, we can show by induction that $g^{(n)}_m(0)=0$ for each $0$. We get $n=0$ for free, and otherwise, we compute
	\[g_m^{(n+1)}(0)=\lim_{x\to0}\frac{g_m^{(n)}(x)-g_m^{(n)}(0)}x=\lim_{h\to0}\left(\frac{p_n(1/x)}x\cdot e^{-1/x^2}\right)=\lim_{x\to\pm\infty}\frac{xp_n(x)}{e^{-x^2}},\]
	which vanishes no matter which $\pm\infty$ we approach. So in total, we see that $g\in C^\infty(\RR)$, so it will produce a legal germ at $0$.
	
	It follows that $e^{-1/x^2}/x^m=g_m(x)\in C^\infty(\RR)$ for each $m$. To finish, we see that
	\[e^{-1/x^2}=x^m\cdot e^{-1/x^2}/x^m\in\mf m^mC^\infty(\RR)\subseteq\mf m^m\]
	for any $m$, which is what we wanted.
\end{proof}
\begin{remark}[Nir]
	The finite generation is also necessary: the module $M=\QQ$ over the integral domain $R=\ZZ$ has $I=(2)\subseteq\ZZ$ a proper ideal while $IM=(2)\QQ=\QQ$ so that $\bigcap_sI^sM=M$. We are essentially detecting a counterexample to Nakayama's lemma here.
\end{remark}
% Finitely generated M is also necessary: Take R = Z and M = Q and I = (2)

\subsection{Flat Modules}
Today we are talking about flatness and $\op{Tor}$. Let's start with flatness; we recall the definition.
\flatdefi*
\noindent As we discussed in \autoref{rem:easierflat}, because $M\otimes_R-$ is already left-exact, we merely have to check that $N\into N'$ induces an injection $M\otimes_RN\into M\otimes_RN'$.

We now run through some examples of flat modules.
\begin{example}
	We showed back in \autoref{ex:freeisflat} that $R^n$ is a flat $R$-module. Essentially this is because $R^n\otimes A\simeq(R\otimes A)^n\simeq M^n$ (functorially), so injections $A\into B$ remain injections $A^n\into B^n$.
\end{example}
\begin{example}
	For any multiplicative set $U\subseteq R$, the module $R\left[U^{-1}\right]$ is flat, as we showed in \autoref{cor:localflat}. For example, $\QQ$ is flat as a $\ZZ$-module.
\end{example}
\begin{remark}
	As a small aside, we note that \autoref{prop:localexact} only says that $R\left[U^{-1}\right]\otimes-:\mathrm{Mod}_R\to\mathrm{Mod}_{R\left[U^{-1}\right]}$ takes short exact sequences in $\mathrm{Mod}_R$ to short exact sequences in $\mathrm{Mod}_{R\left[U^{-1}\right]}$, but this restricts to $R$-modules just fine (even when $R\to R\left[U^{-1}\right]$ is not injective). To be explicit, given $A\into B$ in $\mathrm{Mod}_R$, the fact that the map
	\[A\otimes_RR\left[U^{-1}\right]\to B\otimes_RR\left[U^{-1}\right]\]
	is injective does not matter if we are looking in the category $\mathrm{Mod}_{R\left[U^{-1}\right]}$ or $\mathrm{Mod}_R$.
\end{remark}
And let's see a non-example.
\begin{exe}
	For any positive integer $n>1$, the module $\ZZ/n\ZZ$ is not flat in the category of $\ZZ$-modules.
\end{exe}
\begin{proof}
	We witness this with a specific short exact sequence. For our purposes, we will take
	\[0\to\ZZ\stackrel{\times n}\to\ZZ/n\ZZ\to0.\]
	We now claim that the induced sequence
	\[0\to\ZZ\otimes_\ZZ\ZZ/n\ZZ\stackrel{\times n}\to\ZZ\otimes_\ZZ\ZZ/n\ZZ\to\ZZ/n\ZZ\to0\]
	is not exact. In particular, we need to show that the induced map $\varphi:\ZZ\otimes_\ZZ\ZZ/n\ZZ\stackrel{\times n}\to\ZZ\otimes_\ZZ\ZZ/n\ZZ$ is not injective. Well, we note $\ZZ\otimes_\ZZ\ZZ/n\ZZ\cong\ZZ/n\ZZ$ by $1\otimes[k]_n\mapsto[k]_n$, so we note $1\otimes[1]_n$ is a nonzero element (it goes to $[1]_n$ under the isomorphism) and that
	\[\varphi(1\otimes[1]_n)=1\otimes n[1]_n=1\otimes[0]_n\]
	is $0$ in $\ZZ\otimes_\ZZ\ZZ/n\ZZ$.
\end{proof}

\subsection{Projective Modules}
For our next example of flat modules, we pick up the following definition.
\begin{definition}[Projective] \label{def:projective}
	An $R$-module $P$ is \textit{projective} if and only if, for any surjection $\pi:B\onto C$ and map $\varphi:P\to C$, there exists an induced map $\overline\varphi:P\to B$ making the following diagram commute.
	% https://q.uiver.app/?q=WzAsMyxbMSwwLCJQIl0sWzEsMSwiTScnIl0sWzAsMSwiTSJdLFsyLDEsIlxccGkiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbMCwxLCJcXHZhcnBoaSJdLFswLDIsIlxccHNpIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
	\[\begin{tikzcd}
		& P \\
		B & {C}
		\arrow["\pi"', two heads, from=2-1, to=2-2]
		\arrow["\varphi", from=1-2, to=2-2]
		\arrow["\psi"', dashed, from=1-2, to=2-1]
	\end{tikzcd}\]
\end{definition}
Actually, there are lots of equivalent definitions of projective. Before doing so, we will want to talk a little more explicitly about what it means for a short exact sequence to split.
\begin{definition}[Splits] \label{def:splits}
	Fix a short exact sequence of $R$-modules
	\[0\to A\to B\stackrel\pi\to C\to0.\]
	Then we say that this short exact sequence \textit{splits} if and only if there is a ``lift'' $\varphi:C\to B$ such that $\pi\circ\varphi=\id_C$.
\end{definition}
Here are a few equivalent conditions.
\begin{lemma} \label{lem:splitgrabbag}
	Fix a short exact sequence of $R$-modules.
	\[0\to A\stackrel\iota\to B\stackrel\pi\to C\to0.\]
	Then the following are equivalent.
	\begin{listalph}
		\item The short exact sequence splits, in the sense of \autoref{def:splits}.
		\item There is an isomorphism $\psi:A\oplus C\to B$ such that the following diagram commutes, where the bottom row has the canonical inclusion and projection.
		% https://q.uiver.app/?q=WzAsMTAsWzAsMCwiMCJdLFsxLDAsIkEiXSxbMiwwLCJBXFxvcGx1cyBDIl0sWzMsMCwiQyJdLFs0LDAsIjAiXSxbMCwxLCIwIl0sWzEsMSwiQSJdLFsyLDEsIkIiXSxbMywxLCJDIl0sWzQsMSwiMCJdLFswLDFdLFsxLDJdLFsyLDNdLFszLDRdLFs1LDZdLFs2LDcsIlxcaW90YSJdLFs3LDgsIlxccGkiXSxbOCw5XSxbMSw2LCIiLDEseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDcsIlxcdmFycGhpIl0sWzMsOCwiIiwxLHsibGV2ZWwiOjIsInN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
		\[\begin{tikzcd}
			0 & A & {A\oplus C} & C & 0 \\
			0 & A & B & C & 0
			\arrow[from=1-1, to=1-2]
			\arrow[from=1-2, to=1-3]
			\arrow[from=1-3, to=1-4]
			\arrow[from=1-4, to=1-5]
			\arrow[from=2-1, to=2-2]
			\arrow["\iota", from=2-2, to=2-3]
			\arrow["\pi", from=2-3, to=2-4]
			\arrow[from=2-4, to=2-5]
			\arrow[Rightarrow, no head, from=1-2, to=2-2]
			\arrow["\psi", from=1-3, to=2-3]
			\arrow[Rightarrow, no head, from=1-4, to=2-4]
		\end{tikzcd}\]
		\item The function $(\pi\circ-):\op{Hom}_R(C,B)\to\op{Hom}_R(C,C)$ is surjective.
	\end{listalph}
\end{lemma}
\begin{proof}
	We start by showing (a) is equivalent to (b).
	\begin{itemize}
		\item We show that (a) implies (b). Well, we claim that the provided lift $\varphi:C\to B$ such that $\pi\circ\varphi=\id_C$ will create the needed isomorphism by $\psi=\iota\oplus\varphi$. Namely, we have to show that $\iota\oplus\varphi:A\oplus C\to B$ is an isomorphism. Certainly it is an $R$-module homomorphism, so we need to show that it is a bijection, for which we have the following checks.
		\begin{itemize}
			\item We show that $\iota\oplus\varphi$ is injective. Well, if $(\iota\oplus\varphi)(a,c)=0$, then we want to show $(a,c)=(0,0)$. Well, $\iota(a)+\varphi(c)=0$, so
			\[0+c=\pi(\iota(a))+\pi(\varphi(c))=\pi(\iota(a)+\varphi(c))=0,\]
			so $c=0$ follows. But then $\iota(a)=0$, so $a=0$ by injectivity of $\iota$.
			\item We show that $\iota\oplus\varphi$ is surjective. Well, pick up some $b\in B$. Then we set $c:=\pi(b)$ so that
			\[\pi(b-\varphi(c))=\pi(b)-\id_C(c)=0.\]
			In particular, $b-\varphi(c)\in\ker\pi=\im\iota$ by exactness, so there exists $a\in A$ such that $b-\varphi(c)=\iota(a)$, from which $(\iota\oplus\varphi)(a,c)=b$ follows.
		\end{itemize}
		It remains to show that the diagram
		% https://q.uiver.app/?q=WzAsMTAsWzAsMCwiMCJdLFsxLDAsIkEiXSxbMiwwLCJBXFxvcGx1cyBDIl0sWzMsMCwiQyJdLFs0LDAsIjAiXSxbMCwxLCIwIl0sWzEsMSwiQSJdLFsyLDEsIkIiXSxbMywxLCJDIl0sWzQsMSwiMCJdLFswLDFdLFsxLDJdLFsyLDNdLFszLDRdLFs1LDZdLFs2LDcsIlxcaW90YSJdLFs3LDgsIlxccGkiXSxbOCw5XSxbMSw2LCIiLDEseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDcsIlxcaW90YVxcb3BsdXNcXHZhcnBoaSIsMV0sWzMsOCwiIiwxLHsibGV2ZWwiOjIsInN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
		\[\begin{tikzcd}
			0 & A & {A\oplus C} & C & 0 \\
			0 & A & B & C & 0
			\arrow[from=1-1, to=1-2]
			\arrow[from=1-2, to=1-3]
			\arrow[from=1-3, to=1-4]
			\arrow[from=1-4, to=1-5]
			\arrow[from=2-1, to=2-2]
			\arrow["\iota", from=2-2, to=2-3]
			\arrow["\pi", from=2-3, to=2-4]
			\arrow[from=2-4, to=2-5]
			\arrow[Rightarrow, no head, from=1-2, to=2-2]
			\arrow["\iota\oplus\varphi"{description}, from=1-3, to=2-3]
			\arrow[Rightarrow, no head, from=1-4, to=2-4]
		\end{tikzcd}\]
		commutes. To check that the left square commutes, we go along the top to get $a\mapsto(a,0)\mapsto\iota(a)$ and go along the bottom to get $a\mapsto a\mapsto\iota(a)$, which match.

		To check that the right square commutes, we go along the top to get $(a,c)\mapsto c\mapsto c$ and go along the bottom to get $(a,c)\mapsto\iota(a)+\varphi(c)\mapsto 0+c$, which match.

		\item We show that (b) implies (a). Well, we claim that the composite
		\[\varphi(c):=\psi((0,c))\]
		will work. Indeed, because the right square of the given diagram commutes, we see that
		\[\pi(\varphi(c))=\pi(\psi((0,c)))=c,\]
		which is what we wanted.
	\end{itemize}
	We now show that (a) is equivalent to (c).
	\begin{itemize}
		\item We show that (a) implies (c). For this, we pick up any morphism $f:C\to C$ that we want to hit and observe $(\varphi\circ f):C\to B$ will have
		\[(\pi\circ-)(\varphi\circ f)=(\pi\circ\varphi)\circ f=\id_C\circ f=f,\]
		so we are done.
		
		\item We show that (c) implies (a). This is not too bad: because $(\pi\circ-)$ is surjective, it must hit $\id_C:C\to C$, so there is a morphism $\varphi:C\to B$ such that $\pi\circ\varphi=(\pi\circ-)(\varphi)=\id_C$, which is what we wanted.
	\end{itemize}
	The above implications finish the proof.
\end{proof}
And now we get to talk about projective modules.
\begin{lemma} \label{lem:projgrabbag}
	Fix an $R$-module $P$. Then the following are equivalent.
	\begin{listalph}
		\item $P$ is projective, in the sense of \autoref{def:projective}.
		\item Any short exact sequence of $R$-modules
		\[0\to A\to B\to P\to 0\]
		splits.
		\item There exists an $R$-module $K$ such that $K\oplus P$ is a free $R$-module.
		\item The functor $\op{Hom}_R(P,-)$ is exact.
	\end{listalph}
\end{lemma}
\begin{proof}
	We take our implications one at a time.
	\begin{itemize}
		\item We show that (a) implies (b). The key is to write the short exact sequence in the following diagram.
		% https://q.uiver.app/?q=WzAsNixbMywwLCJQIl0sWzMsMSwiUCJdLFsyLDEsIkIiXSxbNCwxLCIwIl0sWzAsMSwiMCJdLFsxLDEsIkEiXSxbMCwxLCIiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDIsIlxcdmFycGhpIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzIsMSwiXFxwaSIsMix7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFs0LDVdLFs1LDJdLFsxLDNdXQ==
		\[\begin{tikzcd}
			&&& P \\
			0 & A & B & P & 0
			\arrow[Rightarrow, no head, from=1-4, to=2-4]
			\arrow["\varphi"', dashed, from=1-4, to=2-3]
			\arrow["\pi"', two heads, from=2-3, to=2-4]
			\arrow[from=2-1, to=2-2]
			\arrow[from=2-2, to=2-3]
			\arrow[from=2-4, to=2-5]
		\end{tikzcd}\]
		In particular, because $P$ is projective, there exists a map $\varphi:P\to M$ such that $\pi\circ\varphi=\id_P$. This is exactly what we need for the short exact sequence to split.

		\item We show that (b) implies (c). The point is to create a free $R$-module to surject onto $R$ and then use \autoref{lem:splitgrabbag}. We outsource this difficulty into the following lemma.
	\end{itemize}
	\begin{lemma} \label{lem:getenoughprojectives}
		Fix $M$ an $R$-module. Then there is a free $R$-module which surjects onto $M$.
	\end{lemma}
	\begin{proof}
		For each $m\in M$, we have a map $\varphi_m:R\to M$ by sending $\varphi_m:x\mapsto xm$, and this is an $R$-module homomorphism because, for $r_1,r_2,x_1,x_2\in R$ we have
		\[\varphi_m(r_1x_1+r_2x_2)=(r_1x_1+r_2x_2)m=r_1(x_1m)+r_2(x_2m)=r_1\varphi_m(x_1)+r_2\varphi_m(x_2).\]
		Now, we can stitch these $\varphi_m$ together to create a surjection
		\[\varphi:\underbrace{\bigoplus_{m\in M}R}_F\to M,\]
		and we note that $\varphi$ is now surjective because, for any $m_0,$ we have
		\[\varphi\left((1_{m=m_0})_{m\in M}\right)=\sum_{m\in M}\varphi_m(1_{m=m_0})=\varphi_{m_0}(1)=m_0.\]
		Thus, we do indeed have a free module $F$ which surjects onto $M$.
	\end{proof}
	\begin{itemize}
		\item[] We now finish showing that (b) implies (c). We use \autoref{lem:getenoughprojectives} to conjure the map $\varphi:F\onto M$ where $F$ is a free $R$-mdule and then create the short exact sequence
		\[0\to\ker\varphi\to F\stackrel\varphi\to M\to0.\]
		Now, by definition of $M$, this short exact sequence splits, so by \autoref{lem:splitgrabbag}, we have an isomorphism $F\cong(\ker\varphi)\oplus M$, which is what we wanted.
		\item We show that (c) implies (d). The main point is that (d) is not too hard to verify for free modules, so we will start by reducing to the free case. Fix our $R$-modules $K$ and $F$ so that $F$ is free and $F\cong K\oplus P$; name this isomorphism $\psi:F\to K\oplus P$. Now, given a short exact sequence
		\[0\to A\to B\to C\to 0,\]
		we need to show that the sequence
		\[0\to\op{Hom}_R(P,A)\to\op{Hom}_R(P,B)\to\op{Hom}_R(P,C)\to0\]
		is exact. Well, we know that $\op{Hom}_R(P,-)$ is always left-exact, so it remains to show that the map $\op{Hom}_R(P,B)\to\op{Hom}_R(P,C)$ is surjective. To be explicit, we name the map $B\to C$ by $\pi:B\to C$ so that we are showing
		\[(\pi\circ-):\op{Hom}_R(P,B)\to\op{Hom}_R(P,C)\]
		is surjective.

		For this, pick up a morphism $f:P\to C$ that we want to hit. We now reduce to the free case. By gluing this together with the zero morphism $0:K\to C$, we get an induced map $f:P\oplus K\to C$, which induces a map $f\varphi:F\to C$. Now that we are mapping from a free module, we can lift to $P\to B$ with ease: suppose $F=R^\lambda$ is free indexed by $\alpha\in\lambda$, so we see that we can find elements $\{b_\alpha\}_{\alpha\in\lambda}\subseteq B$ such that
		\[\pi(b_\alpha)=(f\varphi)(\alpha)\]
		because $\pi$ is surjective. Now, we can define a map $\overline f:F\to B$ by $\alpha\mapsto b_\alpha$ because $F$ is free, which satisfies
		\[\pi\circ\overline f=f\varphi\]
		by checking $(\pi\circ\overline f)(\alpha)=\pi(b_\alpha)=(f\varphi)(\alpha)$ on each $\alpha\in\lambda$.

		To finish, $\overline f:F\to B$ induces a map $\overline f\varphi^{-1}:P\oplus K\to B$, which restricts to a map $\overline f\varphi^{-1}\iota:P\to K$ by $p\mapsto(p,0)\mapsto\overline f(\varphi^{-1}(p,0))$. We now check that $\overline f\varphi^{-1}\iota$ actually satisfies the desired property: we see
		\[\pi\circ(\overline f\circ\varphi^{-1}\circ\iota)=f\circ\varphi\circ\varphi^{-1}\circ\iota=f\circ\id_{P\oplus K}\circ\iota_P=f\circ\id_P=f,\]
		so we are done.

		\item We show that (d) implies (a). This is definition-chasing. Suppose that we have a surjection $\pi:B\onto C$ and a map $\varphi:P\to C$ that we want to lift. Well, there is a short exact sequence
		\[0\to\ker\pi\to B\stackrel\pi\to C\to 0,\]
		which upon applying the exact functor $\op{Hom}_R(P,-)$ gives tells us that
		\[(\pi\circ-):\op{Hom}_R(P,C)\to\op{Hom}_R(P,B)\]
		is surjective, which is (c). In particular, there is a map $\overline\varphi:P\to C$ such that $\pi\circ\overline\varphi=\varphi$, which is what we wanted.
		\qedhere
	\end{itemize}
\end{proof}
\begin{remark}[Nir]
	Even though being projective has many definitions, some more concrete than others, I have chosen \autoref{def:projective} to begin with because it will be the most useful in homological algebra, which is where we are going next.
\end{remark}
Because I just can't resist, here is a more geometric view of projective modules, which was not covered in class.
\begin{proposition}
	Fix $M$ a finitely presented $R$-module. Then $M$ is projective if and only if $M_\mf p$ is a free $R_\mf p$ for all primes $\mf p\subseteq R$. In other words, $M$ is projective if and only if $M$ is locally free.
\end{proposition}
\begin{proof}
	We take our directions separately.
	\begin{itemize}
		\item Suppose $M$ is a finitely generated projective $R$-module. Thus, we have a projection $R^n\onto M$, so \autoref{lem:projgrabbag} grants us an isomorphism $K\oplus M\cong R^n$ for some $R$-module $K$. Localizing at some prime $\mf p$, we get
		\[K_\mf p\oplus M_\mf p\cong R_\mf p^n.\]
		So now we see that the localized module $M_\mf p$ is still a finitely generated projective $R_\mf p$-module by \autoref{lem:projgrabbag}, but now $R_\mf p$ is local with maximal ideal $\mf p_\mf p$.
		
		The main idea, now, is to extract out our dimension via \autoref{cor:quotientdimension}: note that we have an isomorphism
		\[(K_\mf p/\mf p_\mf pK_\mf p)\oplus(M_\mf p/\mf p_\mf pM_\mf p)\cong(R_\mf p/\mf p_\mf p)\otimes_{R_\mf p}(K_\mf p\oplus M_\mf p)\cong(R_\mf p/\mf p_\mf p)\otimes_{R_\mf P}R_\mf p^n\cong(R_\mf p/\mf p_\mf pR_\mf p)^n\]
		by repeatedly using \autoref{prop:tensorquotient}. Now, everything involved now has the $\mf p_\mf p$-action vanished, so the above exhibits an isomorphism of $R_\mf p/\mf p_\mf p$-vector spaces. In particular,
		\[\dim_{R_\mf p/\mf p_\mf p}(K_\mf p/\mf p_\mf pK_\mf p)+\dim_{M_\mf p/\mf p_\mf p}(M_\mf p/\mf p_\mf pM_\mf p)=n,\]
		so we provide these with bases $\{\overline{k_1},\ldots,\overline{k_a}\}$ and $\{\overline{m_1},\ldots,\overline{m_b}\}$ with $a+b=n$. By \autoref{cor:quotientdimension}, these bases extend to surjections $R_\mf p^a\onto K_\mf p$ and $R_\mf p^b\onto M_\mf p$ so that we have a big surjection
		\[R_\mf p^n=R_\mf p^a\oplus R_\mf p^b\onto K_\mf p\oplus M_\mf p\cong R_\mf p^n.\]
		But now \autoref{prop:epiisiso} now tells us that this is an isomorphism! In particular, the map $R_\mf p^b\onto M_\mf p$ may have no kernel, so it is an isomorphism, and we conclude that $M_\mf p$ is free.

		\item Suppose $M$ is a finitely presented $R$-module such that $M_\mf p$ is a free $R_\mf p$-module for each prime $\mf p\subseteq R$. The key is to use \autoref{rem:splitsifflocallysplits}. Indeed, suppose that we have any short exact sequence
		\[0\to A\to B\to M\to 0,\]
		and by \autoref{lem:projgrabbag}, it suffices to show that this short exact sequence splits. Well, by \autoref{rem:splitsifflocallysplits}, this short exact sequence splits if and only if
		\[0\to A_\mf p\to B_\mf p\to M_\mf p\to 0\]
		splits for all prime ideals $\mf p$. But now $M_\mf p$ is free and in particular projective (e.g., use (c) of \autoref{lem:projgrabbag}), so the short exact sequence splits by (b) of \autoref{lem:projgrabbag}. So we are done.
		\qedhere
	\end{itemize}
\end{proof}
Anyways, here is, roughly, why we introduced projective modules now.
\begin{prop}
	Projective modules are flat.
\end{prop}
\begin{proof}
	Fix $P$ a projective $R$-module. By (c) of \autoref{lem:projgrabbag}, we are promise an $R$-module $K$ such that $K\oplus P$ is free.

	Now, by \autoref{rem:easierflat}, it suffices to pick up an inclusion $\iota:A\into B$ and show that the induced map $\iota_P:A\otimes_RP\to B\otimes_RP$ is also injective. The point is to reduce to the free case. Indeed, we see that, for an $R$-module $M$, we have
	\[\psi_M:M\otimes_R(K\oplus P)\simeq(M\otimes_RK)\oplus(M\otimes_RP)\]
	by $\psi_M:m\otimes(k,p)\mapsto(m\otimes k,m\otimes p)$. In particular, we pick up the induced map $\iota_K:A\otimes_RP\to B\otimes_RP$ and $\iota_F:A\otimes_R(K\oplus P)\to B\otimes_R(K\oplus P)$ and note that the following diagram commutes.
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJBXFxvdGltZXNfUihLXFxvcGx1cyBQKSJdLFswLDEsIkJcXG90aW1lc19SKEtcXG9wbHVzIFApIl0sWzEsMCwiKEFcXG90aW1lc19SSylcXG9wbHVzKEFcXG90aW1lc19SUCkiXSxbMSwxLCIoQlxcb3RpbWVzX1JLKVxcb3BsdXMoQlxcb3RpbWVzX1JQKSJdLFswLDEsIlxcaW90YV9GIl0sWzIsMywiXFxpb3RhX0tcXG9wbHVzXFxpb3RhX1AiXSxbMCwyXSxbMSwzXV0=
	\[\begin{tikzcd}
		{A\otimes_R(K\oplus P)} & {(A\otimes_RK)\oplus(A\otimes_RP)} \\
		{B\otimes_R(K\oplus P)} & {(B\otimes_RK)\oplus(B\otimes_RP)}
		\arrow["{\iota_F}", from=1-1, to=2-1]
		\arrow["{\iota_K\oplus\iota_P}", from=1-2, to=2-2]
		\arrow["{\psi_A}", from=1-1, to=1-2]
		\arrow["{\psi_B}"', from=2-1, to=2-2]
	\end{tikzcd}\tag{$*$}\label{eq:tensordistribfunctorial}\]
	Tracking our generating elements, along the top we have $a\otimes(k,p)\mapsto(a\otimes k,a\otimes p)\mapsto(\iota a\otimes k,\iota a\otimes p)$, and along the bottom we have $a\otimes(k,p)\mapsto\iota a\otimes(k,p)\mapsto(\iota a\otimes k,\iota a\otimes p)$, which matches.

	To finish, suppose that we have an element $x\in K\oplus P$ in the kernel of $\iota_P$. Then $(0,x)\in\ker\iota_K\oplus\iota_P$, so because the diagram in \autoref{eq:tensordistribfunctorial} commutes, we see that
	\[\iota_F\left(\psi_A^{-1}(0,x)\right)=\psi_B^{-1}\big((\iota_K\oplus\iota_P)(0,x)\big)=0.\]
	But now $F$ is surely projective by \autoref{ex:freeisflat}, so $\iota_F$ is injective, so $\psi_A^{-1}(0,x)=0$, so $(0,x)=0$, so $x=0$. Thus, $\iota_P$ does indeed have trivial kernel.
\end{proof}

\subsection{Flatness via Algebraic Geometry}
In algebraic geometry, we are interested in families of affine varieties, which consists of a base $B$ and a morphism $\varphi:X\to B$; in particular, we get an affine variety ``parameterized'' by the elements of our $B$ by taking the fiber $\varphi^{-1}(b)$ for each $b\in B$.

For example, here is the standard image of a M\"obius strip $X$ as a family of affine lines over $S^1$.
\begin{center}
	\begin{asy}
		import graph3;
		// thank you https://asymptote.sourceforge.io/asymptote_tutorial.pdf
		unitsize(2cm);
		currentprojection=orthographic(0,-2,1);
		
		real offset = pi;
		triple F(pair uv) {
			real t = uv.x;
			real r = uv.y;
			return (
				cos(t+offset) + r*cos(t)*sin(t/2),
				sin(t+offset) + r*sin(t)*sin(t/2),
				r*cos(t/2)
			);
		}
		real r = 0.2;
		surface moeb = surface(F, (0,-r), (2pi,r), Spline);
		draw(moeb, surfacepen=material(gray(0.7)+opacity(0.7), emissivepen=0.2 white));
		
		real x(real t) {return cos(2pi*t);}
		real y(real t) {return sin(2pi*t);}
		real z1(real t) {return 0;}
		real z2(real t) {return -2;}
		draw(graph(x,y,z1,0,1,operator ..));
		draw(graph(x,y,z2,0,1,operator ..));
	
		label("$X$", (-1.5,0,0));
		label("$S^1$", (-1.5,0,-2));
		draw((-1.5,0,-0.3) -- (-1.5,0,-2+0.3), EndArrow3);
		label("$\pi$", (-1.63,0,-1));
		
		real theta = -1;
		dot((cos(theta), sin(theta), 0), red);
		dot((cos(theta), sin(theta), -2), red);
		draw((cos(theta), sin(theta), -2+0.3) -- (cos(theta), sin(theta), -0.3), arrow=Arrow3(DefaultHead2(),Fill,emissive(red)), p=red+dashed);
		
		real t0 = theta-offset;
		real r0 = -0.4;
		draw(F((t0,-r0)) -- F((t0,r0)), arrow=Arrow3(DefaultHead2(),Fill,emissive(red)), p=red);
		draw(F((t0,r0)) -- F((t0,-r0)), arrow=Arrow3(DefaultHead2(),Fill,emissive(red)), p=red);
		
		label("$x$", (1.3*cos(theta), 1.3*sin(theta), -2), p=red);
		label("$\pi^{-1}(x)$", (1.3*cos(theta-0.1)+0.5, 1.3*sin(theta-0.1), 0), p=red);
	\end{asy}
\end{center}
In particular, the ``data'' of this family really just consists of the morphism $\pi:X\to S^1$.

As usual, the algebraic story will reverse, so a family in the algebraic world should consist of the data
\[(-\circ\varphi):A(B)\to A(X).\]
In particular, such a map $A(B)\to A(X)$ is exactly the data of $A(X)$ being an $A(B)$-algebra. To make our notions more general, we set $S:=A(X)$ an $R:=A(B)$-algebra by $\varphi:R\to S$.

Keeping track of our geometry, we would like to talk about how to move fibers into our algebraic world. We start by fixing a point $p\in B$, whose coordinate ring is $R/\mf m$, where $\mf m$ is some maximal ideal. Moving up to $S$, we note that if we want a function $f:X\to k$ to vanish on $\varphi^{-1}(p)$, then ``morally'' it should look like it factors through $\varphi$ and take the form $f\varphi$ for some $f\in\mf m$. In other words, we should modulo out by the ideal generated by
\[(-\circ\varphi)(\mf m),\]
which is $\mf mS$, so the coordinate ring of $\varphi^{-1}(p)$ will be
\[S/\mf mS.\]
To generalize this past maximal ideals, we write\footnote{For example, we are using \autoref{prop:tensorquotient} to get an isomorphism of $R$-modules, but the multiplication also matches: we have $\psi:[s]_{\mf mS}\mapsto[1]_\mf m\otimes s$, so $\psi([s]\cdot[t])=\psi([st])=[1]\otimes st=([1]\otimes s)([1]\otimes t)=\psi([s])\psi([t])$.} $S/\mf mS\simeq(R/\mf m)\otimes_RS$, so for more general primes $\mf p\subseteq R$, our coordinate ring of the fiber over $\mf p$ will be
\[(R/\mf p)\otimes_RS.\]
In a family, we would like the fibers to be well-behaved. One way to keep track of well-behaved families of ``algebras'' (which, as above, consists of the data of a single ring homomorphism $R\to S$) is via the flatness condition.
\begin{definition}[Flat]
	An $R$-algebra $S$ is \textit{flat} if and only if $S$ is flat as an $R$-module.
\end{definition}
On the geometric side, flatness (roughly speaking) means that the fiber $(R/\mf p)\otimes_RS$ varies continuously as the point $\mf p$ moves.

Let's see some examples. We will take our base to be $B:=\AA^1(k)$ the affine line over an algebraically closed field $k$, which gives that $R:=k[t]$.
\begin{exe}
	We consider the flatness of $S:=R[x]/\left(x^2-t\right)$ geometrically and algebraically.
\end{exe}
\begin{proof}
	This looks like the following.
	\begin{center}
		\begin{asy}
			unitsize(1cm);
			import graph;
			real y(real t)
			{
				return t;
			}
			real x(real t)
			{
				return t*t;
			}
			draw(graph(x, y,-2,2));
		\end{asy}
	\end{center}
	The fiber at $t=a$ as $a\in k$ varies is
	\[\frac{k[x]}{\left(x^2-a\right)}\cong\begin{cases}
		k^2 & a\ne0, \\
		k[x]/\left(x^2\right) & a=0.
	\end{cases}\]
	Visually, we can see that $a\ne0$ has two points above it, and at $x=0$, we are vertical. Because the dimension is constant as the point moves, we suspect $S$ to be a flat $R$-algebra. And indeed, viewing $x^2-t$ as a monic polynomial with coefficients in $R[t]$, we see that $S$ is a free module over $R[t]$ of rank $2$, so $S$ is flat.
\end{proof}
\begin{exe}
	We consider the flatness of $S:=R[x]/\left(xt-1\right)$ geometrically and algebraically.
\end{exe}
\begin{proof}
	This looks like the following.
	\begin{center}
		\begin{asy}
			unitsize(0.4cm);
			import graph;
			real y(real t)
			{
				return t;
			}
			real x(real t)
			{
				return 1/t;
			}
			draw(graph(x, y,-4,-1/4));
			draw(graph(x, y, 4,1/4));
		\end{asy}
	\end{center}
	Visually, we can see that the fiber over any $t=a$ as $a\in k$ is one point, except when $a=0$, where the fiber is empty. So we expect $S$ to be flat, and indeed it is: $S=R\left[t^{-1}\right]$ is a localization and therefore flat.
\end{proof}
\begin{exe}
	We consider the non-flatness of $S:=R[x]/(tx-t)$ geometrically and algebraically.
\end{exe}
\begin{proof}
	This looks like the following.
	\begin{center}
		\begin{asy}
			unitsize(0.4cm);
			import graph;
			draw((-4,1)--(4,1));
			draw((0,-4)--(0,4));
		\end{asy}
	\end{center}
	The problem here is that the fiber is jumping at $t=0$, so we expect $S$ to not be flat as an $R$-module. For this, we have the following result.
	\begin{lemma}
		Fix $R$ a ring $a\in R$ a non-zero-divisor. Further, if $M$ is a flat $R$-module, then $am=0$ implies $m=0$ for $m\in M$.
	\end{lemma}
	\begin{proof}
		The point is to look at the short exact sequence
		\[0\to(a)\to R\to R/(a)\to 0.\]
		Upon tensoring with $M$, we see that $(a)\otimes_RM\into R\otimes_RM$, so $(a)M\into M$. In particular, multiplication by $a$ is injective on $M$, so $am=0=a\cdot0$ implies $m=0$.
	\end{proof}
	From the above lemma, we note that $t(x-1)=0$ in $S$ while $t$ is not a zero-divisor, so $S$ is not flat.
\end{proof}

\subsection{Homological Algebra}
We will want to talk about $\op{Tor}$ for our discussion, so we will want to talk about homological algebra.
\begin{quot}
	The difference between homology and cohomology is that homology indexes like $H_i$, and cohomology indexes like $H^i$.
\end{quot}
We will want to talk about chains in homological algebra, so we will start with complexes.
\begin{definition}[Complex]
	Fix $C:=\oplus_{i\ge0}C_i$ a $\NN$-graded $R$-module. Then $C$ is a \textit{chain} if and only if it is equipped with a (graded) morphism $\del\in\op{End}_R(C)$ such that $\del^2=0$. If $\deg\del=-1$, this is homology, and if $\deg\del=+1$, this is cohomology.
\end{definition}
In the homology case, we can view this like
\[\cdots\stackrel\del\to C_2\stackrel\del\to C_1\stackrel\del\to C_0\stackrel\del\to 0.\]
If we wanted, we could index the arrows as $\del_i:C_i\to C_{i-1}$, but it makes things a little harder to keep track of.
\begin{definition}[Homology]
	Given a chain $(C,\del)$, we define the \textit{homology groups} as
	\[H_i(C):=\ker\del_i/\im\del_{i+1}\]
\end{definition}
Note this is well-defined because $\del^2=0$.

As usual in algebra, we will want morphisms between our objects.
\begin{definition}[Chain morphism]
	Fix chain complexes $(C,\del)$ and $(C',\del')$, we define a morphism $\varphi$ as a degree-$0$ morphism $\varphi:C\to C'$ preserving $\del$ as in the following diagram.
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJDX2kiXSxbMSwwLCJDX3tpLTF9Il0sWzEsMSwiQydfe2ktMX0iXSxbMCwxLCJDJ19pIl0sWzAsMSwiXFxkZWwiXSxbMywyLCJcXGRlbCciLDJdLFswLDMsIlxcdmFycGhpIiwyXSxbMSwyLCJcXHZhcnBoaSJdXQ==
	\[\begin{tikzcd}
		{C_i} & {C_{i-1}} \\
		{C'_i} & {C'_{i-1}}
		\arrow["\del", from=1-1, to=1-2]
		\arrow["{\del'}"', from=2-1, to=2-2]
		\arrow["\varphi"', from=1-1, to=2-1]
		\arrow["\varphi", from=1-2, to=2-2]
	\end{tikzcd}\]
\end{definition}
We can check that $\varphi$ maps kernels of $\del$ to kernels of $\del'$ and images of $\del$ to images of $\del'$, so we get an induced map $H(\varphi):H_i(C)\to H_i(C')$.

And because abstraction is all the rage, there is also a notion of morphisms being the same.
\begin{definition}[Homotopically equivalent]
	Two chain morphisms $\varphi,\psi:(C,\del)\to(C',\del')$ are \textit{homotopically equivalent} if and only if there exists an $R$-module homomorphism $h:C\to C$ of degree $1$ (i.e., $h:C_i\to C_{i+1}'$) such that $\varphi-\psi=h\del+\del'h$.
\end{definition}
The image is as follows. As a warning, this diagram does not commute.
% https://q.uiver.app/?q=WzAsMTAsWzIsMCwiQ18xIl0sWzMsMCwiQ18wIl0sWzQsMCwiMCJdLFsyLDEsIkNfMSciXSxbMywxLCJDXzAnIl0sWzQsMSwiMCJdLFsxLDAsIkNfMiJdLFsxLDEsIkNfMiciXSxbMCwwLCJcXGNkb3RzIl0sWzAsMSwiXFxjZG90cyJdLFs4LDZdLFs2LDBdLFswLDFdLFsxLDJdLFs5LDddLFs3LDNdLFszLDRdLFs0LDVdLFsxLDRdLFswLDNdLFs2LDddLFsxLDMsImgiLDFdLFswLDcsImgiLDFdXQ==
\[\begin{tikzcd}
	\cdots & {C_2} & {C_1} & {C_0} & 0 \\
	\cdots & {C_2'} & {C_1'} & {C_0'} & 0
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-3, to=1-4]
	\arrow[from=1-4, to=1-5]
	\arrow[from=2-1, to=2-2]
	\arrow[from=2-2, to=2-3]
	\arrow[from=2-3, to=2-4]
	\arrow[from=2-4, to=2-5]
	\arrow[from=1-4, to=2-4]
	\arrow[from=1-3, to=2-3]
	\arrow[from=1-2, to=2-2]
	\arrow["h"{description}, from=1-4, to=2-3]
	\arrow["h"{description}, from=1-3, to=2-2]
\end{tikzcd}\]
The main point of this definition is the following.
\begin{proposition}
	Suppose $\varphi,\psi:(C,\del)\to(C',\del')$ are homotopically equivalent. Then $H(\varphi)=H(\psi)$.
\end{proposition}
\begin{proof}
	It suffices (by taking $\gamma:=\varphi-\psi$) to show that if $\gamma$ is homotopically equivalent to $0$, then $H(\gamma)$ vanishes. Now, suppose we have any $c\in\ker\del$, and we want to show that $\gamma(c)\in\im\del'$. Well, we compute
	\[\gamma(c)=(h\del+\del'h)(c)=\del'(h)\in\im\del',\]
	so we are done.
\end{proof}

To close out class, we discuss the long exact sequence.
\begin{theorem}
	Fix
	\[0\to C'\stackrel\alpha\to C\stackrel\beta\to C''\to0\]
	a short exact sequence of complexes. Then there is a long exact sequence of homology
	\[\cdots\to H_i(C')\stackrel{H(\alpha)}\to H_i(C)\stackrel{H(\beta)}\to H_i(C'')\stackrel{\delta}\to H_{i-1}(C')\to\cdots.\]
\end{theorem}
\begin{proof}
	We will be very brief. The main point is the construction of $\delta$. Fix some element $c\in\ker\del_i''$ from $H_i(C'')$. Then we can pull it back to $\beta^{-1}(c)$ in $H_i(c)$, then push it forwards through $\del'$ to live in $H_{i-1}(C)$, which we can then lastly check lives in the image of $\alpha$, so we finish by pulling backwards along $\alpha$ to get back to $H_{i-1}(C')$.
\end{proof}