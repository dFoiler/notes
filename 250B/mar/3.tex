% !TEX root = ../notes.tex

Welcome back everybody.

\subsection{Projective Resolutions}
Today we will discuss homological methods to determine flatness. As mentioned last class, we will want to introduce the functor $\op{Tor}$, so we want to be able to talk about left-derived functors.

We will make left-derived functors out of projective resolutions, so that is where we will start.
\begin{definition}[Resolution]
	Given an $R$-module $M$ a \textit{resolution of $M$} is a chain complex $(P,\del)$ such that
	\[P_i=\begin{cases}
		M & i=-1, \\
		0 & i<-1.
	\end{cases}\]
	Additionally, we require
	\[\cdots\stackrel{\del_3}\to P_2\stackrel{\del_2}\to P_1\stackrel{\del_1}\to P_0\stackrel{\del_0}\to M\stackrel{\del_{-1}}\to 0\]
	to be an exact sequence.
\end{definition}
\begin{remark}
	Alternatively, we can just look at the complex
	\[\cdots\stackrel{\del_3}\to P_2\stackrel{\del_2}\to P_1\stackrel{\del_1}\to P_0\stackrel{\del_0}\to 0\]
	and ask to be exact at all terms except at $P_0$, where we require $H_0(P)=\ker\del_0/\im\del_1=M$. In particular, we note $\ker\del_0=P_0$ because $\del_0:P_0\to0$, so $\del_0$ induces a surjection $P\onto M$ with kernel $\im\del_1$. So we can insert $M$ to make an exact sequence
	\[\cdots\stackrel{\del_3}\to P_2\stackrel{\del_2}\to P_1\stackrel{\del_1}\to P_0\stackrel{\del_0}\to M\to 0.\]
\end{remark}
\begin{defi}[Projective, free resolutions]
	Fix an $R$-module $M$ with a resolution $(P,\del)$.
	\begin{itemize}
		\item The resolution is \textit{projective} if and only if $P_i$ is projective for $i\ge0$.
		\item The resolution is \textit{free} if any only if $P_i$ is free over $i\ge0$.
	\end{itemize}
\end{defi}
\begin{remark}
	Because free modules are projective (see \autoref{lem:projgrabbag} part (c), for example), it follows that a free resolution is a projective resolution.
\end{remark}
% \begin{remark}[Nir]
% 	The last exactness condition is asking for $\im\del_{i-1}=\ker\del_i$ for each $i$; looping over all indices $i$, this is equivalent to requiring $\im\del=\ker\del$.
% \end{remark}
To start, we give every module a projective resolution.
\begin{lemma} \label{lem:enoughprojectives}
	Every $R$-module $M$ has a free resolution and therefore a projective resolution.
\end{lemma}
\begin{proof}
	The point is to use \autoref{lem:getenoughprojectives}. We produce our injective resolution inductively. To start our resolution $(P,\del)$, we start as required with
	\[P_i=\begin{cases}
		M & i=-1, \\
		0 & i<-1,
	\end{cases}\]
	and $\del_i=0$ for $i\le-1$. We now claim that, for any $n\in\NN$, we can construct projective modules $\{P_i\}_{i=0}^n$ with maps $\del_i:P_i\to P_{i-1}$ such that
	\[P_n\stackrel{\del_n}\to P_{n-1}\stackrel{\del_{n-1}}\to\cdots\stackrel{\del_{2}}\to P_1\stackrel{\del_1}\to P_0\stackrel{\del_0}\to M\to 0\]
	is an exact sequence. This induction will finish the proof.\footnote{Technically, one might want to use something like Zorn's lemma to actually go get the projective resolution with infinitely many terms, but we won't do this here.}
	
	For $n=0$, we use \autoref{lem:getenoughprojectives} to find a free module $P_0$ which surjects onto $M$ as $\del_0:P_0\onto M$. Thus,
	\[P_0\stackrel{\del_0}\to M\to0\]
	is exact at $M$ because the kernel of $0:M\to 0$ is all of $M$, which is precisely the image of $\del_0:P_0\onto M$.
	
	For the inductive step, we begin with our exact sequence
	\[P_n\stackrel{\del_n}\to P_{n-1}\stackrel{\del_{n-1}}\to\cdots\stackrel{\del_{2}}\to P_1\stackrel{\del_1}\to P_0\stackrel{\del_0}\to M\to 0\]
	and extend it by $P_{n+1}$. Indeed, by \autoref{lem:getenoughprojectives}, we can find a free module $P_{n+1}$ with a surjection $\del_{n+1}:P_{n+1}\onto\ker\del_n$. Tacking this on the front, we have the sequence
	\[P_{n+1}\stackrel{\del_{n+1}}\to P_n\stackrel{\del_n}\to P_{n-1}\stackrel{\del_{n-1}}\to\cdots\stackrel{\del_{2}}\to P_1\stackrel{\del_1}\to P_0\stackrel{\del_0}\to M\to 0.\]
	It remains to show that this sequence is exact. Well, by the inductive hypothesis, we already have exactness at everyone in $\{P_{n-1},P_{n-2},\ldots,P_1,P_0,M\}$. It remains to show exactness at $P_n$. Well, by construction of $\del_{n+1}$, we see that
	\[\im\del_{n+1}=\ker\del_n,\]
	which is exactly the exactness condition at $P_n$.
\end{proof}
\begin{remark}[Nir]
	There is a complaint that \autoref{lem:getenoughprojectives} products huge free modules to project. However, if $R$ is Noetherian and $M$ is finitely generated, then we can choose a resolution of free and finitely generated modules.
	
	To see this, we proceed inductively: $M$ is finitely generated, so we can choose $P_0$ to be free of finite rank surjecting onto $M$. Then, for the inductive step, $P_n$ is free of finite rank, and $\ker\del_n\subseteq P_n$ is a submodule of the Noetherian module $P_n$, so $\ker\del_n$ is finitely generated, so we can surject onto it.
\end{remark}
\begin{example}
	Fix $R:=k[x]/\left(x^2\right)$. Then $k$ is an $R$-module, where the $x$ acts by $0$: we can induce a map $k[x]\to k$ by lifting $\id_k:k\to k$ by $x\mapsto0$, and then we can mod out $k[x]$ by $x^2\mapsto0$, which gives us our map $\pi:R\to k$. Note $ax+b\in\ker\pi$ if and only if $bx=x(ax+b)=0$, so $\ker\pi=kx$.
	
	To start our projective resolution, we note we have a surjection
	\[R\stackrel\pi\to k\to 0\]
	with kernel $kx$; in particular, $\pi$ is surjective because $\pi$ lifts $\id_k:k\to k$. But now, we see that $\ker\pi=kx\cong k$ by $ax\mapsto a$, so we can project onto this kernel from $R$ by $ax+b\mapsto b\mapsto bx=x(ax+b)$. Thus, employing the algorithm in \autoref{lem:enoughprojectives}, we can create a free resolution
	\[\cdots\stackrel x\to R\stackrel x\to R\stackrel x\to R\to k\to 0.\]
\end{example}

\subsection{Creating Chain Morphisms}
One complaint is that our proof of \autoref{lem:enoughprojectives} did not produce a unique projective resolution. However, projective resolutions are unique in the following way.
\begin{lemma} \label{lem:uniqprojresolution}
	Suppose that $P$ and $Q$ are projective resolutions for an $R$-module $M$. Then there are chain morphisms $\alpha:P\to Q$ and $\beta:Q\to B$ such that $\alpha\beta\sim\id_Q$ and $\beta\alpha\sim\id_P$.
\end{lemma}
For this, it will be convenient to talk about how to induce chain morphisms for projective resolutions.
\begin{lemma} \label{lem:inducechainmorphism}
	Suppose that $\left(P,\del^P\right)$ and $\left(Q,\del^Q\right)$ are projective resolutions for the $R$-modules $M$ and $N$, respectively. Then an $R$-module homomorphism $\varphi:M\to N$ can be extended to a chain morphism $\varphi:P\to Q$.
\end{lemma}
\begin{proof}
	The point is to use the fact our modules are projective to extend the morphism $\varphi_{-1}:P_{-1}\to Q_{-1}$ backwards. In particular, for $i<-1$, we set $\varphi_i=0$ so that the following diagram commutes for any $i\le-1$.
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJQX2kiXSxbMSwwLCJQX3tpLTF9Il0sWzAsMSwiUV9pIl0sWzEsMSwiUV97aS0xfSJdLFswLDIsIlxcdmFycGhpX2kiLDJdLFsxLDMsIlxcdmFycGhpX3tpLTF9Il0sWzAsMSwiXFxkZWxeUF9pIl0sWzIsMywiXFxkZWxfaV5RIiwyXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{P_i} & {P_{i-1}} \\
		{Q_i} & {Q_{i-1}}
		\arrow["{\varphi_i}"', from=1-1, to=2-1]
		\arrow["{\varphi_{i-1}}", from=1-2, to=2-2]
		\arrow["{\del^P_i}", from=1-1, to=1-2]
		\arrow["{\del_i^Q}"', from=2-1, to=2-2]
	\end{tikzcd}\]
	Namely, the top and bottom arrows are both $0$s, so the diagram commutes for free.

	Because we have $\varphi_i$ for $i\le-1$, it suffices exhibit the $\varphi_i$ for $i\ge0$ inductively, assuming that we have $\varphi_{i-1}$; this will finish by muttering something about Zorn's lemma. Namely, we need to induce $\varphi_i$ to make the following diagram commute.
	% https://q.uiver.app/?q=WzAsNixbMCwwLCJQX2kiXSxbMSwwLCJQX3tpLTF9Il0sWzAsMSwiUV9pIl0sWzEsMSwiUV97aS0xfSJdLFsyLDAsIlBfe2ktMn0iXSxbMiwxLCJRX3tpLTJ9Il0sWzAsMiwiXFx2YXJwaGlfaSIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsxLDMsIlxcdmFycGhpX3tpLTF9Il0sWzAsMSwiXFxkZWxeUF9pIl0sWzIsMywiXFxkZWxfaV5RIiwyXSxbNCw1LCJcXHZhcnBoaV97aS0yfSJdLFsxLDQsIlxcZGVsX3tpLTF9XlAiXSxbMyw1LCJcXGRlbF97aS0xfV5RIiwyXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{P_i} & {P_{i-1}} & {P_{i-2}} \\
		{Q_i} & {Q_{i-1}} & {Q_{i-2}}
		\arrow["{\varphi_i}"', dashed, from=1-1, to=2-1]
		\arrow["{\varphi_{i-1}}", from=1-2, to=2-2]
		\arrow["{\del^P_i}", from=1-1, to=1-2]
		\arrow["{\del_i^Q}"', from=2-1, to=2-2]
		\arrow["{\varphi_{i-2}}", from=1-3, to=2-3]
		\arrow["{\del_{i-1}^P}", from=1-2, to=1-3]
		\arrow["{\del_{i-1}^Q}"', from=2-2, to=2-3]
	\end{tikzcd}\]
	We would like the fact that $P_i$ is projective in order to induce this arrow, but $\del_i^Q$ is not a surjection. However, $\del_i^Q$ does surject onto $\im\del_i^Q=\ker\del_{i-1}^Q$ (by exactness), so we would like $\varphi_{i-1}\circ\del_i^P$ to map into this kernel. Well, we can use the commutativity of the right square to write
	\[\del_{i-1}^Q\circ\varphi_{i-1}\circ\del_i^P=\varphi_{i-2}\circ\del_{i-1}^P\circ\del_i^P=\varphi_{i-2}\circ0=0,\]
	so $\im(\varphi_{i-1}\circ\del_i^P)\subseteq\ker\del_{i-1}^Q=\im\del_i^Q$. Thus, the following diagram is well-defined.
	% https://q.uiver.app/?q=WzAsMyxbMCwwLCJQX2kiXSxbMCwxLCJRX2kiXSxbMSwxLCJcXGltIFxcZGVsX2leUSJdLFswLDEsIlxcdmFycGhpX2kiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMSwyLCJcXGRlbF9pXlEiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbMCwyLCJcXHZhcnBoaV97aS0xfVxcY2lyY1xcZGVsX2leUCJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{P_i} \\
		{Q_i} & {\im \del_i^Q}
		\arrow["{\varphi_i}"', dashed, from=1-1, to=2-1]
		\arrow["{\del_i^Q}"', two heads, from=2-1, to=2-2]
		\arrow["{\varphi_{i-1}\circ\del_i^P}", from=1-1, to=2-2]
	\end{tikzcd}\]
	So, because $P_i$ is projective, we are promised an induced morphism $\varphi_i:P_i\to Q_i$ such that $\del_i^Q\circ\varphi_i=\varphi_{i-1}\circ\del_i^P$, which is what we wanted.
\end{proof}
Now, these induced chain morphisms do not look unique either (namely, the arrow provided by the projective condition need not be unique), but they are unique in the following sense.
\begin{lemma} \label{lem:uniqchainmorphism}
	Suppose that $\left(P,\del^P\right)$ and $\left(Q,\del^Q\right)$ are projective resolutions for the $R$-modules $M$ and $N$, respectively. Further, fix two chain morphisms $\alpha,\beta:P\to Q$ such that $\alpha_{-1}=\beta_{-1}$; i.e., the restrictions of $\alpha$ and $\beta$ to $M\to N$ are equal. Then $\alpha$ and $\beta$ are homotopic.
\end{lemma}
\begin{proof}
	By \autoref{lem:rlinearchainhomotopy}, it suffices to show that $\alpha-\beta\sim0$, so set $\varphi:=\alpha-\beta$. In particular, we know that $\varphi_{-1}=\alpha_{-1}-\beta_{-1}=0$, and we would like to extend this to $\varphi\sim0$.

	Unsurprisingly, we construct our chain homotopy $h$ to witness $\varphi\sim0$ inductively; i.e., we want $\varphi_i=h_{i-1}\del_i^P+\del_{i+1}^Qh_i$ for each $i$. To start off, we set $h_i=0$ for $i\le-1$ because this is a morphism $h_i:P_i\to Q_{i+1}$, which must be the zero morphism anyways. Observe that $i\le-1$ will then have
	\[\varphi_i=0=h_{i-1}\del_i^P+\del_{i+1}^Qh_i\]
	because everything involved is $0$. For the inductive step, we have $i\ge0$ and are trying to induce the arrow $h_i$ in the following diagram which does not commute.
	% https://q.uiver.app/?q=WzAsNCxbMSwwLCJQX2kiXSxbMSwxLCJRX2kiXSxbMCwxLCJRX3tpKzF9Il0sWzIsMCwiUF97aS0xfSJdLFswLDIsImhfaSIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFszLDEsImhfe2ktMX0iXSxbMCwzLCJcXGRlbF9pXlAiXSxbMCwxLCJcXHZhcnBoaV9pIiwxXSxbMiwxLCJcXGRlbF97aSsxfV5RIiwyXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		& {P_i} & {P_{i-1}} \\
		{Q_{i+1}} & {Q_i}
		\arrow["{h_i}"', dashed, from=1-2, to=2-1]
		\arrow["{h_{i-1}}", from=1-3, to=2-2]
		\arrow["{\del_i^P}", from=1-2, to=1-3]
		\arrow["{\varphi_i}"{description}, from=1-2, to=2-2]
		\arrow["{\del_{i+1}^Q}"', from=2-1, to=2-2]
	\end{tikzcd}\]
	As usual, we would like to induce $h_i$ using the fact that $P_i$ is projective. The main point is to show that $\varphi_i-h_{i-1}\del_i^P$ maps into $\im\del_{i+1}^Q=\ker\del_i^Q$. Well, because $\varphi_{i-1}=h_{i-2}\del_{i-1}^P+\del_i^Qh_{i-1}$ already, we compute
	\begin{align*}
		\del_i^Q\left(\varphi_i-h_{i-1}\del_i^P\right) &= \del_i^Q\varphi_i-\del_i^Qh_{i-1}\del_i^P \\
		&= \del_i^Q\varphi_i-\left(\varphi_{i-1}-h_{i-2}\del_{i-1}^P\right)\del_i^P \\
		&= \left(\del_i^Q\varphi_i-\varphi_{i-1}\del_i^P\right)+h_{i-2}\del_{i-1}^P\del_i^P.
	\end{align*}
	The left term here is zero because $\varphi$ is a chain morphism; the right term is zero by exactness of $P$. Thus, $\im\left(\varphi_i-h_{i-1}\del_i^P\right)\subseteq\ker\del_i^Q=\im\del_{i+1}^Q$, so the following diagram makes sense.
	% https://q.uiver.app/?q=WzAsMyxbMCwxLCJRX3tpKzF9Il0sWzEsMCwiUF9pIl0sWzEsMSwiXFxpbVxcZGVsXlFfe2krMX0iXSxbMSwwLCJoX2kiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMCwyLCJcXGRlbF97aSsxfV5RIiwyXSxbMSwyLCJcXHZhcnBoaV9pLWhfe2ktMX1cXGRlbF9pXlAiXV0=&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		& {P_i} \\
		{Q_{i+1}} & {\im\del^Q_{i+1}}
		\arrow["{h_i}"', dashed, from=1-2, to=2-1]
		\arrow["{\del_{i+1}^Q}"', two heads, from=2-1, to=2-2]
		\arrow["{\varphi_i-h_{i-1}\del_i^P}", from=1-2, to=2-2]
	\end{tikzcd}\]
	In particular, the fact that $P_i$ is projective grants us a morphism $h_i$ such that
	\[\del_{i+1}^Qh_i=\varphi_i-h_{i-1}\del_i^P,\]
	which is what we wanted.
\end{proof}
We are now ready to prove \autoref{lem:uniqprojresolution}.
\begin{proof}[Proof of \autoref{lem:uniqprojresolution}]
	To start, we use \autoref{lem:inducechainmorphism} to construct chain morphisms $\alpha:P\to Q$ and $\beta:Q\to P$ such that $\alpha_{-1}=\beta_{-1}=\id_M$.

	By symmetry, it suffices to show that $\alpha\beta\sim\id_Q$. Well, $\alpha\beta:Q\to Q$ is a chain morphism such that
	\[(\alpha\beta)_{-1}=\alpha_{-1}\beta_{-1}=\id_M\id_M=\id_M,\]
	and $\id_Q:Q\to Q$ is also a chain morphism such that $(\id_Q)_{-1}=\id_M$. This finishes by \autoref{lem:uniqchainmorphism}.
\end{proof}

\subsection{The Horseshoe Lemma}
Arguably, the ``main point'' of homology is to introduce the amazing long exact sequence in \autoref{thm:les}. To apply this story to projective resolutions, we will need a way to create a short exact sequence of projective resolutions.
\begin{prop}[Horseshoe lemma]
	Fix a short exact sequence of $R$-modules named
	\[0\to M'\to M\to M''\to 0.\]
	Further, suppose we have projections resolutions $P'$ and $P''$ for $M'$ and $M''$, respectively. Then we can form a projective resolution $P$ for $M$ such that
	\[0\to P'\to P\to P''\to 0\]
	is a short exact sequence of complexes.
\end{prop}
\begin{proof}
	This is a little technical. Let our short exact sequence of $R$-modules be
	\[0\to M'\stackrel\iota\to M\stackrel\pi\to M''\to 0,\]
	and name our projective resolutions $(P',\del')$ and $(P'',\del'')$ for $M'$ and $M''$. To ground ourselves, we'll say from the outset that
	\[P_i:=\begin{cases}
		M & i=-1, \\
		P_i'\oplus P_i'' & i\ne-1.
	\end{cases}\]
	Further, we set $\iota_i:P_i'\to P_i$ be $\iota$ at $i=-1$ and the canonical inclusion otherwise; similarly, set $\pi_i:P_i\to P_i''$ be $\pi$ at $i=-1$ and the canonical projection otherwise. Thus, $\im\iota_i=\ker\pi_i$ for all $i$, by construction. As such,
	\[0\to P'\to P\to P''\to 0\]
	will be a short exact sequence of complexes as soon as we exhibit the needed map $\del:P\to P$. We have two constraints.
	\begin{itemize}
		\item To make $(P,\del)$ a valid projective resolution, we require $\im\del_i=\ker\del_{i-1}$ for each $i$.
		\item To make $\iota$ and $\pi$ valid chain morphisms, we need $\del'_i\iota_{i-1}=\iota_i\del_i$ and $\del_i\pi_{i-1}=\pi_i\del''_i$ for each $i\le-1$.
	\end{itemize}
	Of course, we will set $\del_i=0$ for $i\le-1$ because $P_{i+1}=0$ here, which gives $\im\del_i=\ker\del_{i-1}$ as well as $\del'_i\iota_{i-1}=\iota_i\del_i$ and $\del_i\pi_{i-1}=\pi_i\del''_i$ for each $i\le-1$.

	From here, it should not be a surprise that we will inductively construct $\del_i$ for $i\ge0$. In particular, we want to exhibit $\del_i$ in the following diagram.
	% https://q.uiver.app/?q=WzAsMTAsWzIsMCwiUF97aS0xfSJdLFsyLDEsIlBfaSdcXG9wbHVzIFBfaScnIl0sWzEsMCwiUCdfe2ktMX0iXSxbMywwLCJQX3tpLTF9JyciXSxbMSwxLCJQX2knIl0sWzMsMSwiUF9pJyciXSxbMCwxLCIwIl0sWzAsMCwiMCJdLFs0LDAsIjAiXSxbNCwxLCIwIl0sWzcsMl0sWzIsMCwiXFxpb3RhX3tpLTF9Il0sWzAsMywiXFxwaV97aS0xfSJdLFszLDhdLFs2LDRdLFs0LDEsIlxcaW90YV9pIiwyXSxbMSw1LCJcXHBpX2kiLDJdLFs1LDldLFs0LDIsIlxcZGVsJ19pIl0sWzEsMCwiXFxkZWxfaSIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFs1LDMsIlxcZGVsX3tpLTF9JyciLDJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		0 & {P'_{i-1}} & {P_{i-1}} & {P_{i-1}''} & 0 \\
		0 & {P_i'} & {P_i'\oplus P_i''} & {P_i''} & 0
		\arrow[from=1-1, to=1-2]
		\arrow["{\iota_{i-1}}", from=1-2, to=1-3]
		\arrow["{\pi_{i-1}}", from=1-3, to=1-4]
		\arrow[from=1-4, to=1-5]
		\arrow[from=2-1, to=2-2]
		\arrow["{\iota_i}"', from=2-2, to=2-3]
		\arrow["{\pi_i}"', from=2-3, to=2-4]
		\arrow[from=2-4, to=2-5]
		\arrow["{\del'_i}", from=2-2, to=1-2]
		\arrow["{\del_i}"', dashed, from=2-3, to=1-3]
		\arrow["{\del_{i}''}"', from=2-4, to=1-4]
	\end{tikzcd}\tag{1}\label{eq:inductivestep}\]
	Well, we have a map $f_i:P_i'\to P_{i-1}$ by $f_i:=\iota_{i-1}\del_i'$. To get a map $P_i''\to P_{i-1}$, we use the fact that $P_i''$ is projective: $\pi_{i-1}:P_{i-1}\onto P''_{i-1}$ is a surjection, so we can pull $\del_{i-1}'':P_{i-1}\to P''_{i-1}$ backwards to a map $f_i':P_i''\to P_{i-1}$ such that $\pi_{i-1}f_i'=\del_{i-1}''$. We acknowledge that we have some freedom in our choice of $f_i'$, which we will restrict later.
	
	From here, we set
	\[\del_i:=f_i\oplus f_i'.\]
	We now run our checks on $\del_i$. Note that $\iota_{i-1}\del'_i=f_i=\del_i\iota_i$. Further, note that $\pi_{i-1}f_i=\pi_{i-1}\iota_{i-1}\del_i'=0$ by the exactness of the top row, so
	\[\pi_{i-1}\del_i=\pi_{i-1}(f_i\oplus f_i')=(\pi_{i-1}f_i)\oplus(\pi_{i-1}f_i')=0\oplus\del''_{i-1}=\del''_{i-1}\pi_i.\]
	So we have made $\iota$ and $\pi$ into valid chain morphisms.
	
	It remains to show that $(P,\del)$ is a complex which is exact everywhere; i.e., we need $\im\del_i=\ker\del_{i-1}$. The trick is to claim that we can construct such a $\del_i$ with the additional constraint that
	\[0\to\ker\del_i'\stackrel{\iota_i}\to\ker\del_i\stackrel{\pi_i}\to\ker\del_i''\to0.\]
	We show this claim by induction.
	
	When $i=0$, we simply use the above construction for $\del_i$. Then \autoref{eq:inductivestep} is a morphism of short exact sequences, so \autoref{lem:snake} gives us the exact sequence
	\[0\to\ker\del_0'\to\ker\del_0\to\ker\del_0''\to\coker\del_0'\to\coker\del_0\to\coker\del_0''\to0.\]
	But now we see that $\del_0':P_0'\to M'$ and $\del_0'':P_0''\to M''$ are both surjective, so $\coker\del_0'=0$ and $\coker\del_0''=0$. Thus, the above sequence forces $\coker\del_0=0$, so $\im\del_0=M=\ker\del_{-1}$. Additionally, we do indeed get our short exact sequence
	\[0\to\ker\del_0'\to\ker\del_0\to\ker\del_0''\to0.\]
	Now, when $i>0$, induction grants us a short exact sequence
	\[0\to\ker\del_{i-1}'\stackrel{\iota_{i-1}}\to\ker\del_{i-1}\stackrel{\pi_{i-1}}\to\ker\del_{i-1}''\to0.\]
	By exactness of $P'$ and $P''$, we see that $\im\del_i'=\ker\del_{i-1}'$ and $\im\del_i''=\ker\del_{i-1}''$, so we can rewrite \autoref{eq:inductivestep} as follows.
	% https://q.uiver.app/?q=WzAsMTAsWzEsMCwiUF9pJyJdLFswLDAsIjAiXSxbMiwwLCJQX2knXFxvcGx1cyBQX2knJyJdLFszLDAsIlBfaScnIl0sWzQsMCwiMCJdLFswLDEsIjAiXSxbMSwxLCJcXGtlclxcZGVsX3tpLTF9JyJdLFsyLDEsIlxca2VyXFxkZWxfe2ktMX0nIl0sWzMsMSwiXFxrZXJcXGRlbF97aS0xfScnIl0sWzQsMSwiMCJdLFsxLDBdLFswLDIsIlxcaW90YV9pIl0sWzIsMywiXFxwaV9pIl0sWzMsNF0sWzUsNl0sWzYsNywiXFxpb3RhX3tpLTF9IiwyXSxbNyw4LCJcXHBpX3tpLTF9IiwyXSxbOCw5XSxbMCw2LCJcXGRlbF9pJyIsMl0sWzIsNywiXFxkZWxfaSIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFszLDgsIlxcZGVsX2knJyJdXQ==&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		0 & {P_i'} & {P_i'\oplus P_i''} & {P_i''} & 0 \\
		0 & {\ker\del_{i-1}'} & {\ker\del_{i-1}'} & {\ker\del_{i-1}''} & 0
		\arrow[from=1-1, to=1-2]
		\arrow["{\iota_i}", from=1-2, to=1-3]
		\arrow["{\pi_i}", from=1-3, to=1-4]
		\arrow[from=1-4, to=1-5]
		\arrow[from=2-1, to=2-2]
		\arrow["{\iota_{i-1}}"', from=2-2, to=2-3]
		\arrow["{\pi_{i-1}}"', from=2-3, to=2-4]
		\arrow[from=2-4, to=2-5]
		\arrow["{\del_i'}"', from=1-2, to=2-2]
		\arrow["{\del_i}", dashed, from=1-3, to=2-3]
		\arrow["{\del_i''}", from=1-4, to=2-4]
	\end{tikzcd}\tag{2}\label{eq:inductivestepagain}\]
	Notably, we have chosen to replace $P_{i-1}$ with $\ker\del_{i-1}$! So now, redoing the construction of $\del_i$ with $\ker\del_{i-1}$ as the codomain, we get a map $\del_i:P_i\to\ker\del_{i-1}$ such that the above diagram commutes. Running \autoref{lem:snake} on \autoref{eq:inductivestepagain}, we get the exact sequence
	\[0\to\ker\del_i'\to\ker\del_i\to\ker\del_i''\to\coker\del_i'\to\coker\del_i\to\coker\del_i''\to0.\]
	Once more, exactness of $P'$ and $P''$ promises $\coker\del_i'=\coker\del_i''=0$, so $\coker\del_i=0$ in \autoref{eq:inductivestepagain}, meaning that $\im\del_i=\ker\del_{i-1}$, as needed. Additionally, we do indeed get
	\[0\to\ker\del_i'\to\ker\del_i\to\ker\del_i''\to0,\]
	which finishes the induction.
\end{proof}

\subsection{Left-Derived Functors}
For left-derived functors, we need to start with a right-exact functor $\Phi$.
\begin{example}
	In the discussion that follows, keeping $\Phi:=-\otimes_RM$ in mind is not a bad idea.
\end{example}
We define a family of functors $\{L_i\Phi\}_{i\in\NN}$ as follows. We start with some projective resolution of $M$ by
\[\cdots\to P_2\to P_1\to P_0\to M\to 0.\]
Applying $\Phi$, we get a new complex by
\[\cdots\to\Phi P_2\to\Phi P_1\to\Phi P_0\to M\to 0.\]
This complex need not be exact because $\Phi$ is not exact, but it is a complex, which is something that we can check. To test the exactness, we have the following.
\begin{definition}[Left-derived functor]
	In the construction above, we define $L_i\Phi:=H_i(\Phi P)$ to be the $i$th homology group of the complex $\Phi P$.
\end{definition}
This definition is well-defined by \autoref{lem:uniqprojresolution}. Here is the formal statement.
\begin{lemma}
	The left-derived functor $L_i\Phi$ does not depend on the chosen projective resolution of $M$.
\end{lemma}
\begin{proof}
	Indeed, any two projective resolutions $P$ and $Q$ for $M$ will have morphisms $\alpha:P\to Q$ and $\beta:Q\to P$ such that
	\[\beta\alpha-\id_Q\sim0.\]
	Applying $\Phi$, we see that
	\[\Phi(\beta)\Phi(\alpha)-\Phi(\id_Q)\sim0,\]
	so we get isomorphisms of homology groups.
\end{proof}
Here are some more nice properties.
\begin{lemma} \label{lem:lzero}
	We have that $L_0\Phi(M)\simeq\Phi M$.
\end{lemma}
\begin{proof}
	The point is that $\Phi$ is right-exact. Indeed, we send the right-exact sequence
	\[P_1\to P_0\to M\to 0\]
	to
	\[\Phi P_1\to\Phi P_0\to\Phi M\to 0.\]
	In particular, $\Phi M=H_0(\Phi P)=\coker(\Phi P_1\to\Phi P_0)=H_0(\Phi P)$, which is what we wanted.
\end{proof}
\begin{lemma} \label{lem:leftderivles}
	Suppose
	\[0\to M'\to M\to M''\to 0\]
	an exact sequence of $R$-modules. Then there is a long exact sequence of left-derived functors, given by
	% https://q.uiver.app/?q=WzAsOCxbMCwwLCJcXGNkb3RzIl0sWzEsMCwiTF9pXFxQaGkoTScpIl0sWzIsMCwiTF9pXFxQaGkoTSkiXSxbMywwLCJMX2lcXFBoaShNJycpIl0sWzEsMSwiTF97aS0xfVxcUGhpKE0nKSJdLFsyLDEsIkxfe2ktMX1cXFBoaShNKSJdLFszLDEsIkxfe2ktMX1cXFBoaShNJycpIl0sWzQsMSwiXFxjZG90cyJdLFswLDFdLFsxLDJdLFsyLDNdLFszLDRdLFs0LDVdLFs1LDZdLFs2LDddXQ==
	\[\begin{tikzcd}
		\cdots & {L_i\Phi(M')} & {L_i\Phi(M)} & {L_i\Phi(M'')} \\
		& {L_{i-1}\Phi(M')} & {L_{i-1}\Phi(M)} & {L_{i-1}\Phi(M'')} & \cdots
		\arrow[from=1-1, to=1-2]
		\arrow[from=1-2, to=1-3]
		\arrow[from=1-3, to=1-4]
		\arrow[from=1-4, to=2-2]
		\arrow[from=2-2, to=2-3]
		\arrow[from=2-3, to=2-4]
		\arrow[from=2-4, to=2-5]
	\end{tikzcd}\]
\end{lemma}
\begin{proof}
	Choose projective resolutions $P'$ and $P$ and $P''$ for $M'$ and $M$ and $M''$ so that we have a short exact sequence
	\[0\to P'\to P\to P''\to 0\]
	of projective resolutions. Then this gives rise to a long exact sequence of homology, which is what we wanted.
\end{proof}
\begin{remark}
	There is an analogous theory for right-derived functors for left-exact functors by simply flipping all the arrows. For example, instead of using projective resolutions, we use injective resolutions. The only technicality is showing that all modules can be embedded into an injective module, which is not easy.
\end{remark}

\subsection{The Functor \texorpdfstring{$\op{Tor}$}{Tor}}
We have the following definition.
\begin{defihelper}[\texorpdfstring{$\op{Tor}$}{Tor}] \nirindex{Tor@$\op{Tor}$}
	Fix $M$ an $R$-module. Then the functor $M\otimes_R-$ is a right-exact functor, so we define $\op{Tor}_i^R(M,N):=L_i(M\otimes_RN)$.
\end{defihelper}
In practice, what happens is that we take a projective resolution $P$ of $M$ written as
\[\cdots\to P_1\to P_0\to M\to 0.\]
Then we apply the functor $N\otimes_R-$ to get
\[\cdots\to N\otimes_RP_1\to N\otimes_RP_0\to N\otimes_RN\to0,\]
and $\op{Tor}_i^R(M,N)$ will be our $i$th homology group. For example, \autoref{lem:lzero} tells us that
\[\op{Tor}_0^R(M,N)\cong M\otimes_RN.\]
This is symmetric, which is perhaps unsurprising.
\begin{remark}
	It is more generally true that $\op{Tor}_i^R(M,N)\simeq\op{Tor}_i^R(N,M)$, but we will not use this. Its proof of somewhat more advanced.
\end{remark}
Let's continue collecting properties.
\begin{lemma}
	Fix $R$ a Noetherian ring and $M,N$ finitely generated $R$-modules. Then $\op{Tor}_i^R(M,N)$ is finitely generated for all $i$.
\end{lemma}
\begin{proof}
	Omitted.
\end{proof}
\begin{lemma}
	If we have a short exact sequence
	\[0\to M'\to M\to M''\to 0,\]
	then we have a long exact sequence of $\op{Tor}$.
\end{lemma}
\begin{proof}
	Use \autoref{lem:leftderivles}.
\end{proof}
\begin{lemma}
	If $F$ is a free $R$-module, then $\op{Tor}_i^R(F,N)\simeq0$ for all $i>0$.
\end{lemma}
\begin{proof}
	The projective resolution for $F$ is almost trivial and in particular trivial for $i>0$.
\end{proof}
\begin{lemma}
	Fix $S$ a flat $R$-algebra. Then
	\[S\otimes_R\op{Tor}_i^R(M,N)\simeq\op{Tor}_i^S(S\otimes_RM,S\otimes_RN).\]
\end{lemma}
\begin{proof}
	Build a projective resolution by hand and apply the definitions.
\end{proof}
Let's see an application.
\begin{exe}
	Fix $a\in R$ an element which is not a zero-divisor. Further, fix $M$ an $R$-module. Then we compute $\op{Tor}_i^R(R/(a),M)$.
\end{exe}
\begin{proof}
	The main point is to construct a projective resolution for $R/(a)$. Namely, we take
	\[\cdots\to 0\to 0\to R\stackrel a\to R\to R/(a)\to 0.\]
	Tensoring with $M$, we get the complex
	\[\cdots0\to 0\to M\stackrel a\to M\to 0.\]
	In particular, we vanish for $i>2$, so we have left to compute for $i=0$ and $i=1$.
	\begin{itemize}
		\item We see $\op{Tor}_0^R(R/(a),M)\cong R/(a)\otimes_RM\cong M/aM$.
		\item We see $\op{Tor}_1^R(R/(a),M)=\ker(M\stackrel a\to M)=\{m\in M:am=0\}$ from the above complex.
	\end{itemize}
	The above computation finishes the proof.
\end{proof}

\subsection{Flatness via \texorpdfstring{$\op{Tor}$}{Tor}}
Here is our main result for today.
\begin{theorem}
	Fix $M$ an $R$-module.
	\begin{listalph}
		\item We have $M$ is flat if and only if $\op{Tor}_1^R(M,N)=0$ for any $R$-module $N$.
		\item If $M$ is flat, then $\op{Tor}_i^R(M,N)=0$ for all $i\ge0$ and $R$-modules $N$.
	\end{listalph}
\end{theorem}
\begin{proof}
	We start with (a). In one direction, suppose that $\op{Tor}_1^R(M,N)=0$ for all $R$-modules $N$. Then we note we have, for any short exact sequence
	\[0\to N'\to N\to N''\to 0,\]
	we get a long exact sequence
	\[\op{Tor}_1^R(M,N'')\to\op{Tor}_0^R(M,N')\to\op{Tor}_0^R(M,N)\to\op{Tor}(M,N'')\to 0.\]
	But now we see that $\op{Tor}_1^R(M,N'')$ vanishes, so we get the short exact sequence
	\[0\to M\otimes_R N''\to M\otimes_R N\to M\otimes_RN'\to0,\]
	which is what we wanted.

	In the other direction, let $M$ be a flat module, and fix $N$ any $R$-module. Well, fix some free module $F$ with a projection $F\onto N$, and we build the short exact sequence
	\[0\to K\to F\to N\to 0.\]
	Then the long exact sequence will look like
	\[\op{Tor}_1^R(M,F)\to\op{Tor}_1^R(M,N)\to\op{Tor}_0^R(M,K)\to\op{Tor}_0^R(M,F)\to\op{Tor}_0^R(M,N)\to0.\]
	However, $\op{Tor}_1^R(M,F)=0$, so the exactness of
	\[0\to\op{Tor}_0^R(M,K)\to\op{Tor}_0^R(M,F)\to\op{Tor}_0^R(M,N)\to0\]
	by $M$'s flatness forces $\op{Tor}_1^R(M,N)=0$, as desired.

	We now show (b). Once more, fix $M$ flat and $F\onto M$ some projection so that we can build the short exact sequence
	\[0\to K\to F\to M\to 0.\]
	Our goal is to show that $K$ is flat, which will show that $\op{Tor}_2^R(M,-)=\op{Tor}_1^R(K,-)$ is zero by ``dimension-shifting.'' Well, pick up some short exact sequence
	\[0\to N'\to N\to N''\to 0.\]
	By using the long exact sequence of $\op{Tor}$, we are able to conclude that the following very large diagram has exact rows.
	% https://q.uiver.app/?q=WzAsMTksWzAsMSwiMCJdLFsxLDEsIktcXG90aW1lcyBOJyJdLFsxLDIsIktcXG90aW1lcyBOIl0sWzEsMywiS1xcb3RpbWVzIE4nJyJdLFswLDIsIjAiXSxbMCwzLCIwIl0sWzIsMSwiRlxcb3RpbWVzIE4nIl0sWzIsMiwiRlxcb3RpbWVzIE4iXSxbMiwzLCJGXFxvdGltZXMgTicnIl0sWzMsMSwiTVxcb3RpbWVzIE4nIl0sWzMsMiwiTVxcb3RpbWVzIE4iXSxbMywzLCJNXFxvdGltZXMgTicnIl0sWzQsMSwiMCJdLFs0LDIsIjAiXSxbNCwzLCIwIl0sWzIsMCwiMCJdLFszLDAsIjAiXSxbMiw0LCIwIl0sWzMsNCwiMCJdLFswLDFdLFsxLDZdLFs2LDldLFs5LDEyXSxbNCwyXSxbMiw3XSxbNywxMF0sWzEwLDEzXSxbNSwzXSxbMyw4XSxbOCwxMV0sWzExLDE0XSxbMTUsNl0sWzYsN10sWzcsOF0sWzgsMTddLFsxNiw5XSxbOSwxMF0sWzEwLDExXSxbMTEsMThdLFsxLDJdLFsyLDNdXQ==
	\[\begin{tikzcd}
		&& 0 & 0 \\
		0 & {K\otimes N'} & {F\otimes N'} & {M\otimes N'} & 0 \\
		0 & {K\otimes N} & {F\otimes N} & {M\otimes N} & 0 \\
		0 & {K\otimes N''} & {F\otimes N''} & {M\otimes N''} & 0 \\
		&& 0 & 0
		\arrow[from=2-1, to=2-2]
		\arrow[from=2-2, to=2-3]
		\arrow[from=2-3, to=2-4]
		\arrow[from=2-4, to=2-5]
		\arrow[from=3-1, to=3-2]
		\arrow[from=3-2, to=3-3]
		\arrow[from=3-3, to=3-4]
		\arrow[from=3-4, to=3-5]
		\arrow[from=4-1, to=4-2]
		\arrow[from=4-2, to=4-3]
		\arrow[from=4-3, to=4-4]
		\arrow[from=4-4, to=4-5]
		\arrow[from=1-3, to=2-3]
		\arrow[from=2-3, to=3-3]
		\arrow[from=3-3, to=4-3]
		\arrow[from=4-3, to=5-3]
		\arrow[from=1-4, to=2-4]
		\arrow[from=2-4, to=3-4]
		\arrow[from=3-4, to=4-4]
		\arrow[from=4-4, to=5-4]
		\arrow[from=2-2, to=3-2]
		\arrow[from=3-2, to=4-2]
	\end{tikzcd}\]
	Now, the two left rows are exact by flatness of $F$ and $M$, so we conclude that the right row is also a short exact sequence by the Nine lemma.

	To finish, we note that the long exact sequence of $\op{Tor}$ tells us that
	\[\op{Tor}_i^R(M,N)\simeq\op{Tor}_{i-1}^R(K,N),\]
	so because both $M$ and $K$ are flat here, we can finish by induction.\footnote{This sort of induction is called dimension-shifting.}
\end{proof}
Here is an example of testing the condition.
\begin{lemma}
	Fix $R$ a ring and $I\subseteq R$ an ideal and $M$ an $R$-module. We show that $\op{Tor}_1^R(R/I,M)$ vanishes if and only if the map $I\otimes_RM\to M$ is injective.
\end{lemma}
\begin{proof}
	The point is to begin with the short exact sequence
	\[0\to I\to R\to R/I\to 0.\]
	Writing the long exact sequence for $\op{Tor}^R_\bullet(M,-)$, we get
	\[\underbrace{\op{Tor}_1^R(R,M)}_0\to\op{Tor}_1^R(R/I,M)\to\underbrace{\op{Tor}_0^R(I,M)}_{I\otimes M}\to\underbrace{\op{Tor}_0^R(R,M)}_M\to\op{Tor}_0^R(R/I,M).\]
	By exactness, we see that $\op{Tor}_1^R(R/I,M)$ will vanish if and only if the map $I\otimes_RM\to M$ is injective, which is what we wanted.
\end{proof}
To use this, we have the following result.
\begin{theorem}
	An $R$-module $M$ is flat if and only if $\op{Tor}_1^R(R/I,M)=0$ for all finitely generated ideals $I\subseteq R$.
\end{theorem}
\begin{proof}
	In one step, we note that checking finitely generated ideals $I$ gives all ideals $I$ because we are really checking that the map
	\[I\otimes M\to M\]
	has trivial kernel. Well, if we find some $\sum x\otimes m$ which goes to $0$, then this really only needs finitely many generators to be witnessed because the tensor product permits only finitely many sums.

	So now we know that $\op{Tor}_1^R(R/I,M)=0$ for all ideals $I$. It remains to show that $\op{Tor}_1^R(M,N)=0$. Well, to show that $M$ is flat, we need to show that embeddings $N'\into N$ induce embeddings $M\otimes_RN'\to M\otimes_RN$. But if not, there is an element of the kernel, which allows us to reduce $N'$ to a cyclic module and $N$ to a finitely generated module. Then we can build a cyclic filtration
	\[N'\subseteq N_1\subseteq\cdots\subseteq N_k=N\]
	and build $\op{Tor}_1^R(M,N_\bullet)$ manually.
\end{proof}