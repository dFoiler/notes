% !TEX root = ../notes.tex

Welcome back from spring break.

% \subsection{Review}
% We start with a little review. Here was our central definition.
% \krulldimdef*
% \noindent Further, if $\mf p\subseteq R$ is prime, we defined the codimension
% \[\codim\mf p:=\dim R/\mf p.\]
% As an example of something we showed, $\dim R=0$ if and only if $R$ is Artinian. We also showed that integral extensions preserve dimension.
% \intextensiondimension*
% \noindent And we also showed the principal ideal theorem.
% \pidtheorem*
% \noindent We also generalized this to minimal primes over ideals $I$ with $s$ generators. In particular, if $\mf p=(x_1,\ldots,x_r)$, then
% \[\codim\mf p\le r.\]
% We were even able to provide a converse.
% \pidthmconverse*
% \begin{example}
% 	Given a polynomial ring $k[x_1,\ldots,x_n]$, fix $\mf p:=(x_1,\ldots,x_k)$. Then
% 	\[\codim\mf p=k,\]
% 	which we could also see directly by constructing the chain
% 	\[(0)\subseteq(x_1)\subseteq\cdots\subseteq(x_1,\ldots,x_k)=\mf p.\]
% \end{example}

\subsection{More Local Dimension}
In light of \autoref{thm:dimislocal}, we can compute dimension via localizations, so we will focus on local rings.
\begin{lemma} \label{lem:dimiscodim}
	Fix a local ring $R$ with unique maximal ideal $\mf m$. Then $\dim R=\codim\mf m$.
\end{lemma}
\begin{proof}
	Certainly $\codim\mf m\le\dim R$ by \autoref{prop:upperbounddimension}, so we need to show $\dim R\le\codim\mf m$. Well, fix any chain of distinct primes
	\[\mf p_0\subsetneq\mf p_1\subsetneq\cdots\subsetneq\mf p_{d-1}\subsetneq\mf p_d\]
	in $R$, we claim that $d\le\codim\mf m$, which will finish by setting $d=\dim R$. Note that $\mf m$ is the unique maximal ideal, so $\mf p_d\subseteq\mf m$. As such, we can replace $\mf p_d$ at the end with $\mf m$ (namely, if $\mf p_{d-1}$ exists and is strictly contained in $\mf p_d\subseteq\mf m$, then $\mf p_{d-1}\subsetneq\mf m$ as well), so we have a chain
	\[\mf p_0\subsetneq\mf p_1\subsetneq\cdots\subsetneq\mf p_{d-1}\subsetneq\mf m\]
	of length $d$ descending from $\mf m$. As such, $d\le\codim\mf m$ by \autoref{lem:codimisdescend}.
\end{proof}
\begin{proposition} \label{prop:betterlocaldim}
	Fix a local ring $R$ with maximal ideal $\mf m$. Then $\dim R$ is the minimal $d\in\NN$ such that there exist generators $f_1,\ldots,f_d$ so that
	\[\mf m^n\subseteq(f_1,\ldots,f_d)\subseteq\mf m\]
	for some $n$.
\end{proposition}
\begin{proof}
	The point is to use the Principal ideal theorem to use the number of generators. By \autoref{lem:dimiscodim}, we have $\dim R=\codim\mf m$. We now take our implications separately.
	\begin{itemize}
		\item Suppose that we have some $d$ generators $f_1,\ldots,f_d$ and some $n\in\NN$ so that
		\[\mf m^n\subseteq(f_1,\ldots,f_d)\subseteq\mf m.\]
		We show $d\ge\dim R=\codim\mf m$. By \autoref{thm:pit}, it suffices to show $\mf m$ is minimal over $(f_1,\ldots,f_d)$. Well, by \autoref{lem:minprimegrabbag}, we note that $\mf m^n\subseteq(f_1,\ldots,f_d)$ provides this for free.
		\item In the other direction, we note that \autoref{cor:pitconverse} provides us with $d:=\codim\mf m=\dim R$ generators $f_1,\ldots,f_d$ such that $\mf m$ is minimal over $(f_1,\ldots,f_d)$. But then \autoref{lem:minprimegrabbag} tells us that there exists some $n$ such that
		\[\mf m^n\subseteq(f_1,\ldots,f_d).\]
		Noting $\mf m$ contains $(f_1,\ldots,f_d)$ because $\mf m$ is minimal over $(f_1,\ldots,f_d)$, we are done.
	\end{itemize}
	From the above two points, we see that the minimal number $d$ such that there exist elements $f_1,\ldots,f_d\in R$ such that
	\[\mf m^n\subseteq(f_1,\ldots,f_d)\subseteq\mf m\]
	is at least $\codim\mf m$ by the first point above, but $\codim\mf m$ is achievable by the second point above, so we conclude $d=\codim\mf m=\dim R$.
\end{proof}
\begin{remark}
	There is a geometric meaning to the discovered $\{f_1,\ldots,f_d\}$. Namely, if $X$ is an algebraic set, and $P\in X$ is a point, then we can set $R:=A(X)$ to be our coordinate ring and $\mf m$ the maximal ideal corresponding to $P$.
	
	Here, the functions $\{f_1,\ldots,f_d\}$ from \autoref{prop:betterlocaldim} will be ``local coordinates'' in a neighborhood of $P$. In other words, these elements $f_k$ have powers which go to $0$, so they are approximately providing an infinitesimal (i.e., ``differential'') basis of some small region around $P$, which indeed what we feel the dimension at $P$ should be.
\end{remark}

\subsection{The Rank--Nullity Theorem}
Working in $\mathrm{Vec}_k$, our notion of dimension has its usual geometric meaning. One important result in linear algebra is the Rank--nullity theorem, which says that a map of vector spaces $\varphi:X\to B$ (thinking of this as giving a ``family'' of vector spaces over $B$) will give
\[\dim X=\dim\im\varphi+\dim\ker\varphi.\]
We would like to remove the data of $\varphi$ from this equation, which we do in two steps.
\begin{itemize}
	\item Certainly $\im\varphi\subseteq B$, so we callously bound $\dim\im\varphi\le\dim B$.
	\item We would like to think of dimension as a local quantity, so instead of looking at $\ker\varphi$ as the pre-image of specifically $0\in B$, we choose any $p\in B$ and note that we are looking at $\dim\varphi^{-1}(p)$, roughly speaking.
\end{itemize}
So in total, we are getting
\[\dim X\le\dim B+\dim\varphi^{-1}(p).\]
Now, translating this into the algebraic context, we set $R=A(B)$ and $S=A(X)$ so that we have the map $\varphi^*:R\to S$, which makes $S$ into an $R$-algebra. Choosing some $p\in B$ with corresponding maximal ideal $\mf m\subseteq R$, we note that the coordinate ring of $\varphi^{-1}(p)$ is $S/\mf mS$, so we can fully translate the above inequality as asking for
\[\dim S\stackrel?\le\dim R+\dim S/\mf mS.\]
Because we no longer expect dimension to be so uniform in a general algebraic variety, we will not expect the above inequality to hold whole-sale. However, if we do look locally at some point in $S$ which is going to $p$, we are expecting something like a linear transformation between these, so perhaps we can salvage this.

We could either manually localize $S$ to get this effect, but we will just force $S$ and $R$ to be local, say with maximal ideals $\mf n$ and $\mf m$ respectively. Then looking at a point in $q\in X$ which goes to $p\in B$ is really just asking for $\varphi(q)=p$, which translates into $(\varphi^*)^{-1}(\mf n)=\mf m$ on the algebraic side. As such, we have the following.
\begin{proposition}[Rank--nullity] \label{prop:ranknullity}
	Fix two local rings $R$ and $S$ with maximal ideals $\mf m$ and $\mf n$, respectively. Given a map $\varphi:R\to S$ of local rings so that $\varphi(\mf m)\subseteq\mf n$, we have
	\[\dim S\le\dim R+\dim S/\mf mS\]
	In fact, if $S$ is a flat as an $R$-module, then we have equality.
\end{proposition}
\begin{proof}
	We use \autoref{prop:betterlocaldim}. For brevity, set $r:=\dim R$ and $s:=\dim S/\mf mS$. As such, \autoref{prop:betterlocaldim} promises us elements $\{f_1,\ldots,f_r\}\subseteq\mf m$ and some $p\in\NN$ such that
	\[\mf m^p\subseteq(f_1,\ldots,f_r)\subseteq\mf m.\]
	On the other hand, let $\pi:S\to S/\mf mS$ be the natural projection and note that \autoref{lem:pullmax} implies that the only maximal ideal of $S/\mf mS$ is $\pi\mf n$ because this is the only maximal ideal of $S$ containing $\mf mS$. (Note $\mf n\supseteq\mf mS$ follows from $\varphi(\mf m)\subseteq\mf n$.) As such, \autoref{prop:betterlocaldim} promises $\{\pi g_1,\ldots,\pi g_s\}\subseteq\pi\mf n$ and $q\in\NN$ so that
	\[(\pi\mf n)^q\subseteq(\pi g_1,\ldots,\pi g_s)\subseteq\pi\mf n.\]
	Pulling back along $\pi$, we see that
	\[\mf n^q=(\mf n+\mf mS)^q\subseteq(g_1,\ldots,g_s)+\mf mS\subseteq\mf n+\mf mS=\mf n\]
	because $\pi^{-1}$ preserves inclusions.

	We thus compute
	\begin{align*}
		\mf n^{pq} &= \left(\mf n^q\right)^p \\
		&\subseteq\big((g_1,\ldots,g_s)+\mf mS\big)^p \\
		&=\sum_{k=0}^p(g_1,\ldots,g_s)^k\cdot(\mf mS)^{p-k} \\
		&\subseteq(g_1,\ldots,g_s)+(\mf mS)^p.
	\end{align*}
	Now, $\mf mS$ is generated by elements of the form $\varphi(x)$ for $x\in\mf m$, so $(\mf mS)^p$ is generated by elements of the form $\varphi(x_1)\cdot\ldots\cdot\varphi(x_p)=\varphi(x_1\cdot\ldots\cdot x_p)$, which are exactly the generators of $\mf m^pS$. As such, we can compute
	\[\mf n^{pq}\subseteq(g_1,\ldots,g_s)+(\mf mS)^p\subseteq(g_1,\ldots,g_s)+(\varphi f_1,\ldots,\varphi f_d),\]
	which is still contained in $\mf n$ because all the generators are contained in $\mf n$ by construction or in $\varphi\mf m\subseteq\mf n$ by construction. Thus, $\dim S\le r+s$ by \autoref{prop:betterlocaldim}, which is what we wanted.
\end{proof}
We can even give an equality case to our Rank--nullity theorem. In particular, if we force $S$ to be flat, then we expect to have ``continuously varying'' fibers, so we should not have any of the disruption of local problems that forced us to localize $S$. As such, we have the following.
\begin{proposition} \label{prop:ranknullityflat}
	Fix two local rings $R$ and $S$ with maximal ideals $\mf m$ and $\mf n$, respectively. Given a map $\varphi:R\to S$ of local rings so that $\varphi(\mf m)\subseteq\mf n$ and $S$ is flat as an $R$-module, we have
	\[\dim S=\dim R+\dim S/\mf mS.\]
\end{proposition}
\begin{proof}
	\autoref{prop:ranknullity} promises
	\[\dim S\le\dim R+\dim S/\mf mS,\]
	so we need $\dim S\ge\dim R+\dim S/\mf mS$. As before, set $r:=\dim R$ and $s:=\dim S/\mf mS$ for brevity. By \autoref{lem:dimisascend}, we can pick up some chain of primes
	\[\mf mS\subseteq\mf p_0\subsetneq\mf p_1\subsetneq\cdots\subsetneq\mf p_s,\]
	so we set $\mf q:=\mf p_0$. As such, we see $\dim\mf q=\dim S/\mf mS=s$ by \autoref{lem:dimisascend} because being able to make any chain longer ascending from $\mf q$ would make both $\dim\mf q$ and $\dim S/\mf mS$ larger. Notably, $\mf q$ is a minimal prime over $\mf mS$, lest we be able to insert a prime between $\mf mS$ and $\mf p_0$ in the above chain.
	
	Now, \autoref{prop:upperbounddimension} tells us that
	\[\dim S\ge\dim\mf q+\codim\mf q=s+\codim\mf q,\]
	so to get $\dim S\ge\dim R+\dim S/\mf mS$, we need $\codim\mf q\ge r$. We will show this by hand, taking chains of primes down in $R$ up to $S$, so we pick up the following lemma.
	\begin{lemma}[Going down] \label{lem:godown}
		Fix a flat $R$-algebra $S$ with $\varphi\colon R\to S$. Further, pick up prime ideals $\mf p'\subseteq\mf p$ in $R$ such that we have a lift prime $\mf q$ in $S$ with $\mf p=\varphi^{-1}\mf q$. Then there is a $\mf q'\subseteq\mf q$ in $S$ such that $\mf p'=\varphi^{-1}\mf q'$.
	\end{lemma}
	\begin{proof}
		Pictorially, we are building $\mf q'$ in the following diagram.
		% https://q.uiver.app/?q=WzAsNixbMCwxLCJcXG1mIHAnIl0sWzEsMSwiXFxtZiBwIl0sWzIsMSwiUiJdLFsyLDAsIlMiXSxbMCwwLCJcXGNvbG9ye3JlZH1cXG1mIHEnIl0sWzEsMCwiXFxtZiBxIl0sWzIsMywiXFx2YXJwaGkiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzUsMSwiIiwyLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs0LDAsIiIsMix7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbNCw1LCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzUsMywiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDEsIlxcc3Vic2V0ZXEiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSwyLCJcXHN1YnNldGVxIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
		\[\begin{tikzcd}
			{\color{red}\mf q'} & {\mf q} & S \\
			{\mf p'} & {\mf p} & R
			\arrow["\varphi"', no head, from=2-3, to=1-3]
			\arrow[no head, from=1-2, to=2-2]
			\arrow[no head, from=1-1, to=2-1]
			\arrow["\subseteq"{marking}, draw=none, from=1-1, to=1-2]
			\arrow["\subseteq"{marking}, draw=none, from=1-2, to=1-3]
			\arrow["\subseteq"{description}, draw=none, from=2-1, to=2-2]
			\arrow["\subseteq"{description}, draw=none, from=2-2, to=2-3]
		\end{tikzcd}\]
		For psychological reasons, we mod out by $\mf p'$. Let $\alpha\colon R\onto R/\mf p'$ and $\beta\colon S\onto S/\mf p'S$ be the canonical projections. We have the following reduction checks.
		\begin{itemize}
			\item Note that $S/\mf p'S\cong S\otimes_RR/\mf p'$ (\autoref{prop:tensorquotient}) is still flat as an $R/\mf p'$-algebra by the composite
			\[R/\mf p'\to S\otimes_RR/\mf p'\cong S/\mf p'S.\]
			Namely, the coset $r+\mf p'$ goes to $\varphi(r)\otimes(1+\mf p')=1_S\otimes(r+\mf p')$ goes to $r1_S+\mf p'S$; we call this map $\overline\varphi$. A direct explanation for the flatness was given on the homework, but the fastest way to see this is that, for any $R/\mf p'$-module $N$, we have
			\[\op{Tor}_1^{R/\mf p'}(N,S\otimes_RR/\mf p')\cong\op{Tor}_1^{R/\mf p'}(N\otimes_RR/\mf p',S\otimes_RR/\mf p')\cong R/\mf p'\otimes_R\op{Tor}_1^R(N,S)=0,\]
			where we are using \autoref{thm:flatisacyclic} and \autoref{lem:flattorbasechange}. It follows $S\otimes_RR/\mf p'$ is indeed flat.
			\item Now, as noted in \autoref{lem:dimisascend}, modding out by $\mf p'$ preserves primality, so $\beta\mf q$ and $\alpha\mf p$ and $\alpha\mf p'=(0)$ are all still primes.
			\item We check that $\beta\mf q$ still lies over $\alpha\mf p$. We compute
			\[\overline\varphi^{-1}(\beta\mf q)=\{r+\mf p':\overline\varphi(r+\mf p')\in\beta\mf q\}=\{r+\mf p':\varphi(r)+\mf p'S\in\beta\mf q\}.\]
			Now, because $\mf p'S\subseteq\mf pS\subseteq\mf q$, we see that $\varphi(r)+\mf p'S\in\beta\mf q$ is equivalent to $\varphi(r)\equiv x\pmod{\mf p'S}$ for some $x\in\mf q$ is equivalent to $\varphi(r)\in\mf q$. But this is equivalent to $r\in\varphi^{-1}\mf q=\mf p$, so we conclude
			\[\overline\varphi^{-1}(\beta\mf q)=\{r+\mf p':r\in\mf p\}=\alpha\mf p.\]
			\item Lastly, we cover the conclusion. If we can find some prime $\beta\mf q'\subseteq\beta\mf q$ in $S/\mf p'S$ lying over $\alpha\mf p'=(0)$, then pulling back to $S$ gives us a prime $\mf q'=\beta\mf q'+\mf p'S$. Note $\mf p'S\subseteq\mf q'$ by construction, and because pre-images preserve inclusion, we get $\mf q'\subseteq\mf q$ as well.

			It remains to check that we will actually have $\mf q'$ lying over $\mf p'$. Certainly $\mf p'\subseteq\varphi^{-1}\mf q'$ because $\varphi\mf p'\subseteq\mf p'S\subseteq\mf q'$ by construction.
			
			On the other hand, if $a\in\varphi^{-1}\mf q'$, then $\varphi a\in\mf q'$, so $\overline\varphi(a+\mf p')=\varphi a+\mf p'S\in\beta\mf q'$. But $\beta\mf q'$ lies over $\alpha\mf p'=(0)$, so we conclude $a+\mf p'=(0)$, so $a\in\mf p'$. This finishes.
		\end{itemize}
		Thus, we may replace $R$ with $R/\mf p$, replace $S$ with $S/\mf p'S$, replace $\mf p'$ and $\mf p$ with $\alpha\mf p'=(0)$ and $\alpha\mf p$, and replace $\mf q$ with $\beta\mf q$. We have checked that $S$ is still a flat $R$-algebra and that $\mf q$ still lies over $\mf p$, and we know that it will suffice to construct a prime $\mf q'\subseteq\mf q$ lying over $\mf p'$.

		However, we now know that $\mf p'=(0)$ and that $R$ is an integral domain. As such, here is our new diagram.
		\[\begin{tikzcd}
			{\color{red}\mf q'} & {\mf q} & S \\
			{(0)} & {\mf p} & R
			\arrow["\varphi"', no head, from=2-3, to=1-3]
			\arrow[no head, from=1-2, to=2-2]
			\arrow[no head, from=1-1, to=2-1]
			\arrow["\subseteq"{marking}, draw=none, from=1-1, to=1-2]
			\arrow["\subseteq"{marking}, draw=none, from=1-2, to=1-3]
			\arrow["\subseteq"{description}, draw=none, from=2-1, to=2-2]
			\arrow["\subseteq"{description}, draw=none, from=2-2, to=2-3]
		\end{tikzcd}\]
		With this in mind, we define $\mf q'$ to be a minimal prime (over $(0)$) contained in $\mf q$, which certainly exists by saying something about Zorn's lemma.\footnote{Set $\mathcal S:=\{\mf q'\in\op{Spec}S:\mf q'\subseteq\mf q\}$. This is nonempty because $\mf q\in\mathcal S$. All descending chains have a lower bound because primes are closed under intersection in chains.} Notably, $\mf q'\subseteq\mf q'$ is free, so it remains to show that
		\[\varphi^{-1}(\mf q)\stackrel?=(0).\]
		Certainly $(0)\subseteq\varphi^{-1}(\mf q)$. On the other hand, fix any $a\in R\setminus\{0\}$, and we show $\varphi(a)\notin\mf q'$. Indeed, because $S$ is flat (!), we see
		\[0=\op{Tor}_1^R(R/(a),S)\cong\{s\in S:\varphi(a)s=a\cdot s=0\}\]
		by \autoref{thm:flatisacyclic} and \autoref{exe:torquotientcomputation}.
		
		In particular, $\varphi(a)$ is a non-zero-divisor in $S$, so $a\notin\mf q'$ by minimality: viewing $S$ as an $S$-module, we see $\op{Ann}_SS=(0)$, so $\mf q'$ being minimal over $(0)$ implies that $\mf q'$ is associated to $S$ by \autoref{prop:minassprimes} and so $\mf q'=\op{Ann}s$ for some $s\in S$, meaning that $\mf q'$ only contains $0$ and zero-divisors. This finishes.
	\end{proof}
	Now, our lemma makes quick work of the theorem. From \autoref{lem:dimiscodim}, we note that $r=\dim R=\codim\mf m$, so \autoref{lem:codimisdescend} promises us a descending chain as follows.
	\[\mf p_0\subsetneq\mf p_1\subsetneq\cdots\subsetneq\mf p_{r-1}\subsetneq\mf p_r=\mf m.\]
	Very quickly, we check that $\mf q$ lies over $\mf m$: by construction, $\mf q$ is minimal over $\mf mS$, so we get $\mf m\subseteq\varphi^{-1}(\mf q)$ for free. But $\varphi^{-1}(\mf q)$ is prime and hence proper, so $\varphi^{-1}(\mf q)\subseteq\mf m$ follows because $R$ is local.

	As such, we may inductively apply \autoref{lem:godown} to build a chain of primes descending from $\mf q:=\mf q_r$ as follows.
	% https://q.uiver.app/?q=WzAsMTIsWzQsMCwiXFxtZiBxX2QiXSxbMywwLCJcXG1mIHFfe2QtMX0iXSxbMiwwLCJcXGNkb3RzIl0sWzEsMCwiXFxtZiBxXzEiXSxbNCwxLCJcXG1mIHBfZCJdLFszLDEsIlxcbWYgcF97ZC0xfSJdLFswLDAsIlxcbWYgcV8wIl0sWzAsMSwiXFxtZiBwXzAiXSxbMSwxLCJcXG1mIHBfMSJdLFsyLDEsIlxcY2RvdHMiXSxbNSwwLCJTIl0sWzUsMSwiUiJdLFs2LDMsIlxcc3Vic2V0ZXEiLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMywyLCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzIsMSwiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxLDAsIlxcc3Vic2V0ZXEiLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMCwxMCwiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs3LDgsIlxcc3Vic2V0bmVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzgsOSwiXFxzdWJzZXRuZXEiLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbOSw1LCJcXHN1YnNldG5lcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs1LDQsIlxcc3Vic2V0bmVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzQsMTEsIlxcc3Vic2V0bmVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzYsNywiIiwzLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFszLDgsIiIsMyx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSw1LCIiLDMseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzAsNCwiIiwzLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxMCwxMSwiXFx2YXJwaGkiLDAseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d&macro_url=https%3A%2F%2Fraw.githubusercontent.com%2FdFoiler%2Fnotes%2Fmaster%2Fnir.tex
	\[\begin{tikzcd}
		{\mf q_0} & {\mf q_1} & \cdots & {\mf q_{r-1}} & {\mf q_r} & S \\
		{\mf p_0} & {\mf p_1} & \cdots & {\mf p_{r-1}} & {\mf p_r} & R
		\arrow["\subseteq"{marking}, draw=none, from=1-1, to=1-2]
		\arrow["\subseteq"{marking}, draw=none, from=1-2, to=1-3]
		\arrow["\subseteq"{marking}, draw=none, from=1-3, to=1-4]
		\arrow["\subseteq"{marking}, draw=none, from=1-4, to=1-5]
		\arrow["\subseteq"{marking}, draw=none, from=1-5, to=1-6]
		\arrow["\subsetneq"{marking}, draw=none, from=2-1, to=2-2]
		\arrow["\subsetneq"{marking}, draw=none, from=2-2, to=2-3]
		\arrow["\subsetneq"{marking}, draw=none, from=2-3, to=2-4]
		\arrow["\subsetneq"{marking}, draw=none, from=2-4, to=2-5]
		\arrow["\subsetneq"{marking}, draw=none, from=2-5, to=2-6]
		\arrow[no head, from=1-1, to=2-1]
		\arrow[no head, from=1-2, to=2-2]
		\arrow[no head, from=1-4, to=2-4]
		\arrow[no head, from=1-5, to=2-5]
		\arrow["\varphi", no head, from=1-6, to=2-6]
	\end{tikzcd}\]
	Notably, all the $\mf q_i$ are distinct because $\varphi^{-1}\mf q_i=\mf p_i$ are all distinct. Because we have exhibited a chain of distinct primes descending from $\mf q$ of length $r$, \autoref{lem:codimisdescend} promises $\codim\mf q\ge r$. This finishes.
\end{proof}
\begin{remark}
	At a high level, we have codified the notion that flat means continuously varying fibers: the dimension of the fiber $S/\mf mS$ over the ``point'' $\mf m\in\op{Spec}R$ must be $\dim S-\dim R$ and therefore is constant!
\end{remark}
Let's see an example of failed equality.
\begin{exe}
	Consider $S:=k[x,y,z,w]/(xw-yz)$ to be the ring of singular matrices, as an algebra over $R:=k[x,y]$. Further, set $\mf n:=(x,y,z,w)\subseteq S$ (which is maximal by \autoref{lem:pullmax}) so that we take $\mf m=(x,y)\subseteq R$. We track through the dimensions of \autoref{prop:ranknullity} at $\mf n$.
\end{exe}
\begin{proof}
	Let $\varphi:R\to S$ be the natural map by lifting $\id_k$ via $x\mapsto x$ and $y\mapsto y$. Very quickly, note that $\varphi^{-1}\mf n=\mf m$, as claimed: if we have some element map into $\mf n$ as
	\[\varphi\left(\sum_{i,j=0}^\infty a_{i,j}x^iy^j\right)=\sum_{i,j=0}^\infty a_{i,j}x^iy^j\in\mf n=(x,y,z,w),\]
	then we see $a_{0,0}\in\mf n$ because all higher terms certainly live in $\mf n$. But the only constant in $\mf n$ is $0$ because all nonzero constants are units, and $\mf n$ is a proper ideal.

	We now run the following computations.
	\begin{itemize}
		\item Using \autoref{lem:dimiscodim}, we see $\dim R_\mf m=\codim\mf mR_\mf m$, which equals $\codim\mf m=2$ by \autoref{lem:localizedim}: notably, $\mf m$ is the minimal prime over the principal ideal $(x,y)$, so $\codim\mf m\le2$ by \autoref{thm:pit}. But we also have the chain of primes
		\[(0)\subseteq(x)\subseteq(x,y)\]
		to witness $\codim\mf m\ge2$ by \autoref{lem:codimisdescend}.
		\item Note that
		\[\frac S{\mf mS}=\frac{k[x,y,z,w]/(xw-yz)}{(x,y)k[x,y,z,w]/(xw-yz)}\cong\frac{k[x,y,z,w]}{(x,y)+(xw-yz)}=\frac{k[x,y,z,w]}{(x,y)}\cong k[w,z].\]
		Now, localizing at $\mf n$ preserves quotients because localization is flat, so
		\[\frac{S_\mf n}{\mf mS_\mf n}\cong\frac{S}{\mf mS}\otimes_SS_\mf n\cong k[w,z]\otimes_SS_\mf n=k[w,z]_\mf n.\]
		Now, the $S$-action on $k[w,z]$ descends into an action by $k[x,y,z,w]/(x,y)=k[z,w]$, so localizing at $\mf n$ is essentially localizing at $(x,y)$. However, we now see that $\dim S_\mf n/\mf mS_\mf n=\dim k[z,w]_{(z,w)}=2$ by exactly the computation of the previous point.
		\item Note that $xw-yz\in k[x,y,z,w]$ is an irreducible by \autoref{ex:dettwo}, so $(xw-yz)$ is a prime ideal because $k[x,y,z,w]$ is a unique factorization domain. In particular,
		\[(0)\subseteq(xw-yz)\]
		forces $\codim(xw-yz)\ge1$ by \autoref{lem:codimisdescend} while $\codim(xw-yz)\le1$ by \autoref{thm:pit1} (note $(xw-yz)$ is the minimal prime over $(xw-yz)$). Thus, $\codim(xw-yz)=1$, so \autoref{prop:upperbounddimension} gives
		\[\dim(xw-yz)+\codim(xw-yz)\le\dim k[x,y,z,w]=4,\]
		forcing $\dim S=\dim(xw-yz)\le4-1=3$. In particular, using \autoref{prop:upperbounddimension} tells us
		\[\dim S_\mf n=\codim\mf n\le\dim S=3.\]
	\end{itemize}
	In total, we see that
	\[\dim S_\mf n\le3<2+2=\dim R_\mf m+\dim S_\mf n/\mf mS_\mf n,\]
	which is what we wanted.
\end{proof}
\begin{remark}
	The above showed that the dimension of the fiber of $S$ over $(x,y)=(0,0)$ is $2$, but ``in general'' the dimension over a fiber should be $1$. Indeed, if $(a,b)\ne(0,0)$, then
	\[\frac S{(x-a,y-b)S}\cong\frac{k[x,y,z,w]}{(x-a,y-b)+(xw-yz)}\cong\frac{k[x,y,z,w]}{(x-a,y-b,aw-bz)}\cong k[w],\]
	where in the last step we send $x\mapsto a$, send $y\mapsto b$, and send $w\mapsto b/a\cdot z$ if $a\ne0$ or $z\mapsto a/b\cdot w$ if $b\ne0$. So indeed, our fibers do not vary continuously, so we see that $S$ should not be flat.
\end{remark}

\subsection{Consequences of the Rank--Nullity Theorem}
As a quick corollary, we show the other side of ``dimension is a local property'': dimension is preserved by completion.
\begin{corollary} \label{cor:completedim}
	Fix a Noetherian local ring $R$ with maximal ideal $\mf m$. Then $\dim R=\dim\widehat R$.
\end{corollary}
\begin{proof}
	To start, we set $\iota:R\to\widehat R$ to be the natural inclusion. Note that $\widehat R$ is local with maximal ideal $\widehat{\mf m}$ by \autoref{lem:completeislocal}, and we note that
	\[\iota{\mf m}\subseteq\mf m\widehat R=\widehat{\mf m},\]
	where the last equality is by \autoref{prop:getbetterinducedfiltration}. So we see that $\iota$ is indeed a good map of local rings.

	Continuing, we note that $\widehat R$ is flat as an $R$-algebra by \autoref{thm:completetensor}, so \autoref{prop:ranknullityflat} promises
	\[\dim\widehat R=\dim R+\dim\widehat R/\widehat{\mf m}.\]
	However, $\widehat R/\widehat{\mf m}\cong R/\mf m$ by definition of $\widehat{\mf m}$, so we conclude $\dim\widehat R/\widehat{\mf m}=\dim R/\mf m=0$ because $R/\mf m$ is a field (all primes are maximal because all proper ideals are $(0)$). It follows
	\[\dim\widehat R=\dim R,\]
	which is what we wanted.
\end{proof}
And here is another corollary: we are finally able to compute the dimension of polynomial rings.
\begin{proposition} \label{prop:polyringdimension}
	Fix a Noetherian ring $R$ with finite dimension. Then $\dim R[x]=\dim R+1$.
\end{proposition}
\begin{proof}
	We split the proof into two parts. For brevity, set $r:=\dim R$.
	\begin{itemize}
		\item We start by showing $\dim R[x]\ge r+1$; we do this by manually constructing a chain of primes of length $r+1$. Well, because $r=\dim R$, we may pick up a chain
		\[\mf p_0\subsetneq\mf p_1\subsetneq\cdots\subsetneq\mf p_r.\]
		Lifting these to $R[x]$, we get the chain
		\[\mf p_0R[x]\subseteq\mf p_1R[x]\subseteq\cdots\subseteq\mf p_rR[x].\]
		The point is to show that this is a distinct chain of primes in $R[x]$, and then we'll add $\mf p_rR[x]+(x)$ to the end.
		
		Note that these ideals $\mf p_iR[x]$ are prime because, for any prime $\mf p\subseteq R$, we have
		\[\frac{R[x]}{\mf pR[x]}\cong(R/\mf p)[x],\]
		where the isomorphism is by lifting the natural projection map $R\onto R/\mf p$ via $x\mapsto x$. (Surjectivity of this morphism $R[x]\to(R/\mf p)[x]$ is clear. The kernel consists of all elements of $R[x]$ all of whose coefficients live in $\mf p$, which is $\mf pR[x]$.) Now, $(R/\mf p)[x]$ is a polynomial ring over an integral domain and hence is an integral domain, so we conclude $\mf pR[x]$ is indeed prime.
	
		Further, the primes $\mf p_iR[x]$ are distinct because passing $\mf p_iR[x]$ through the map $R[x]\to R$ evaluating $x\mapsto0$ recovers the constant terms in $\mf p_iR[x]$, which is simply $\mf p_i$. So the map $\mf p\mapsto\mf pR[x]$ has a left inverse and hence must be injective. So we indeed have the chain of distinct primes
		\[\mf p_0R[x]\subsetneq\mf p_1R[x]\subsetneq\cdots\subsetneq\mf p_rR[x]\]
		of length $r$ in $R[x]$.

		Lastly, we note that $\mf p_rR[x]+(x)$ is a prime ideal because
		\[\frac{R[x]}{\mf p_rR[x]+(x)}\cong R/\mf p_r,\]
		where the isomorphism is by lifting $R\mapsto R/\mf p_r$ with $x\mapsto0$; in other words, we extract the constant term and take it$\pmod{\mf p_r}$. Certainly this map is surjective (everyone in $R$ is eligible to be a constant term), and $\mf p_rR[x]+(x)$ lives in its kernel; conversely, the kernel consists exactly of the elements with constant term in $\mf p_r$, which is $\mf p_r+(x)=\mf p_rR[x]+(x)$.

		However, note $\mf p_rR[x]\subsetneq\mf p_rR[x]+(x)$ because $x\notin\mf p_rR[x]$ (the coefficient of $x$ is $1$, which is not in $\mf p_r$) while $x\in\mf p_rR[x]+(x)$. As such, we have a chain of distinct primes
		\[\mf p_0R[x]\subsetneq\mf p_1R[x]\subsetneq\cdots\subsetneq\mf p_rR[x]\subsetneq\mf p_rR[x]+(x)\]
		of length $r+1$ in $R[x]$. Thus, $\dim R[x]\ge r+1=\dim R+1$.
		
		\item We show $\dim R[x]\le\dim R+1$ by \autoref{prop:ranknullity}. Well, suppose that we have a chain of primes
		\[\mf q_0\subsetneq\mf q_1\subsetneq\cdots\subsetneq\mf q_d\label{eq:polychain}\tag{$*$}\]
		for some $d$; we will show that $d\le r+1$, which will be enough. Note that, if $\mf q_d$ is not a maximal ideal, then we can place $\mf q_d$ inside a maximal ideal $\mf n$ and then replace $\mf q_d$ with $\mf n$ because we still have $\mf q_{d-1}\subsetneq\mf q_d\subseteq\mf n$. Notably, we still have a chain of distinct primes of length $d$, and we'll still show $d\le r+1$.

		As such, we can assume that $\mf n:=\mf q_d$ is a maximal ideal. Very quickly, note that we have the natural map $\iota:R\into R[x]$, and we note $\iota^{-1}\mf n$ (i.e., $\mf n\cap R$) is a maximal ideal: certainly $\iota^{-1}\mf n$ is prime and hence proper. On the other hand, if
		\[\iota^{-1}\mf n\subseteq I\subsetneq R,\]
		then $I=\iota^{-1}\mf n+I$ still does not contain $1_R$, so $\mf n+IR[x]$ still cannot $1_R$ because the constant terms of $\mf n+IR[x]$ are precisely $\iota^{-1}\mf n+I$. So $\mf n+IR[x]$ is a proper ideal containing $\mf mf n$, so $\mf n+IR[x]=\mf n$, so $IR[x]\subseteq\mf n$, so $I\subseteq\iota^{-1}\mf n$, so $\iota^{-1}\mf n=I$.

		Thus, we set $\mf m:=\iota^{-1}\mf n$ and so $\iota\mf m\subseteq\mf n$. Localizing, we see that \autoref{prop:ranknullity} promises
		\[\dim R[x]_\mf n\le\dim R_\mf m+\dim R[x]_\mf n/(\mf mR_\mf m)R[x]_\mf n.\]
		We now compute each of these terms.
		\begin{itemize}
			\item Note that $\dim R[x]_\mf n=\codim\mf n=\codim\mf q_d\ge d$ from \autoref{eq:polychain}.
			\item Note that $\dim R_\mf m=\codim\mf m\le\dim R=r$ by \autoref{prop:upperbounddimension}.
			\item Lastly, we compute $\dim R[x]_\mf n/(\mf mR_\mf m)R[x]_\mf n$. Intuitively, this is a localization of $R[x]/\mf mR[x]$, which is $(R/\mf m)[x]$, which is a polynomial ring over a field and hence a principal ideal domain (while not a field) and therefore has dimension $1$.
			
			Rigorizing this computation is quite annoying, so we will be a little terse. Note that $\mf n/\mf mR[x]$ is a maximal ideal of $R[x]/\mf mR[x]$ by \autoref{lem:pullmax}, and so $\mf n/\mf mR[x]$ will go to a maximal ideal $\mf n'$ under the isomorphism
			\[\frac{R[x]}{\mf mR[x]}\cong(R/\mf m)[x],\]
			induced by $R\onto R/\mf m$ and $x\mapsto x$. Thus, we compute
			\[\dim\left(\frac{R[x]}{\mf mR[x]}\right)_{\mf n/\mf mR[x]}=\dim\big((R/\mf m)[x]\big)_{\mf n'}=1,\]
			where the last equality is because $\mf n'$ is a nonzero prime of the principal ideal domain $(R/\mf m)[x]$.

			So to finish, we claim that
			\[\frac{R[x]_\mf n}{(\mf mR_\mf m)R[x]_\mf n}\cong\left(\frac{R[x]}{\mf mR[x]}\right)_{\mf n/\mf mR[x]}.\]
			This will finish because it shows that $\dim R[x]_\mf n/(\mf mR_\mf m)R[x]_\mf n=1$.
			
			We manually exhibit maps in both directions. In one direction, we have a map
			\[R[x]\to\frac{R[x]}{\mf mR[x]}\to\left(\frac{R[x]}{\mf mR[x]}\right)_{\mf n/\mf mR[x]}\]
			sending $p(x)$ to $\frac{[p(x)]_{\mf mR[x]}}1$ and in particular all elements of $R[x]\setminus\mf n$ to a unit (notably, $\mf mR[x]\subseteq\mf n$, so this localization is legal), so we get an induced map from $R[x]_\mf n$ by the universal property. By definition, we can see that $(\mf mR_\mf m)R[x]_\mf n$ will end up in the kernel, so we get an induced map
			\[\varphi:\frac{R[x]_\mf n}{(\mf mR_\mf m)R[x]_\mf n}\to\left(\frac{R[x]}{\mf mR[x]}\right)_{\mf n/\mf mR[x]}\]
			by sending
			\[\varphi:\left[\frac{p(x)}{q(x)}\right]_{\mf mR_\mf mR[x]_\mf n}\mapsto\frac{[p(x)]_{\mf mR[x]}}{[q(x)]_{\mf mR[x]}}.\]
			In the other direction, we note that we have a map
			\[R[x]\to R[x]_\mf n\to\frac{R[x]_\mf n}{(\mf mR_\mf m)R[x]_\mf n}\]
			sending $p(x)$ to $\left[\frac{p(x)}1\right]_{(\mf mR_\mf m)R[x]_\mf n}$. In particular, we can see that any element of $\mf mR[x]$ goes to $0$ immediately, so we get an induced map from $R[x]/\mf mR[x]$. However, we see further that any $[p]\notin\mf n/\mf mR[x]$ will go to a unit because it's mapping to $\frac{p(x)}1$, which is a unit in $R[x]_\mf n$ with inverse $\frac1{p(x)}$. As such, we get an induced map
			\[\psi:\left(\frac{R[x]}{\mf mR[x]}\right)_{\mf n/\mf mR[x]}\to\frac{R[x]_\mf n}{(\mf mR_\mf m)R[x]_\mf n}\]
			by sending
			\[\psi:\frac{[p(x)]_{\mf mR[x]}}{[q(x)]_{\mf mR[x]}}\mapsto\left[\frac{p(x)}{q(x)}\right]_{\mf mR_\mf mR[x]_\mf n}\]
			Tracking through $\varphi$ and $\psi$ shows that they are inverse essentially immediately, so we get our isomorphism.
		\end{itemize}
		Plugging in, we see that
		\[d\le r+1,\]
		which is what we wanted.
	\end{itemize}
	The above inequalities finish the proof.
\end{proof}
\begin{corollary} \label{cor:affinedim}
	For a field $k$, we have $k[x_1,\ldots,x_n]=n$.
\end{corollary}
\begin{proof}
	This follows by induction on $n$. For $n=0$, we are showing that $\dim k=0$, which follows because all prime ideals are maximal because all proper ideals are $(0)$ in a field. Then the inductive step is \autoref{prop:polyringdimension} because we compute
	\[\dim k[x_1,\ldots,x_{n+1}]=\dim k[x_1,\ldots,x_n]+1=n+1\]
	by induction.
\end{proof}

\subsection{Dimension for Modules}
We now add a notion of Krull dimension for modules.
\begin{definition}[Krull dimension, modules]
	Given an $R$-module $M$, we define the \textit{dimension} of $M$ as $\dim M:=\dim R/\op{Ann}M$.
\end{definition}
As in the case of Artinian rings, it will be useful to be more closely monitor the dimension-$0$ case.
\begin{definition}[Colength]
	Fix an ideal $\mf q\subseteq R$. Then $\mf q$ \textit{has finite colength} on a module $M$ if and only if $M/\mf qM$ has finite length. We might also say that $\mf q$ is a \textit{parameter ideal}.
\end{definition}
% To continue our discussion, we need to review a little theory on modules of finite length.
% \begin{proposition}
% 	Fix a Noetherian ring $R$ and a finitely generated module $M$. Then the following are equivalent.
% 	\begin{listalph}
% 		\item $M$ has finite length.
% 		\item A product of maximal ideals in $M$ annihilates $R$.
% 		\item $R/\op{Ann}M$ is Artinian.
% 	\end{listalph}
% \end{proposition}
% \begin{proof}
% 	We show our implications in sequence.
% 	\begin{itemize}
% 		\item Suppose $M$ has finite length. Then \autoref{thm:finitelengthdecomp} tells us that $M$ is the direct sum of its localizations $M_\mf p$, where 
% 	\end{itemize}
% \end{proof}
We have the following check.
\begin{lemma} \label{lem:finitecolengthcheck}
	Fix a Noetherian local ring $R$ with maximal ideal $\mf m$, and let $M$ be a finitely generated $R$-module. Then an $R$-ideal $\mf q\subseteq R$ has finite colength if and only if there exists an integer $n$ so that
	\[\mf m^n\subseteq\mf q+\op{Ann}M.\]
\end{lemma}
\begin{proof}
	For motivation, we quickly check that $M'\coloneqq M/\mf m^nM$ has finite length for all $n$. The main intermediate claim is that $R/\op{Ann}M'$ is Artinian; by \autoref{thm:artingrabbag}, it suffices to show that all primes of $R$ containing $\op{Ann}M'$ are maximal. However, a prime $\mf p$ containing $\op{Ann}M'$ contains $\mf m^n$ and hence contains $\mf m$ and hence $\mf p=\mf m$ is maximal.

	But now, again using \autoref{thm:artingrabbag}, we note that $R/\op{Ann}M'$ has finite length as a ring but also as an $R$-module because the $R/\op{Ann}M'$-action is the same as the $R$-action. So because $M'$ is finitely generated as an $R$-module but really as an $R/\op{Ann}M'$-module (again, the actions match, so we might as well mod out by $\op{Ann}M'$), we have a surjection of $R$-modules
	\[(R/\op{Ann}M')^n\onto M'\]
	for some $n$. It follows from \autoref{prop:finlengthses} that $M'$ has finite length.

	We now show the two directions independently.
	\begin{itemize}
		\item Suppose there exists some $n$ for which $\mf m^n\subseteq\mf q+\op{Ann}M$. Then we have the surjection
		\[M/\mf m^nM\onto\frac{M}{(\mf q+\op{Ann}M)M}\to0.\]
		It follows by \autoref{prop:finlengthses} that $M/(\mf q+\op{Ann}M)M=M/\mf qM$ has finite length; notably, $(\mf q+\op{Ann}M)M=\mf qM$ because $\op{Ann}M$ merely annihilates all of $M$.
		\item Conversely, suppose that $M/\mf qM$ has finite length; the idea is to use the Krull intersection theorem. In particular, \autoref{thm:krullintersect} grants us $r\in\mf m$ such that
		\[(1-r)\cdot\left(\bigcap_{s\ge0}\mf m^s(M/\mf qM)\right)=0.\]
		However, $1-r$ is a unit because $R$ is local and $\mf m$ is its unique maximal ideal, so we conclude
		\[\bigcap_{s\ge0}\mf m^s(M/\mf qM)=0.\]
		Now, $\mf m^s(M/\mf qM)$ is a descending chain of submodules, which must stabilize because $M/\mf qM$ has finite length. But this stabilization must be $0$ because of the above intersection, so we conclude that there exists some $n\in\NN$ for which
		\[\mf m^n\cdot(M/\mf qM)=0.\]
		So we are done upon noting that the annihilator of $M/\mf qM$ is $\mf q+\op{Ann}M$, so $\mf m^n\subseteq\mf q+\op{Ann}M$.
	\end{itemize}
	The above implications complete the proof.
\end{proof}
As usual, our notion of size behaves in short exact sequences.
\begin{proposition}
	Fix a Noetherian ring $R$ and pick up a short exact sequence of $R$-modules
	\[0\to A\to B\to C\to 0.\]
	If $\mf q$ has finite colength on $A$ and $C$, then $\mf q$ has finite colength on $B$.
\end{proposition}
\begin{proof}
	Tensoring the given short exact sequence with $R/\mf q$, we get the right-exact sequence
	\[A/\mf qA\to B/\mf qB\to C/\mf qC\to 0.\]
	For concreteness, let the last map be $\pi\colon B/\mf qB\to C/\mf qC$. Then $A/\mf qA$ surjects onto $\ker\pi$ by the exactness above, so because $A/\mf qA$ has finite length, \autoref{prop:finlengthses} tells us that $\ker\pi$ has finite length. But then the short exact sequence
	\[0\to\ker\pi\to B/\mf qB\stackrel\pi\to C/\mf qC\]
	tells us that $B/\mf qB$ has finite length by \autoref{prop:finlengthses} again.
\end{proof}
The punchline of defining finite colength is the following result.
\begin{proposition} \label{prop:generatorsdimension}
	Fix a Noetherian local ring $R$ with maximal ideal $\mf m$ and an $R$-module $M$. Then $\dim M$ is equal to the minimal $d$ such that there is some proper ideal $(f_1,\ldots,f_d)\subseteq R$ with finite colength on $M$.
\end{proposition}
\begin{proof}
	The point is to use \autoref{prop:betterlocaldim}. Namely, the dimension of the module $M$ is equal to the dimension of the ring $R/\op{Ann}M$. Now, $R/\op{Ann}M$ is still local with maximal ideal $\mf m/\op{Ann}M$, so its dimension by \autoref{prop:betterlocaldim} is the smallest $d$ for which there is a proper $R$-ideal with
	\[\mf m^n/\op{Ann}M\subseteq(f_1,\ldots,f_d)\subseteq\mf m\]
	for some $n$. Equivalently, we are asking for
	\[\mf m^n\subseteq(f_1,\ldots,f_d)+\op{Ann}M,\]
	which by \autoref{lem:finitecolengthcheck} is equivalent to $(f_1,\ldots,f_d)$ having finite colength on $M$.
\end{proof}
\begin{proposition} \label{prop:killoneelement}
	Fix a local ring $R$ with maximal ideal $\mf m$ and an $R$-module $M$. Given $x\in\mf m$, we have
	\[\dim M/xM\ge\dim M-1.\]
\end{proposition}
\begin{proof}
	The point is to use \autoref{prop:generatorsdimension} twice. Set $d\coloneqq\dim M/xM$ and will show
	\[\dim M\stackrel?\le d+1.\]
	Now, \autoref{prop:generatorsdimension} grants us a proper ideal $(f_1,\ldots,f_d)$ with finite colength on $M/xM$. Namely,
	\[\frac{M/xM}{(f_1,\ldots,f_d)\cdot M/xM}\cong\frac M{\big((f_1,\ldots,f_d)+(x)\big)M}=\frac M{(f_1,\ldots,f_d,x)M}\]
	has finite length. However, using \autoref{prop:generatorsdimension} again, we see that $\dim M$ is then at most $d+1$. This finishes.
\end{proof}

\subsection{Regular Rings}
We close class by defining regular.
\begin{definition}[Regular]
	Fix a local ring $R$ of dimension $d\coloneqq\dim R$. Further, let $\mf m$ be the maximal ideal of $R$. Then $R$ is \textit{regular} if and only if there exist elements $\{f_1,\ldots,f_d\}\subseteq R$ such that
	\[\mf m=(f_1,\ldots,f_d).\]
\end{definition}
In particular, because $R$ is local, $\codim\mf m=\dim R$ (see \autoref{lem:dimiscodim}), so \autoref{cor:pitconverse} tells us that $\mf m$ is at least a minimal prime over some ideal generated by $d$ elements. The regularity condition strengthens being minimal over to having a full equality.

Here are some examples.
\begin{example}
	Fix $R:=k[x_1,\ldots,x_d]_{\mf m}$, where $\mf m=(x_1,\ldots,x_d)$. Then $R$ is regular because $\dim R=d$. To see that $\dim R=d$, note on one hand that
	\[\dim R=\codim\mf m\le\dim k[x_1,\ldots,x_d]=d.\]
	On the other hand,
	\[(0)\subsetneq(x_1)\subsetneq(x_1,x_2)\subsetneq\cdots\subsetneq(x_1,\ldots,x_d)\]
	is a chain of distinct primes in $R$ by \autoref{thm:localizedprimes}, so $\dim R\ge d$.
\end{example}
\begin{example}
	The completion $R\coloneqq k\bb{x_1,\ldots,x_n}$ is regular. Here, $\dim R=d$ by \autoref{cor:completedim} and \autoref{cor:affinedim}, and our maximal ideal is
	\[(x_1,\ldots,x_d),\]
	which is indeed generated by $d$ elements.
\end{example}
\begin{example}
	Any local principal ideal domain $R$ which is not a field has dimension $1$, and the maximal ideal also is generated by one element (because the ring is principal), so $R$ is regular.
\end{example}
Let's get some practice with this definition.
\begin{prop} \label{prop:reglocaldimisdim}
	Let $R$ be a regular local ring with maximal ideal $\mf m$. Then
	\[\dim_{R/\mf m}\mf m/\mf m^2=\dim R.\]
\end{prop}
\begin{proof}
	As some quick type-checking, note that $\mf m/\mf m^2$ is in fact annihilated by $\mf m$ (namely, $\mf m\cdot \mf m/\mf m^2=0$), so it is an $R/\mf m$-vector space. We now show two inequalities to finish the proof.
	\begin{itemize}
		\item We show $\dim_{R/\mf m}\mf m/\mf m^2\le\dim R$. For brevity, set $d\coloneqq\dim R$. Here we use the fact that $R$ is regular: by definition, we can find $f_1,\ldots,f_d\in\mf m$ so that
		\[\mf m=(f_1,\ldots,f_d).\]
		In particular, the $f_\bullet$ generate $\mf m$ as an $R$-module, so it follows that they span $\mf m/\mf m^2$ as an $R$-module as well. But the $R$-action descends to an $R/\mf m$-action, so the $f_\bullet$ provide a spanning set of $d$ elements.
		\item We show $\dim_{R/\mf m}\mf m/\mf m^2\ge\dim R$. For brevity, set $d'\coloneqq \dim_{R/\mf m}\mf m/\mf m^2$ so that we can find a basis
		\[\left\{f_1+\mf m^2,\ldots,f_{d'}+\mf m^2\right\}\]
		for $\mf m/\mf m^2$. Thus, \autoref{cor:quotientdimension} (applied to the $R$-module $\mf m$) tells us that these elements $f_1,\ldots,f_{d'}$ will generate $\mf m$, giving
		\[\mf m=(f_1,\ldots,f_{d'}),\]
		It follows from \autoref{thm:pit} that $\dim R=\codim\mf m\le d'$, which is what we wanted.
	\end{itemize}
	The above inequalities establish that $\dim_{R/\mf m}\mf m/\mf m^2=\dim R$, finishing the proof.
\end{proof}
And here is a last result.
\begin{proposition}
	A regular local ring is an integral domain.
\end{proposition}
\begin{proof}
	Let $R$ be a regular local ring with maximal ideal $\mf m$. We proceed by induction on $\dim R$. If $\dim R=0$, then $\mf m$ is generated by zero elements, so $\mf m=(0)$, so $(0)$ is maximal and hence prime, so $R$ is an integral domain.

	Now, for the inductive step, suppose that $d\coloneqq\dim R>0$. The idea is to reduce to use the inductive hypothesis on some suitable quotient $R/(x)$. We do this construction and application in steps.
	\begin{enumerate}
		\item Because $\codim\mf m=d>0$ (see \autoref{lem:dimiscodim}), we see that $\mf m$ is not a minimal prime (over $(0)$).
	
		We now use prime avoidance to conjure our desired $x\in R$: by \autoref{prop:finminprimes}, we see that there are finitely many minimal primes, and $\mf m$ strictly contains all of these. Additionally, $\mf m^2\ne\mf m$ because $\mf m^2=\mf m$ would imply $\mf m=0$ by \autoref{thm:nakayama} and hence $\dim R=0$. In total, \autoref{lem:primeavoidance} promises us some $xin\mf m$ which does not live in any minimal prime nor in $\mf m^2$.
		
		\item As such, $\dim(x)<d$ (using \autoref{lem:dimisascend}) because any chain of primes
		\[(x)\subseteq\mf p_0\subsetneq\mf p_1\subsetneq\cdots\subsetneq\mf p_{d'}\]
		cannot have $\mf p_0$ a minimal prime, so there is some prime $\mf p_{-1}$ strictly contained in $\mf p_0$. This gives us a chain of $d'+1$ distinct primes in $R$, so $d'\le d-1<d$, so $\dim(x)<d$ follows.
	
		\item Thus, $\dim R/(x)<\dim R$. We would therefore like to apply the inductive hypothesis to $R/(x)$, but we need to know that $R/(x)$ is regular. To start, we note that $R/(x)$ is local with maximal ideal $\mf m/(x)$, which we need to provide generators for. How many generators? Well, we note \autoref{prop:killoneelement} tells us that
		\[\dim R/(x)\ge\dim R-1\]
		where dimension is as $R$-modules, but $R/(x)$-ideals are the same as the $R$-submodules of $R/(x)$, so we might as well compute these dimensions as rings. As such, we get that $\dim R/(x)=\dim R-1$.
	
		\item To show $R$ is regular, we now need to generate $\mf m/(x)$ by $d-1$ elements. To get our generators, we cheat by using Nakayama's lemma. In particular, by \autoref{cor:quotientdimension}, it suffices to generate
		\[\frac{\mf m/(x)}{\mf m/(x)\cdot\mf m/(x)}=\frac{\mf m/(x)}{\mf m\cdot\mf m/(x)}=\frac{\mf m/(x)}{\mf m^2/(x)}\cong\frac{\mf m}{\mf m^2+(x)}\]
		by $d-1$ elements. However, $\dim_{R/\mf m}\mf m^2/\mf m=d$ by \autoref{prop:reglocaldimisdim}, and
		\[\frac{\mf m}{\mf m^2}\onto\frac{\mf m}{\mf m^2+(x)}\]
		is a map with nontrivial kernel---namely, $x+\mf m^2$ lives in the kernel, and $x\notin\mf m^2$ by construction (!). Thus,
		\[\dim_{R/\mf m}\frac{\mf m}{\mf m^2+(x)}<\dim\frac{\mf m}{\mf m^2}=d,\]
		so we can in fact generate $\mf m/\left((x)+\mf m^2\right)$ by strictly fewer than $d$ elements and hence by $d-1$ elements (by just choosing some large spanning set).
	\end{enumerate}
	From the above construction, $R/(x)$ is in fact a regular local ring of dimension $d-1$ and hence an integral domain by the inductive hypothesis. We now show that $R$ is an integral domain by showing that $(0)\subseteq R$ is prime. Certainly $(x)$ contains some minimal prime $\mf q$ because $x$ was chosen outside all minimal primes. As such, we claim that
	\[\mf q\stackrel?=(x)\cdot\mf q,\]
	which will show $\mf q=(0)$ by \autoref{thm:nakayama} finishing. Certainly $(x)\cdot\mf q\subseteq\mf q$. In the other direction, any $y\in\mf q\subseteq(x)$ can be written as $y=ax$ for some $a\in R$, but $ax\in\mf q$ with $x\notin\mf q$ (recall $x$ is outside all minimal primes), we conclude $a\in\mf q$, so $y\in (x)\mf q$.
\end{proof}