% !TEX root = ../notes.tex

\documentclass[../notes.tex]{subfiles}

\begin{document}

The midterm is next week. It will be about four questions. More information will be sent out soon.

\subsection{Null Sets}
Sard's theorem will tell us that most values are regular values. In particular, we will show that critical values have measure zero. The notion of measure zero will be glued together from charts.
\begin{definition}[null set]
	A subset $A\subseteq\RR^n$ has \textit{measure zero} or is a \textit{null set} if and only if any $\varepsilon>0$ has some countable list of balls $\{B(x_i,r_i)\}_{i\ge1}$ such that
	\[A\subseteq\bigcup_{i\ge1}B(x_i,r_i)\qquad\text{and}\qquad\sum_{i=1}^\infty r_i^n<\varepsilon.\]
\end{definition}
\begin{example}
	According to the above definition, any countable subset is a null set, even if we are in $\RR^0$.
\end{example}
The point of the $r_i^n$ is that it is the volume of $B(x_i,r_i)$, up to a constant, so we are saying that $A$ can be covered by sets of arbitrarily small measure.

Here are some quick checks.
\begin{lemma} \label{lem:null-set-checks}
	Fix a positive integer $n$.
	\begin{listalph}
		\item If $A\subseteq\RR^n$ is a null set and $B\subseteq A$, then $B$ is a null set.
		\item If $\{A_j\}_{j\ge1}$ is a countable collection of null sets, then $\bigcup_{i=1}^\infty A_i$ is a null set.
		\item If $A\subseteq\RR^n$ makes $A\cap\left(\{c\}\times\RR^{n-1}\right)\subseteq\{c\}\times\RR^{n-1}$ into a null set for each $c\in\RR$, then $A$ is a null set.
		\item If $f\colon U\to\RR$ is a continuous function with $U\subseteq\RR^{n-1}$, then the graph
		\[\Gamma(f)\coloneqq\left\{(x,f(x)):x\in U\right\}\]
		is a null set.
		\item Every nontrivial affine subspace of $\RR^n$ (not equal to $\RR^n$) is a null set.
		\item If $A\subseteq\RR^n$ is a null set, then $\RR^n\setminus A$ is dense.
		\item A subset $A\subseteq\RR^n$ is a null set if and only if each $p\in A$ has some open neighborhood $U_p\subseteq\RR^n$ such that $A\cap U_p$ is a null set.
		\item If a subset $A\subseteq\RR^n$ is a null set, and a function $F\colon A\to\RR^n$ is Lipschitz, then $F(A)$ is a null set.
		\item Let $S\subseteq\RR^n$ be a submanifold of positive codimension. Then $S$ has measure zero.
	\end{listalph}
\end{lemma}
\begin{proof}
	Here we go.
	\begin{listalph}
		\item For any $\varepsilon>0$, use the countable list $\{B(x_i,r_i)\}_{i\ge1}$ such that
		\[A\subseteq\bigcup_{i\ge1}B(x_i,r_i)\qquad\text{and}\qquad\sum_{i=1}^\infty r_i^n<\varepsilon.\]
		Indeed, the same conclusion will hold for $B\subseteq A$.
		\item Fix $\varepsilon>0$. For each $j$, build a countable list $\{B(x_{ij},r_{ij})\}_{i\ge1}$ such that
		\[A_j\subseteq\bigcup_{i\ge1}B(x_{ij},r_{ij})\qquad\text{and}\qquad\sum_{i=1}^\infty r_{ij}^n<\frac{\varepsilon}{2^j}.\]
		Then zipper the countable lists together to cover the union, and the total measure is bounded above by $\sum_{j=1}^\infty\varepsilon/2^j=\varepsilon$.
		\item Use Fubini's theorem, integrating over $c\in\RR$. Explicitly, now using some heavier measure theory,
		\[\mu(A)=\int_{\RR^n}1_A(x)\,dx=\int_\RR\int_{\RR^{n-1}}1_A(c,x)\,dx\,dc=\int_\RR0\,dc=0.\]
		\item Apply the previous part, slicing by the last coordinate inductively.
		\item Apply the previous part because an affine subspace is the image of a linear map composed with a translation.
		\item If $\RR^n\setminus A$ fails to be dense, then there is an open subset in the complement of $\RR^n\setminus A$, so $A$ contains an open ball, so $A$ cannot be a null set.
		\item The forward direction is immediate by taking subsets. Looping over all $p\in\RR^n$ produces an open cover of $\RR^n$, which can be reduced to a countable cover by a compactness argument of closed balls. Then we see that $A$ is a countable union of null sets and hence a null set.
		\item For $\varepsilon>0$, cover $A$ with open balls of measure smaller than $\varepsilon$. Passing the open balls through $F$ (with Lipschitz constant $K$) will have image contained in an open ball with $K$ times the radius. So we have bounded the measure of $A$ by $K^n\varepsilon$, up to some constants, which vanishes as $\varepsilon\to0^+$.
		\item Use $k$-slice charts to realize $S^k$ locally as a slice chart, which have measure zero. Notably, if $A\subseteq U$ is a null set where $U\subseteq\RR^n$ is open, and $\varphi\colon U\to\widehat U$ is a diffeomorphism to some other $\widehat U\subseteq\RR^n$, then $\varphi(A)$ continues to be a null set by using (g) to allow us to check locally and then note that diffeomorphisms are locally Lipschitz by taking the Lipschitz constant to be the norm of the Jacobian matrix.
		\qedhere
	\end{listalph}
\end{proof}
And now let's glue.
\begin{definition}[null set]
	Let $M$ be a smooth $n$-manifold. Then a subset $A\subseteq M$ is a \textit{null set} if and only if any smooth chart $(U,\varphi)$ of $M$ makes $\varphi(A\cap U)\subseteq\RR^n$ into a null set.
\end{definition}
\begin{remark}
	If $A\subseteq\RR^n$ is a null set, then actually $A$ has measure zero where we view $\RR^n$ as an $n$-manifold. The backward direction is clear because $(\RR^n,{\id_{\RR^n}})$ is a smooth chart; the forward direction follows because having measure zero is a diffeomorphism invariant as argued in (i) of \Cref{lem:null-set-checks}.
\end{remark}
\begin{remark}
	A quick argument shows that (a), (b), (f), (g), (h), and (i).
\end{remark}

\subsection{Sard's Theorem}
Recall from our examples that there simply were not many critical values; for example, see \Cref{ex:almost-submersion,ex:sphere-level-set}. This is in general true.
\begin{theorem}[Sard] \label{thm:sard}
	Fix a smooth map $F\colon M\to N$. Then the set of critical values of $F$ has measure zero.
\end{theorem}
\begin{remark}
	Here's a heuristic argument when $\dim M=\dim N$. Let $C\subseteq M$ consist of the critical points. Then one has
	\[\mu(F(c))=\int_{F(c)}1\,dy\le\int_C\left|\det dF_p(x)\right|\,dx=0,\]
	where the content is in justifying the inequality above via some change-of-variables argument.
\end{remark}
Anyway, let's start the proof.
\begin{proof}[Proof of \Cref{thm:sard}]
	Let $D\subseteq N$ be the set of critical points. By \Cref{lem:null-set-checks}, we know that it suffices to show that each $q\in N$ has some open neighborhood $U_q$ such that $D\cap U_q$ is a null set. As such, it suffices to replace $N$ with $\RR^n$ (using diffeomorphism invariance of null sets) where $n\coloneqq\dim N$, and then restrictions of $F$ by pullback mean that we may as well replace $M$ also with an open subset $U\subseteq\RR^m$ where $m\coloneqq\dim M$.

	We are going to induct on $m$. Starting with $m=0$, it means that $M$ is a $0$-manifold, so $M$ is countable, so $F(M)$ is countable, so its image has measure zero. We also note that if $n=0$, then the image is always countable and hence a null set. So we are left with the case $m,n\ge1$.

	To set up, let $C\subseteq U$ denote the critical points of $F$, and we set
	\[C_k\coloneqq\left\{p\in U:\frac{\del F_\bullet}{\del x_{i_1}\cdots\del x_{i_\ell}}\bigg|_p=0\text{ for all }\ell\le k\text{ and }i_1,\ldots,i_\ell\in\{1,\ldots,m\}\right\}.\]
	Notably, we have a chain $C\supseteq C_1\supseteq C_2\supseteq\cdots$; note all these sets are closed because taking these derivatives is continuous. The game for the proof is to show that the differences are small, and that these sets are small for large $k$. Explicitly, we find
	\[F(C)=\big(F(C\setminus C_1)\big)\cup\bigcup_{i=2}^k\big(F(C_i\setminus C_{i+1})\big)\cup F(C_{k+1})\]
	where $k$ is some large integer to be determined later. So we see that our sets divide up into three classes (as above), and we will show that each class is a null set.
	\begin{enumerate}
		\item We show that $F(C\setminus C_1)$ is a null set. Well, choose some $p\in C\setminus C_1$; we would like an open subset $U_p\subseteq U$ such that $F(C\cap U_p)$ is a null set, which will complete the argument by looping over all $p$ and then reducing to a countable cover of $C$. Because $C_1$ is closed, we may as well replace $U$ by $U\setminus C_1$, meaning that some partial derivative of $F$ fails to vanish at each point in $U$. We can cover $U$ by the open subsets where each partial derivative fails to vanish, of which there are finitely many, so we may as well assume that there's a fixed partial derivative that fails to vanish by passing to this open set. By rearranging, we may then assume that $\frac{\del F_1}{\del x_1}\ne0$, and by scaling, we'll just go ahead and take $\frac{\del F_1}{\del x_1}=1$.

		Set $y_1\coloneqq F_1$ and $y_i\coloneqq x_i$ for each $2\le i\le m$ so that the matrix of partial derivatives $\left[\frac{\del y_j}{\del x_i}\right]_{1\le i,j\le m}$ is invertible at $p$. In particular, $\Phi\coloneqq(y_1,\ldots,y_m)$ is a local diffeomorphism around $p$, so passing to an open neighborhood of $p\in U$ allows us to make $\Phi$ into a genuine diffeomorphism $\Phi\colon U\to U'$. Because $\Phi$ is a diffeomorphism, we see that showing the critical values of $F$ is a null set is then equivalent to show that the critical values of $\widetilde F\coloneqq F\circ\Phi^{-1}$ is a null set, so we will focus on $\widetilde F$.

		Now, the point of passing to $\widetilde F$ is that
		\[(F_1(x_1,\ldots,x_m),\ldots)=F(x_1,\ldots,x_m)=\left(\widetilde F\circ\Phi\right)(x_1,\ldots,x_m)=(y_1(x_1,\ldots,x_m),\ldots),\]
		so the moral of the story is that
		\[\widetilde F(x_1,\ldots,x_m)=(x_1,\ldots),\]
		where the ``$\ldots$'' simply means that we have some other functions that we haven't bothered to write out. The point is that we can compute the Jacobian of $\widetilde F$ as a block matrix
		\[\begin{bmatrix}
			1 & 0 & \cdots & 0 \\
			* & \del\widetilde F_2/\del x_2 & \cdots & \del\widetilde F_2/\del x_m \\
			\vdots & \vdots & \ddots & \vdots \\
			* & \del\widetilde F_n/\del x_2 & \cdots & \del\widetilde F_n/\del x_m
		\end{bmatrix}.\]
		The moral of the story is that surjectivity of $F$ is equivalent to surjectivity of $\widetilde F$. Now set
		\[\widetilde C_s\coloneqq C\cap\left(\{s\}\times\RR^{n-1}\right)\]
		to be the critical points of $F$ whose first coordinate is $s$. So we can integrate over $s$ to get the desired null sets, using the inductive hypothesis because we moved down in coordinates.

		\item We show that $F(C_k\setminus C_{k+1})$ is a null set. Note that $p\in C_k\setminus C_{k+1}$ must have some $(k+1)$-derivative which is nonzero, say
		\[\frac{\del^{k+1} F^j}{\del x_{i_1}\cdots\del x_{i_{k+1}}}\bigg|_p\ne0,\]
		so we set $h\coloneqq\del^kF_j/\left(\del x_{i_1}\cdots\del x_{i_{k}}\right)$ to be a function $M\to\RR$. Then $h(p)=0$ but $\frac{\del}{\del x_{k+1}}h\big|_p\ne0$. Thus, $p$ is a regular point (having nonzero derivative is enough for a map to $\RR$), so we may as well take $U_p\subseteq M$ to be the regular locus of $h$.

		In particular, we see that $h^{-1}(\{0\})\cap U_p$ is a lower-dimensional embedded submanifold $S\subseteq M$, and $C_k\cap U_p\subseteq h^{-1}(\{0\})\cap U_p$, so $F(C_k\cap U_p)$ is contained in the critical values of $F|_S\colon S\to N$, which we see has measure zero by the induction. Looping over all $p\in M$ (and then reducing $\{U_p\}_{p\in M}$ to a countable subcover), we conclude.

		\item We show that $F(C_k)$ is a null set for $k>\frac mn-1$. This is rather technical. Recall we realized $M$ as an open subset $U\subseteq\RR^m$, so we may as well show that each $p\in M$ is contained in some cube $Q\subseteq\RR^m$ such that $F(C_k\cap Q)$ is a null set. By shifting and scaling, we may as well assume that $Q=[0,1]^m$.

		Take some large $N$ to be determined later. The point is that $F$ has very slow polynomial growth on the scale of $1/N$ when living in $C_k$, made rigorous by Taylor's theorem, so we are able to bound the size of the image of $F$. Indeed, we go ahead and subdivide the cube $Q$ into the $N^m$ cubes $\{Q_{v}\}_{v\in(\ZZ\cap[0,N))^m}$ given by
		\[Q_{v}=\prod_{i=1}^m\left[\frac{v_i}N,\frac{v_i+1}N\right].\]
		Now, for each $v\in(\ZZ\cap[0,N))^m$, we bound the size of $F(Q_v)$ under the assumption that $C_k\cap Q_v$ is nonempty. Say $a\in C_k\cap Q_v$.

		So we claim that
		\[\left|F(x)-F(a)\right|\stackrel?\le C\left|x-a\right|^{k+1}\]
		for some constant $C>0$ depending only on $F$. Let's quickly see why this is enough. Indeed, it follows that the value of $F$ on $Q_v$ is contained in a cube of radius $C(1/N)^{k+1}$. But there are only $N^m$ total cubes, so the volume of our images is bounded above by
		\[N^m(1/N)^{n(k+1)},\]
		up to some unnamed constant depending only on $F$. Because $k>\frac mn-1$, sending $N\to\infty$ will complete our bound.
		
		It remains to show the bound of the previous paragraph. This follows from an analogue of Taylor's theorem. It suffices to get this bound when $F$ is valued in $\RR$ by working on each coordinate function $f\coloneqq F_\ell$ and then summing the bounds for each coordinate. (Note now that the derivatives for $f$ all vanish to the order $k$.) So now we claim more generally that
		\begin{equation}
			f(x)\stackrel?=f(a)+\sum_{i=1}^k\frac1{i!}\sum_{\substack{I\subseteq\{1,\ldots,m\}\\\#I=i}}\del_If(a)(x-a)^I+R_k(x), \label{eq:taylor-for-sard}
		\end{equation}
		where our remainder is
		\[R_k(x)\coloneqq\frac1{k!}\sum_{\substack{I\subseteq\{1,\ldots,m\}\\\#I=k+1}}(x-a)^I\int_0^1(1-t)^k\del_If(a+(t-a)x)\,dt.\]
		This is enough for our inequality because all the terms vanish except for $f(a)+R_k(x)$, and we can upper-bound our remainder by hand because these derivatives are taking place over the compact set $Q$, the integral can be bounded. One now shows \eqref{eq:taylor-for-sard} by an induction on $k$: if $k=0$, there is nothing to say (this is just the Fundamental theorem of calculus), and for the induction, one uses integration by parts to expand out $\del_If$ again.
		\qedhere
	\end{enumerate}
\end{proof}

\end{document}